begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.mapreduce
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|mapreduce
package|;
end_package

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|mock
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|when
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|never
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|verify
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|times
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|ArgumentMatchers
operator|.
name|any
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|ArgumentMatchers
operator|.
name|eq
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|URI
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileSystem
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|Path
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|FsPermission
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|DistributedFileSystem
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|SystemErasureCodingPolicies
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|mapred
operator|.
name|JobConf
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Assert
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|mockito
operator|.
name|verification
operator|.
name|VerificationMode
import|;
end_import

begin_comment
comment|/**  * A class for unit testing JobResourceUploader.  */
end_comment

begin_class
DECL|class|TestJobResourceUploader
specifier|public
class|class
name|TestJobResourceUploader
block|{
annotation|@
name|Test
DECL|method|testStringToPath ()
specifier|public
name|void
name|testStringToPath
parameter_list|()
throws|throws
name|IOException
block|{
name|Configuration
name|conf
init|=
operator|new
name|Configuration
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|JobResourceUploader
argument_list|(
name|FileSystem
operator|.
name|getLocal
argument_list|(
name|conf
argument_list|)
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Failed: absolute, no scheme, with fragment"
argument_list|,
literal|"/testWithFragment.txt"
argument_list|,
name|uploader
operator|.
name|stringToPath
argument_list|(
literal|"/testWithFragment.txt#fragment.txt"
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Failed: absolute, with scheme, with fragment"
argument_list|,
literal|"file:/testWithFragment.txt"
argument_list|,
name|uploader
operator|.
name|stringToPath
argument_list|(
literal|"file:///testWithFragment.txt#fragment.txt"
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Failed: relative, no scheme, with fragment"
argument_list|,
literal|"testWithFragment.txt"
argument_list|,
name|uploader
operator|.
name|stringToPath
argument_list|(
literal|"testWithFragment.txt#fragment.txt"
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Failed: relative, no scheme, no fragment"
argument_list|,
literal|"testWithFragment.txt"
argument_list|,
name|uploader
operator|.
name|stringToPath
argument_list|(
literal|"testWithFragment.txt"
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Failed: absolute, with scheme, no fragment"
argument_list|,
literal|"file:/testWithFragment.txt"
argument_list|,
name|uploader
operator|.
name|stringToPath
argument_list|(
literal|"file:///testWithFragment.txt"
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAllDefaults ()
specifier|public
name|void
name|testAllDefaults
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testNoLimitsWithResources ()
specifier|public
name|void
name|testNoLimitsWithResources
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setSizeOfResource
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAtResourceLimit ()
specifier|public
name|void
name|testAtResourceLimit
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setMaxResources
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testOverResourceLimit ()
specifier|public
name|void
name|testOverResourceLimit
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setMaxResources
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|false
argument_list|,
name|ResourceViolation
operator|.
name|NUMBER_OF_RESOURCES
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAtResourcesMBLimit ()
specifier|public
name|void
name|testAtResourcesMBLimit
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setMaxResourcesMB
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|b
operator|.
name|setSizeOfResource
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testOverResourcesMBLimit ()
specifier|public
name|void
name|testOverResourcesMBLimit
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setMaxResourcesMB
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|b
operator|.
name|setSizeOfResource
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|false
argument_list|,
name|ResourceViolation
operator|.
name|TOTAL_RESOURCE_SIZE
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAtSingleResourceMBLimit ()
specifier|public
name|void
name|testAtSingleResourceMBLimit
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setMaxSingleResourceMB
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setSizeOfResource
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|true
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testOverSingleResourceMBLimit ()
specifier|public
name|void
name|testOverSingleResourceMBLimit
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfDCArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfDCFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setMaxSingleResourceMB
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|b
operator|.
name|setSizeOfResource
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|runLimitsTest
argument_list|(
name|b
operator|.
name|build
argument_list|()
argument_list|,
literal|false
argument_list|,
name|ResourceViolation
operator|.
name|SINGLE_RESOURCE_SIZE
argument_list|)
expr_stmt|;
block|}
DECL|field|destinationPathPrefix
specifier|private
name|String
name|destinationPathPrefix
init|=
literal|"hdfs:///destinationPath/"
decl_stmt|;
DECL|field|expectedFilesNoFrags
specifier|private
name|String
index|[]
name|expectedFilesNoFrags
init|=
block|{
name|destinationPathPrefix
operator|+
literal|"tmpFiles0.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles1.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles2.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles3.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles4.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpjars0.jar"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpjars1.jar"
block|}
decl_stmt|;
DECL|field|expectedFilesWithFrags
specifier|private
name|String
index|[]
name|expectedFilesWithFrags
init|=
block|{
name|destinationPathPrefix
operator|+
literal|"tmpFiles0.txt#tmpFilesfragment0.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles1.txt#tmpFilesfragment1.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles2.txt#tmpFilesfragment2.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles3.txt#tmpFilesfragment3.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles4.txt#tmpFilesfragment4.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpjars0.jar#tmpjarsfragment0.jar"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpjars1.jar#tmpjarsfragment1.jar"
block|}
decl_stmt|;
comment|// We use the local fs for the submitFS in the StubedUploader, so libjars
comment|// should be replaced with a single path.
DECL|field|expectedFilesWithWildcard
specifier|private
name|String
index|[]
name|expectedFilesWithWildcard
init|=
block|{
name|destinationPathPrefix
operator|+
literal|"tmpFiles0.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles1.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles2.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles3.txt"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpFiles4.txt"
block|,
literal|"file:///libjars-submit-dir/libjars/*"
block|}
decl_stmt|;
DECL|field|expectedArchivesNoFrags
specifier|private
name|String
index|[]
name|expectedArchivesNoFrags
init|=
block|{
name|destinationPathPrefix
operator|+
literal|"tmpArchives0.tgz"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpArchives1.tgz"
block|}
decl_stmt|;
DECL|field|expectedArchivesWithFrags
specifier|private
name|String
index|[]
name|expectedArchivesWithFrags
init|=
block|{
name|destinationPathPrefix
operator|+
literal|"tmpArchives0.tgz#tmpArchivesfragment0.tgz"
block|,
name|destinationPathPrefix
operator|+
literal|"tmpArchives1.tgz#tmpArchivesfragment1.tgz"
block|}
decl_stmt|;
DECL|field|jobjarSubmitDir
specifier|private
name|String
name|jobjarSubmitDir
init|=
literal|"/jobjar-submit-dir"
decl_stmt|;
DECL|field|basicExpectedJobJar
specifier|private
name|String
name|basicExpectedJobJar
init|=
name|jobjarSubmitDir
operator|+
literal|"/job.jar"
decl_stmt|;
annotation|@
name|Test
DECL|method|testPathsWithNoFragNoSchemeRelative ()
specifier|public
name|void
name|testPathsWithNoFragNoSchemeRelative
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesNoFrags
argument_list|,
name|expectedArchivesNoFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithNoFragNoSchemeAbsolute ()
specifier|public
name|void
name|testPathsWithNoFragNoSchemeAbsolute
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesNoFrags
argument_list|,
name|expectedArchivesNoFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithFragNoSchemeAbsolute ()
specifier|public
name|void
name|testPathsWithFragNoSchemeAbsolute
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesWithFrags
argument_list|,
name|expectedArchivesWithFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithFragNoSchemeRelative ()
specifier|public
name|void
name|testPathsWithFragNoSchemeRelative
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesWithFrags
argument_list|,
name|expectedArchivesWithFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithFragSchemeAbsolute ()
specifier|public
name|void
name|testPathsWithFragSchemeAbsolute
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesWithFrags
argument_list|,
name|expectedArchivesWithFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithNoFragWithSchemeAbsolute ()
specifier|public
name|void
name|testPathsWithNoFragWithSchemeAbsolute
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesNoFrags
argument_list|,
name|expectedArchivesNoFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithNoFragAndWildCard ()
specifier|public
name|void
name|testPathsWithNoFragAndWildCard
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesWithWildcard
argument_list|,
name|expectedArchivesNoFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPathsWithFragsAndWildCard ()
specifier|public
name|void
name|testPathsWithFragsAndWildCard
parameter_list|()
throws|throws
name|IOException
block|{
name|ResourceConf
operator|.
name|Builder
name|b
init|=
operator|new
name|ResourceConf
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|b
operator|.
name|setNumOfTmpFiles
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpLibJars
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setNumOfTmpArchives
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|b
operator|.
name|setJobJar
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithFrags
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setPathsWithScheme
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|b
operator|.
name|setAbsolutePaths
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|ResourceConf
name|rConf
init|=
name|b
operator|.
name|build
argument_list|()
decl_stmt|;
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|jConf
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|runTmpResourcePathTest
argument_list|(
name|uploader
argument_list|,
name|rConf
argument_list|,
name|jConf
argument_list|,
name|expectedFilesWithFrags
argument_list|,
name|expectedArchivesWithFrags
argument_list|,
name|basicExpectedJobJar
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testErasureCodingDefault ()
specifier|public
name|void
name|testErasureCodingDefault
parameter_list|()
throws|throws
name|IOException
block|{
name|testErasureCodingSetting
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testErasureCodingDisabled ()
specifier|public
name|void
name|testErasureCodingDisabled
parameter_list|()
throws|throws
name|IOException
block|{
name|testErasureCodingSetting
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
DECL|method|testErasureCodingSetting (boolean defaultBehavior)
specifier|private
name|void
name|testErasureCodingSetting
parameter_list|(
name|boolean
name|defaultBehavior
parameter_list|)
throws|throws
name|IOException
block|{
name|JobConf
name|jConf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
comment|// don't set to false if EC remains disabled to check default setting
if|if
condition|(
operator|!
name|defaultBehavior
condition|)
block|{
name|jConf
operator|.
name|setBoolean
argument_list|(
name|MRJobConfig
operator|.
name|MR_AM_STAGING_DIR_ERASURECODING_ENABLED
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
name|DistributedFileSystem
name|fs
init|=
name|mock
argument_list|(
name|DistributedFileSystem
operator|.
name|class
argument_list|)
decl_stmt|;
name|Path
name|path
init|=
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|fs
operator|.
name|makeQualified
argument_list|(
name|any
argument_list|(
name|Path
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|fs
argument_list|,
literal|true
argument_list|)
decl_stmt|;
name|Job
name|job
init|=
name|Job
operator|.
name|getInstance
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|uploader
operator|.
name|uploadResources
argument_list|(
name|job
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/test"
argument_list|)
argument_list|)
expr_stmt|;
name|String
name|replicationPolicyName
init|=
name|SystemErasureCodingPolicies
operator|.
name|getReplicationPolicy
argument_list|()
operator|.
name|getName
argument_list|()
decl_stmt|;
name|VerificationMode
name|mode
init|=
name|defaultBehavior
condition|?
name|times
argument_list|(
literal|1
argument_list|)
else|:
name|never
argument_list|()
decl_stmt|;
name|verify
argument_list|(
name|fs
argument_list|,
name|mode
argument_list|)
operator|.
name|setErasureCodingPolicy
argument_list|(
name|eq
argument_list|(
name|path
argument_list|)
argument_list|,
name|eq
argument_list|(
name|replicationPolicyName
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|runTmpResourcePathTest (JobResourceUploader uploader, ResourceConf rConf, JobConf jConf, String[] expectedFiles, String[] expectedArchives, String expectedJobJar)
specifier|private
name|void
name|runTmpResourcePathTest
parameter_list|(
name|JobResourceUploader
name|uploader
parameter_list|,
name|ResourceConf
name|rConf
parameter_list|,
name|JobConf
name|jConf
parameter_list|,
name|String
index|[]
name|expectedFiles
parameter_list|,
name|String
index|[]
name|expectedArchives
parameter_list|,
name|String
name|expectedJobJar
parameter_list|)
throws|throws
name|IOException
block|{
name|Job
name|job
init|=
name|rConf
operator|.
name|setupJobConf
argument_list|(
name|jConf
argument_list|)
decl_stmt|;
name|uploadResources
argument_list|(
name|uploader
argument_list|,
name|job
argument_list|)
expr_stmt|;
name|validateResourcePaths
argument_list|(
name|job
argument_list|,
name|expectedFiles
argument_list|,
name|expectedArchives
argument_list|,
name|expectedJobJar
argument_list|)
expr_stmt|;
block|}
DECL|method|uploadResources (JobResourceUploader uploader, Job job)
specifier|private
name|void
name|uploadResources
parameter_list|(
name|JobResourceUploader
name|uploader
parameter_list|,
name|Job
name|job
parameter_list|)
throws|throws
name|IOException
block|{
name|Configuration
name|conf
init|=
name|job
operator|.
name|getConfiguration
argument_list|()
decl_stmt|;
name|Collection
argument_list|<
name|String
argument_list|>
name|files
init|=
name|conf
operator|.
name|getStringCollection
argument_list|(
literal|"tmpfiles"
argument_list|)
decl_stmt|;
name|Collection
argument_list|<
name|String
argument_list|>
name|libjars
init|=
name|conf
operator|.
name|getStringCollection
argument_list|(
literal|"tmpjars"
argument_list|)
decl_stmt|;
name|Collection
argument_list|<
name|String
argument_list|>
name|archives
init|=
name|conf
operator|.
name|getStringCollection
argument_list|(
literal|"tmparchives"
argument_list|)
decl_stmt|;
name|Map
argument_list|<
name|URI
argument_list|,
name|FileStatus
argument_list|>
name|statCache
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|Boolean
argument_list|>
name|fileSCUploadPolicies
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|String
name|jobJar
init|=
name|job
operator|.
name|getJar
argument_list|()
decl_stmt|;
name|uploader
operator|.
name|uploadFiles
argument_list|(
name|job
argument_list|,
name|files
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/files-submit-dir"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|(
name|short
operator|)
literal|3
argument_list|,
name|fileSCUploadPolicies
argument_list|,
name|statCache
argument_list|)
expr_stmt|;
name|uploader
operator|.
name|uploadArchives
argument_list|(
name|job
argument_list|,
name|archives
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/archives-submit-dir"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|(
name|short
operator|)
literal|3
argument_list|,
name|fileSCUploadPolicies
argument_list|,
name|statCache
argument_list|)
expr_stmt|;
name|uploader
operator|.
name|uploadLibJars
argument_list|(
name|job
argument_list|,
name|libjars
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/libjars-submit-dir"
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|(
name|short
operator|)
literal|3
argument_list|,
name|fileSCUploadPolicies
argument_list|,
name|statCache
argument_list|)
expr_stmt|;
name|uploader
operator|.
name|uploadJobJar
argument_list|(
name|job
argument_list|,
name|jobJar
argument_list|,
operator|new
name|Path
argument_list|(
name|jobjarSubmitDir
argument_list|)
argument_list|,
operator|(
name|short
operator|)
literal|3
argument_list|,
name|statCache
argument_list|)
expr_stmt|;
block|}
DECL|method|validateResourcePaths (Job job, String[] expectedFiles, String[] expectedArchives, String expectedJobJar)
specifier|private
name|void
name|validateResourcePaths
parameter_list|(
name|Job
name|job
parameter_list|,
name|String
index|[]
name|expectedFiles
parameter_list|,
name|String
index|[]
name|expectedArchives
parameter_list|,
name|String
name|expectedJobJar
parameter_list|)
throws|throws
name|IOException
block|{
name|validateResourcePathsSub
argument_list|(
name|job
operator|.
name|getCacheFiles
argument_list|()
argument_list|,
name|expectedFiles
argument_list|)
expr_stmt|;
name|validateResourcePathsSub
argument_list|(
name|job
operator|.
name|getCacheArchives
argument_list|()
argument_list|,
name|expectedArchives
argument_list|)
expr_stmt|;
comment|// We use a different job object here because the jobjar was set on a
comment|// different job object
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Job jar path is different than expected!"
argument_list|,
name|expectedJobJar
argument_list|,
name|job
operator|.
name|getJar
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|validateResourcePathsSub (URI[] actualURIs, String[] expectedURIs)
specifier|private
name|void
name|validateResourcePathsSub
parameter_list|(
name|URI
index|[]
name|actualURIs
parameter_list|,
name|String
index|[]
name|expectedURIs
parameter_list|)
block|{
name|List
argument_list|<
name|URI
argument_list|>
name|actualList
init|=
name|Arrays
operator|.
name|asList
argument_list|(
name|actualURIs
argument_list|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|expectedSet
init|=
operator|new
name|HashSet
argument_list|<>
argument_list|(
name|Arrays
operator|.
name|asList
argument_list|(
name|expectedURIs
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|actualList
operator|.
name|size
argument_list|()
operator|!=
name|expectedSet
operator|.
name|size
argument_list|()
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Expected list of resources ("
operator|+
name|expectedSet
operator|.
name|size
argument_list|()
operator|+
literal|") and actual list of resources ("
operator|+
name|actualList
operator|.
name|size
argument_list|()
operator|+
literal|") are different lengths!"
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|URI
name|u
range|:
name|actualList
control|)
block|{
if|if
condition|(
operator|!
name|expectedSet
operator|.
name|contains
argument_list|(
name|u
operator|.
name|toString
argument_list|()
argument_list|)
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Resource list contained unexpected path: "
operator|+
name|u
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
DECL|enum|ResourceViolation
specifier|private
enum|enum
name|ResourceViolation
block|{
DECL|enumConstant|NUMBER_OF_RESOURCES
DECL|enumConstant|TOTAL_RESOURCE_SIZE
DECL|enumConstant|SINGLE_RESOURCE_SIZE
name|NUMBER_OF_RESOURCES
block|,
name|TOTAL_RESOURCE_SIZE
block|,
name|SINGLE_RESOURCE_SIZE
block|;   }
DECL|method|runLimitsTest (ResourceConf rlConf, boolean checkShouldSucceed, ResourceViolation violation)
specifier|private
name|void
name|runLimitsTest
parameter_list|(
name|ResourceConf
name|rlConf
parameter_list|,
name|boolean
name|checkShouldSucceed
parameter_list|,
name|ResourceViolation
name|violation
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|checkShouldSucceed
operator|&&
name|violation
operator|==
literal|null
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Test is misconfigured. checkShouldSucceed is set to false"
operator|+
literal|" and a ResourceViolation is not specified."
argument_list|)
expr_stmt|;
block|}
name|JobConf
name|conf
init|=
operator|new
name|JobConf
argument_list|()
decl_stmt|;
name|rlConf
operator|.
name|setupJobConf
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|JobResourceUploader
name|uploader
init|=
operator|new
name|StubedUploader
argument_list|(
name|conf
argument_list|)
decl_stmt|;
name|long
name|configuredSizeOfResourceBytes
init|=
name|rlConf
operator|.
name|sizeOfResource
operator|*
literal|1024
operator|*
literal|1024
decl_stmt|;
name|when
argument_list|(
name|mockedStatus
operator|.
name|getLen
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|configuredSizeOfResourceBytes
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|mockedStatus
operator|.
name|isDirectory
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|URI
argument_list|,
name|FileStatus
argument_list|>
name|statCache
init|=
operator|new
name|HashMap
argument_list|<
name|URI
argument_list|,
name|FileStatus
argument_list|>
argument_list|()
decl_stmt|;
try|try
block|{
name|uploader
operator|.
name|checkLocalizationLimits
argument_list|(
name|conf
argument_list|,
name|conf
operator|.
name|getStringCollection
argument_list|(
literal|"tmpfiles"
argument_list|)
argument_list|,
name|conf
operator|.
name|getStringCollection
argument_list|(
literal|"tmpjars"
argument_list|)
argument_list|,
name|conf
operator|.
name|getStringCollection
argument_list|(
literal|"tmparchives"
argument_list|)
argument_list|,
name|conf
operator|.
name|getJar
argument_list|()
argument_list|,
name|statCache
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Limits check succeeded when it should have failed."
argument_list|,
name|checkShouldSucceed
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
if|if
condition|(
name|checkShouldSucceed
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Limits check failed when it should have succeeded: "
operator|+
name|e
argument_list|)
expr_stmt|;
block|}
switch|switch
condition|(
name|violation
condition|)
block|{
case|case
name|NUMBER_OF_RESOURCES
case|:
if|if
condition|(
operator|!
name|e
operator|.
name|getMessage
argument_list|()
operator|.
name|contains
argument_list|(
name|JobResourceUploader
operator|.
name|MAX_RESOURCE_ERR_MSG
argument_list|)
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Test failed unexpectedly: "
operator|+
name|e
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|TOTAL_RESOURCE_SIZE
case|:
if|if
condition|(
operator|!
name|e
operator|.
name|getMessage
argument_list|()
operator|.
name|contains
argument_list|(
name|JobResourceUploader
operator|.
name|MAX_TOTAL_RESOURCE_MB_ERR_MSG
argument_list|)
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Test failed unexpectedly: "
operator|+
name|e
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|SINGLE_RESOURCE_SIZE
case|:
if|if
condition|(
operator|!
name|e
operator|.
name|getMessage
argument_list|()
operator|.
name|contains
argument_list|(
name|JobResourceUploader
operator|.
name|MAX_SINGLE_RESOURCE_MB_ERR_MSG
argument_list|)
condition|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Test failed unexpectedly: "
operator|+
name|e
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|Assert
operator|.
name|fail
argument_list|(
literal|"Test failed unexpectedly: "
operator|+
name|e
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
DECL|field|mockedStatus
specifier|private
specifier|final
name|FileStatus
name|mockedStatus
init|=
name|mock
argument_list|(
name|FileStatus
operator|.
name|class
argument_list|)
decl_stmt|;
DECL|class|ResourceConf
specifier|private
specifier|static
class|class
name|ResourceConf
block|{
DECL|field|maxResources
specifier|private
specifier|final
name|int
name|maxResources
decl_stmt|;
DECL|field|maxResourcesMB
specifier|private
specifier|final
name|long
name|maxResourcesMB
decl_stmt|;
DECL|field|maxSingleResourceMB
specifier|private
specifier|final
name|long
name|maxSingleResourceMB
decl_stmt|;
DECL|field|numOfTmpFiles
specifier|private
specifier|final
name|int
name|numOfTmpFiles
decl_stmt|;
DECL|field|numOfTmpArchives
specifier|private
specifier|final
name|int
name|numOfTmpArchives
decl_stmt|;
DECL|field|numOfTmpLibJars
specifier|private
specifier|final
name|int
name|numOfTmpLibJars
decl_stmt|;
DECL|field|jobJar
specifier|private
specifier|final
name|boolean
name|jobJar
decl_stmt|;
DECL|field|numOfDCFiles
specifier|private
specifier|final
name|int
name|numOfDCFiles
decl_stmt|;
DECL|field|numOfDCArchives
specifier|private
specifier|final
name|int
name|numOfDCArchives
decl_stmt|;
DECL|field|sizeOfResource
specifier|private
specifier|final
name|long
name|sizeOfResource
decl_stmt|;
DECL|field|pathsWithFrags
specifier|private
specifier|final
name|boolean
name|pathsWithFrags
decl_stmt|;
DECL|field|pathsWithScheme
specifier|private
specifier|final
name|boolean
name|pathsWithScheme
decl_stmt|;
DECL|field|absolutePaths
specifier|private
specifier|final
name|boolean
name|absolutePaths
decl_stmt|;
DECL|method|ResourceConf ()
specifier|private
name|ResourceConf
parameter_list|()
block|{
name|this
argument_list|(
operator|new
name|Builder
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|ResourceConf (Builder builder)
specifier|private
name|ResourceConf
parameter_list|(
name|Builder
name|builder
parameter_list|)
block|{
name|this
operator|.
name|maxResources
operator|=
name|builder
operator|.
name|maxResources
expr_stmt|;
name|this
operator|.
name|maxResourcesMB
operator|=
name|builder
operator|.
name|maxResourcesMB
expr_stmt|;
name|this
operator|.
name|maxSingleResourceMB
operator|=
name|builder
operator|.
name|maxSingleResourceMB
expr_stmt|;
name|this
operator|.
name|numOfTmpFiles
operator|=
name|builder
operator|.
name|numOfTmpFiles
expr_stmt|;
name|this
operator|.
name|numOfTmpArchives
operator|=
name|builder
operator|.
name|numOfTmpArchives
expr_stmt|;
name|this
operator|.
name|numOfTmpLibJars
operator|=
name|builder
operator|.
name|numOfTmpLibJars
expr_stmt|;
name|this
operator|.
name|jobJar
operator|=
name|builder
operator|.
name|jobJar
expr_stmt|;
name|this
operator|.
name|numOfDCFiles
operator|=
name|builder
operator|.
name|numOfDCFiles
expr_stmt|;
name|this
operator|.
name|numOfDCArchives
operator|=
name|builder
operator|.
name|numOfDCArchives
expr_stmt|;
name|this
operator|.
name|sizeOfResource
operator|=
name|builder
operator|.
name|sizeOfResource
expr_stmt|;
name|this
operator|.
name|pathsWithFrags
operator|=
name|builder
operator|.
name|pathsWithFrags
expr_stmt|;
name|this
operator|.
name|pathsWithScheme
operator|=
name|builder
operator|.
name|pathsWithScheme
expr_stmt|;
name|this
operator|.
name|absolutePaths
operator|=
name|builder
operator|.
name|absolutePaths
expr_stmt|;
block|}
DECL|class|Builder
specifier|static
class|class
name|Builder
block|{
comment|// Defaults
DECL|field|maxResources
specifier|private
name|int
name|maxResources
init|=
literal|0
decl_stmt|;
DECL|field|maxResourcesMB
specifier|private
name|long
name|maxResourcesMB
init|=
literal|0
decl_stmt|;
DECL|field|maxSingleResourceMB
specifier|private
name|long
name|maxSingleResourceMB
init|=
literal|0
decl_stmt|;
DECL|field|numOfTmpFiles
specifier|private
name|int
name|numOfTmpFiles
init|=
literal|0
decl_stmt|;
DECL|field|numOfTmpArchives
specifier|private
name|int
name|numOfTmpArchives
init|=
literal|0
decl_stmt|;
DECL|field|numOfTmpLibJars
specifier|private
name|int
name|numOfTmpLibJars
init|=
literal|0
decl_stmt|;
DECL|field|jobJar
specifier|private
name|boolean
name|jobJar
init|=
literal|false
decl_stmt|;
DECL|field|numOfDCFiles
specifier|private
name|int
name|numOfDCFiles
init|=
literal|0
decl_stmt|;
DECL|field|numOfDCArchives
specifier|private
name|int
name|numOfDCArchives
init|=
literal|0
decl_stmt|;
DECL|field|sizeOfResource
specifier|private
name|long
name|sizeOfResource
init|=
literal|0
decl_stmt|;
DECL|field|pathsWithFrags
specifier|private
name|boolean
name|pathsWithFrags
init|=
literal|false
decl_stmt|;
DECL|field|pathsWithScheme
specifier|private
name|boolean
name|pathsWithScheme
init|=
literal|false
decl_stmt|;
DECL|field|absolutePaths
specifier|private
name|boolean
name|absolutePaths
init|=
literal|true
decl_stmt|;
DECL|method|Builder ()
specifier|private
name|Builder
parameter_list|()
block|{       }
DECL|method|setMaxResources (int max)
specifier|private
name|Builder
name|setMaxResources
parameter_list|(
name|int
name|max
parameter_list|)
block|{
name|this
operator|.
name|maxResources
operator|=
name|max
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setMaxResourcesMB (long max)
specifier|private
name|Builder
name|setMaxResourcesMB
parameter_list|(
name|long
name|max
parameter_list|)
block|{
name|this
operator|.
name|maxResourcesMB
operator|=
name|max
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setMaxSingleResourceMB (long max)
specifier|private
name|Builder
name|setMaxSingleResourceMB
parameter_list|(
name|long
name|max
parameter_list|)
block|{
name|this
operator|.
name|maxSingleResourceMB
operator|=
name|max
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNumOfTmpFiles (int num)
specifier|private
name|Builder
name|setNumOfTmpFiles
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|this
operator|.
name|numOfTmpFiles
operator|=
name|num
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNumOfTmpArchives (int num)
specifier|private
name|Builder
name|setNumOfTmpArchives
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|this
operator|.
name|numOfTmpArchives
operator|=
name|num
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNumOfTmpLibJars (int num)
specifier|private
name|Builder
name|setNumOfTmpLibJars
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|this
operator|.
name|numOfTmpLibJars
operator|=
name|num
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setJobJar (boolean jar)
specifier|private
name|Builder
name|setJobJar
parameter_list|(
name|boolean
name|jar
parameter_list|)
block|{
name|this
operator|.
name|jobJar
operator|=
name|jar
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNumOfDCFiles (int num)
specifier|private
name|Builder
name|setNumOfDCFiles
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|this
operator|.
name|numOfDCFiles
operator|=
name|num
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNumOfDCArchives (int num)
specifier|private
name|Builder
name|setNumOfDCArchives
parameter_list|(
name|int
name|num
parameter_list|)
block|{
name|this
operator|.
name|numOfDCArchives
operator|=
name|num
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setSizeOfResource (long sizeMB)
specifier|private
name|Builder
name|setSizeOfResource
parameter_list|(
name|long
name|sizeMB
parameter_list|)
block|{
name|this
operator|.
name|sizeOfResource
operator|=
name|sizeMB
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPathsWithFrags (boolean fragments)
specifier|private
name|Builder
name|setPathsWithFrags
parameter_list|(
name|boolean
name|fragments
parameter_list|)
block|{
name|this
operator|.
name|pathsWithFrags
operator|=
name|fragments
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPathsWithScheme (boolean scheme)
specifier|private
name|Builder
name|setPathsWithScheme
parameter_list|(
name|boolean
name|scheme
parameter_list|)
block|{
name|this
operator|.
name|pathsWithScheme
operator|=
name|scheme
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setAbsolutePaths (boolean absolute)
specifier|private
name|Builder
name|setAbsolutePaths
parameter_list|(
name|boolean
name|absolute
parameter_list|)
block|{
name|this
operator|.
name|absolutePaths
operator|=
name|absolute
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|build ()
name|ResourceConf
name|build
parameter_list|()
block|{
return|return
operator|new
name|ResourceConf
argument_list|(
name|this
argument_list|)
return|;
block|}
block|}
DECL|method|setupJobConf (JobConf conf)
specifier|private
name|Job
name|setupJobConf
parameter_list|(
name|JobConf
name|conf
parameter_list|)
throws|throws
name|IOException
block|{
name|conf
operator|.
name|set
argument_list|(
literal|"tmpfiles"
argument_list|,
name|buildPathString
argument_list|(
literal|"tmpFiles"
argument_list|,
name|this
operator|.
name|numOfTmpFiles
argument_list|,
literal|".txt"
argument_list|)
argument_list|)
expr_stmt|;
name|conf
operator|.
name|set
argument_list|(
literal|"tmpjars"
argument_list|,
name|buildPathString
argument_list|(
literal|"tmpjars"
argument_list|,
name|this
operator|.
name|numOfTmpLibJars
argument_list|,
literal|".jar"
argument_list|)
argument_list|)
expr_stmt|;
name|conf
operator|.
name|set
argument_list|(
literal|"tmparchives"
argument_list|,
name|buildPathString
argument_list|(
literal|"tmpArchives"
argument_list|,
name|this
operator|.
name|numOfTmpArchives
argument_list|,
literal|".tgz"
argument_list|)
argument_list|)
expr_stmt|;
name|conf
operator|.
name|set
argument_list|(
name|MRJobConfig
operator|.
name|CACHE_ARCHIVES
argument_list|,
name|buildDistributedCachePathString
argument_list|(
literal|"cacheArchives"
argument_list|,
name|this
operator|.
name|numOfDCArchives
argument_list|,
literal|".tgz"
argument_list|)
argument_list|)
expr_stmt|;
name|conf
operator|.
name|set
argument_list|(
name|MRJobConfig
operator|.
name|CACHE_FILES
argument_list|,
name|buildDistributedCachePathString
argument_list|(
literal|"cacheFiles"
argument_list|,
name|this
operator|.
name|numOfDCFiles
argument_list|,
literal|".txt"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|jobJar
condition|)
block|{
name|String
name|fragment
init|=
literal|""
decl_stmt|;
if|if
condition|(
name|pathsWithFrags
condition|)
block|{
name|fragment
operator|=
literal|"#jobjarfrag.jar"
expr_stmt|;
block|}
if|if
condition|(
name|pathsWithScheme
condition|)
block|{
name|conf
operator|.
name|setJar
argument_list|(
literal|"file:///jobjar.jar"
operator|+
name|fragment
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|absolutePaths
condition|)
block|{
name|conf
operator|.
name|setJar
argument_list|(
literal|"/jobjar.jar"
operator|+
name|fragment
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|conf
operator|.
name|setJar
argument_list|(
literal|"jobjar.jar"
operator|+
name|fragment
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|conf
operator|.
name|setInt
argument_list|(
name|MRJobConfig
operator|.
name|MAX_RESOURCES
argument_list|,
name|this
operator|.
name|maxResources
argument_list|)
expr_stmt|;
name|conf
operator|.
name|setLong
argument_list|(
name|MRJobConfig
operator|.
name|MAX_RESOURCES_MB
argument_list|,
name|this
operator|.
name|maxResourcesMB
argument_list|)
expr_stmt|;
name|conf
operator|.
name|setLong
argument_list|(
name|MRJobConfig
operator|.
name|MAX_SINGLE_RESOURCE_MB
argument_list|,
name|this
operator|.
name|maxSingleResourceMB
argument_list|)
expr_stmt|;
return|return
operator|new
name|Job
argument_list|(
name|conf
argument_list|)
return|;
block|}
comment|// We always want absolute paths with a scheme in the DistributedCache, so
comment|// we use a separate method to construct the path string.
DECL|method|buildDistributedCachePathString (String pathPrefix, int numOfPaths, String extension)
specifier|private
name|String
name|buildDistributedCachePathString
parameter_list|(
name|String
name|pathPrefix
parameter_list|,
name|int
name|numOfPaths
parameter_list|,
name|String
name|extension
parameter_list|)
block|{
if|if
condition|(
name|numOfPaths
operator|<
literal|1
condition|)
block|{
return|return
literal|""
return|;
block|}
else|else
block|{
name|StringBuilder
name|b
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|b
operator|.
name|append
argument_list|(
name|buildPathStringSub
argument_list|(
name|pathPrefix
argument_list|,
literal|"file:///"
operator|+
name|pathPrefix
argument_list|,
name|extension
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<
name|numOfPaths
condition|;
name|i
operator|++
control|)
block|{
name|b
operator|.
name|append
argument_list|(
literal|","
operator|+
name|buildPathStringSub
argument_list|(
name|pathPrefix
argument_list|,
literal|"file:///"
operator|+
name|pathPrefix
argument_list|,
name|extension
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|b
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
DECL|method|buildPathString (String pathPrefix, int numOfPaths, String extension)
specifier|private
name|String
name|buildPathString
parameter_list|(
name|String
name|pathPrefix
parameter_list|,
name|int
name|numOfPaths
parameter_list|,
name|String
name|extension
parameter_list|)
block|{
if|if
condition|(
name|numOfPaths
operator|<
literal|1
condition|)
block|{
return|return
literal|""
return|;
block|}
else|else
block|{
name|StringBuilder
name|b
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|String
name|processedPath
decl_stmt|;
if|if
condition|(
name|pathsWithScheme
condition|)
block|{
name|processedPath
operator|=
literal|"file:///"
operator|+
name|pathPrefix
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|absolutePaths
condition|)
block|{
name|processedPath
operator|=
literal|"/"
operator|+
name|pathPrefix
expr_stmt|;
block|}
else|else
block|{
name|processedPath
operator|=
name|pathPrefix
expr_stmt|;
block|}
block|}
name|b
operator|.
name|append
argument_list|(
name|buildPathStringSub
argument_list|(
name|pathPrefix
argument_list|,
name|processedPath
argument_list|,
name|extension
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<
name|numOfPaths
condition|;
name|i
operator|++
control|)
block|{
name|b
operator|.
name|append
argument_list|(
literal|","
operator|+
name|buildPathStringSub
argument_list|(
name|pathPrefix
argument_list|,
name|processedPath
argument_list|,
name|extension
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|b
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
DECL|method|buildPathStringSub (String pathPrefix, String processedPath, String extension, int num)
specifier|private
name|String
name|buildPathStringSub
parameter_list|(
name|String
name|pathPrefix
parameter_list|,
name|String
name|processedPath
parameter_list|,
name|String
name|extension
parameter_list|,
name|int
name|num
parameter_list|)
block|{
if|if
condition|(
name|pathsWithFrags
condition|)
block|{
return|return
name|processedPath
operator|+
name|num
operator|+
name|extension
operator|+
literal|"#"
operator|+
name|pathPrefix
operator|+
literal|"fragment"
operator|+
name|num
operator|+
name|extension
return|;
block|}
else|else
block|{
return|return
name|processedPath
operator|+
name|num
operator|+
name|extension
return|;
block|}
block|}
block|}
DECL|class|StubedUploader
specifier|private
class|class
name|StubedUploader
extends|extends
name|JobResourceUploader
block|{
DECL|method|StubedUploader (JobConf conf)
name|StubedUploader
parameter_list|(
name|JobConf
name|conf
parameter_list|)
throws|throws
name|IOException
block|{
name|this
argument_list|(
name|conf
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
DECL|method|StubedUploader (JobConf conf, boolean useWildcard)
name|StubedUploader
parameter_list|(
name|JobConf
name|conf
parameter_list|,
name|boolean
name|useWildcard
parameter_list|)
throws|throws
name|IOException
block|{
name|super
argument_list|(
name|FileSystem
operator|.
name|getLocal
argument_list|(
name|conf
argument_list|)
argument_list|,
name|useWildcard
argument_list|)
expr_stmt|;
block|}
DECL|method|StubedUploader (FileSystem fs, boolean useWildcard)
name|StubedUploader
parameter_list|(
name|FileSystem
name|fs
parameter_list|,
name|boolean
name|useWildcard
parameter_list|)
throws|throws
name|IOException
block|{
name|super
argument_list|(
name|fs
argument_list|,
name|useWildcard
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|getFileStatus (Map<URI, FileStatus> statCache, Configuration job, Path p)
name|FileStatus
name|getFileStatus
parameter_list|(
name|Map
argument_list|<
name|URI
argument_list|,
name|FileStatus
argument_list|>
name|statCache
parameter_list|,
name|Configuration
name|job
parameter_list|,
name|Path
name|p
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|mockedStatus
return|;
block|}
annotation|@
name|Override
DECL|method|mkdirs (FileSystem fs, Path dir, FsPermission permission)
name|boolean
name|mkdirs
parameter_list|(
name|FileSystem
name|fs
parameter_list|,
name|Path
name|dir
parameter_list|,
name|FsPermission
name|permission
parameter_list|)
throws|throws
name|IOException
block|{
comment|// Do nothing. Stubbed out to avoid side effects. We don't actually need
comment|// to create submit dirs.
return|return
literal|true
return|;
block|}
annotation|@
name|Override
DECL|method|copyRemoteFiles (Path parentDir, Path originalPath, Configuration conf, short replication)
name|Path
name|copyRemoteFiles
parameter_list|(
name|Path
name|parentDir
parameter_list|,
name|Path
name|originalPath
parameter_list|,
name|Configuration
name|conf
parameter_list|,
name|short
name|replication
parameter_list|)
throws|throws
name|IOException
block|{
return|return
operator|new
name|Path
argument_list|(
name|destinationPathPrefix
operator|+
name|originalPath
operator|.
name|getName
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|copyJar (Path originalJarPath, Path submitJarFile, short replication)
name|void
name|copyJar
parameter_list|(
name|Path
name|originalJarPath
parameter_list|,
name|Path
name|submitJarFile
parameter_list|,
name|short
name|replication
parameter_list|)
throws|throws
name|IOException
block|{
comment|// Do nothing. Stubbed out to avoid side effects. We don't actually need
comment|// to copy the jar to the remote fs.
block|}
block|}
block|}
end_class

end_unit

