begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.fs.viewfs
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|viewfs
package|;
end_package

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
operator|.
name|checkFileLinkStatus
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
operator|.
name|checkFileStatus
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
operator|.
name|exists
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
operator|.
name|isDir
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
operator|.
name|isFile
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileNotFoundException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|URI
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|AbstractFileSystem
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|BlockLocation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|RemoteIterator
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileContextTestHelper
operator|.
name|fileType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FsConstants
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|Path
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|UnresolvedLinkException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|viewfs
operator|.
name|ViewFs
operator|.
name|MountPoint
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|AccessControlException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|token
operator|.
name|Token
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|After
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Assert
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Before
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|mockito
operator|.
name|Mockito
import|;
end_import

begin_comment
comment|/**  *<p>  * A collection of tests for the {@link ViewFs}.  * This test should be used for testing ViewFs that has mount links to   * a target file system such  localFs or Hdfs etc.   *</p>  *<p>  * To test a given target file system create a subclass of this  * test and override {@link #setUp()} to initialize the<code>fcTarget</code>   * to point to the file system to which you want the mount targets  *   * Since this a junit 4 you can also do a single setup before   * the start of any tests.  * E.g.  *     @BeforeClass   public static void clusterSetupAtBegining()  *     @AfterClass    public static void ClusterShutdownAtEnd()  *</p>  */
end_comment

begin_class
DECL|class|ViewFsBaseTest
specifier|public
class|class
name|ViewFsBaseTest
block|{
DECL|field|fcView
name|FileContext
name|fcView
decl_stmt|;
comment|// the view file system - the mounts are here
DECL|field|fcTarget
name|FileContext
name|fcTarget
decl_stmt|;
comment|// the target file system - the mount will point here
DECL|field|targetTestRoot
name|Path
name|targetTestRoot
decl_stmt|;
DECL|field|conf
name|Configuration
name|conf
decl_stmt|;
DECL|field|xfcViewWithAuthority
name|FileContext
name|xfcViewWithAuthority
decl_stmt|;
comment|// same as fsView but with authority
DECL|field|schemeWithAuthority
name|URI
name|schemeWithAuthority
decl_stmt|;
annotation|@
name|Before
DECL|method|setUp ()
specifier|public
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|initializeTargetTestRoot
argument_list|()
expr_stmt|;
comment|// Make  user and data dirs - we creates links to them in the mount table
name|fcTarget
operator|.
name|mkdir
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fcTarget
operator|.
name|mkdir
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"data"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fcTarget
operator|.
name|mkdir
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fcTarget
operator|.
name|mkdir
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir3"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"aFile"
argument_list|)
argument_list|)
expr_stmt|;
comment|// Now we use the mount fs to set links to user and dir
comment|// in the test root
comment|// Set up the defaultMT in the config with our mount point links
name|conf
operator|=
operator|new
name|Configuration
argument_list|()
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/targetRoot"
argument_list|,
name|targetTestRoot
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/user"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/user2"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/data"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"data"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/internalDir/linkToDir2"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/internalDir/internalDir2/linkToDir3"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir3"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/danglingLink"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"missingTarget"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|ConfigUtil
operator|.
name|addLink
argument_list|(
name|conf
argument_list|,
literal|"/linkToAFile"
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"aFile"
argument_list|)
operator|.
name|toUri
argument_list|()
argument_list|)
expr_stmt|;
name|fcView
operator|=
name|FileContext
operator|.
name|getFileContext
argument_list|(
name|FsConstants
operator|.
name|VIEWFS_URI
argument_list|,
name|conf
argument_list|)
expr_stmt|;
comment|// Also try viewfs://default/    - note authority is name of mount table
block|}
DECL|method|initializeTargetTestRoot ()
name|void
name|initializeTargetTestRoot
parameter_list|()
throws|throws
name|IOException
block|{
name|targetTestRoot
operator|=
name|FileContextTestHelper
operator|.
name|getAbsoluteTestRootPath
argument_list|(
name|fcTarget
argument_list|)
expr_stmt|;
comment|// In case previous test was killed before cleanup
name|fcTarget
operator|.
name|delete
argument_list|(
name|targetTestRoot
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|fcTarget
operator|.
name|mkdir
argument_list|(
name|targetTestRoot
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
annotation|@
name|After
DECL|method|tearDown ()
specifier|public
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|fcTarget
operator|.
name|delete
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcTarget
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetMountPoints ()
specifier|public
name|void
name|testGetMountPoints
parameter_list|()
block|{
name|ViewFs
name|viewfs
init|=
operator|(
name|ViewFs
operator|)
name|fcView
operator|.
name|getDefaultFileSystem
argument_list|()
decl_stmt|;
name|MountPoint
index|[]
name|mountPoints
init|=
name|viewfs
operator|.
name|getMountPoints
argument_list|()
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|8
argument_list|,
name|mountPoints
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
DECL|method|getExpectedDelegationTokenCount ()
name|int
name|getExpectedDelegationTokenCount
parameter_list|()
block|{
return|return
literal|0
return|;
block|}
comment|/**    * This default implementation is when viewfs has mount points    * into file systems, such as LocalFs that do no have delegation tokens.    * It should be overridden for when mount points into hdfs.    */
annotation|@
name|Test
DECL|method|testGetDelegationTokens ()
specifier|public
name|void
name|testGetDelegationTokens
parameter_list|()
throws|throws
name|IOException
block|{
name|List
argument_list|<
name|Token
argument_list|<
name|?
argument_list|>
argument_list|>
name|delTokens
init|=
name|fcView
operator|.
name|getDelegationTokens
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|,
literal|"sanjay"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|getExpectedDelegationTokenCount
argument_list|()
argument_list|,
name|delTokens
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testBasicPaths ()
specifier|public
name|void
name|testBasicPaths
parameter_list|()
block|{
name|Assert
operator|.
name|assertEquals
argument_list|(
name|FsConstants
operator|.
name|VIEWFS_URI
argument_list|,
name|fcView
operator|.
name|getDefaultFileSystem
argument_list|()
operator|.
name|getUri
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|makeQualified
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/"
operator|+
name|System
operator|.
name|getProperty
argument_list|(
literal|"user.name"
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|fcView
operator|.
name|getWorkingDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|makeQualified
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/"
operator|+
name|System
operator|.
name|getProperty
argument_list|(
literal|"user.name"
argument_list|)
argument_list|)
argument_list|)
argument_list|,
name|fcView
operator|.
name|getHomeDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/foo/bar"
argument_list|)
operator|.
name|makeQualified
argument_list|(
name|FsConstants
operator|.
name|VIEWFS_URI
argument_list|,
literal|null
argument_list|)
argument_list|,
name|fcView
operator|.
name|makeQualified
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/foo/bar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/**     * Test modify operations (create, mkdir, delete, etc)     * on the mount file system where the pathname references through    * the mount points.  Hence these operation will modify the target    * file system.    *     * Verify the operation via mountfs (ie fc) and *also* via the    *  target file system (ie fclocal) that the mount link points-to.    */
annotation|@
name|Test
DECL|method|testOperationsThroughMountLinks ()
specifier|public
name|void
name|testOperationsThroughMountLinks
parameter_list|()
throws|throws
name|IOException
block|{
comment|// Create file
name|FileContextTestHelper
operator|.
name|createFileNonRecursive
argument_list|(
name|fcView
argument_list|,
literal|"/user/foo"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Create file should be file"
argument_list|,
name|isFile
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Target of created file should be type file"
argument_list|,
name|isFile
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Delete the created file
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Delete should succeed"
argument_list|,
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"File should not exist after delete"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Target File should not exist after delete"
argument_list|,
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Create file with a 2 component dirs
name|FileContextTestHelper
operator|.
name|createFileNonRecursive
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/linkToDir2/foo"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Created file should be type file"
argument_list|,
name|isFile
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Target of created file should be type file"
argument_list|,
name|isFile
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Delete the created file
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Delete should suceed"
argument_list|,
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2/foo"
argument_list|)
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"File should not exist after deletion"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Target should not exist after deletion"
argument_list|,
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Create file with a 3 component dirs
name|FileContextTestHelper
operator|.
name|createFileNonRecursive
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/internalDir2/linkToDir3/foo"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Created file should be of type file"
argument_list|,
name|isFile
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/internalDir2/linkToDir3/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Target of created file should also be type file"
argument_list|,
name|isFile
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir3/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Recursive Create file with missing dirs
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/linkToDir2/missingDir/miss2/foo"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Created file should be of type file"
argument_list|,
name|isFile
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2/missingDir/miss2/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Target of created file should also be type file"
argument_list|,
name|isFile
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2/missingDir/miss2/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Delete the created file
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Delete should succeed"
argument_list|,
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/internalDir2/linkToDir3/foo"
argument_list|)
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Deleted File should not exist"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/internalDir2/linkToDir3/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Target of deleted file should not exist"
argument_list|,
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir3/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// mkdir
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/dirX"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"New dir should be type dir"
argument_list|,
name|isDir
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/dirX"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Target of new dir should be of type dir"
argument_list|,
name|isDir
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirX"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/dirX/dirY"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"New dir should be type dir"
argument_list|,
name|isDir
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/dirX/dirY"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Target of new dir should be of type dir"
argument_list|,
name|isDir
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirX/dirY"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Delete the created dir
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Delete should succeed"
argument_list|,
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirX/dirY"
argument_list|)
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Deleted File should not exist"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/dirX/dirY"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Deleted Target should not exist"
argument_list|,
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirX/dirY"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Delete should succeed"
argument_list|,
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirX"
argument_list|)
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Deleted File should not exist"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/dirX"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Deleted Target should not exist"
argument_list|,
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirX"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Rename a file
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/user/foo"
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/fooBar"
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Renamed src should not exist"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|isFile
argument_list|(
name|fcView
argument_list|,
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/fooBar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|isFile
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/fooBar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|mkdir
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirFoo"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirFoo"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/dirFooBar"
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Renamed src should not exist"
argument_list|,
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user/dirFoo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertFalse
argument_list|(
literal|"Renamed src should not exist in target"
argument_list|,
name|exists
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirFoo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Renamed dest should  exist as dir"
argument_list|,
name|isDir
argument_list|(
name|fcView
argument_list|,
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/dirFooBar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Renamed dest should  exist as dir in target"
argument_list|,
name|isDir
argument_list|(
name|fcTarget
argument_list|,
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirFooBar"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Make a directory under a directory that's mounted from the root of another FS
name|fcView
operator|.
name|mkdir
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/targetRoot/dirFoo"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|exists
argument_list|(
name|fcView
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/targetRoot/dirFoo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|boolean
name|dirFooPresent
init|=
literal|false
decl_stmt|;
name|RemoteIterator
argument_list|<
name|FileStatus
argument_list|>
name|dirContents
init|=
name|fcView
operator|.
name|listStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/targetRoot/"
argument_list|)
argument_list|)
decl_stmt|;
while|while
condition|(
name|dirContents
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|FileStatus
name|fileStatus
init|=
name|dirContents
operator|.
name|next
argument_list|()
decl_stmt|;
if|if
condition|(
name|fileStatus
operator|.
name|getPath
argument_list|()
operator|.
name|getName
argument_list|()
operator|.
name|equals
argument_list|(
literal|"dirFoo"
argument_list|)
condition|)
block|{
name|dirFooPresent
operator|=
literal|true
expr_stmt|;
block|}
block|}
name|Assert
operator|.
name|assertTrue
argument_list|(
name|dirFooPresent
argument_list|)
expr_stmt|;
block|}
comment|// rename across mount points that point to same target also fail
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|IOException
operator|.
name|class
argument_list|)
DECL|method|testRenameAcrossMounts1 ()
specifier|public
name|void
name|testRenameAcrossMounts1
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/user/foo"
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/user2/fooBarBar"
argument_list|)
argument_list|)
expr_stmt|;
comment|/* - code if we had wanted this to succeed     Assert.assertFalse(exists(fc, new Path("/user/foo")));     Assert.assertFalse(exists(fclocal, new Path(targetTestRoot,"user/foo")));     Assert.assertTrue(isFile(fc,        FileContextTestHelper.getTestRootPath(fc,"/user2/fooBarBar")));     Assert.assertTrue(isFile(fclocal,         new Path(targetTestRoot,"user/fooBarBar")));     */
block|}
comment|// rename across mount points fail if the mount link targets are different
comment|// even if the targets are part of the same target FS
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|IOException
operator|.
name|class
argument_list|)
DECL|method|testRenameAcrossMounts2 ()
specifier|public
name|void
name|testRenameAcrossMounts2
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/user/foo"
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/data/fooBar"
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|field|SupportsBlocks
specifier|static
specifier|protected
name|boolean
name|SupportsBlocks
init|=
literal|false
decl_stmt|;
comment|//  local fs use 1 block
comment|// override for HDFS
annotation|@
name|Test
DECL|method|testGetBlockLocations ()
specifier|public
name|void
name|testGetBlockLocations
parameter_list|()
throws|throws
name|IOException
block|{
name|Path
name|targetFilePath
init|=
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"data/largeFile"
argument_list|)
decl_stmt|;
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcTarget
argument_list|,
name|targetFilePath
argument_list|,
literal|10
argument_list|,
literal|1024
argument_list|)
expr_stmt|;
name|Path
name|viewFilePath
init|=
operator|new
name|Path
argument_list|(
literal|"/data/largeFile"
argument_list|)
decl_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
name|viewFilePath
operator|.
name|toString
argument_list|()
argument_list|,
name|fileType
operator|.
name|isFile
argument_list|)
expr_stmt|;
name|BlockLocation
index|[]
name|viewBL
init|=
name|fcView
operator|.
name|getFileBlockLocations
argument_list|(
name|viewFilePath
argument_list|,
literal|0
argument_list|,
literal|10240
operator|+
literal|100
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|SupportsBlocks
condition|?
literal|10
else|:
literal|1
argument_list|,
name|viewBL
operator|.
name|length
argument_list|)
expr_stmt|;
name|BlockLocation
index|[]
name|targetBL
init|=
name|fcTarget
operator|.
name|getFileBlockLocations
argument_list|(
name|targetFilePath
argument_list|,
literal|0
argument_list|,
literal|10240
operator|+
literal|100
argument_list|)
decl_stmt|;
name|compareBLs
argument_list|(
name|viewBL
argument_list|,
name|targetBL
argument_list|)
expr_stmt|;
comment|// Same test but now get it via the FileStatus Parameter
name|fcView
operator|.
name|getFileBlockLocations
argument_list|(
name|viewFilePath
argument_list|,
literal|0
argument_list|,
literal|10240
operator|+
literal|100
argument_list|)
expr_stmt|;
name|targetBL
operator|=
name|fcTarget
operator|.
name|getFileBlockLocations
argument_list|(
name|targetFilePath
argument_list|,
literal|0
argument_list|,
literal|10240
operator|+
literal|100
argument_list|)
expr_stmt|;
name|compareBLs
argument_list|(
name|viewBL
argument_list|,
name|targetBL
argument_list|)
expr_stmt|;
block|}
DECL|method|compareBLs (BlockLocation[] viewBL, BlockLocation[] targetBL)
name|void
name|compareBLs
parameter_list|(
name|BlockLocation
index|[]
name|viewBL
parameter_list|,
name|BlockLocation
index|[]
name|targetBL
parameter_list|)
block|{
name|Assert
operator|.
name|assertEquals
argument_list|(
name|targetBL
operator|.
name|length
argument_list|,
name|viewBL
operator|.
name|length
argument_list|)
expr_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
for|for
control|(
name|BlockLocation
name|vbl
range|:
name|viewBL
control|)
block|{
name|Assert
operator|.
name|assertEquals
argument_list|(
name|vbl
operator|.
name|toString
argument_list|()
argument_list|,
name|targetBL
index|[
name|i
index|]
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|targetBL
index|[
name|i
index|]
operator|.
name|getOffset
argument_list|()
argument_list|,
name|vbl
operator|.
name|getOffset
argument_list|()
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|targetBL
index|[
name|i
index|]
operator|.
name|getLength
argument_list|()
argument_list|,
name|vbl
operator|.
name|getLength
argument_list|()
argument_list|)
expr_stmt|;
name|i
operator|++
expr_stmt|;
block|}
block|}
comment|/**    * Test "readOps" (e.g. list, listStatus)     * on internal dirs of mount table    * These operations should succeed.    */
comment|// test list on internal dirs of mount table
annotation|@
name|Test
DECL|method|testListOnInternalDirsOfMountTable ()
specifier|public
name|void
name|testListOnInternalDirsOfMountTable
parameter_list|()
throws|throws
name|IOException
block|{
comment|// list on Slash
name|FileStatus
index|[]
name|dirPaths
init|=
name|fcView
operator|.
name|util
argument_list|()
operator|.
name|listStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|)
decl_stmt|;
name|FileStatus
name|fs
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|7
argument_list|,
name|dirPaths
operator|.
name|length
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/user"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"A mount should appear as symlink"
argument_list|,
name|fs
operator|.
name|isSymlink
argument_list|()
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/data"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"A mount should appear as symlink"
argument_list|,
name|fs
operator|.
name|isSymlink
argument_list|()
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"InternalDirs should appear as dir"
argument_list|,
name|fs
operator|.
name|isDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/danglingLink"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"A mount should appear as symlink"
argument_list|,
name|fs
operator|.
name|isSymlink
argument_list|()
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/linkToAFile"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"A mount should appear as symlink"
argument_list|,
name|fs
operator|.
name|isSymlink
argument_list|()
argument_list|)
expr_stmt|;
comment|// list on internal dir
name|dirPaths
operator|=
name|fcView
operator|.
name|util
argument_list|()
operator|.
name|listStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir"
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|dirPaths
operator|.
name|length
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/internalDir2"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"InternalDirs should appear as dir"
argument_list|,
name|fs
operator|.
name|isDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|fs
operator|=
name|FileContextTestHelper
operator|.
name|containsPath
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/linkToDir2"
argument_list|,
name|dirPaths
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|fs
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"A mount should appear as symlink"
argument_list|,
name|fs
operator|.
name|isSymlink
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testFileStatusOnMountLink ()
specifier|public
name|void
name|testFileStatusOnMountLink
parameter_list|()
throws|throws
name|IOException
block|{
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Slash should appear as dir"
argument_list|,
name|fcView
operator|.
name|getFileStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|)
operator|.
name|isDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/user"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/data"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/linkToDir2"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/internalDir2/linkToDir3"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileStatus
argument_list|(
name|fcView
argument_list|,
literal|"/linkToAFile"
argument_list|,
name|fileType
operator|.
name|isFile
argument_list|)
expr_stmt|;
try|try
block|{
name|fcView
operator|.
name|getFileStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/danglingLink"
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|fail
argument_list|(
literal|"Excepted a not found exception here"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|FileNotFoundException
name|e
parameter_list|)
block|{
comment|// as excepted
block|}
block|}
annotation|@
name|Test
DECL|method|testGetFileChecksum ()
specifier|public
name|void
name|testGetFileChecksum
parameter_list|()
throws|throws
name|AccessControlException
throws|,
name|UnresolvedLinkException
throws|,
name|IOException
block|{
name|AbstractFileSystem
name|mockAFS
init|=
name|Mockito
operator|.
name|mock
argument_list|(
name|AbstractFileSystem
operator|.
name|class
argument_list|)
decl_stmt|;
name|InodeTree
operator|.
name|ResolveResult
argument_list|<
name|AbstractFileSystem
argument_list|>
name|res
init|=
operator|new
name|InodeTree
operator|.
name|ResolveResult
argument_list|<
name|AbstractFileSystem
argument_list|>
argument_list|(
literal|null
argument_list|,
name|mockAFS
argument_list|,
literal|null
argument_list|,
operator|new
name|Path
argument_list|(
literal|"someFile"
argument_list|)
argument_list|)
decl_stmt|;
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
name|InodeTree
argument_list|<
name|AbstractFileSystem
argument_list|>
name|fsState
init|=
name|Mockito
operator|.
name|mock
argument_list|(
name|InodeTree
operator|.
name|class
argument_list|)
decl_stmt|;
name|Mockito
operator|.
name|when
argument_list|(
name|fsState
operator|.
name|resolve
argument_list|(
name|Mockito
operator|.
name|anyString
argument_list|()
argument_list|,
name|Mockito
operator|.
name|anyBoolean
argument_list|()
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|res
argument_list|)
expr_stmt|;
name|ViewFs
name|vfs
init|=
name|Mockito
operator|.
name|mock
argument_list|(
name|ViewFs
operator|.
name|class
argument_list|)
decl_stmt|;
name|vfs
operator|.
name|fsState
operator|=
name|fsState
expr_stmt|;
name|Mockito
operator|.
name|when
argument_list|(
name|vfs
operator|.
name|getFileChecksum
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/tmp/someFile"
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenCallRealMethod
argument_list|()
expr_stmt|;
name|vfs
operator|.
name|getFileChecksum
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/tmp/someFile"
argument_list|)
argument_list|)
expr_stmt|;
name|Mockito
operator|.
name|verify
argument_list|(
name|mockAFS
argument_list|)
operator|.
name|getFileChecksum
argument_list|(
operator|new
name|Path
argument_list|(
literal|"someFile"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testgetFSonDanglingLink ()
specifier|public
name|void
name|testgetFSonDanglingLink
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|getFileStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/danglingLink"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testgetFSonNonExistingInternalDir ()
specifier|public
name|void
name|testgetFSonNonExistingInternalDir
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|getFileStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/nonExisting"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testgetFileLinkStatus ()
specifier|public
name|void
name|testgetFileLinkStatus
parameter_list|()
throws|throws
name|IOException
block|{
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/user"
argument_list|,
name|fileType
operator|.
name|isSymlink
argument_list|)
expr_stmt|;
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/data"
argument_list|,
name|fileType
operator|.
name|isSymlink
argument_list|)
expr_stmt|;
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/linkToDir2"
argument_list|,
name|fileType
operator|.
name|isSymlink
argument_list|)
expr_stmt|;
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/internalDir2/linkToDir3"
argument_list|,
name|fileType
operator|.
name|isSymlink
argument_list|)
expr_stmt|;
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/linkToAFile"
argument_list|,
name|fileType
operator|.
name|isSymlink
argument_list|)
expr_stmt|;
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
name|checkFileLinkStatus
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/internalDir2"
argument_list|,
name|fileType
operator|.
name|isDir
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testgetFileLinkStatusonNonExistingInternalDir ()
specifier|public
name|void
name|testgetFileLinkStatusonNonExistingInternalDir
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|getFileLinkStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/nonExisting"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSymlinkTarget ()
specifier|public
name|void
name|testSymlinkTarget
parameter_list|()
throws|throws
name|IOException
block|{
comment|// get link target`
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|getLinkTarget
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user"
argument_list|)
argument_list|)
argument_list|,
operator|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|getLinkTarget
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/data"
argument_list|)
argument_list|)
argument_list|,
operator|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"data"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|getLinkTarget
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|)
argument_list|,
operator|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|getLinkTarget
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/internalDir2/linkToDir3"
argument_list|)
argument_list|)
argument_list|,
operator|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir3"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|fcView
operator|.
name|getLinkTarget
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/linkToAFile"
argument_list|)
argument_list|)
argument_list|,
operator|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"aFile"
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|IOException
operator|.
name|class
argument_list|)
DECL|method|testgetLinkTargetOnNonLink ()
specifier|public
name|void
name|testgetLinkTargetOnNonLink
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|getLinkTarget
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/internalDir2"
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/*    * Test resolvePath(p)     * TODO In the tests below replace     * fcView.getDefaultFileSystem().resolvePath() fcView.resolvePath()    */
annotation|@
name|Test
DECL|method|testResolvePathInternalPaths ()
specifier|public
name|void
name|testResolvePathInternalPaths
parameter_list|()
throws|throws
name|IOException
block|{
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testResolvePathMountPoints ()
specifier|public
name|void
name|testResolvePathMountPoints
parameter_list|()
throws|throws
name|IOException
block|{
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"data"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/data"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir2"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"dir3"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/internalDir2/linkToDir3"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testResolvePathThroughMountPoints ()
specifier|public
name|void
name|testResolvePathThroughMountPoints
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/user/foo"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/foo"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/foo"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/dirX"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirX"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirX"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/dirX/dirY"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
operator|new
name|Path
argument_list|(
name|targetTestRoot
argument_list|,
literal|"user/dirX/dirY"
argument_list|)
argument_list|,
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirX/dirY"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testResolvePathDanglingLink ()
specifier|public
name|void
name|testResolvePathDanglingLink
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/danglingLink"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testResolvePathMissingThroughMountPoints ()
specifier|public
name|void
name|testResolvePathMissingThroughMountPoints
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/nonExisting"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testResolvePathMissingThroughMountPoints2 ()
specifier|public
name|void
name|testResolvePathMissingThroughMountPoints2
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/user/dirX"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|resolvePath
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user/dirX/nonExisting"
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/**    * Test modify operations (create, mkdir, rename, etc)     * on internal dirs of mount table    * These operations should fail since the mount table is read-only or    * because the internal dir that it is trying to create already    * exits.    */
comment|// Mkdir on internal mount table should fail
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalMkdirSlash ()
specifier|public
name|void
name|testInternalMkdirSlash
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalMkdirExisting1 ()
specifier|public
name|void
name|testInternalMkdirExisting1
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalMkdirExisting2 ()
specifier|public
name|void
name|testInternalMkdirExisting2
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalMkdirNew ()
specifier|public
name|void
name|testInternalMkdirNew
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/dirNew"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalMkdirNew2 ()
specifier|public
name|void
name|testInternalMkdirNew2
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|mkdir
argument_list|(
name|FileContextTestHelper
operator|.
name|getTestRootPath
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/dirNew"
argument_list|)
argument_list|,
name|FileContext
operator|.
name|DEFAULT_PERM
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
comment|// Create on internal mount table should fail
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalCreate1 ()
specifier|public
name|void
name|testInternalCreate1
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFileNonRecursive
argument_list|(
name|fcView
argument_list|,
literal|"/foo"
argument_list|)
expr_stmt|;
comment|// 1 component
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalCreate2 ()
specifier|public
name|void
name|testInternalCreate2
parameter_list|()
throws|throws
name|IOException
block|{
comment|// 2 component
name|FileContextTestHelper
operator|.
name|createFileNonRecursive
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/foo"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalCreateMissingDir ()
specifier|public
name|void
name|testInternalCreateMissingDir
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/missingDir/foo"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalCreateMissingDir2 ()
specifier|public
name|void
name|testInternalCreateMissingDir2
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/missingDir/miss2/foo"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalCreateMissingDir3 ()
specifier|public
name|void
name|testInternalCreateMissingDir3
parameter_list|()
throws|throws
name|IOException
block|{
name|FileContextTestHelper
operator|.
name|createFile
argument_list|(
name|fcView
argument_list|,
literal|"/internalDir/miss2/foo"
argument_list|)
expr_stmt|;
block|}
comment|// Delete on internal mount table should fail
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testInternalDeleteNonExisting ()
specifier|public
name|void
name|testInternalDeleteNonExisting
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/NonExisting"
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|FileNotFoundException
operator|.
name|class
argument_list|)
DECL|method|testInternalDeleteNonExisting2 ()
specifier|public
name|void
name|testInternalDeleteNonExisting2
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/NonExisting"
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalDeleteExisting ()
specifier|public
name|void
name|testInternalDeleteExisting
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir"
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalDeleteExisting2 ()
specifier|public
name|void
name|testInternalDeleteExisting2
parameter_list|()
throws|throws
name|IOException
block|{
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"Delete of link to dir should succeed"
argument_list|,
name|fcView
operator|.
name|getFileStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|)
operator|.
name|isDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|delete
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
comment|// Rename on internal mount table should fail
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalRename1 ()
specifier|public
name|void
name|testInternalRename1
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/newDir"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalRename2 ()
specifier|public
name|void
name|testInternalRename2
parameter_list|()
throws|throws
name|IOException
block|{
name|Assert
operator|.
name|assertTrue
argument_list|(
literal|"linkTODir2 should be a dir"
argument_list|,
name|fcView
operator|.
name|getFileStatus
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|)
operator|.
name|isDirectory
argument_list|()
argument_list|)
expr_stmt|;
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/dir1"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalRename3 ()
specifier|public
name|void
name|testInternalRename3
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/user"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalRenameToSlash ()
specifier|public
name|void
name|testInternalRenameToSlash
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir/linkToDir2/foo"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalRenameFromSlash ()
specifier|public
name|void
name|testInternalRenameFromSlash
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|rename
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/"
argument_list|)
argument_list|,
operator|new
name|Path
argument_list|(
literal|"/bar"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|expected
operator|=
name|AccessControlException
operator|.
name|class
argument_list|)
DECL|method|testInternalSetOwner ()
specifier|public
name|void
name|testInternalSetOwner
parameter_list|()
throws|throws
name|IOException
block|{
name|fcView
operator|.
name|setOwner
argument_list|(
operator|new
name|Path
argument_list|(
literal|"/internalDir"
argument_list|)
argument_list|,
literal|"foo"
argument_list|,
literal|"bar"
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

