begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *<p>  * http://www.apache.org/licenses/LICENSE-2.0  *<p>  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.ozone.om.protocolPB
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|protocolPB
package|;
end_package

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|base
operator|.
name|Preconditions
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|base
operator|.
name|Strings
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|RpcController
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|ServiceException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|classification
operator|.
name|InterfaceAudience
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|Text
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|ProtobufHelper
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|ProtocolTranslator
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|KeyValueUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmBucketArgs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmBucketInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmKeyArgs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmKeyInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmKeyLocationInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmMultipartCommitUploadPartInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmMultipartInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmMultipartUploadCompleteInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmMultipartUploadList
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OmVolumeArgs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|OpenKeySession
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|S3SecretValue
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|helpers
operator|.
name|ServiceInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|om
operator|.
name|protocol
operator|.
name|OzoneManagerProtocol
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|AllocateBlockRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|AllocateBlockResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CreateKeyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CreateKeyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CommitKeyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CommitKeyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|DeleteKeyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|DeleteKeyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|BucketArgs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|BucketInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CreateBucketRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CreateBucketResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|InfoBucketRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|InfoBucketResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|SetBucketPropertyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|SetBucketPropertyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|DeleteBucketRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|DeleteBucketResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CreateVolumeRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CreateVolumeResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|LookupKeyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|LookupKeyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartCommitUploadPartRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartCommitUploadPartResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartInfoInitiateRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartInfoInitiateResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartUploadAbortRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartUploadAbortResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartUploadCompleteRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|MultipartUploadCompleteResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|RenameKeyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|RenameKeyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|KeyArgs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|SetVolumePropertyRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|SetVolumePropertyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|DeleteVolumeRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|DeleteVolumeResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|InfoVolumeRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|InfoVolumeResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CheckVolumeAccessRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CheckVolumeAccessResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ListBucketsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ListBucketsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ListKeysRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ListKeysResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|VolumeInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|Status
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|OzoneAclInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ListVolumeRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ListVolumeResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ServiceListRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|ServiceListResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3CreateBucketRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3CreateBucketResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3DeleteBucketRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3DeleteBucketResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3BucketInfoRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3BucketInfoResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3ListBucketsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|S3ListBucketsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|GetS3SecretRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|GetS3SecretResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|OMRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|OMResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|Type
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|Closeable
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|stream
operator|.
name|Collectors
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocolPB
operator|.
name|OMPBHelper
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|security
operator|.
name|OzoneTokenIdentifier
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|proto
operator|.
name|SecurityProtos
operator|.
name|GetDelegationTokenRequestProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|GetDelegationTokenResponseProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|proto
operator|.
name|SecurityProtos
operator|.
name|RenewDelegationTokenRequestProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|RenewDelegationTokenResponseProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|proto
operator|.
name|SecurityProtos
operator|.
name|CancelDelegationTokenRequestProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|protocol
operator|.
name|proto
operator|.
name|OzoneManagerProtocolProtos
operator|.
name|CancelDelegationTokenResponseProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|token
operator|.
name|Token
import|;
end_import

begin_comment
comment|/**  *  The client side implementation of OzoneManagerProtocol.  */
end_comment

begin_class
annotation|@
name|InterfaceAudience
operator|.
name|Private
DECL|class|OzoneManagerProtocolClientSideTranslatorPB
specifier|public
specifier|final
class|class
name|OzoneManagerProtocolClientSideTranslatorPB
implements|implements
name|OzoneManagerProtocol
implements|,
name|ProtocolTranslator
implements|,
name|Closeable
block|{
comment|/**    * RpcController is not used and hence is set to null.    */
DECL|field|NULL_RPC_CONTROLLER
specifier|private
specifier|static
specifier|final
name|RpcController
name|NULL_RPC_CONTROLLER
init|=
literal|null
decl_stmt|;
DECL|field|rpcProxy
specifier|private
specifier|final
name|OzoneManagerProtocolPB
name|rpcProxy
decl_stmt|;
DECL|field|clientID
specifier|private
specifier|final
name|String
name|clientID
decl_stmt|;
comment|/**    * Constructor for KeySpaceManger Client.    * @param rpcProxy    */
DECL|method|OzoneManagerProtocolClientSideTranslatorPB ( OzoneManagerProtocolPB rpcProxy, String clientId)
specifier|public
name|OzoneManagerProtocolClientSideTranslatorPB
parameter_list|(
name|OzoneManagerProtocolPB
name|rpcProxy
parameter_list|,
name|String
name|clientId
parameter_list|)
block|{
name|this
operator|.
name|rpcProxy
operator|=
name|rpcProxy
expr_stmt|;
name|this
operator|.
name|clientID
operator|=
name|clientId
expr_stmt|;
block|}
comment|/**    * Closes this stream and releases any system resources associated    * with it. If the stream is already closed then invoking this    * method has no effect.    *<p>    *<p> As noted in {@link AutoCloseable#close()}, cases where the    * close may fail require careful attention. It is strongly advised    * to relinquish the underlying resources and to internally    *<em>mark</em> the {@code Closeable} as closed, prior to throwing    * the {@code IOException}.    *    * @throws IOException if an I/O error occurs    */
annotation|@
name|Override
DECL|method|close ()
specifier|public
name|void
name|close
parameter_list|()
throws|throws
name|IOException
block|{    }
comment|/**    * Return the proxy object underlying this protocol translator.    *    * @return the proxy object underlying this protocol translator.    */
annotation|@
name|Override
DECL|method|getUnderlyingProxyObject ()
specifier|public
name|Object
name|getUnderlyingProxyObject
parameter_list|()
block|{
return|return
name|rpcProxy
return|;
block|}
comment|/**    * Returns a OMRequest builder with specified type.    * @param cmdType type of the request    */
DECL|method|createOMRequest (Type cmdType)
specifier|private
name|OMRequest
operator|.
name|Builder
name|createOMRequest
parameter_list|(
name|Type
name|cmdType
parameter_list|)
block|{
return|return
name|OMRequest
operator|.
name|newBuilder
argument_list|()
operator|.
name|setCmdType
argument_list|(
name|cmdType
argument_list|)
operator|.
name|setClientId
argument_list|(
name|clientID
argument_list|)
return|;
block|}
comment|/**    * Submits client request to OM server.    * @param omRequest client request    * @return response from OM    * @throws IOException thrown if any Protobuf service exception occurs    */
DECL|method|submitRequest (OMRequest omRequest)
specifier|private
name|OMResponse
name|submitRequest
parameter_list|(
name|OMRequest
name|omRequest
parameter_list|)
throws|throws
name|IOException
block|{
try|try
block|{
return|return
name|rpcProxy
operator|.
name|submitRequest
argument_list|(
name|NULL_RPC_CONTROLLER
argument_list|,
name|omRequest
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|ServiceException
name|e
parameter_list|)
block|{
throw|throw
name|ProtobufHelper
operator|.
name|getRemoteException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
comment|/**    * Creates a volume.    *    * @param args - Arguments to create Volume.    * @throws IOException    */
annotation|@
name|Override
DECL|method|createVolume (OmVolumeArgs args)
specifier|public
name|void
name|createVolume
parameter_list|(
name|OmVolumeArgs
name|args
parameter_list|)
throws|throws
name|IOException
block|{
name|CreateVolumeRequest
operator|.
name|Builder
name|req
init|=
name|CreateVolumeRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|VolumeInfo
name|volumeInfo
init|=
name|args
operator|.
name|getProtobuf
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeInfo
argument_list|(
name|volumeInfo
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CreateVolume
argument_list|)
operator|.
name|setCreateVolumeRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|CreateVolumeResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCreateVolumeResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Volume creation failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Changes the owner of a volume.    *    * @param volume - Name of the volume.    * @param owner - Name of the owner.    * @throws IOException    */
annotation|@
name|Override
DECL|method|setOwner (String volume, String owner)
specifier|public
name|void
name|setOwner
parameter_list|(
name|String
name|volume
parameter_list|,
name|String
name|owner
parameter_list|)
throws|throws
name|IOException
block|{
name|SetVolumePropertyRequest
operator|.
name|Builder
name|req
init|=
name|SetVolumePropertyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
operator|.
name|setOwnerName
argument_list|(
name|owner
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|SetVolumeProperty
argument_list|)
operator|.
name|setSetVolumePropertyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|SetVolumePropertyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getSetVolumePropertyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Volume owner change failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Changes the Quota on a volume.    *    * @param volume - Name of the volume.    * @param quota - Quota in bytes.    * @throws IOException    */
annotation|@
name|Override
DECL|method|setQuota (String volume, long quota)
specifier|public
name|void
name|setQuota
parameter_list|(
name|String
name|volume
parameter_list|,
name|long
name|quota
parameter_list|)
throws|throws
name|IOException
block|{
name|SetVolumePropertyRequest
operator|.
name|Builder
name|req
init|=
name|SetVolumePropertyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
operator|.
name|setQuotaInBytes
argument_list|(
name|quota
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|SetVolumeProperty
argument_list|)
operator|.
name|setSetVolumePropertyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|SetVolumePropertyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getSetVolumePropertyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Volume quota change failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Checks if the specified user can access this volume.    *    * @param volume - volume    * @param userAcl - user acls which needs to be checked for access    * @return true if the user has required access for the volume,    *         false otherwise    * @throws IOException    */
annotation|@
name|Override
DECL|method|checkVolumeAccess (String volume, OzoneAclInfo userAcl)
specifier|public
name|boolean
name|checkVolumeAccess
parameter_list|(
name|String
name|volume
parameter_list|,
name|OzoneAclInfo
name|userAcl
parameter_list|)
throws|throws
name|IOException
block|{
name|CheckVolumeAccessRequest
operator|.
name|Builder
name|req
init|=
name|CheckVolumeAccessRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
operator|.
name|setUserAcl
argument_list|(
name|userAcl
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CheckVolumeAccess
argument_list|)
operator|.
name|setCheckVolumeAccessRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|CheckVolumeAccessResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCheckVolumeAccessResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|ACCESS_DENIED
condition|)
block|{
return|return
literal|false
return|;
block|}
elseif|else
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
return|return
literal|true
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Check Volume Access failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Gets the volume information.    *    * @param volume - Volume name.    * @return OmVolumeArgs or exception is thrown.    * @throws IOException    */
annotation|@
name|Override
DECL|method|getVolumeInfo (String volume)
specifier|public
name|OmVolumeArgs
name|getVolumeInfo
parameter_list|(
name|String
name|volume
parameter_list|)
throws|throws
name|IOException
block|{
name|InfoVolumeRequest
operator|.
name|Builder
name|req
init|=
name|InfoVolumeRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|InfoVolume
argument_list|)
operator|.
name|setInfoVolumeRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|InfoVolumeResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getInfoVolumeResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Info Volume failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
name|OmVolumeArgs
operator|.
name|getFromProtobuf
argument_list|(
name|resp
operator|.
name|getVolumeInfo
argument_list|()
argument_list|)
return|;
block|}
comment|/**    * Deletes an existing empty volume.    *    * @param volume - Name of the volume.    * @throws IOException    */
annotation|@
name|Override
DECL|method|deleteVolume (String volume)
specifier|public
name|void
name|deleteVolume
parameter_list|(
name|String
name|volume
parameter_list|)
throws|throws
name|IOException
block|{
name|DeleteVolumeRequest
operator|.
name|Builder
name|req
init|=
name|DeleteVolumeRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|DeleteVolume
argument_list|)
operator|.
name|setDeleteVolumeRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|DeleteVolumeResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getDeleteVolumeResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Delete Volume failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Lists volume owned by a specific user.    *    * @param userName - user name    * @param prefix - Filter prefix -- Return only entries that match this.    * @param prevKey - Previous key -- List starts from the next from the    * prevkey    * @param maxKeys - Max number of keys to return.    * @return List of Volumes.    * @throws IOException    */
annotation|@
name|Override
DECL|method|listVolumeByUser (String userName, String prefix, String prevKey, int maxKeys)
specifier|public
name|List
argument_list|<
name|OmVolumeArgs
argument_list|>
name|listVolumeByUser
parameter_list|(
name|String
name|userName
parameter_list|,
name|String
name|prefix
parameter_list|,
name|String
name|prevKey
parameter_list|,
name|int
name|maxKeys
parameter_list|)
throws|throws
name|IOException
block|{
name|ListVolumeRequest
operator|.
name|Builder
name|builder
init|=
name|ListVolumeRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|Strings
operator|.
name|isNullOrEmpty
argument_list|(
name|prefix
argument_list|)
condition|)
block|{
name|builder
operator|.
name|setPrefix
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|Strings
operator|.
name|isNullOrEmpty
argument_list|(
name|prevKey
argument_list|)
condition|)
block|{
name|builder
operator|.
name|setPrevKey
argument_list|(
name|prevKey
argument_list|)
expr_stmt|;
block|}
name|builder
operator|.
name|setMaxKeys
argument_list|(
name|maxKeys
argument_list|)
expr_stmt|;
name|builder
operator|.
name|setUserName
argument_list|(
name|userName
argument_list|)
expr_stmt|;
name|builder
operator|.
name|setScope
argument_list|(
name|ListVolumeRequest
operator|.
name|Scope
operator|.
name|VOLUMES_BY_USER
argument_list|)
expr_stmt|;
return|return
name|listVolume
argument_list|(
name|builder
operator|.
name|build
argument_list|()
argument_list|)
return|;
block|}
comment|/**    * Lists volume all volumes in the cluster.    *    * @param prefix - Filter prefix -- Return only entries that match this.    * @param prevKey - Previous key -- List starts from the next from the    * prevkey    * @param maxKeys - Max number of keys to return.    * @return List of Volumes.    * @throws IOException    */
annotation|@
name|Override
DECL|method|listAllVolumes (String prefix, String prevKey, int maxKeys)
specifier|public
name|List
argument_list|<
name|OmVolumeArgs
argument_list|>
name|listAllVolumes
parameter_list|(
name|String
name|prefix
parameter_list|,
name|String
name|prevKey
parameter_list|,
name|int
name|maxKeys
parameter_list|)
throws|throws
name|IOException
block|{
name|ListVolumeRequest
operator|.
name|Builder
name|builder
init|=
name|ListVolumeRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|Strings
operator|.
name|isNullOrEmpty
argument_list|(
name|prefix
argument_list|)
condition|)
block|{
name|builder
operator|.
name|setPrefix
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|Strings
operator|.
name|isNullOrEmpty
argument_list|(
name|prevKey
argument_list|)
condition|)
block|{
name|builder
operator|.
name|setPrevKey
argument_list|(
name|prevKey
argument_list|)
expr_stmt|;
block|}
name|builder
operator|.
name|setMaxKeys
argument_list|(
name|maxKeys
argument_list|)
expr_stmt|;
name|builder
operator|.
name|setScope
argument_list|(
name|ListVolumeRequest
operator|.
name|Scope
operator|.
name|VOLUMES_BY_CLUSTER
argument_list|)
expr_stmt|;
return|return
name|listVolume
argument_list|(
name|builder
operator|.
name|build
argument_list|()
argument_list|)
return|;
block|}
DECL|method|listVolume (ListVolumeRequest request)
specifier|private
name|List
argument_list|<
name|OmVolumeArgs
argument_list|>
name|listVolume
parameter_list|(
name|ListVolumeRequest
name|request
parameter_list|)
throws|throws
name|IOException
block|{
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|ListVolume
argument_list|)
operator|.
name|setListVolumeRequest
argument_list|(
name|request
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|ListVolumeResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getListVolumeResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"List volume failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
name|resp
operator|.
name|getVolumeInfoList
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|item
lambda|->
name|OmVolumeArgs
operator|.
name|getFromProtobuf
argument_list|(
name|item
argument_list|)
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
return|;
block|}
comment|/**    * Creates a bucket.    *    * @param bucketInfo - BucketInfo to create bucket.    * @throws IOException    */
annotation|@
name|Override
DECL|method|createBucket (OmBucketInfo bucketInfo)
specifier|public
name|void
name|createBucket
parameter_list|(
name|OmBucketInfo
name|bucketInfo
parameter_list|)
throws|throws
name|IOException
block|{
name|CreateBucketRequest
operator|.
name|Builder
name|req
init|=
name|CreateBucketRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|BucketInfo
name|bucketInfoProtobuf
init|=
name|bucketInfo
operator|.
name|getProtobuf
argument_list|()
decl_stmt|;
name|req
operator|.
name|setBucketInfo
argument_list|(
name|bucketInfoProtobuf
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CreateBucket
argument_list|)
operator|.
name|setCreateBucketRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|CreateBucketResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCreateBucketResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Bucket creation failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Gets the bucket information.    *    * @param volume - Volume name.    * @param bucket - Bucket name.    * @return OmBucketInfo or exception is thrown.    * @throws IOException    */
annotation|@
name|Override
DECL|method|getBucketInfo (String volume, String bucket)
specifier|public
name|OmBucketInfo
name|getBucketInfo
parameter_list|(
name|String
name|volume
parameter_list|,
name|String
name|bucket
parameter_list|)
throws|throws
name|IOException
block|{
name|InfoBucketRequest
operator|.
name|Builder
name|req
init|=
name|InfoBucketRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
expr_stmt|;
name|req
operator|.
name|setBucketName
argument_list|(
name|bucket
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|InfoBucket
argument_list|)
operator|.
name|setInfoBucketRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|InfoBucketResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getInfoBucketResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
return|return
name|OmBucketInfo
operator|.
name|getFromProtobuf
argument_list|(
name|resp
operator|.
name|getBucketInfo
argument_list|()
argument_list|)
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Info Bucket failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Sets bucket property from args.    * @param args - BucketArgs.    * @throws IOException    */
annotation|@
name|Override
DECL|method|setBucketProperty (OmBucketArgs args)
specifier|public
name|void
name|setBucketProperty
parameter_list|(
name|OmBucketArgs
name|args
parameter_list|)
throws|throws
name|IOException
block|{
name|SetBucketPropertyRequest
operator|.
name|Builder
name|req
init|=
name|SetBucketPropertyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|BucketArgs
name|bucketArgs
init|=
name|args
operator|.
name|getProtobuf
argument_list|()
decl_stmt|;
name|req
operator|.
name|setBucketArgs
argument_list|(
name|bucketArgs
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|SetBucketProperty
argument_list|)
operator|.
name|setSetBucketPropertyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|SetBucketPropertyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getSetBucketPropertyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Setting bucket property failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * List buckets in a volume.    *    * @param volumeName    * @param startKey    * @param prefix    * @param count    * @return    * @throws IOException    */
annotation|@
name|Override
DECL|method|listBuckets (String volumeName, String startKey, String prefix, int count)
specifier|public
name|List
argument_list|<
name|OmBucketInfo
argument_list|>
name|listBuckets
parameter_list|(
name|String
name|volumeName
parameter_list|,
name|String
name|startKey
parameter_list|,
name|String
name|prefix
parameter_list|,
name|int
name|count
parameter_list|)
throws|throws
name|IOException
block|{
name|List
argument_list|<
name|OmBucketInfo
argument_list|>
name|buckets
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
name|ListBucketsRequest
operator|.
name|Builder
name|reqBuilder
init|=
name|ListBucketsRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|reqBuilder
operator|.
name|setVolumeName
argument_list|(
name|volumeName
argument_list|)
expr_stmt|;
name|reqBuilder
operator|.
name|setCount
argument_list|(
name|count
argument_list|)
expr_stmt|;
if|if
condition|(
name|startKey
operator|!=
literal|null
condition|)
block|{
name|reqBuilder
operator|.
name|setStartKey
argument_list|(
name|startKey
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|prefix
operator|!=
literal|null
condition|)
block|{
name|reqBuilder
operator|.
name|setPrefix
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
block|}
name|ListBucketsRequest
name|request
init|=
name|reqBuilder
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|ListBuckets
argument_list|)
operator|.
name|setListBucketsRequest
argument_list|(
name|request
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|ListBucketsResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getListBucketsResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
name|buckets
operator|.
name|addAll
argument_list|(
name|resp
operator|.
name|getBucketInfoList
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|OmBucketInfo
operator|::
name|getFromProtobuf
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|buckets
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"List Buckets failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Create a new open session of the key, then use the returned meta info to    * talk to data node to actually write the key.    * @param args the args for the key to be allocated    * @return a handler to the key, returned client    * @throws IOException    */
annotation|@
name|Override
DECL|method|openKey (OmKeyArgs args)
specifier|public
name|OpenKeySession
name|openKey
parameter_list|(
name|OmKeyArgs
name|args
parameter_list|)
throws|throws
name|IOException
block|{
name|CreateKeyRequest
operator|.
name|Builder
name|req
init|=
name|CreateKeyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
operator|.
name|Builder
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|args
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|args
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|args
operator|.
name|getKeyName
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|args
operator|.
name|getFactor
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|keyArgs
operator|.
name|setFactor
argument_list|(
name|args
operator|.
name|getFactor
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|args
operator|.
name|getType
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|keyArgs
operator|.
name|setType
argument_list|(
name|args
operator|.
name|getType
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|args
operator|.
name|getDataSize
argument_list|()
operator|>
literal|0
condition|)
block|{
name|keyArgs
operator|.
name|setDataSize
argument_list|(
name|args
operator|.
name|getDataSize
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|args
operator|.
name|getMetadata
argument_list|()
operator|!=
literal|null
operator|&&
name|args
operator|.
name|getMetadata
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|)
block|{
name|keyArgs
operator|.
name|addAllMetadata
argument_list|(
name|KeyValueUtil
operator|.
name|toProtobuf
argument_list|(
name|args
operator|.
name|getMetadata
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|args
operator|.
name|getMultipartUploadID
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|keyArgs
operator|.
name|setMultipartUploadID
argument_list|(
name|args
operator|.
name|getMultipartUploadID
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|args
operator|.
name|getMultipartUploadPartNumber
argument_list|()
operator|>
literal|0
condition|)
block|{
name|keyArgs
operator|.
name|setMultipartNumber
argument_list|(
name|args
operator|.
name|getMultipartUploadPartNumber
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|keyArgs
operator|.
name|setIsMultipartKey
argument_list|(
name|args
operator|.
name|getIsMultipartKey
argument_list|()
argument_list|)
expr_stmt|;
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CreateKey
argument_list|)
operator|.
name|setCreateKeyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|CreateKeyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCreateKeyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Create key failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
operator|new
name|OpenKeySession
argument_list|(
name|resp
operator|.
name|getID
argument_list|()
argument_list|,
name|OmKeyInfo
operator|.
name|getFromProtobuf
argument_list|(
name|resp
operator|.
name|getKeyInfo
argument_list|()
argument_list|)
argument_list|,
name|resp
operator|.
name|getOpenVersion
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|allocateBlock (OmKeyArgs args, long clientId)
specifier|public
name|OmKeyLocationInfo
name|allocateBlock
parameter_list|(
name|OmKeyArgs
name|args
parameter_list|,
name|long
name|clientId
parameter_list|)
throws|throws
name|IOException
block|{
name|AllocateBlockRequest
operator|.
name|Builder
name|req
init|=
name|AllocateBlockRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|args
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|args
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|args
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setDataSize
argument_list|(
name|args
operator|.
name|getDataSize
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
argument_list|)
expr_stmt|;
name|req
operator|.
name|setClientID
argument_list|(
name|clientId
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|AllocateBlock
argument_list|)
operator|.
name|setAllocateBlockRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|AllocateBlockResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getAllocateBlockResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Allocate block failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
name|OmKeyLocationInfo
operator|.
name|getFromProtobuf
argument_list|(
name|resp
operator|.
name|getKeyLocation
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|commitKey (OmKeyArgs args, long clientId)
specifier|public
name|void
name|commitKey
parameter_list|(
name|OmKeyArgs
name|args
parameter_list|,
name|long
name|clientId
parameter_list|)
throws|throws
name|IOException
block|{
name|CommitKeyRequest
operator|.
name|Builder
name|req
init|=
name|CommitKeyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|OmKeyLocationInfo
argument_list|>
name|locationInfoList
init|=
name|args
operator|.
name|getLocationInfoList
argument_list|()
decl_stmt|;
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|locationInfoList
argument_list|)
expr_stmt|;
name|KeyArgs
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|args
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|args
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|args
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setDataSize
argument_list|(
name|args
operator|.
name|getDataSize
argument_list|()
argument_list|)
operator|.
name|addAllKeyLocations
argument_list|(
name|locationInfoList
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|OmKeyLocationInfo
operator|::
name|getProtobuf
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
argument_list|)
expr_stmt|;
name|req
operator|.
name|setClientID
argument_list|(
name|clientId
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CommitKey
argument_list|)
operator|.
name|setCommitKeyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|CommitKeyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCommitKeyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Commit key failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
DECL|method|lookupKey (OmKeyArgs args)
specifier|public
name|OmKeyInfo
name|lookupKey
parameter_list|(
name|OmKeyArgs
name|args
parameter_list|)
throws|throws
name|IOException
block|{
name|LookupKeyRequest
operator|.
name|Builder
name|req
init|=
name|LookupKeyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|args
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|args
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|args
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setDataSize
argument_list|(
name|args
operator|.
name|getDataSize
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|LookupKey
argument_list|)
operator|.
name|setLookupKeyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|LookupKeyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getLookupKeyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Lookup key failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
name|OmKeyInfo
operator|.
name|getFromProtobuf
argument_list|(
name|resp
operator|.
name|getKeyInfo
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|renameKey (OmKeyArgs args, String toKeyName)
specifier|public
name|void
name|renameKey
parameter_list|(
name|OmKeyArgs
name|args
parameter_list|,
name|String
name|toKeyName
parameter_list|)
throws|throws
name|IOException
block|{
name|RenameKeyRequest
operator|.
name|Builder
name|req
init|=
name|RenameKeyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|args
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|args
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|args
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setDataSize
argument_list|(
name|args
operator|.
name|getDataSize
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
argument_list|)
expr_stmt|;
name|req
operator|.
name|setToKeyName
argument_list|(
name|toKeyName
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|RenameKey
argument_list|)
operator|.
name|setRenameKeyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|RenameKeyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getRenameKeyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Rename key failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Deletes an existing key.    *    * @param args the args of the key.    * @throws IOException    */
annotation|@
name|Override
DECL|method|deleteKey (OmKeyArgs args)
specifier|public
name|void
name|deleteKey
parameter_list|(
name|OmKeyArgs
name|args
parameter_list|)
throws|throws
name|IOException
block|{
name|DeleteKeyRequest
operator|.
name|Builder
name|req
init|=
name|DeleteKeyRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|args
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|args
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|args
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|req
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|DeleteKey
argument_list|)
operator|.
name|setDeleteKeyRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|DeleteKeyResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getDeleteKeyResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Delete key failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Deletes an existing empty bucket from volume.    * @param volume - Name of the volume.    * @param bucket - Name of the bucket.    * @throws IOException    */
DECL|method|deleteBucket (String volume, String bucket)
specifier|public
name|void
name|deleteBucket
parameter_list|(
name|String
name|volume
parameter_list|,
name|String
name|bucket
parameter_list|)
throws|throws
name|IOException
block|{
name|DeleteBucketRequest
operator|.
name|Builder
name|req
init|=
name|DeleteBucketRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|req
operator|.
name|setVolumeName
argument_list|(
name|volume
argument_list|)
expr_stmt|;
name|req
operator|.
name|setBucketName
argument_list|(
name|bucket
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|DeleteBucket
argument_list|)
operator|.
name|setDeleteBucketRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|DeleteBucketResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getDeleteBucketResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Delete Bucket failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * List keys in a bucket.    */
annotation|@
name|Override
DECL|method|listKeys (String volumeName, String bucketName, String startKey, String prefix, int maxKeys)
specifier|public
name|List
argument_list|<
name|OmKeyInfo
argument_list|>
name|listKeys
parameter_list|(
name|String
name|volumeName
parameter_list|,
name|String
name|bucketName
parameter_list|,
name|String
name|startKey
parameter_list|,
name|String
name|prefix
parameter_list|,
name|int
name|maxKeys
parameter_list|)
throws|throws
name|IOException
block|{
name|List
argument_list|<
name|OmKeyInfo
argument_list|>
name|keys
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
name|ListKeysRequest
operator|.
name|Builder
name|reqBuilder
init|=
name|ListKeysRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|reqBuilder
operator|.
name|setVolumeName
argument_list|(
name|volumeName
argument_list|)
expr_stmt|;
name|reqBuilder
operator|.
name|setBucketName
argument_list|(
name|bucketName
argument_list|)
expr_stmt|;
name|reqBuilder
operator|.
name|setCount
argument_list|(
name|maxKeys
argument_list|)
expr_stmt|;
if|if
condition|(
name|startKey
operator|!=
literal|null
condition|)
block|{
name|reqBuilder
operator|.
name|setStartKey
argument_list|(
name|startKey
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|prefix
operator|!=
literal|null
condition|)
block|{
name|reqBuilder
operator|.
name|setPrefix
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
block|}
name|ListKeysRequest
name|req
init|=
name|reqBuilder
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|ListKeys
argument_list|)
operator|.
name|setListKeysRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|ListKeysResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getListKeysResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
name|keys
operator|.
name|addAll
argument_list|(
name|resp
operator|.
name|getKeyInfoList
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|OmKeyInfo
operator|::
name|getFromProtobuf
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|keys
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"List Keys failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
DECL|method|createS3Bucket (String userName, String s3BucketName)
specifier|public
name|void
name|createS3Bucket
parameter_list|(
name|String
name|userName
parameter_list|,
name|String
name|s3BucketName
parameter_list|)
throws|throws
name|IOException
block|{
name|S3CreateBucketRequest
name|req
init|=
name|S3CreateBucketRequest
operator|.
name|newBuilder
argument_list|()
operator|.
name|setUserName
argument_list|(
name|userName
argument_list|)
operator|.
name|setS3Bucketname
argument_list|(
name|s3BucketName
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CreateS3Bucket
argument_list|)
operator|.
name|setCreateS3BucketRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|S3CreateBucketResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCreateS3BucketResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Creating S3 bucket failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
DECL|method|deleteS3Bucket (String s3BucketName)
specifier|public
name|void
name|deleteS3Bucket
parameter_list|(
name|String
name|s3BucketName
parameter_list|)
throws|throws
name|IOException
block|{
name|S3DeleteBucketRequest
name|request
init|=
name|S3DeleteBucketRequest
operator|.
name|newBuilder
argument_list|()
operator|.
name|setS3BucketName
argument_list|(
name|s3BucketName
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|DeleteS3Bucket
argument_list|)
operator|.
name|setDeleteS3BucketRequest
argument_list|(
name|request
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|S3DeleteBucketResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getDeleteS3BucketResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Creating S3 bucket failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
DECL|method|getOzoneBucketMapping (String s3BucketName)
specifier|public
name|String
name|getOzoneBucketMapping
parameter_list|(
name|String
name|s3BucketName
parameter_list|)
throws|throws
name|IOException
block|{
name|S3BucketInfoRequest
name|request
init|=
name|S3BucketInfoRequest
operator|.
name|newBuilder
argument_list|()
operator|.
name|setS3BucketName
argument_list|(
name|s3BucketName
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|InfoS3Bucket
argument_list|)
operator|.
name|setInfoS3BucketRequest
argument_list|(
name|request
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|S3BucketInfoResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getInfoS3BucketResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"GetOzoneBucketMapping failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
name|resp
operator|.
name|getOzoneMapping
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|listS3Buckets (String userName, String startKey, String prefix, int count)
specifier|public
name|List
argument_list|<
name|OmBucketInfo
argument_list|>
name|listS3Buckets
parameter_list|(
name|String
name|userName
parameter_list|,
name|String
name|startKey
parameter_list|,
name|String
name|prefix
parameter_list|,
name|int
name|count
parameter_list|)
throws|throws
name|IOException
block|{
name|List
argument_list|<
name|OmBucketInfo
argument_list|>
name|buckets
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
name|S3ListBucketsRequest
operator|.
name|Builder
name|reqBuilder
init|=
name|S3ListBucketsRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|reqBuilder
operator|.
name|setUserName
argument_list|(
name|userName
argument_list|)
expr_stmt|;
name|reqBuilder
operator|.
name|setCount
argument_list|(
name|count
argument_list|)
expr_stmt|;
if|if
condition|(
name|startKey
operator|!=
literal|null
condition|)
block|{
name|reqBuilder
operator|.
name|setStartKey
argument_list|(
name|startKey
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|prefix
operator|!=
literal|null
condition|)
block|{
name|reqBuilder
operator|.
name|setPrefix
argument_list|(
name|prefix
argument_list|)
expr_stmt|;
block|}
name|S3ListBucketsRequest
name|request
init|=
name|reqBuilder
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|ListS3Buckets
argument_list|)
operator|.
name|setListS3BucketsRequest
argument_list|(
name|request
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|S3ListBucketsResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getListS3BucketsResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
name|buckets
operator|.
name|addAll
argument_list|(
name|resp
operator|.
name|getBucketInfoList
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|OmBucketInfo
operator|::
name|getFromProtobuf
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|buckets
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"List S3 Buckets failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
annotation|@
name|Override
DECL|method|getS3Secret (String kerberosID)
specifier|public
name|S3SecretValue
name|getS3Secret
parameter_list|(
name|String
name|kerberosID
parameter_list|)
throws|throws
name|IOException
block|{
name|GetS3SecretRequest
name|request
init|=
name|GetS3SecretRequest
operator|.
name|newBuilder
argument_list|()
operator|.
name|setKerberosID
argument_list|(
name|kerberosID
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|GetS3Secret
argument_list|)
operator|.
name|setGetS3SecretRequest
argument_list|(
name|request
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
specifier|final
name|GetS3SecretResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getGetS3SecretResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Fetch S3 Secret failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
else|else
block|{
return|return
name|S3SecretValue
operator|.
name|fromProtobuf
argument_list|(
name|resp
operator|.
name|getS3Secret
argument_list|()
argument_list|)
return|;
block|}
block|}
comment|/**    * Return the proxy object underlying this protocol translator.    *    * @return the proxy object underlying this protocol translator.    */
annotation|@
name|Override
DECL|method|initiateMultipartUpload (OmKeyArgs omKeyArgs)
specifier|public
name|OmMultipartInfo
name|initiateMultipartUpload
parameter_list|(
name|OmKeyArgs
name|omKeyArgs
parameter_list|)
throws|throws
name|IOException
block|{
name|MultipartInfoInitiateRequest
operator|.
name|Builder
name|multipartInfoInitiateRequest
init|=
name|MultipartInfoInitiateRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
operator|.
name|Builder
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|omKeyArgs
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|omKeyArgs
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|omKeyArgs
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setFactor
argument_list|(
name|omKeyArgs
operator|.
name|getFactor
argument_list|()
argument_list|)
operator|.
name|setType
argument_list|(
name|omKeyArgs
operator|.
name|getType
argument_list|()
argument_list|)
decl_stmt|;
name|multipartInfoInitiateRequest
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|InitiateMultiPartUpload
argument_list|)
operator|.
name|setInitiateMultiPartUploadRequest
argument_list|(
name|multipartInfoInitiateRequest
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|MultipartInfoInitiateResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getInitiateMultiPartUploadResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Initiate Multipart upload failed, error:"
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
return|return
operator|new
name|OmMultipartInfo
argument_list|(
name|resp
operator|.
name|getVolumeName
argument_list|()
argument_list|,
name|resp
operator|.
name|getBucketName
argument_list|()
argument_list|,
name|resp
operator|.
name|getKeyName
argument_list|()
argument_list|,
name|resp
operator|.
name|getMultipartUploadID
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|commitMultipartUploadPart ( OmKeyArgs omKeyArgs, long clientId)
specifier|public
name|OmMultipartCommitUploadPartInfo
name|commitMultipartUploadPart
parameter_list|(
name|OmKeyArgs
name|omKeyArgs
parameter_list|,
name|long
name|clientId
parameter_list|)
throws|throws
name|IOException
block|{
name|List
argument_list|<
name|OmKeyLocationInfo
argument_list|>
name|locationInfoList
init|=
name|omKeyArgs
operator|.
name|getLocationInfoList
argument_list|()
decl_stmt|;
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|locationInfoList
argument_list|)
expr_stmt|;
name|MultipartCommitUploadPartRequest
operator|.
name|Builder
name|multipartCommitUploadPartRequest
init|=
name|MultipartCommitUploadPartRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
operator|.
name|Builder
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|omKeyArgs
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|omKeyArgs
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|omKeyArgs
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setMultipartUploadID
argument_list|(
name|omKeyArgs
operator|.
name|getMultipartUploadID
argument_list|()
argument_list|)
operator|.
name|setIsMultipartKey
argument_list|(
name|omKeyArgs
operator|.
name|getIsMultipartKey
argument_list|()
argument_list|)
operator|.
name|setMultipartNumber
argument_list|(
name|omKeyArgs
operator|.
name|getMultipartUploadPartNumber
argument_list|()
argument_list|)
operator|.
name|setDataSize
argument_list|(
name|omKeyArgs
operator|.
name|getDataSize
argument_list|()
argument_list|)
operator|.
name|addAllKeyLocations
argument_list|(
name|locationInfoList
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|OmKeyLocationInfo
operator|::
name|getProtobuf
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|multipartCommitUploadPartRequest
operator|.
name|setClientID
argument_list|(
name|clientId
argument_list|)
expr_stmt|;
name|multipartCommitUploadPartRequest
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CommitMultiPartUpload
argument_list|)
operator|.
name|setCommitMultiPartUploadRequest
argument_list|(
name|multipartCommitUploadPartRequest
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|MultipartCommitUploadPartResponse
name|response
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCommitMultiPartUploadResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|response
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Commit multipart upload part key failed, error:"
operator|+
name|response
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
name|OmMultipartCommitUploadPartInfo
name|info
init|=
operator|new
name|OmMultipartCommitUploadPartInfo
argument_list|(
name|response
operator|.
name|getPartName
argument_list|()
argument_list|)
decl_stmt|;
return|return
name|info
return|;
block|}
annotation|@
name|Override
DECL|method|completeMultipartUpload ( OmKeyArgs omKeyArgs, OmMultipartUploadList multipartUploadList)
specifier|public
name|OmMultipartUploadCompleteInfo
name|completeMultipartUpload
parameter_list|(
name|OmKeyArgs
name|omKeyArgs
parameter_list|,
name|OmMultipartUploadList
name|multipartUploadList
parameter_list|)
throws|throws
name|IOException
block|{
name|MultipartUploadCompleteRequest
operator|.
name|Builder
name|multipartUploadCompleteRequest
init|=
name|MultipartUploadCompleteRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|KeyArgs
operator|.
name|Builder
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|omKeyArgs
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|omKeyArgs
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|omKeyArgs
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setMultipartUploadID
argument_list|(
name|omKeyArgs
operator|.
name|getMultipartUploadID
argument_list|()
argument_list|)
decl_stmt|;
name|multipartUploadCompleteRequest
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
name|multipartUploadCompleteRequest
operator|.
name|addAllPartsList
argument_list|(
name|multipartUploadList
operator|.
name|getPartsList
argument_list|()
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CompleteMultiPartUpload
argument_list|)
operator|.
name|setCompleteMultiPartUploadRequest
argument_list|(
name|multipartUploadCompleteRequest
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|MultipartUploadCompleteResponse
name|response
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCompleteMultiPartUploadResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|response
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Complete multipart upload failed, error:"
operator|+
name|response
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
name|OmMultipartUploadCompleteInfo
name|info
init|=
operator|new
name|OmMultipartUploadCompleteInfo
argument_list|(
name|response
operator|.
name|getVolume
argument_list|()
argument_list|,
name|response
operator|.
name|getBucket
argument_list|()
argument_list|,
name|response
operator|.
name|getKey
argument_list|()
argument_list|,
name|response
operator|.
name|getHash
argument_list|()
argument_list|)
decl_stmt|;
return|return
name|info
return|;
block|}
annotation|@
name|Override
DECL|method|abortMultipartUpload (OmKeyArgs omKeyArgs)
specifier|public
name|void
name|abortMultipartUpload
parameter_list|(
name|OmKeyArgs
name|omKeyArgs
parameter_list|)
throws|throws
name|IOException
block|{
name|KeyArgs
operator|.
name|Builder
name|keyArgs
init|=
name|KeyArgs
operator|.
name|newBuilder
argument_list|()
operator|.
name|setVolumeName
argument_list|(
name|omKeyArgs
operator|.
name|getVolumeName
argument_list|()
argument_list|)
operator|.
name|setBucketName
argument_list|(
name|omKeyArgs
operator|.
name|getBucketName
argument_list|()
argument_list|)
operator|.
name|setKeyName
argument_list|(
name|omKeyArgs
operator|.
name|getKeyName
argument_list|()
argument_list|)
operator|.
name|setMultipartUploadID
argument_list|(
name|omKeyArgs
operator|.
name|getMultipartUploadID
argument_list|()
argument_list|)
decl_stmt|;
name|MultipartUploadAbortRequest
operator|.
name|Builder
name|multipartUploadAbortRequest
init|=
name|MultipartUploadAbortRequest
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|multipartUploadAbortRequest
operator|.
name|setKeyArgs
argument_list|(
name|keyArgs
argument_list|)
expr_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|AbortMultiPartUpload
argument_list|)
operator|.
name|setAbortMultiPartUploadRequest
argument_list|(
name|multipartUploadAbortRequest
operator|.
name|build
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|MultipartUploadAbortResponse
name|response
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getAbortMultiPartUploadResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|response
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Abort multipart upload failed, error:"
operator|+
name|response
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
DECL|method|getServiceList ()
specifier|public
name|List
argument_list|<
name|ServiceInfo
argument_list|>
name|getServiceList
parameter_list|()
throws|throws
name|IOException
block|{
name|ServiceListRequest
name|req
init|=
name|ServiceListRequest
operator|.
name|newBuilder
argument_list|()
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|ServiceList
argument_list|)
operator|.
name|setServiceListRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
specifier|final
name|ServiceListResponse
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getServiceListResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
return|return
name|resp
operator|.
name|getServiceInfoList
argument_list|()
operator|.
name|stream
argument_list|()
operator|.
name|map
argument_list|(
name|ServiceInfo
operator|::
name|getFromProtobuf
argument_list|)
operator|.
name|collect
argument_list|(
name|Collectors
operator|.
name|toList
argument_list|()
argument_list|)
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Getting service list failed, error: "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Get a valid Delegation Token.    *    * @param renewer the designated renewer for the token    * @return Token<OzoneDelegationTokenSelector>    * @throws IOException    */
annotation|@
name|Override
DECL|method|getDelegationToken (Text renewer)
specifier|public
name|Token
argument_list|<
name|OzoneTokenIdentifier
argument_list|>
name|getDelegationToken
parameter_list|(
name|Text
name|renewer
parameter_list|)
throws|throws
name|IOException
block|{
name|GetDelegationTokenRequestProto
name|req
init|=
name|GetDelegationTokenRequestProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setRenewer
argument_list|(
name|renewer
operator|==
literal|null
condition|?
literal|""
else|:
name|renewer
operator|.
name|toString
argument_list|()
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|GetDelegationToken
argument_list|)
operator|.
name|setGetDelegationTokenRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
specifier|final
name|GetDelegationTokenResponseProto
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getGetDelegationTokenResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
return|return
name|resp
operator|.
name|getResponse
argument_list|()
operator|.
name|hasToken
argument_list|()
condition|?
name|OMPBHelper
operator|.
name|convertToDelegationToken
argument_list|(
name|resp
operator|.
name|getResponse
argument_list|()
operator|.
name|getToken
argument_list|()
argument_list|)
else|:
literal|null
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Get Delegation Token failed, error : "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Renew an existing delegation token.    *    * @param token delegation token obtained earlier    * @return the new expiration time    * @throws IOException    */
annotation|@
name|Override
DECL|method|renewDelegationToken (Token<OzoneTokenIdentifier> token)
specifier|public
name|long
name|renewDelegationToken
parameter_list|(
name|Token
argument_list|<
name|OzoneTokenIdentifier
argument_list|>
name|token
parameter_list|)
throws|throws
name|IOException
block|{
name|RenewDelegationTokenRequestProto
name|req
init|=
name|RenewDelegationTokenRequestProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setToken
argument_list|(
name|OMPBHelper
operator|.
name|convertToTokenProto
argument_list|(
name|token
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|RenewDelegationToken
argument_list|)
operator|.
name|setRenewDelegationTokenRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
specifier|final
name|RenewDelegationTokenResponseProto
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getRenewDelegationTokenResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|==
name|Status
operator|.
name|OK
condition|)
block|{
return|return
name|resp
operator|.
name|getResponse
argument_list|()
operator|.
name|getNewExpiryTime
argument_list|()
return|;
block|}
else|else
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Renew Delegation Token failed, error : "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
comment|/**    * Cancel an existing delegation token.    *    * @param token delegation token    * @throws IOException    */
annotation|@
name|Override
DECL|method|cancelDelegationToken (Token<OzoneTokenIdentifier> token)
specifier|public
name|void
name|cancelDelegationToken
parameter_list|(
name|Token
argument_list|<
name|OzoneTokenIdentifier
argument_list|>
name|token
parameter_list|)
throws|throws
name|IOException
block|{
name|CancelDelegationTokenRequestProto
name|req
init|=
name|CancelDelegationTokenRequestProto
operator|.
name|newBuilder
argument_list|()
operator|.
name|setToken
argument_list|(
name|OMPBHelper
operator|.
name|convertToTokenProto
argument_list|(
name|token
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|OMRequest
name|omRequest
init|=
name|createOMRequest
argument_list|(
name|Type
operator|.
name|CancelDelegationToken
argument_list|)
operator|.
name|setCancelDelegationTokenRequest
argument_list|(
name|req
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
specifier|final
name|CancelDelegationTokenResponseProto
name|resp
init|=
name|submitRequest
argument_list|(
name|omRequest
argument_list|)
operator|.
name|getCancelDelegationTokenResponse
argument_list|()
decl_stmt|;
if|if
condition|(
name|resp
operator|.
name|getStatus
argument_list|()
operator|!=
name|Status
operator|.
name|OK
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Cancel Delegation Token failed, error : "
operator|+
name|resp
operator|.
name|getStatus
argument_list|()
argument_list|)
throw|;
block|}
block|}
block|}
end_class

end_unit

