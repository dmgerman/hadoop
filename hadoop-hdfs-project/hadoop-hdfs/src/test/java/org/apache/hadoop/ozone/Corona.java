begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.ozone
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
package|;
end_package

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|cli
operator|.
name|CommandLine
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|cli
operator|.
name|Option
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|cli
operator|.
name|OptionBuilder
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|cli
operator|.
name|Options
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|lang
operator|.
name|RandomStringUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configured
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ozone
operator|.
name|io
operator|.
name|OzoneOutputStream
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|GenericOptionsParser
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|Tool
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|ToolRunner
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|LoggerFactory
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|PrintStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|ExecutorService
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|Executors
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|TimeUnit
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|atomic
operator|.
name|AtomicInteger
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|atomic
operator|.
name|AtomicLong
import|;
end_import

begin_comment
comment|/**  * Corona - A tool to populate ozone with data for testing.<br>  * This is not a map-reduce program and this is not for benchmarking  * Ozone write throughput.<br>  * It supports both online and offline modes. Default mode is offline,  *<i>-mode</i> can be used to change the mode.  *<p>  * In online mode, active internet connection is required,  * common crawl data from AWS will be used.<br>  * Default source is:<br>  * https://commoncrawl.s3.amazonaws.com/crawl-data/  * CC-MAIN-2017-17/warc.paths.gz<br>  * (it contains the path to actual data segment)<br>  * User can override this using<i>-source</i>.  * The following values are derived from URL of Common Crawl data  *<ul>  *<li>Domain will be used as Volume</li>  *<li>URL will be used as Bucket</li>  *<li>FileName will be used as Key</li>  *</ul></p>  * In offline mode, the data will be random bytes and  * size of data will be 10 KB.<br>  *<ul>  *<li>Default number of Volumes 10,<i>-numOfVolumes</i>  * can be used to override</li>  *<li>Default number of Buckets per Volume 1000,<i>-numOfBuckets</i>  * can be used to override</li>  *<li>Default number of Keys per Bucket 500000,<i>-numOfKeys</i>  * can be used to override</li>  *</ul>  */
end_comment

begin_class
DECL|class|Corona
specifier|public
specifier|final
class|class
name|Corona
extends|extends
name|Configured
implements|implements
name|Tool
block|{
DECL|field|HELP
specifier|private
specifier|static
specifier|final
name|String
name|HELP
init|=
literal|"help"
decl_stmt|;
DECL|field|MODE
specifier|private
specifier|static
specifier|final
name|String
name|MODE
init|=
literal|"mode"
decl_stmt|;
DECL|field|SOURCE
specifier|private
specifier|static
specifier|final
name|String
name|SOURCE
init|=
literal|"source"
decl_stmt|;
DECL|field|NUM_OF_VOLUMES
specifier|private
specifier|static
specifier|final
name|String
name|NUM_OF_VOLUMES
init|=
literal|"numOfVolumes"
decl_stmt|;
DECL|field|NUM_OF_BUCKETS
specifier|private
specifier|static
specifier|final
name|String
name|NUM_OF_BUCKETS
init|=
literal|"numOfBuckets"
decl_stmt|;
DECL|field|NUM_OF_KEYS
specifier|private
specifier|static
specifier|final
name|String
name|NUM_OF_KEYS
init|=
literal|"numOfKeys"
decl_stmt|;
DECL|field|MODE_DEFAULT
specifier|private
specifier|static
specifier|final
name|String
name|MODE_DEFAULT
init|=
literal|"offline"
decl_stmt|;
DECL|field|SOURCE_DEFAULT
specifier|private
specifier|static
specifier|final
name|String
name|SOURCE_DEFAULT
init|=
literal|"https://commoncrawl.s3.amazonaws.com/"
operator|+
literal|"crawl-data/CC-MAIN-2017-17/warc.paths.gz"
decl_stmt|;
DECL|field|NUM_OF_VOLUMES_DEFAULT
specifier|private
specifier|static
specifier|final
name|String
name|NUM_OF_VOLUMES_DEFAULT
init|=
literal|"10"
decl_stmt|;
DECL|field|NUM_OF_BUCKETS_DEFAULT
specifier|private
specifier|static
specifier|final
name|String
name|NUM_OF_BUCKETS_DEFAULT
init|=
literal|"1000"
decl_stmt|;
DECL|field|NUM_OF_KEYS_DEFAULT
specifier|private
specifier|static
specifier|final
name|String
name|NUM_OF_KEYS_DEFAULT
init|=
literal|"500000"
decl_stmt|;
DECL|field|NUM_OF_THREADS_DEFAULT
specifier|private
specifier|static
specifier|final
name|int
name|NUM_OF_THREADS_DEFAULT
init|=
literal|10
decl_stmt|;
DECL|field|LOG
specifier|private
specifier|static
specifier|final
name|Logger
name|LOG
init|=
name|LoggerFactory
operator|.
name|getLogger
argument_list|(
name|Corona
operator|.
name|class
argument_list|)
decl_stmt|;
DECL|field|printUsage
specifier|private
name|boolean
name|printUsage
init|=
literal|false
decl_stmt|;
DECL|field|mode
specifier|private
name|String
name|mode
decl_stmt|;
DECL|field|source
specifier|private
name|String
name|source
decl_stmt|;
DECL|field|numOfVolumes
specifier|private
name|String
name|numOfVolumes
decl_stmt|;
DECL|field|numOfBuckets
specifier|private
name|String
name|numOfBuckets
decl_stmt|;
DECL|field|numOfKeys
specifier|private
name|String
name|numOfKeys
decl_stmt|;
DECL|field|ozoneClient
specifier|private
name|OzoneClient
name|ozoneClient
decl_stmt|;
DECL|field|processor
specifier|private
name|ExecutorService
name|processor
decl_stmt|;
DECL|field|startTime
specifier|private
name|long
name|startTime
decl_stmt|;
DECL|field|numberOfVolumesCreated
specifier|private
name|AtomicInteger
name|numberOfVolumesCreated
decl_stmt|;
DECL|field|numberOfBucketsCreated
specifier|private
name|AtomicInteger
name|numberOfBucketsCreated
decl_stmt|;
DECL|field|numberOfKeysAdded
specifier|private
name|AtomicLong
name|numberOfKeysAdded
decl_stmt|;
DECL|method|Corona (Configuration conf)
specifier|private
name|Corona
parameter_list|(
name|Configuration
name|conf
parameter_list|)
throws|throws
name|IOException
block|{
name|startTime
operator|=
name|System
operator|.
name|nanoTime
argument_list|()
expr_stmt|;
name|numberOfVolumesCreated
operator|=
operator|new
name|AtomicInteger
argument_list|()
expr_stmt|;
name|numberOfBucketsCreated
operator|=
operator|new
name|AtomicInteger
argument_list|()
expr_stmt|;
name|numberOfKeysAdded
operator|=
operator|new
name|AtomicLong
argument_list|()
expr_stmt|;
name|OzoneClientFactory
operator|.
name|setConfiguration
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|ozoneClient
operator|=
name|OzoneClientFactory
operator|.
name|getRpcClient
argument_list|()
expr_stmt|;
name|processor
operator|=
name|Executors
operator|.
name|newFixedThreadPool
argument_list|(
name|NUM_OF_THREADS_DEFAULT
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|run (String[] args)
specifier|public
name|int
name|run
parameter_list|(
name|String
index|[]
name|args
parameter_list|)
throws|throws
name|Exception
block|{
name|GenericOptionsParser
name|parser
init|=
operator|new
name|GenericOptionsParser
argument_list|(
name|getConf
argument_list|()
argument_list|,
name|getOzonePetaGenOptions
argument_list|()
argument_list|,
name|args
argument_list|)
decl_stmt|;
name|parseOzonePetaGenOptions
argument_list|(
name|parser
operator|.
name|getCommandLine
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|printUsage
condition|)
block|{
name|usage
argument_list|()
expr_stmt|;
name|System
operator|.
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
name|addShutdownHook
argument_list|()
expr_stmt|;
if|if
condition|(
name|mode
operator|.
name|equals
argument_list|(
literal|"online"
argument_list|)
condition|)
block|{
name|LOG
operator|.
name|info
argument_list|(
literal|"Mode: online"
argument_list|)
expr_stmt|;
throw|throw
operator|new
name|UnsupportedOperationException
argument_list|(
literal|"Not yet implemented."
argument_list|)
throw|;
block|}
else|else
block|{
name|LOG
operator|.
name|info
argument_list|(
literal|"Mode: offline"
argument_list|)
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
literal|"Number of Volumes: {}."
argument_list|,
name|numOfBuckets
argument_list|)
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
literal|"Number of Buckets per Volume: {}."
argument_list|,
name|numOfBuckets
argument_list|)
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
literal|"Number of Keys per Bucket: {}."
argument_list|,
name|numOfKeys
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|Integer
operator|.
name|parseInt
argument_list|(
name|numOfVolumes
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|String
name|volume
init|=
literal|"vol-"
operator|+
name|i
operator|+
literal|"-"
operator|+
name|RandomStringUtils
operator|.
name|randomNumeric
argument_list|(
literal|5
argument_list|)
decl_stmt|;
name|processor
operator|.
name|submit
argument_list|(
operator|new
name|OfflineProcessor
argument_list|(
name|volume
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|processor
operator|.
name|shutdown
argument_list|()
expr_stmt|;
name|processor
operator|.
name|awaitTermination
argument_list|(
name|Integer
operator|.
name|MAX_VALUE
argument_list|,
name|TimeUnit
operator|.
name|MILLISECONDS
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
DECL|method|getOzonePetaGenOptions ()
specifier|private
name|Options
name|getOzonePetaGenOptions
parameter_list|()
block|{
name|Options
name|options
init|=
operator|new
name|Options
argument_list|()
decl_stmt|;
name|OptionBuilder
operator|.
name|withDescription
argument_list|(
literal|"prints usage."
argument_list|)
expr_stmt|;
name|Option
name|optHelp
init|=
name|OptionBuilder
operator|.
name|create
argument_list|(
name|HELP
argument_list|)
decl_stmt|;
name|OptionBuilder
operator|.
name|withArgName
argument_list|(
literal|"online | offline"
argument_list|)
expr_stmt|;
name|OptionBuilder
operator|.
name|hasArg
argument_list|()
expr_stmt|;
name|OptionBuilder
operator|.
name|withDescription
argument_list|(
literal|"specifies the mode of "
operator|+
literal|"Corona run."
argument_list|)
expr_stmt|;
name|Option
name|optMode
init|=
name|OptionBuilder
operator|.
name|create
argument_list|(
name|MODE
argument_list|)
decl_stmt|;
name|OptionBuilder
operator|.
name|withArgName
argument_list|(
literal|"source url"
argument_list|)
expr_stmt|;
name|OptionBuilder
operator|.
name|hasArg
argument_list|()
expr_stmt|;
name|OptionBuilder
operator|.
name|withDescription
argument_list|(
literal|"specifies the URL of s3 "
operator|+
literal|"commoncrawl warc file to be used when the mode is online."
argument_list|)
expr_stmt|;
name|Option
name|optSource
init|=
name|OptionBuilder
operator|.
name|create
argument_list|(
name|SOURCE
argument_list|)
decl_stmt|;
name|OptionBuilder
operator|.
name|withArgName
argument_list|(
literal|"value"
argument_list|)
expr_stmt|;
name|OptionBuilder
operator|.
name|hasArg
argument_list|()
expr_stmt|;
name|OptionBuilder
operator|.
name|withDescription
argument_list|(
literal|"specifies number of Volumes to be "
operator|+
literal|"created in offline mode"
argument_list|)
expr_stmt|;
name|Option
name|optNumOfVolumes
init|=
name|OptionBuilder
operator|.
name|create
argument_list|(
name|NUM_OF_VOLUMES
argument_list|)
decl_stmt|;
name|OptionBuilder
operator|.
name|withArgName
argument_list|(
literal|"value"
argument_list|)
expr_stmt|;
name|OptionBuilder
operator|.
name|hasArg
argument_list|()
expr_stmt|;
name|OptionBuilder
operator|.
name|withDescription
argument_list|(
literal|"specifies number of Buckets to be "
operator|+
literal|"created per Volume in offline mode"
argument_list|)
expr_stmt|;
name|Option
name|optNumOfBuckets
init|=
name|OptionBuilder
operator|.
name|create
argument_list|(
name|NUM_OF_BUCKETS
argument_list|)
decl_stmt|;
name|OptionBuilder
operator|.
name|withArgName
argument_list|(
literal|"value"
argument_list|)
expr_stmt|;
name|OptionBuilder
operator|.
name|hasArg
argument_list|()
expr_stmt|;
name|OptionBuilder
operator|.
name|withDescription
argument_list|(
literal|"specifies number of Keys to be "
operator|+
literal|"created per Bucket in offline mode"
argument_list|)
expr_stmt|;
name|Option
name|optNumOfKeys
init|=
name|OptionBuilder
operator|.
name|create
argument_list|(
name|NUM_OF_KEYS
argument_list|)
decl_stmt|;
name|options
operator|.
name|addOption
argument_list|(
name|optHelp
argument_list|)
expr_stmt|;
name|options
operator|.
name|addOption
argument_list|(
name|optMode
argument_list|)
expr_stmt|;
name|options
operator|.
name|addOption
argument_list|(
name|optSource
argument_list|)
expr_stmt|;
name|options
operator|.
name|addOption
argument_list|(
name|optNumOfVolumes
argument_list|)
expr_stmt|;
name|options
operator|.
name|addOption
argument_list|(
name|optNumOfBuckets
argument_list|)
expr_stmt|;
name|options
operator|.
name|addOption
argument_list|(
name|optNumOfKeys
argument_list|)
expr_stmt|;
return|return
name|options
return|;
block|}
DECL|method|parseOzonePetaGenOptions (CommandLine cmdLine)
specifier|private
name|void
name|parseOzonePetaGenOptions
parameter_list|(
name|CommandLine
name|cmdLine
parameter_list|)
block|{
name|printUsage
operator|=
name|cmdLine
operator|.
name|hasOption
argument_list|(
name|HELP
argument_list|)
expr_stmt|;
name|mode
operator|=
name|cmdLine
operator|.
name|hasOption
argument_list|(
name|MODE
argument_list|)
condition|?
name|cmdLine
operator|.
name|getOptionValue
argument_list|(
name|MODE
argument_list|)
else|:
name|MODE_DEFAULT
expr_stmt|;
name|source
operator|=
name|cmdLine
operator|.
name|hasOption
argument_list|(
name|SOURCE
argument_list|)
condition|?
name|cmdLine
operator|.
name|getOptionValue
argument_list|(
name|SOURCE
argument_list|)
else|:
name|SOURCE_DEFAULT
expr_stmt|;
name|numOfVolumes
operator|=
name|cmdLine
operator|.
name|hasOption
argument_list|(
name|NUM_OF_VOLUMES
argument_list|)
condition|?
name|cmdLine
operator|.
name|getOptionValue
argument_list|(
name|NUM_OF_VOLUMES
argument_list|)
else|:
name|NUM_OF_VOLUMES_DEFAULT
expr_stmt|;
name|numOfBuckets
operator|=
name|cmdLine
operator|.
name|hasOption
argument_list|(
name|NUM_OF_BUCKETS
argument_list|)
condition|?
name|cmdLine
operator|.
name|getOptionValue
argument_list|(
name|NUM_OF_BUCKETS
argument_list|)
else|:
name|NUM_OF_BUCKETS_DEFAULT
expr_stmt|;
name|numOfKeys
operator|=
name|cmdLine
operator|.
name|hasOption
argument_list|(
name|NUM_OF_KEYS
argument_list|)
condition|?
name|cmdLine
operator|.
name|getOptionValue
argument_list|(
name|NUM_OF_KEYS
argument_list|)
else|:
name|NUM_OF_KEYS_DEFAULT
expr_stmt|;
block|}
DECL|method|usage ()
specifier|private
name|void
name|usage
parameter_list|()
block|{
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Options supported are:"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"-mode [online | offline]        "
operator|+
literal|"specifies the mode in which Corona should run."
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"-source<url>                   "
operator|+
literal|"specifies the URL of s3 commoncrawl warc file to "
operator|+
literal|"be used when the mode is online."
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"-numOfVolumes<value>           "
operator|+
literal|"specifies number of Volumes to be created in offline mode"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"-numOfBuckets<value>           "
operator|+
literal|"specifies number of Buckets to be created per Volume "
operator|+
literal|"in offline mode"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"-numOfKeys<value>              "
operator|+
literal|"specifies number of Keys to be created per Bucket "
operator|+
literal|"in offline mode"
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"-help                           "
operator|+
literal|"prints usage."
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
block|}
DECL|class|OfflineProcessor
specifier|private
class|class
name|OfflineProcessor
implements|implements
name|Runnable
block|{
DECL|field|totalBuckets
specifier|private
name|int
name|totalBuckets
decl_stmt|;
DECL|field|totalKeys
specifier|private
name|int
name|totalKeys
decl_stmt|;
DECL|field|volume
specifier|private
name|String
name|volume
decl_stmt|;
DECL|method|OfflineProcessor (String volume)
name|OfflineProcessor
parameter_list|(
name|String
name|volume
parameter_list|)
throws|throws
name|Exception
block|{
name|this
operator|.
name|totalBuckets
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|numOfBuckets
argument_list|)
expr_stmt|;
name|this
operator|.
name|totalKeys
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|numOfKeys
argument_list|)
expr_stmt|;
name|this
operator|.
name|volume
operator|=
name|volume
expr_stmt|;
name|LOG
operator|.
name|trace
argument_list|(
literal|"Creating volume: {}"
argument_list|,
name|volume
argument_list|)
expr_stmt|;
name|ozoneClient
operator|.
name|createVolume
argument_list|(
name|this
operator|.
name|volume
argument_list|)
expr_stmt|;
name|numberOfVolumesCreated
operator|.
name|getAndIncrement
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|run ()
specifier|public
name|void
name|run
parameter_list|()
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|totalBuckets
condition|;
name|j
operator|++
control|)
block|{
name|String
name|bucket
init|=
literal|"bucket-"
operator|+
name|j
operator|+
literal|"-"
operator|+
name|RandomStringUtils
operator|.
name|randomNumeric
argument_list|(
literal|5
argument_list|)
decl_stmt|;
try|try
block|{
name|LOG
operator|.
name|trace
argument_list|(
literal|"Creating bucket: {} in volume: {}"
argument_list|,
name|bucket
argument_list|,
name|volume
argument_list|)
expr_stmt|;
name|ozoneClient
operator|.
name|createBucket
argument_list|(
name|volume
argument_list|,
name|bucket
argument_list|)
expr_stmt|;
name|numberOfBucketsCreated
operator|.
name|getAndIncrement
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|totalKeys
condition|;
name|k
operator|++
control|)
block|{
name|String
name|key
init|=
literal|"key-"
operator|+
name|k
operator|+
literal|"-"
operator|+
name|RandomStringUtils
operator|.
name|randomNumeric
argument_list|(
literal|5
argument_list|)
decl_stmt|;
name|byte
index|[]
name|value
init|=
name|RandomStringUtils
operator|.
name|randomAscii
argument_list|(
literal|10240
argument_list|)
operator|.
name|getBytes
argument_list|()
decl_stmt|;
try|try
block|{
name|LOG
operator|.
name|trace
argument_list|(
literal|"Adding key: {} in bucket: {} of volume: {}"
argument_list|,
name|key
argument_list|,
name|bucket
argument_list|,
name|volume
argument_list|)
expr_stmt|;
name|OzoneOutputStream
name|os
init|=
name|ozoneClient
operator|.
name|createKey
argument_list|(
name|volume
argument_list|,
name|bucket
argument_list|,
name|key
argument_list|,
name|value
operator|.
name|length
argument_list|)
decl_stmt|;
name|os
operator|.
name|write
argument_list|(
name|value
argument_list|)
expr_stmt|;
name|os
operator|.
name|close
argument_list|()
expr_stmt|;
name|numberOfKeysAdded
operator|.
name|getAndIncrement
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|error
argument_list|(
literal|"Exception while adding key: {} in bucket: {}"
operator|+
literal|" of volume: {}."
argument_list|,
name|key
argument_list|,
name|bucket
argument_list|,
name|volume
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|error
argument_list|(
literal|"Exception while creating bucket: {}"
operator|+
literal|" in volume: {}."
argument_list|,
name|bucket
argument_list|,
name|volume
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
comment|/**    * Adds ShutdownHook to print statistics.    */
DECL|method|addShutdownHook ()
specifier|private
name|void
name|addShutdownHook
parameter_list|()
block|{
name|Runtime
operator|.
name|getRuntime
argument_list|()
operator|.
name|addShutdownHook
argument_list|(
operator|new
name|Thread
argument_list|()
block|{
specifier|public
name|void
name|run
parameter_list|()
block|{
name|printStats
argument_list|(
name|System
operator|.
name|out
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
block|}
comment|/**    * Prints stats of {@link Corona} run to the PrintStream.    *    * @param out PrintStream    */
DECL|method|printStats (PrintStream out)
specifier|private
name|void
name|printStats
parameter_list|(
name|PrintStream
name|out
parameter_list|)
block|{
name|long
name|timeInSec
init|=
name|TimeUnit
operator|.
name|SECONDS
operator|.
name|convert
argument_list|(
name|System
operator|.
name|nanoTime
argument_list|()
operator|-
name|startTime
argument_list|,
name|TimeUnit
operator|.
name|NANOSECONDS
argument_list|)
decl_stmt|;
name|String
name|timeToPrint
init|=
name|timeInSec
operator|<
literal|60
condition|?
name|timeInSec
operator|+
literal|" seconds"
else|:
name|TimeUnit
operator|.
name|MINUTES
operator|.
name|convert
argument_list|(
name|timeInSec
argument_list|,
name|TimeUnit
operator|.
name|SECONDS
argument_list|)
operator|+
literal|" minuites"
decl_stmt|;
name|out
operator|.
name|println
argument_list|(
literal|"***************************************************"
argument_list|)
expr_stmt|;
name|out
operator|.
name|println
argument_list|(
literal|"Number of Volumes created: "
operator|+
name|numberOfVolumesCreated
argument_list|)
expr_stmt|;
name|out
operator|.
name|println
argument_list|(
literal|"Number of Buckets created: "
operator|+
name|numberOfBucketsCreated
argument_list|)
expr_stmt|;
name|out
operator|.
name|println
argument_list|(
literal|"Number of Keys added: "
operator|+
name|numberOfKeysAdded
argument_list|)
expr_stmt|;
name|out
operator|.
name|println
argument_list|(
literal|"Execution time: "
operator|+
name|timeToPrint
argument_list|)
expr_stmt|;
name|out
operator|.
name|println
argument_list|(
literal|"***************************************************"
argument_list|)
expr_stmt|;
block|}
comment|/**    * @param args arguments    */
DECL|method|main (String[] args)
specifier|public
specifier|static
name|void
name|main
parameter_list|(
name|String
index|[]
name|args
parameter_list|)
throws|throws
name|Exception
block|{
name|Configuration
name|conf
init|=
operator|new
name|OzoneConfiguration
argument_list|()
decl_stmt|;
name|int
name|res
init|=
name|ToolRunner
operator|.
name|run
argument_list|(
name|conf
argument_list|,
operator|new
name|Corona
argument_list|(
name|conf
argument_list|)
argument_list|,
name|args
argument_list|)
decl_stmt|;
name|System
operator|.
name|exit
argument_list|(
name|res
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

