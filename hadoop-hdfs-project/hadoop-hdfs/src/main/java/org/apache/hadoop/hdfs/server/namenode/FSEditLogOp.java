begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.hdfs.server.namenode
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
package|;
end_package

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ADD
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ADD_ERASURE_CODING_POLICY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_APPEND
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ADD_BLOCK
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ADD_CACHE_DIRECTIVE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ADD_CACHE_POOL
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ALLOCATE_BLOCK_ID
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ALLOW_SNAPSHOT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_CANCEL_DELEGATION_TOKEN
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_CLEAR_NS_QUOTA
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_CLOSE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_CONCAT_DELETE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_CREATE_SNAPSHOT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_DELETE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_DELETE_SNAPSHOT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_DISABLE_ERASURE_CODING_POLICY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_DISALLOW_SNAPSHOT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ENABLE_ERASURE_CODING_POLICY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_END_LOG_SEGMENT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_GET_DELEGATION_TOKEN
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_INVALID
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_MKDIR
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_MODIFY_CACHE_DIRECTIVE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_MODIFY_CACHE_POOL
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_REASSIGN_LEASE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_REMOVE_CACHE_DIRECTIVE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_REMOVE_CACHE_POOL
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_REMOVE_ERASURE_CODING_POLICY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_REMOVE_XATTR
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_RENAME
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_RENAME_OLD
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_RENAME_SNAPSHOT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_RENEW_DELEGATION_TOKEN
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ROLLING_UPGRADE_FINALIZE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_ROLLING_UPGRADE_START
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_ACL
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_GENSTAMP_V1
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_GENSTAMP_V2
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_NS_QUOTA
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_OWNER
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_PERMISSIONS
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_QUOTA
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_REPLICATION
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_XATTR
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_START_LOG_SEGMENT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SYMLINK
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_TIMES
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_TRUNCATE
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_UPDATE_BLOCKS
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_UPDATE_MASTER_KEY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_STORAGE_POLICY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|FSEditLogOpCodes
operator|.
name|OP_SET_QUOTA_BY_STORAGETYPE
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|DataInput
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|DataInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|DataOutput
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|DataOutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|EOFException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Arrays
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|EnumMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|zip
operator|.
name|CheckedInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|zip
operator|.
name|Checksum
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|codec
operator|.
name|DecoderException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|codec
operator|.
name|binary
operator|.
name|Hex
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|classification
operator|.
name|InterfaceAudience
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|classification
operator|.
name|InterfaceStability
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|ChecksumException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|Options
operator|.
name|Rename
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|XAttr
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|XAttrCodec
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|AclEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|AclEntryScope
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|AclEntryType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|FsAction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|FsPermission
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|PermissionStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|StorageType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|DFSConfigKeys
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|DeprecatedUTF8
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|Block
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CacheDirectiveInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CachePoolInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ClientProtocol
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ErasureCodingPolicy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsConstants
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|LayoutVersion
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|LayoutVersion
operator|.
name|Feature
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|proto
operator|.
name|EditLogProtos
operator|.
name|AclEditLogProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|proto
operator|.
name|EditLogProtos
operator|.
name|XAttrEditLogProto
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocolPB
operator|.
name|PBHelperClient
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|security
operator|.
name|token
operator|.
name|delegation
operator|.
name|DelegationTokenIdentifier
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|common
operator|.
name|HdfsServerConstants
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|util
operator|.
name|XMLUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|util
operator|.
name|XMLUtils
operator|.
name|InvalidXmlException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|util
operator|.
name|XMLUtils
operator|.
name|Stanza
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|ArrayWritable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|BytesWritable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|DataOutputBuffer
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|IOUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|Text
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|Writable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|WritableFactories
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|WritableFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|erasurecode
operator|.
name|ECSchema
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|erasurecode
operator|.
name|ErasureCodeConstants
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|ClientId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|RpcConstants
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|token
operator|.
name|delegation
operator|.
name|DelegationKey
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|DataChecksum
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|StringUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|ContentHandler
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|SAXException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xml
operator|.
name|sax
operator|.
name|helpers
operator|.
name|AttributesImpl
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|annotations
operator|.
name|VisibleForTesting
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|base
operator|.
name|Joiner
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|base
operator|.
name|Preconditions
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableMap
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|Lists
import|;
end_import

begin_comment
comment|/**  * Helper classes for reading the ops from an InputStream.  * All ops derive from FSEditLogOp and are only  * instantiated from Reader#readOp()  */
end_comment

begin_class
annotation|@
name|InterfaceAudience
operator|.
name|Private
annotation|@
name|InterfaceStability
operator|.
name|Unstable
DECL|class|FSEditLogOp
specifier|public
specifier|abstract
class|class
name|FSEditLogOp
block|{
DECL|field|opCode
specifier|public
specifier|final
name|FSEditLogOpCodes
name|opCode
decl_stmt|;
DECL|field|txid
name|long
name|txid
decl_stmt|;
DECL|field|rpcClientId
name|byte
index|[]
name|rpcClientId
decl_stmt|;
DECL|field|rpcCallId
name|int
name|rpcCallId
decl_stmt|;
DECL|class|OpInstanceCache
specifier|public
specifier|static
class|class
name|OpInstanceCache
block|{
DECL|field|CACHE
specifier|private
specifier|static
specifier|final
name|ThreadLocal
argument_list|<
name|OpInstanceCacheMap
argument_list|>
name|CACHE
init|=
operator|new
name|ThreadLocal
argument_list|<
name|OpInstanceCacheMap
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|protected
name|OpInstanceCacheMap
name|initialValue
parameter_list|()
block|{
return|return
operator|new
name|OpInstanceCacheMap
argument_list|()
return|;
block|}
block|}
decl_stmt|;
annotation|@
name|SuppressWarnings
argument_list|(
literal|"serial"
argument_list|)
DECL|class|OpInstanceCacheMap
specifier|static
specifier|final
class|class
name|OpInstanceCacheMap
extends|extends
name|EnumMap
argument_list|<
name|FSEditLogOpCodes
argument_list|,
name|FSEditLogOp
argument_list|>
block|{
DECL|method|OpInstanceCacheMap ()
name|OpInstanceCacheMap
parameter_list|()
block|{
name|super
argument_list|(
name|FSEditLogOpCodes
operator|.
name|class
argument_list|)
expr_stmt|;
for|for
control|(
name|FSEditLogOpCodes
name|opCode
range|:
name|FSEditLogOpCodes
operator|.
name|values
argument_list|()
control|)
block|{
name|put
argument_list|(
name|opCode
argument_list|,
name|newInstance
argument_list|(
name|opCode
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
DECL|field|useCache
specifier|private
name|boolean
name|useCache
init|=
literal|true
decl_stmt|;
DECL|method|disableCache ()
name|void
name|disableCache
parameter_list|()
block|{
name|useCache
operator|=
literal|false
expr_stmt|;
block|}
DECL|method|get ()
specifier|public
name|OpInstanceCache
name|get
parameter_list|()
block|{
return|return
name|this
return|;
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
DECL|method|get (FSEditLogOpCodes opCode)
specifier|public
parameter_list|<
name|T
extends|extends
name|FSEditLogOp
parameter_list|>
name|T
name|get
parameter_list|(
name|FSEditLogOpCodes
name|opCode
parameter_list|)
block|{
return|return
name|useCache
condition|?
operator|(
name|T
operator|)
name|CACHE
operator|.
name|get
argument_list|()
operator|.
name|get
argument_list|(
name|opCode
argument_list|)
else|:
operator|(
name|T
operator|)
name|newInstance
argument_list|(
name|opCode
argument_list|)
return|;
block|}
DECL|method|newInstance (FSEditLogOpCodes opCode)
specifier|private
specifier|static
name|FSEditLogOp
name|newInstance
parameter_list|(
name|FSEditLogOpCodes
name|opCode
parameter_list|)
block|{
name|FSEditLogOp
name|instance
init|=
literal|null
decl_stmt|;
name|Class
argument_list|<
name|?
extends|extends
name|FSEditLogOp
argument_list|>
name|clazz
init|=
name|opCode
operator|.
name|getOpClass
argument_list|()
decl_stmt|;
if|if
condition|(
name|clazz
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|instance
operator|=
name|clazz
operator|.
name|newInstance
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
throw|throw
operator|new
name|RuntimeException
argument_list|(
literal|"Failed to instantiate "
operator|+
name|opCode
argument_list|,
name|ex
argument_list|)
throw|;
block|}
block|}
return|return
name|instance
return|;
block|}
block|}
DECL|method|reset ()
specifier|final
name|void
name|reset
parameter_list|()
block|{
name|txid
operator|=
name|HdfsServerConstants
operator|.
name|INVALID_TXID
expr_stmt|;
name|rpcClientId
operator|=
name|RpcConstants
operator|.
name|DUMMY_CLIENT_ID
expr_stmt|;
name|rpcCallId
operator|=
name|RpcConstants
operator|.
name|INVALID_CALL_ID
expr_stmt|;
name|resetSubFields
argument_list|()
expr_stmt|;
block|}
DECL|method|resetSubFields ()
specifier|abstract
name|void
name|resetSubFields
parameter_list|()
function_decl|;
DECL|method|fsActionMap ()
specifier|private
specifier|static
name|ImmutableMap
argument_list|<
name|String
argument_list|,
name|FsAction
argument_list|>
name|fsActionMap
parameter_list|()
block|{
name|ImmutableMap
operator|.
name|Builder
argument_list|<
name|String
argument_list|,
name|FsAction
argument_list|>
name|b
init|=
name|ImmutableMap
operator|.
name|builder
argument_list|()
decl_stmt|;
for|for
control|(
name|FsAction
name|v
range|:
name|FsAction
operator|.
name|values
argument_list|()
control|)
name|b
operator|.
name|put
argument_list|(
name|v
operator|.
name|SYMBOL
argument_list|,
name|v
argument_list|)
expr_stmt|;
return|return
name|b
operator|.
name|build
argument_list|()
return|;
block|}
DECL|field|FSACTION_SYMBOL_MAP
specifier|private
specifier|static
specifier|final
name|ImmutableMap
argument_list|<
name|String
argument_list|,
name|FsAction
argument_list|>
name|FSACTION_SYMBOL_MAP
init|=
name|fsActionMap
argument_list|()
decl_stmt|;
comment|/**    * Constructor for an EditLog Op. EditLog ops cannot be constructed    * directly, but only through Reader#readOp.    */
annotation|@
name|VisibleForTesting
DECL|method|FSEditLogOp (FSEditLogOpCodes opCode)
specifier|protected
name|FSEditLogOp
parameter_list|(
name|FSEditLogOpCodes
name|opCode
parameter_list|)
block|{
name|this
operator|.
name|opCode
operator|=
name|opCode
expr_stmt|;
name|reset
argument_list|()
expr_stmt|;
block|}
DECL|method|getTransactionId ()
specifier|public
name|long
name|getTransactionId
parameter_list|()
block|{
name|Preconditions
operator|.
name|checkState
argument_list|(
name|txid
operator|!=
name|HdfsServerConstants
operator|.
name|INVALID_TXID
argument_list|)
expr_stmt|;
return|return
name|txid
return|;
block|}
DECL|method|getTransactionIdStr ()
specifier|public
name|String
name|getTransactionIdStr
parameter_list|()
block|{
return|return
operator|(
name|txid
operator|==
name|HdfsServerConstants
operator|.
name|INVALID_TXID
operator|)
condition|?
literal|"(none)"
else|:
literal|""
operator|+
name|txid
return|;
block|}
DECL|method|hasTransactionId ()
specifier|public
name|boolean
name|hasTransactionId
parameter_list|()
block|{
return|return
operator|(
name|txid
operator|!=
name|HdfsServerConstants
operator|.
name|INVALID_TXID
operator|)
return|;
block|}
DECL|method|setTransactionId (long txid)
specifier|public
name|void
name|setTransactionId
parameter_list|(
name|long
name|txid
parameter_list|)
block|{
name|this
operator|.
name|txid
operator|=
name|txid
expr_stmt|;
block|}
DECL|method|hasRpcIds ()
specifier|public
name|boolean
name|hasRpcIds
parameter_list|()
block|{
return|return
name|rpcClientId
operator|!=
name|RpcConstants
operator|.
name|DUMMY_CLIENT_ID
operator|&&
name|rpcCallId
operator|!=
name|RpcConstants
operator|.
name|INVALID_CALL_ID
return|;
block|}
comment|/** this has to be called after calling {@link #hasRpcIds()} */
DECL|method|getClientId ()
specifier|public
name|byte
index|[]
name|getClientId
parameter_list|()
block|{
name|Preconditions
operator|.
name|checkState
argument_list|(
name|rpcClientId
operator|!=
name|RpcConstants
operator|.
name|DUMMY_CLIENT_ID
argument_list|)
expr_stmt|;
return|return
name|rpcClientId
return|;
block|}
DECL|method|setRpcClientId (byte[] clientId)
specifier|public
name|void
name|setRpcClientId
parameter_list|(
name|byte
index|[]
name|clientId
parameter_list|)
block|{
name|this
operator|.
name|rpcClientId
operator|=
name|clientId
expr_stmt|;
block|}
comment|/** this has to be called after calling {@link #hasRpcIds()} */
DECL|method|getCallId ()
specifier|public
name|int
name|getCallId
parameter_list|()
block|{
name|Preconditions
operator|.
name|checkState
argument_list|(
name|rpcCallId
operator|!=
name|RpcConstants
operator|.
name|INVALID_CALL_ID
argument_list|)
expr_stmt|;
return|return
name|rpcCallId
return|;
block|}
DECL|method|setRpcCallId (int callId)
specifier|public
name|void
name|setRpcCallId
parameter_list|(
name|int
name|callId
parameter_list|)
block|{
name|this
operator|.
name|rpcCallId
operator|=
name|callId
expr_stmt|;
block|}
DECL|method|readFields (DataInputStream in, int logVersion)
specifier|abstract
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
function_decl|;
DECL|method|writeFields (DataOutputStream out)
specifier|public
specifier|abstract
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
function_decl|;
DECL|method|writeFields (DataOutputStream out, int logVersion)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|writeFields
argument_list|(
name|out
argument_list|)
expr_stmt|;
block|}
DECL|interface|BlockListUpdatingOp
specifier|static
interface|interface
name|BlockListUpdatingOp
block|{
DECL|method|getBlocks ()
name|Block
index|[]
name|getBlocks
parameter_list|()
function_decl|;
DECL|method|getPath ()
name|String
name|getPath
parameter_list|()
function_decl|;
DECL|method|shouldCompleteLastBlock ()
name|boolean
name|shouldCompleteLastBlock
parameter_list|()
function_decl|;
block|}
DECL|method|writeRpcIds (final byte[] clientId, final int callId, DataOutputStream out)
specifier|private
specifier|static
name|void
name|writeRpcIds
parameter_list|(
specifier|final
name|byte
index|[]
name|clientId
parameter_list|,
specifier|final
name|int
name|callId
parameter_list|,
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeBytes
argument_list|(
name|clientId
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeInt
argument_list|(
name|callId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
DECL|method|readRpcIds (DataInputStream in, int logVersion)
name|void
name|readRpcIds
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_SUPPORT_RETRYCACHE
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|rpcClientId
operator|=
name|FSImageSerialization
operator|.
name|readBytes
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|rpcCallId
operator|=
name|FSImageSerialization
operator|.
name|readInt
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
DECL|method|readRpcIdsFromXml (Stanza st)
name|void
name|readRpcIdsFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
block|{
name|this
operator|.
name|rpcClientId
operator|=
name|st
operator|.
name|hasChildren
argument_list|(
literal|"RPC_CLIENTID"
argument_list|)
condition|?
name|ClientId
operator|.
name|toBytes
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"RPC_CLIENTID"
argument_list|)
argument_list|)
else|:
name|RpcConstants
operator|.
name|DUMMY_CLIENT_ID
expr_stmt|;
name|this
operator|.
name|rpcCallId
operator|=
name|st
operator|.
name|hasChildren
argument_list|(
literal|"RPC_CALLID"
argument_list|)
condition|?
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"RPC_CALLID"
argument_list|)
argument_list|)
else|:
name|RpcConstants
operator|.
name|INVALID_CALL_ID
expr_stmt|;
block|}
DECL|method|appendRpcIdsToString (final StringBuilder builder, final byte[] clientId, final int callId)
specifier|private
specifier|static
name|void
name|appendRpcIdsToString
parameter_list|(
specifier|final
name|StringBuilder
name|builder
parameter_list|,
specifier|final
name|byte
index|[]
name|clientId
parameter_list|,
specifier|final
name|int
name|callId
parameter_list|)
block|{
name|builder
operator|.
name|append
argument_list|(
literal|", RpcClientId="
argument_list|)
operator|.
name|append
argument_list|(
name|ClientId
operator|.
name|toString
argument_list|(
name|clientId
argument_list|)
argument_list|)
operator|.
name|append
argument_list|(
literal|", RpcCallId="
argument_list|)
operator|.
name|append
argument_list|(
name|callId
argument_list|)
expr_stmt|;
block|}
DECL|method|appendRpcIdsToXml (ContentHandler contentHandler, final byte[] clientId, final int callId)
specifier|private
specifier|static
name|void
name|appendRpcIdsToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
specifier|final
name|byte
index|[]
name|clientId
parameter_list|,
specifier|final
name|int
name|callId
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"RPC_CLIENTID"
argument_list|,
name|ClientId
operator|.
name|toString
argument_list|(
name|clientId
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"RPC_CALLID"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|callId
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|class|AclEditLogUtil
specifier|private
specifier|static
specifier|final
class|class
name|AclEditLogUtil
block|{
DECL|field|ACL_EDITLOG_ENTRY_HAS_NAME_OFFSET
specifier|private
specifier|static
specifier|final
name|int
name|ACL_EDITLOG_ENTRY_HAS_NAME_OFFSET
init|=
literal|6
decl_stmt|;
DECL|field|ACL_EDITLOG_ENTRY_TYPE_OFFSET
specifier|private
specifier|static
specifier|final
name|int
name|ACL_EDITLOG_ENTRY_TYPE_OFFSET
init|=
literal|3
decl_stmt|;
DECL|field|ACL_EDITLOG_ENTRY_SCOPE_OFFSET
specifier|private
specifier|static
specifier|final
name|int
name|ACL_EDITLOG_ENTRY_SCOPE_OFFSET
init|=
literal|5
decl_stmt|;
DECL|field|ACL_EDITLOG_PERM_MASK
specifier|private
specifier|static
specifier|final
name|int
name|ACL_EDITLOG_PERM_MASK
init|=
literal|7
decl_stmt|;
DECL|field|ACL_EDITLOG_ENTRY_TYPE_MASK
specifier|private
specifier|static
specifier|final
name|int
name|ACL_EDITLOG_ENTRY_TYPE_MASK
init|=
literal|3
decl_stmt|;
DECL|field|ACL_EDITLOG_ENTRY_SCOPE_MASK
specifier|private
specifier|static
specifier|final
name|int
name|ACL_EDITLOG_ENTRY_SCOPE_MASK
init|=
literal|1
decl_stmt|;
DECL|field|FSACTION_VALUES
specifier|private
specifier|static
specifier|final
name|FsAction
index|[]
name|FSACTION_VALUES
init|=
name|FsAction
operator|.
name|values
argument_list|()
decl_stmt|;
DECL|field|ACL_ENTRY_SCOPE_VALUES
specifier|private
specifier|static
specifier|final
name|AclEntryScope
index|[]
name|ACL_ENTRY_SCOPE_VALUES
init|=
name|AclEntryScope
operator|.
name|values
argument_list|()
decl_stmt|;
DECL|field|ACL_ENTRY_TYPE_VALUES
specifier|private
specifier|static
specifier|final
name|AclEntryType
index|[]
name|ACL_ENTRY_TYPE_VALUES
init|=
name|AclEntryType
operator|.
name|values
argument_list|()
decl_stmt|;
DECL|method|read (DataInputStream in, int logVersion)
specifier|private
specifier|static
name|List
argument_list|<
name|AclEntry
argument_list|>
name|read
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|Feature
operator|.
name|EXTENDED_ACL
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
return|return
literal|null
return|;
block|}
name|int
name|size
init|=
name|in
operator|.
name|readInt
argument_list|()
decl_stmt|;
if|if
condition|(
name|size
operator|==
literal|0
condition|)
block|{
return|return
literal|null
return|;
block|}
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
init|=
name|Lists
operator|.
name|newArrayListWithCapacity
argument_list|(
name|size
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
operator|++
name|i
control|)
block|{
name|int
name|v
init|=
name|in
operator|.
name|read
argument_list|()
decl_stmt|;
name|int
name|p
init|=
name|v
operator|&
name|ACL_EDITLOG_PERM_MASK
decl_stmt|;
name|int
name|t
init|=
operator|(
name|v
operator|>>
name|ACL_EDITLOG_ENTRY_TYPE_OFFSET
operator|)
operator|&
name|ACL_EDITLOG_ENTRY_TYPE_MASK
decl_stmt|;
name|int
name|s
init|=
operator|(
name|v
operator|>>
name|ACL_EDITLOG_ENTRY_SCOPE_OFFSET
operator|)
operator|&
name|ACL_EDITLOG_ENTRY_SCOPE_MASK
decl_stmt|;
name|boolean
name|hasName
init|=
operator|(
operator|(
name|v
operator|>>
name|ACL_EDITLOG_ENTRY_HAS_NAME_OFFSET
operator|)
operator|&
literal|1
operator|)
operator|==
literal|1
decl_stmt|;
name|String
name|name
init|=
name|hasName
condition|?
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
else|:
literal|null
decl_stmt|;
name|aclEntries
operator|.
name|add
argument_list|(
operator|new
name|AclEntry
operator|.
name|Builder
argument_list|()
operator|.
name|setName
argument_list|(
name|name
argument_list|)
operator|.
name|setPermission
argument_list|(
name|FSACTION_VALUES
index|[
name|p
index|]
argument_list|)
operator|.
name|setScope
argument_list|(
name|ACL_ENTRY_SCOPE_VALUES
index|[
name|s
index|]
argument_list|)
operator|.
name|setType
argument_list|(
name|ACL_ENTRY_TYPE_VALUES
index|[
name|t
index|]
argument_list|)
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|aclEntries
return|;
block|}
DECL|method|write (List<AclEntry> aclEntries, DataOutputStream out)
specifier|private
specifier|static
name|void
name|write
parameter_list|(
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
parameter_list|,
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|aclEntries
operator|==
literal|null
condition|)
block|{
name|out
operator|.
name|writeInt
argument_list|(
literal|0
argument_list|)
expr_stmt|;
return|return;
block|}
name|out
operator|.
name|writeInt
argument_list|(
name|aclEntries
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|AclEntry
name|e
range|:
name|aclEntries
control|)
block|{
name|boolean
name|hasName
init|=
name|e
operator|.
name|getName
argument_list|()
operator|!=
literal|null
decl_stmt|;
name|int
name|v
init|=
operator|(
name|e
operator|.
name|getScope
argument_list|()
operator|.
name|ordinal
argument_list|()
operator|<<
name|ACL_EDITLOG_ENTRY_SCOPE_OFFSET
operator|)
operator||
operator|(
name|e
operator|.
name|getType
argument_list|()
operator|.
name|ordinal
argument_list|()
operator|<<
name|ACL_EDITLOG_ENTRY_TYPE_OFFSET
operator|)
operator||
name|e
operator|.
name|getPermission
argument_list|()
operator|.
name|ordinal
argument_list|()
decl_stmt|;
if|if
condition|(
name|hasName
condition|)
block|{
name|v
operator||=
literal|1
operator|<<
name|ACL_EDITLOG_ENTRY_HAS_NAME_OFFSET
expr_stmt|;
block|}
name|out
operator|.
name|write
argument_list|(
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|hasName
condition|)
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|e
operator|.
name|getName
argument_list|()
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
DECL|method|readXAttrsFromEditLog (DataInputStream in, int logVersion)
specifier|private
specifier|static
name|List
argument_list|<
name|XAttr
argument_list|>
name|readXAttrsFromEditLog
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|NameNodeLayoutVersion
operator|.
name|Feature
operator|.
name|XATTRS
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
return|return
literal|null
return|;
block|}
name|XAttrEditLogProto
name|proto
init|=
name|XAttrEditLogProto
operator|.
name|parseDelimitedFrom
argument_list|(
name|in
argument_list|)
decl_stmt|;
return|return
name|PBHelperClient
operator|.
name|convertXAttrs
argument_list|(
name|proto
operator|.
name|getXAttrsList
argument_list|()
argument_list|)
return|;
block|}
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
DECL|class|AddCloseOp
specifier|static
specifier|abstract
class|class
name|AddCloseOp
extends|extends
name|FSEditLogOp
implements|implements
name|BlockListUpdatingOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|inodeId
name|long
name|inodeId
decl_stmt|;
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|replication
name|short
name|replication
decl_stmt|;
DECL|field|mtime
name|long
name|mtime
decl_stmt|;
DECL|field|atime
name|long
name|atime
decl_stmt|;
DECL|field|blockSize
name|long
name|blockSize
decl_stmt|;
DECL|field|blocks
name|Block
index|[]
name|blocks
decl_stmt|;
DECL|field|permissions
name|PermissionStatus
name|permissions
decl_stmt|;
DECL|field|aclEntries
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
decl_stmt|;
DECL|field|xAttrs
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
decl_stmt|;
DECL|field|clientName
name|String
name|clientName
decl_stmt|;
DECL|field|clientMachine
name|String
name|clientMachine
decl_stmt|;
DECL|field|overwrite
name|boolean
name|overwrite
decl_stmt|;
DECL|field|storagePolicyId
name|byte
name|storagePolicyId
decl_stmt|;
DECL|field|erasureCodingPolicyId
name|byte
name|erasureCodingPolicyId
decl_stmt|;
DECL|method|AddCloseOp (FSEditLogOpCodes opCode)
specifier|private
name|AddCloseOp
parameter_list|(
name|FSEditLogOpCodes
name|opCode
parameter_list|)
block|{
name|super
argument_list|(
name|opCode
argument_list|)
expr_stmt|;
name|storagePolicyId
operator|=
name|HdfsConstants
operator|.
name|BLOCK_STORAGE_POLICY_ID_UNSPECIFIED
expr_stmt|;
name|erasureCodingPolicyId
operator|=
name|ErasureCodeConstants
operator|.
name|REPLICATION_POLICY_ID
expr_stmt|;
assert|assert
operator|(
name|opCode
operator|==
name|OP_ADD
operator|||
name|opCode
operator|==
name|OP_CLOSE
operator|||
name|opCode
operator|==
name|OP_APPEND
operator|)
assert|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|inodeId
operator|=
literal|0L
expr_stmt|;
name|path
operator|=
literal|null
expr_stmt|;
name|replication
operator|=
literal|0
expr_stmt|;
name|mtime
operator|=
literal|0L
expr_stmt|;
name|atime
operator|=
literal|0L
expr_stmt|;
name|blockSize
operator|=
literal|0L
expr_stmt|;
name|blocks
operator|=
literal|null
expr_stmt|;
name|permissions
operator|=
literal|null
expr_stmt|;
name|aclEntries
operator|=
literal|null
expr_stmt|;
name|xAttrs
operator|=
literal|null
expr_stmt|;
name|clientName
operator|=
literal|null
expr_stmt|;
name|clientMachine
operator|=
literal|null
expr_stmt|;
name|overwrite
operator|=
literal|false
expr_stmt|;
name|storagePolicyId
operator|=
literal|0
expr_stmt|;
name|erasureCodingPolicyId
operator|=
name|ErasureCodeConstants
operator|.
name|REPLICATION_POLICY_ID
expr_stmt|;
block|}
DECL|method|setInodeId (long inodeId)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setInodeId
parameter_list|(
name|long
name|inodeId
parameter_list|)
block|{
name|this
operator|.
name|inodeId
operator|=
name|inodeId
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setPath (String path)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|getPath ()
specifier|public
name|String
name|getPath
parameter_list|()
block|{
return|return
name|path
return|;
block|}
DECL|method|setReplication (short replication)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setReplication
parameter_list|(
name|short
name|replication
parameter_list|)
block|{
name|this
operator|.
name|replication
operator|=
name|replication
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setModificationTime (long mtime)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setModificationTime
parameter_list|(
name|long
name|mtime
parameter_list|)
block|{
name|this
operator|.
name|mtime
operator|=
name|mtime
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setAccessTime (long atime)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setAccessTime
parameter_list|(
name|long
name|atime
parameter_list|)
block|{
name|this
operator|.
name|atime
operator|=
name|atime
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setBlockSize (long blockSize)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setBlockSize
parameter_list|(
name|long
name|blockSize
parameter_list|)
block|{
name|this
operator|.
name|blockSize
operator|=
name|blockSize
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setBlocks (Block[] blocks)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setBlocks
parameter_list|(
name|Block
index|[]
name|blocks
parameter_list|)
block|{
if|if
condition|(
name|blocks
operator|.
name|length
operator|>
name|MAX_BLOCKS
condition|)
block|{
throw|throw
operator|new
name|RuntimeException
argument_list|(
literal|"Can't have more than "
operator|+
name|MAX_BLOCKS
operator|+
literal|" in an AddCloseOp."
argument_list|)
throw|;
block|}
name|this
operator|.
name|blocks
operator|=
name|blocks
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|getBlocks ()
specifier|public
name|Block
index|[]
name|getBlocks
parameter_list|()
block|{
return|return
name|blocks
return|;
block|}
DECL|method|setPermissionStatus (PermissionStatus permissions)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setPermissionStatus
parameter_list|(
name|PermissionStatus
name|permissions
parameter_list|)
block|{
name|this
operator|.
name|permissions
operator|=
name|permissions
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setAclEntries (List<AclEntry> aclEntries)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setAclEntries
parameter_list|(
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
parameter_list|)
block|{
name|this
operator|.
name|aclEntries
operator|=
name|aclEntries
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setXAttrs (List<XAttr> xAttrs)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setXAttrs
parameter_list|(
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
parameter_list|)
block|{
name|this
operator|.
name|xAttrs
operator|=
name|xAttrs
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setClientName (String clientName)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setClientName
parameter_list|(
name|String
name|clientName
parameter_list|)
block|{
name|this
operator|.
name|clientName
operator|=
name|clientName
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setClientMachine (String clientMachine)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setClientMachine
parameter_list|(
name|String
name|clientMachine
parameter_list|)
block|{
name|this
operator|.
name|clientMachine
operator|=
name|clientMachine
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setOverwrite (boolean overwrite)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setOverwrite
parameter_list|(
name|boolean
name|overwrite
parameter_list|)
block|{
name|this
operator|.
name|overwrite
operator|=
name|overwrite
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setStoragePolicyId (byte storagePolicyId)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setStoragePolicyId
parameter_list|(
name|byte
name|storagePolicyId
parameter_list|)
block|{
name|this
operator|.
name|storagePolicyId
operator|=
name|storagePolicyId
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
DECL|method|setErasureCodingPolicyId (byte ecPolicyId)
parameter_list|<
name|T
extends|extends
name|AddCloseOp
parameter_list|>
name|T
name|setErasureCodingPolicyId
parameter_list|(
name|byte
name|ecPolicyId
parameter_list|)
block|{
name|this
operator|.
name|erasureCodingPolicyId
operator|=
name|ecPolicyId
expr_stmt|;
return|return
operator|(
name|T
operator|)
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Unsupported without logversion"
argument_list|)
throw|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out, int logVersion)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|inodeId
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeShort
argument_list|(
name|replication
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|mtime
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|atime
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|blockSize
argument_list|,
name|out
argument_list|)
expr_stmt|;
operator|new
name|ArrayWritable
argument_list|(
name|Block
operator|.
name|class
argument_list|,
name|blocks
argument_list|)
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|permissions
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|opCode
operator|==
name|OP_ADD
condition|)
block|{
name|AclEditLogUtil
operator|.
name|write
argument_list|(
name|aclEntries
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|XAttrEditLogProto
operator|.
name|Builder
name|b
init|=
name|XAttrEditLogProto
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|b
operator|.
name|addAllXAttrs
argument_list|(
name|PBHelperClient
operator|.
name|convertXAttrProto
argument_list|(
name|xAttrs
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|.
name|build
argument_list|()
operator|.
name|writeDelimitedTo
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|clientName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|clientMachine
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeBoolean
argument_list|(
name|overwrite
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeByte
argument_list|(
name|storagePolicyId
argument_list|,
name|out
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|NameNodeLayoutVersion
operator|.
name|Feature
operator|.
name|ERASURE_CODING
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|FSImageSerialization
operator|.
name|writeByte
argument_list|(
name|erasureCodingPolicyId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
comment|// write clientId and callId
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|ADD_INODE_ID
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|inodeId
operator|=
name|in
operator|.
name|readLong
argument_list|()
expr_stmt|;
block|}
else|else
block|{
comment|// The inodeId should be updated when this editLogOp is applied
name|this
operator|.
name|inodeId
operator|=
name|HdfsConstants
operator|.
name|GRANDFATHER_INODE_ID
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|-
literal|17
operator|<
name|logVersion
operator|&&
name|length
operator|!=
literal|4
operator|)
operator|||
operator|(
name|logVersion
operator|<=
operator|-
literal|17
operator|&&
name|length
operator|!=
literal|5
operator|&&
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
operator|)
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format."
operator|+
literal|" logVersion is "
operator|+
name|logVersion
operator|+
literal|" but writables.length is "
operator|+
name|length
operator|+
literal|". "
argument_list|)
throw|;
block|}
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|replication
operator|=
name|FSImageSerialization
operator|.
name|readShort
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|mtime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|replication
operator|=
name|readShort
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|mtime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|FILE_ACCESS_TIME
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|atime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|atime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|this
operator|.
name|atime
operator|=
literal|0
expr_stmt|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|blockSize
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|blockSize
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
name|this
operator|.
name|blocks
operator|=
name|readBlocks
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|this
operator|.
name|permissions
operator|=
name|PermissionStatus
operator|.
name|read
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|opCode
operator|==
name|OP_ADD
condition|)
block|{
name|aclEntries
operator|=
name|AclEditLogUtil
operator|.
name|read
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|this
operator|.
name|xAttrs
operator|=
name|readXAttrsFromEditLog
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|NameNodeLayoutVersion
operator|.
name|Feature
operator|.
name|CREATE_OVERWRITE
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|overwrite
operator|=
name|FSImageSerialization
operator|.
name|readBoolean
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|overwrite
operator|=
literal|false
expr_stmt|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|NameNodeLayoutVersion
operator|.
name|Feature
operator|.
name|BLOCK_STORAGE_POLICY
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|storagePolicyId
operator|=
name|FSImageSerialization
operator|.
name|readByte
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|storagePolicyId
operator|=
name|HdfsConstants
operator|.
name|BLOCK_STORAGE_POLICY_ID_UNSPECIFIED
expr_stmt|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|NameNodeLayoutVersion
operator|.
name|Feature
operator|.
name|ERASURE_CODING
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|erasureCodingPolicyId
operator|=
name|FSImageSerialization
operator|.
name|readByte
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|erasureCodingPolicyId
operator|=
name|ErasureCodeConstants
operator|.
name|REPLICATION_POLICY_ID
expr_stmt|;
block|}
comment|// read clientId and callId
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|clientName
operator|=
literal|""
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
literal|""
expr_stmt|;
block|}
block|}
DECL|field|MAX_BLOCKS
specifier|static
specifier|final
specifier|public
name|int
name|MAX_BLOCKS
init|=
literal|1024
operator|*
literal|1024
operator|*
literal|64
decl_stmt|;
DECL|method|readBlocks ( DataInputStream in, int logVersion)
specifier|private
specifier|static
name|Block
index|[]
name|readBlocks
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|int
name|numBlocks
init|=
name|in
operator|.
name|readInt
argument_list|()
decl_stmt|;
if|if
condition|(
name|numBlocks
operator|<
literal|0
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"invalid negative number of blocks"
argument_list|)
throw|;
block|}
elseif|else
if|if
condition|(
name|numBlocks
operator|>
name|MAX_BLOCKS
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"invalid number of blocks: "
operator|+
name|numBlocks
operator|+
literal|".  The maximum number of blocks per file is "
operator|+
name|MAX_BLOCKS
argument_list|)
throw|;
block|}
name|Block
index|[]
name|blocks
init|=
operator|new
name|Block
index|[
name|numBlocks
index|]
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|numBlocks
condition|;
name|i
operator|++
control|)
block|{
name|Block
name|blk
init|=
operator|new
name|Block
argument_list|()
decl_stmt|;
name|blk
operator|.
name|readFields
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|blocks
index|[
name|i
index|]
operator|=
name|blk
expr_stmt|;
block|}
return|return
name|blocks
return|;
block|}
DECL|method|stringifyMembers ()
specifier|public
name|String
name|stringifyMembers
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"[length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", inodeId="
argument_list|)
operator|.
name|append
argument_list|(
name|inodeId
argument_list|)
operator|.
name|append
argument_list|(
literal|", path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", replication="
argument_list|)
operator|.
name|append
argument_list|(
name|replication
argument_list|)
operator|.
name|append
argument_list|(
literal|", mtime="
argument_list|)
operator|.
name|append
argument_list|(
name|mtime
argument_list|)
operator|.
name|append
argument_list|(
literal|", atime="
argument_list|)
operator|.
name|append
argument_list|(
name|atime
argument_list|)
operator|.
name|append
argument_list|(
literal|", blockSize="
argument_list|)
operator|.
name|append
argument_list|(
name|blockSize
argument_list|)
operator|.
name|append
argument_list|(
literal|", blocks="
argument_list|)
operator|.
name|append
argument_list|(
name|Arrays
operator|.
name|toString
argument_list|(
name|blocks
argument_list|)
argument_list|)
operator|.
name|append
argument_list|(
literal|", permissions="
argument_list|)
operator|.
name|append
argument_list|(
name|permissions
argument_list|)
operator|.
name|append
argument_list|(
literal|", aclEntries="
argument_list|)
operator|.
name|append
argument_list|(
name|aclEntries
argument_list|)
operator|.
name|append
argument_list|(
literal|", clientName="
argument_list|)
operator|.
name|append
argument_list|(
name|clientName
argument_list|)
operator|.
name|append
argument_list|(
literal|", clientMachine="
argument_list|)
operator|.
name|append
argument_list|(
name|clientMachine
argument_list|)
operator|.
name|append
argument_list|(
literal|", overwrite="
argument_list|)
operator|.
name|append
argument_list|(
name|overwrite
argument_list|)
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|opCode
operator|==
name|OP_ADD
condition|)
block|{
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
name|builder
operator|.
name|append
argument_list|(
literal|", storagePolicyId="
argument_list|)
operator|.
name|append
argument_list|(
name|storagePolicyId
argument_list|)
operator|.
name|append
argument_list|(
literal|", erasureCodingPolicyId="
argument_list|)
operator|.
name|append
argument_list|(
name|erasureCodingPolicyId
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"INODEID"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|inodeId
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"REPLICATION"
argument_list|,
name|Short
operator|.
name|toString
argument_list|(
name|replication
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MTIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|mtime
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"ATIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|atime
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"BLOCKSIZE"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|blockSize
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CLIENT_NAME"
argument_list|,
name|clientName
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CLIENT_MACHINE"
argument_list|,
name|clientMachine
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"OVERWRITE"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|overwrite
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Block
name|b
range|:
name|blocks
control|)
block|{
name|FSEditLogOp
operator|.
name|blockToXml
argument_list|(
name|contentHandler
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
name|FSEditLogOp
operator|.
name|permissionStatusToXml
argument_list|(
name|contentHandler
argument_list|,
name|permissions
argument_list|)
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|opCode
operator|==
name|OP_ADD
condition|)
block|{
if|if
condition|(
name|aclEntries
operator|!=
literal|null
condition|)
block|{
name|appendAclEntriesToXml
argument_list|(
name|contentHandler
argument_list|,
name|aclEntries
argument_list|)
expr_stmt|;
block|}
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"ERASURE_CODING_POLICY_ID"
argument_list|,
name|Byte
operator|.
name|toString
argument_list|(
name|erasureCodingPolicyId
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|inodeId
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"INODEID"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|replication
operator|=
name|Short
operator|.
name|parseShort
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"REPLICATION"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|mtime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MTIME"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"ATIME"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|blockSize
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"BLOCKSIZE"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CLIENT_NAME"
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CLIENT_MACHINE"
argument_list|)
expr_stmt|;
name|this
operator|.
name|overwrite
operator|=
name|Boolean
operator|.
name|parseBoolean
argument_list|(
name|st
operator|.
name|getValueOrNull
argument_list|(
literal|"OVERWRITE"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|st
operator|.
name|hasChildren
argument_list|(
literal|"BLOCK"
argument_list|)
condition|)
block|{
name|List
argument_list|<
name|Stanza
argument_list|>
name|blocks
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"BLOCK"
argument_list|)
decl_stmt|;
name|this
operator|.
name|blocks
operator|=
operator|new
name|Block
index|[
name|blocks
operator|.
name|size
argument_list|()
index|]
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|blocks
operator|.
name|size
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|this
operator|.
name|blocks
index|[
name|i
index|]
operator|=
name|FSEditLogOp
operator|.
name|blockFromXml
argument_list|(
name|blocks
operator|.
name|get
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|this
operator|.
name|blocks
operator|=
operator|new
name|Block
index|[
literal|0
index|]
expr_stmt|;
block|}
name|this
operator|.
name|permissions
operator|=
name|permissionStatusFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|aclEntries
operator|=
name|readAclEntriesFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
if|if
condition|(
name|st
operator|.
name|hasChildren
argument_list|(
literal|"ERASURE_CODING_POLICY_ID"
argument_list|)
condition|)
block|{
name|this
operator|.
name|erasureCodingPolicyId
operator|=
name|Byte
operator|.
name|parseByte
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"ERASURE_CODING_POLICY_ID"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * {@literal @AtMostOnce} for {@link ClientProtocol#create} and    * {@link ClientProtocol#append}    */
DECL|class|AddOp
specifier|static
class|class
name|AddOp
extends|extends
name|AddCloseOp
block|{
DECL|method|AddOp ()
name|AddOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ADD
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AddOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AddOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ADD
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|shouldCompleteLastBlock ()
specifier|public
name|boolean
name|shouldCompleteLastBlock
parameter_list|()
block|{
return|return
literal|false
return|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AddOp "
argument_list|)
operator|.
name|append
argument_list|(
name|stringifyMembers
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Although {@link ClientProtocol#append} may also log a close op, we do    * not need to record the rpc ids here since a successful appendFile op will    * finally log an AddOp.    */
DECL|class|CloseOp
specifier|static
class|class
name|CloseOp
extends|extends
name|AddCloseOp
block|{
DECL|method|CloseOp ()
name|CloseOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_CLOSE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|CloseOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|CloseOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_CLOSE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|shouldCompleteLastBlock ()
specifier|public
name|boolean
name|shouldCompleteLastBlock
parameter_list|()
block|{
return|return
literal|true
return|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"CloseOp "
argument_list|)
operator|.
name|append
argument_list|(
name|stringifyMembers
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
DECL|class|AppendOp
specifier|static
class|class
name|AppendOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|clientName
name|String
name|clientName
decl_stmt|;
DECL|field|clientMachine
name|String
name|clientMachine
decl_stmt|;
DECL|field|newBlock
name|boolean
name|newBlock
decl_stmt|;
DECL|method|AppendOp ()
name|AppendOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_APPEND
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AppendOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AppendOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_APPEND
argument_list|)
return|;
block|}
DECL|method|setPath (String path)
name|AppendOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setClientName (String clientName)
name|AppendOp
name|setClientName
parameter_list|(
name|String
name|clientName
parameter_list|)
block|{
name|this
operator|.
name|clientName
operator|=
name|clientName
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setClientMachine (String clientMachine)
name|AppendOp
name|setClientMachine
parameter_list|(
name|String
name|clientMachine
parameter_list|)
block|{
name|this
operator|.
name|clientMachine
operator|=
name|clientMachine
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNewBlock (boolean newBlock)
name|AppendOp
name|setNewBlock
parameter_list|(
name|boolean
name|newBlock
parameter_list|)
block|{
name|this
operator|.
name|newBlock
operator|=
name|newBlock
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AppendOp "
argument_list|)
operator|.
name|append
argument_list|(
literal|"[path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", clientName="
argument_list|)
operator|.
name|append
argument_list|(
name|clientName
argument_list|)
operator|.
name|append
argument_list|(
literal|", clientMachine="
argument_list|)
operator|.
name|append
argument_list|(
name|clientMachine
argument_list|)
operator|.
name|append
argument_list|(
literal|", newBlock="
argument_list|)
operator|.
name|append
argument_list|(
name|newBlock
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|this
operator|.
name|path
operator|=
literal|null
expr_stmt|;
name|this
operator|.
name|clientName
operator|=
literal|null
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
literal|null
expr_stmt|;
name|this
operator|.
name|newBlock
operator|=
literal|false
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|newBlock
operator|=
name|FSImageSerialization
operator|.
name|readBoolean
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|clientName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|clientMachine
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeBoolean
argument_list|(
name|newBlock
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CLIENT_NAME"
argument_list|,
name|clientName
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CLIENT_MACHINE"
argument_list|,
name|clientMachine
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NEWBLOCK"
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|newBlock
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CLIENT_NAME"
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CLIENT_MACHINE"
argument_list|)
expr_stmt|;
name|this
operator|.
name|newBlock
operator|=
name|Boolean
operator|.
name|parseBoolean
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"NEWBLOCK"
argument_list|)
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|AddBlockOp
specifier|static
class|class
name|AddBlockOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|path
specifier|private
name|String
name|path
decl_stmt|;
DECL|field|penultimateBlock
specifier|private
name|Block
name|penultimateBlock
decl_stmt|;
DECL|field|lastBlock
specifier|private
name|Block
name|lastBlock
decl_stmt|;
DECL|method|AddBlockOp ()
name|AddBlockOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ADD_BLOCK
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AddBlockOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AddBlockOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ADD_BLOCK
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|path
operator|=
literal|null
expr_stmt|;
name|penultimateBlock
operator|=
literal|null
expr_stmt|;
name|lastBlock
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setPath (String path)
name|AddBlockOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|getPath ()
specifier|public
name|String
name|getPath
parameter_list|()
block|{
return|return
name|path
return|;
block|}
DECL|method|setPenultimateBlock (Block pBlock)
name|AddBlockOp
name|setPenultimateBlock
parameter_list|(
name|Block
name|pBlock
parameter_list|)
block|{
name|this
operator|.
name|penultimateBlock
operator|=
name|pBlock
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|getPenultimateBlock ()
name|Block
name|getPenultimateBlock
parameter_list|()
block|{
return|return
name|penultimateBlock
return|;
block|}
DECL|method|setLastBlock (Block lastBlock)
name|AddBlockOp
name|setLastBlock
parameter_list|(
name|Block
name|lastBlock
parameter_list|)
block|{
name|this
operator|.
name|lastBlock
operator|=
name|lastBlock
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|getLastBlock ()
name|Block
name|getLastBlock
parameter_list|()
block|{
return|return
name|lastBlock
return|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|int
name|size
init|=
name|penultimateBlock
operator|!=
literal|null
condition|?
literal|2
else|:
literal|1
decl_stmt|;
name|Block
index|[]
name|blocks
init|=
operator|new
name|Block
index|[
name|size
index|]
decl_stmt|;
if|if
condition|(
name|penultimateBlock
operator|!=
literal|null
condition|)
block|{
name|blocks
index|[
literal|0
index|]
operator|=
name|penultimateBlock
expr_stmt|;
block|}
name|blocks
index|[
name|size
operator|-
literal|1
index|]
operator|=
name|lastBlock
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeCompactBlockArray
argument_list|(
name|blocks
argument_list|,
name|out
argument_list|)
expr_stmt|;
comment|// clientId and callId
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|Block
index|[]
name|blocks
init|=
name|FSImageSerialization
operator|.
name|readCompactBlockArray
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
decl_stmt|;
name|Preconditions
operator|.
name|checkState
argument_list|(
name|blocks
operator|.
name|length
operator|==
literal|2
operator|||
name|blocks
operator|.
name|length
operator|==
literal|1
argument_list|)
expr_stmt|;
name|penultimateBlock
operator|=
name|blocks
operator|.
name|length
operator|==
literal|1
condition|?
literal|null
else|:
name|blocks
index|[
literal|0
index|]
expr_stmt|;
name|lastBlock
operator|=
name|blocks
index|[
name|blocks
operator|.
name|length
operator|-
literal|1
index|]
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|sb
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|sb
operator|.
name|append
argument_list|(
literal|"AddBlockOp [path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", penultimateBlock="
argument_list|)
operator|.
name|append
argument_list|(
name|penultimateBlock
operator|==
literal|null
condition|?
literal|"NULL"
else|:
name|penultimateBlock
argument_list|)
operator|.
name|append
argument_list|(
literal|", lastBlock="
argument_list|)
operator|.
name|append
argument_list|(
name|lastBlock
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|sb
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|sb
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|sb
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
name|penultimateBlock
operator|!=
literal|null
condition|)
block|{
name|FSEditLogOp
operator|.
name|blockToXml
argument_list|(
name|contentHandler
argument_list|,
name|penultimateBlock
argument_list|)
expr_stmt|;
block|}
name|FSEditLogOp
operator|.
name|blockToXml
argument_list|(
name|contentHandler
argument_list|,
name|lastBlock
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Stanza
argument_list|>
name|blocks
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"BLOCK"
argument_list|)
decl_stmt|;
name|int
name|size
init|=
name|blocks
operator|.
name|size
argument_list|()
decl_stmt|;
name|Preconditions
operator|.
name|checkState
argument_list|(
name|size
operator|==
literal|1
operator|||
name|size
operator|==
literal|2
argument_list|)
expr_stmt|;
name|this
operator|.
name|penultimateBlock
operator|=
name|size
operator|==
literal|2
condition|?
name|FSEditLogOp
operator|.
name|blockFromXml
argument_list|(
name|blocks
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
else|:
literal|null
expr_stmt|;
name|this
operator|.
name|lastBlock
operator|=
name|FSEditLogOp
operator|.
name|blockFromXml
argument_list|(
name|blocks
operator|.
name|get
argument_list|(
name|size
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * {@literal @AtMostOnce} for {@link ClientProtocol#updatePipeline}, but     * {@literal @Idempotent} for some other ops.    */
DECL|class|UpdateBlocksOp
specifier|static
class|class
name|UpdateBlocksOp
extends|extends
name|FSEditLogOp
implements|implements
name|BlockListUpdatingOp
block|{
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|blocks
name|Block
index|[]
name|blocks
decl_stmt|;
DECL|method|UpdateBlocksOp ()
name|UpdateBlocksOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_UPDATE_BLOCKS
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|UpdateBlocksOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|UpdateBlocksOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_UPDATE_BLOCKS
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|path
operator|=
literal|null
expr_stmt|;
name|blocks
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setPath (String path)
name|UpdateBlocksOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|getPath ()
specifier|public
name|String
name|getPath
parameter_list|()
block|{
return|return
name|path
return|;
block|}
DECL|method|setBlocks (Block[] blocks)
name|UpdateBlocksOp
name|setBlocks
parameter_list|(
name|Block
index|[]
name|blocks
parameter_list|)
block|{
name|this
operator|.
name|blocks
operator|=
name|blocks
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|getBlocks ()
specifier|public
name|Block
index|[]
name|getBlocks
parameter_list|()
block|{
return|return
name|blocks
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeCompactBlockArray
argument_list|(
name|blocks
argument_list|,
name|out
argument_list|)
expr_stmt|;
comment|// clientId and callId
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|blocks
operator|=
name|FSImageSerialization
operator|.
name|readCompactBlockArray
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|shouldCompleteLastBlock ()
specifier|public
name|boolean
name|shouldCompleteLastBlock
parameter_list|()
block|{
return|return
literal|false
return|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|sb
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|sb
operator|.
name|append
argument_list|(
literal|"UpdateBlocksOp [path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", blocks="
argument_list|)
operator|.
name|append
argument_list|(
name|Arrays
operator|.
name|toString
argument_list|(
name|blocks
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|sb
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|sb
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|sb
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
for|for
control|(
name|Block
name|b
range|:
name|blocks
control|)
block|{
name|FSEditLogOp
operator|.
name|blockToXml
argument_list|(
name|contentHandler
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Stanza
argument_list|>
name|blocks
init|=
name|st
operator|.
name|hasChildren
argument_list|(
literal|"BLOCK"
argument_list|)
condition|?
name|st
operator|.
name|getChildren
argument_list|(
literal|"BLOCK"
argument_list|)
else|:
operator|new
name|ArrayList
argument_list|<
name|Stanza
argument_list|>
argument_list|()
decl_stmt|;
name|this
operator|.
name|blocks
operator|=
operator|new
name|Block
index|[
name|blocks
operator|.
name|size
argument_list|()
index|]
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|blocks
operator|.
name|size
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|this
operator|.
name|blocks
index|[
name|i
index|]
operator|=
name|FSEditLogOp
operator|.
name|blockFromXml
argument_list|(
name|blocks
operator|.
name|get
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setReplication} */
DECL|class|SetReplicationOp
specifier|static
class|class
name|SetReplicationOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|replication
name|short
name|replication
decl_stmt|;
DECL|method|SetReplicationOp ()
name|SetReplicationOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_REPLICATION
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetReplicationOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetReplicationOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_REPLICATION
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|path
operator|=
literal|null
expr_stmt|;
name|replication
operator|=
literal|0
expr_stmt|;
block|}
DECL|method|setPath (String path)
name|SetReplicationOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setReplication (short replication)
name|SetReplicationOp
name|setReplication
parameter_list|(
name|short
name|replication
parameter_list|)
block|{
name|this
operator|.
name|replication
operator|=
name|replication
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeShort
argument_list|(
name|replication
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|replication
operator|=
name|FSImageSerialization
operator|.
name|readShort
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|replication
operator|=
name|readShort
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetReplicationOp [path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", replication="
argument_list|)
operator|.
name|append
argument_list|(
name|replication
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"REPLICATION"
argument_list|,
name|Short
operator|.
name|toString
argument_list|(
name|replication
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|replication
operator|=
name|Short
operator|.
name|parseShort
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"REPLICATION"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#concat} */
DECL|class|ConcatDeleteOp
specifier|static
class|class
name|ConcatDeleteOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|trg
name|String
name|trg
decl_stmt|;
DECL|field|srcs
name|String
index|[]
name|srcs
decl_stmt|;
DECL|field|timestamp
name|long
name|timestamp
decl_stmt|;
DECL|field|MAX_CONCAT_SRC
specifier|final
specifier|static
specifier|public
name|int
name|MAX_CONCAT_SRC
init|=
literal|1024
operator|*
literal|1024
decl_stmt|;
DECL|method|ConcatDeleteOp ()
name|ConcatDeleteOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_CONCAT_DELETE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|ConcatDeleteOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|ConcatDeleteOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_CONCAT_DELETE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|trg
operator|=
literal|null
expr_stmt|;
name|srcs
operator|=
literal|null
expr_stmt|;
name|timestamp
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setTarget (String trg)
name|ConcatDeleteOp
name|setTarget
parameter_list|(
name|String
name|trg
parameter_list|)
block|{
name|this
operator|.
name|trg
operator|=
name|trg
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setSources (String[] srcs)
name|ConcatDeleteOp
name|setSources
parameter_list|(
name|String
index|[]
name|srcs
parameter_list|)
block|{
if|if
condition|(
name|srcs
operator|.
name|length
operator|>
name|MAX_CONCAT_SRC
condition|)
block|{
throw|throw
operator|new
name|RuntimeException
argument_list|(
literal|"ConcatDeleteOp can only have "
operator|+
name|MAX_CONCAT_SRC
operator|+
literal|" sources at most."
argument_list|)
throw|;
block|}
name|this
operator|.
name|srcs
operator|=
name|srcs
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTimestamp (long timestamp)
name|ConcatDeleteOp
name|setTimestamp
parameter_list|(
name|long
name|timestamp
parameter_list|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|timestamp
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|trg
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|DeprecatedUTF8
name|info
index|[]
init|=
operator|new
name|DeprecatedUTF8
index|[
name|srcs
operator|.
name|length
index|]
decl_stmt|;
name|int
name|idx
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|srcs
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|info
index|[
name|idx
operator|++
index|]
operator|=
operator|new
name|DeprecatedUTF8
argument_list|(
name|srcs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
operator|new
name|ArrayWritable
argument_list|(
name|DeprecatedUTF8
operator|.
name|class
argument_list|,
name|info
argument_list|)
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
comment|// rpc ids
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
if|if
condition|(
name|length
operator|<
literal|3
condition|)
block|{
comment|// trg, srcs.., timestamp
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format "
operator|+
literal|"for ConcatDeleteOp."
argument_list|)
throw|;
block|}
block|}
name|this
operator|.
name|trg
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|int
name|srcSize
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|srcSize
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|srcSize
operator|=
name|this
operator|.
name|length
operator|-
literal|1
operator|-
literal|1
expr_stmt|;
comment|// trg and timestamp
block|}
if|if
condition|(
name|srcSize
operator|<
literal|0
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"ConcatDeleteOp cannot have a negative number of data "
operator|+
literal|" sources."
argument_list|)
throw|;
block|}
elseif|else
if|if
condition|(
name|srcSize
operator|>
name|MAX_CONCAT_SRC
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"ConcatDeleteOp can have at most "
operator|+
name|MAX_CONCAT_SRC
operator|+
literal|" sources, but we tried to have "
operator|+
operator|(
name|length
operator|-
literal|3
operator|)
operator|+
literal|" sources."
argument_list|)
throw|;
block|}
name|this
operator|.
name|srcs
operator|=
operator|new
name|String
index|[
name|srcSize
index|]
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|srcSize
condition|;
name|i
operator|++
control|)
block|{
name|srcs
index|[
name|i
index|]
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|timestamp
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"ConcatDeleteOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", trg="
argument_list|)
operator|.
name|append
argument_list|(
name|trg
argument_list|)
operator|.
name|append
argument_list|(
literal|", srcs="
argument_list|)
operator|.
name|append
argument_list|(
name|Arrays
operator|.
name|toString
argument_list|(
name|srcs
argument_list|)
argument_list|)
operator|.
name|append
argument_list|(
literal|", timestamp="
argument_list|)
operator|.
name|append
argument_list|(
name|timestamp
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TRG"
argument_list|,
name|trg
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TIMESTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"SOURCES"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|srcs
operator|.
name|length
condition|;
operator|++
name|i
control|)
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SOURCE"
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
argument_list|,
name|srcs
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"SOURCES"
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|trg
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"TRG"
argument_list|)
expr_stmt|;
name|this
operator|.
name|timestamp
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TIMESTAMP"
argument_list|)
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Stanza
argument_list|>
name|sources
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"SOURCES"
argument_list|)
decl_stmt|;
name|int
name|i
init|=
literal|0
decl_stmt|;
while|while
condition|(
literal|true
condition|)
block|{
if|if
condition|(
operator|!
name|sources
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|hasChildren
argument_list|(
literal|"SOURCE"
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
argument_list|)
condition|)
break|break;
name|i
operator|++
expr_stmt|;
block|}
name|srcs
operator|=
operator|new
name|String
index|[
name|i
index|]
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|srcs
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|srcs
index|[
name|i
index|]
operator|=
name|sources
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|.
name|getValue
argument_list|(
literal|"SOURCE"
operator|+
operator|(
name|i
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#rename} */
DECL|class|RenameOldOp
specifier|static
class|class
name|RenameOldOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|dst
name|String
name|dst
decl_stmt|;
DECL|field|timestamp
name|long
name|timestamp
decl_stmt|;
DECL|method|RenameOldOp ()
name|RenameOldOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_RENAME_OLD
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RenameOldOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RenameOldOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_RENAME_OLD
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|src
operator|=
literal|null
expr_stmt|;
name|dst
operator|=
literal|null
expr_stmt|;
name|timestamp
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setSource (String src)
name|RenameOldOp
name|setSource
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setDestination (String dst)
name|RenameOldOp
name|setDestination
parameter_list|(
name|String
name|dst
parameter_list|)
block|{
name|this
operator|.
name|dst
operator|=
name|dst
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTimestamp (long timestamp)
name|RenameOldOp
name|setTimestamp
parameter_list|(
name|long
name|timestamp
parameter_list|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|timestamp
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|dst
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|length
operator|!=
literal|3
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"Old rename operation."
argument_list|)
throw|;
block|}
block|}
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|dst
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|timestamp
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RenameOldOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", dst="
argument_list|)
operator|.
name|append
argument_list|(
name|dst
argument_list|)
operator|.
name|append
argument_list|(
literal|", timestamp="
argument_list|)
operator|.
name|append
argument_list|(
name|timestamp
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"DST"
argument_list|,
name|dst
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TIMESTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|dst
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"DST"
argument_list|)
expr_stmt|;
name|this
operator|.
name|timestamp
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TIMESTAMP"
argument_list|)
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#delete} */
DECL|class|DeleteOp
specifier|static
class|class
name|DeleteOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|timestamp
name|long
name|timestamp
decl_stmt|;
DECL|method|DeleteOp ()
name|DeleteOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_DELETE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|DeleteOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|DeleteOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_DELETE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|path
operator|=
literal|null
expr_stmt|;
name|timestamp
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setPath (String path)
name|DeleteOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTimestamp (long timestamp)
name|DeleteOp
name|setTimestamp
parameter_list|(
name|long
name|timestamp
parameter_list|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|timestamp
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|length
operator|!=
literal|2
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"delete operation."
argument_list|)
throw|;
block|}
block|}
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|timestamp
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"DeleteOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", timestamp="
argument_list|)
operator|.
name|append
argument_list|(
name|timestamp
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TIMESTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|timestamp
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TIMESTAMP"
argument_list|)
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#mkdirs} */
DECL|class|MkdirOp
specifier|static
class|class
name|MkdirOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|inodeId
name|long
name|inodeId
decl_stmt|;
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|timestamp
name|long
name|timestamp
decl_stmt|;
DECL|field|permissions
name|PermissionStatus
name|permissions
decl_stmt|;
DECL|field|aclEntries
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
decl_stmt|;
DECL|field|xAttrs
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
decl_stmt|;
DECL|method|MkdirOp ()
name|MkdirOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_MKDIR
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|MkdirOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|MkdirOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_MKDIR
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|inodeId
operator|=
literal|0L
expr_stmt|;
name|path
operator|=
literal|null
expr_stmt|;
name|timestamp
operator|=
literal|0L
expr_stmt|;
name|permissions
operator|=
literal|null
expr_stmt|;
name|aclEntries
operator|=
literal|null
expr_stmt|;
name|xAttrs
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setInodeId (long inodeId)
name|MkdirOp
name|setInodeId
parameter_list|(
name|long
name|inodeId
parameter_list|)
block|{
name|this
operator|.
name|inodeId
operator|=
name|inodeId
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPath (String path)
name|MkdirOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTimestamp (long timestamp)
name|MkdirOp
name|setTimestamp
parameter_list|(
name|long
name|timestamp
parameter_list|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|timestamp
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPermissionStatus (PermissionStatus permissions)
name|MkdirOp
name|setPermissionStatus
parameter_list|(
name|PermissionStatus
name|permissions
parameter_list|)
block|{
name|this
operator|.
name|permissions
operator|=
name|permissions
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setAclEntries (List<AclEntry> aclEntries)
name|MkdirOp
name|setAclEntries
parameter_list|(
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
parameter_list|)
block|{
name|this
operator|.
name|aclEntries
operator|=
name|aclEntries
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setXAttrs (List<XAttr> xAttrs)
name|MkdirOp
name|setXAttrs
parameter_list|(
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
parameter_list|)
block|{
name|this
operator|.
name|xAttrs
operator|=
name|xAttrs
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|inodeId
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
comment|// mtime
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
comment|// atime, unused at this
name|permissions
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|AclEditLogUtil
operator|.
name|write
argument_list|(
name|aclEntries
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|XAttrEditLogProto
operator|.
name|Builder
name|b
init|=
name|XAttrEditLogProto
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
name|b
operator|.
name|addAllXAttrs
argument_list|(
name|PBHelperClient
operator|.
name|convertXAttrProto
argument_list|(
name|xAttrs
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|.
name|build
argument_list|()
operator|.
name|writeDelimitedTo
argument_list|(
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|-
literal|17
operator|<
name|logVersion
operator|&&
name|length
operator|!=
literal|2
operator|||
name|logVersion
operator|<=
operator|-
literal|17
operator|&&
name|length
operator|!=
literal|3
operator|&&
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. Mkdir operation."
argument_list|)
throw|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|ADD_INODE_ID
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|inodeId
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// This id should be updated when this editLogOp is applied
name|this
operator|.
name|inodeId
operator|=
name|HdfsConstants
operator|.
name|GRANDFATHER_INODE_ID
expr_stmt|;
block|}
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|timestamp
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
comment|// The disk format stores atimes for directories as well.
comment|// However, currently this is not being updated/used because of
comment|// performance reasons.
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|FILE_ACCESS_TIME
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
name|this
operator|.
name|permissions
operator|=
name|PermissionStatus
operator|.
name|read
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|aclEntries
operator|=
name|AclEditLogUtil
operator|.
name|read
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|xAttrs
operator|=
name|readXAttrsFromEditLog
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"MkdirOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", inodeId="
argument_list|)
operator|.
name|append
argument_list|(
name|inodeId
argument_list|)
operator|.
name|append
argument_list|(
literal|", path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", timestamp="
argument_list|)
operator|.
name|append
argument_list|(
name|timestamp
argument_list|)
operator|.
name|append
argument_list|(
literal|", permissions="
argument_list|)
operator|.
name|append
argument_list|(
name|permissions
argument_list|)
operator|.
name|append
argument_list|(
literal|", aclEntries="
argument_list|)
operator|.
name|append
argument_list|(
name|aclEntries
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|", xAttrs="
argument_list|)
operator|.
name|append
argument_list|(
name|xAttrs
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"INODEID"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|inodeId
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TIMESTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
name|FSEditLogOp
operator|.
name|permissionStatusToXml
argument_list|(
name|contentHandler
argument_list|,
name|permissions
argument_list|)
expr_stmt|;
if|if
condition|(
name|aclEntries
operator|!=
literal|null
condition|)
block|{
name|appendAclEntriesToXml
argument_list|(
name|contentHandler
argument_list|,
name|aclEntries
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|xAttrs
operator|!=
literal|null
condition|)
block|{
name|appendXAttrsToXml
argument_list|(
name|contentHandler
argument_list|,
name|xAttrs
argument_list|)
expr_stmt|;
block|}
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|inodeId
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"INODEID"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|timestamp
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TIMESTAMP"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|permissions
operator|=
name|permissionStatusFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|aclEntries
operator|=
name|readAclEntriesFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|xAttrs
operator|=
name|readXAttrsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * The corresponding operations are either {@literal @Idempotent} (    * {@link ClientProtocol#updateBlockForPipeline},    * {@link ClientProtocol#recoverLease}, {@link ClientProtocol#addBlock}) or    * already bound with other editlog op which records rpc ids (    * {@link ClientProtocol#create}). Thus no need to record rpc ids here.    */
DECL|class|SetGenstampV1Op
specifier|static
class|class
name|SetGenstampV1Op
extends|extends
name|FSEditLogOp
block|{
DECL|field|genStampV1
name|long
name|genStampV1
decl_stmt|;
DECL|method|SetGenstampV1Op ()
name|SetGenstampV1Op
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_GENSTAMP_V1
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetGenstampV1Op
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetGenstampV1Op
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_GENSTAMP_V1
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|genStampV1
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setGenerationStamp (long genStamp)
name|SetGenstampV1Op
name|setGenerationStamp
parameter_list|(
name|long
name|genStamp
parameter_list|)
block|{
name|this
operator|.
name|genStampV1
operator|=
name|genStamp
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|genStampV1
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|genStampV1
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetGenstampOp [GenStamp="
argument_list|)
operator|.
name|append
argument_list|(
name|genStampV1
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"GENSTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|genStampV1
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|genStampV1
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"GENSTAMP"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * This operation does not actually update gen stamp immediately,    * the new gen stamp is recorded as impending gen stamp.    * The global generation stamp on Standby Node is updated when    * the block with the next generation stamp is actually received.    * We keep logging this operation for backward compatibility.    * The impending gen stamp will take effect when the standby    * transition to become an active.    */
DECL|class|SetGenstampV2Op
specifier|static
class|class
name|SetGenstampV2Op
extends|extends
name|FSEditLogOp
block|{
DECL|field|genStampV2
name|long
name|genStampV2
decl_stmt|;
DECL|method|SetGenstampV2Op ()
name|SetGenstampV2Op
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_GENSTAMP_V2
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetGenstampV2Op
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetGenstampV2Op
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_GENSTAMP_V2
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|genStampV2
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setGenerationStamp (long genStamp)
name|SetGenstampV2Op
name|setGenerationStamp
parameter_list|(
name|long
name|genStamp
parameter_list|)
block|{
name|this
operator|.
name|genStampV2
operator|=
name|genStamp
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|genStampV2
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|genStampV2
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetGenstampV2Op [GenStampV2="
argument_list|)
operator|.
name|append
argument_list|(
name|genStampV2
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"GENSTAMPV2"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|genStampV2
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|genStampV2
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"GENSTAMPV2"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#addBlock} */
DECL|class|AllocateBlockIdOp
specifier|static
class|class
name|AllocateBlockIdOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|blockId
name|long
name|blockId
decl_stmt|;
DECL|method|AllocateBlockIdOp ()
name|AllocateBlockIdOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ALLOCATE_BLOCK_ID
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AllocateBlockIdOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AllocateBlockIdOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ALLOCATE_BLOCK_ID
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|blockId
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setBlockId (long blockId)
name|AllocateBlockIdOp
name|setBlockId
parameter_list|(
name|long
name|blockId
parameter_list|)
block|{
name|this
operator|.
name|blockId
operator|=
name|blockId
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|blockId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|blockId
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AllocateBlockIdOp [blockId="
argument_list|)
operator|.
name|append
argument_list|(
name|blockId
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"BLOCK_ID"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|blockId
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|blockId
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"BLOCK_ID"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setPermission} */
DECL|class|SetPermissionsOp
specifier|static
class|class
name|SetPermissionsOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|permissions
name|FsPermission
name|permissions
decl_stmt|;
DECL|method|SetPermissionsOp ()
name|SetPermissionsOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_PERMISSIONS
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetPermissionsOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetPermissionsOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_PERMISSIONS
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
name|permissions
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSource (String src)
name|SetPermissionsOp
name|setSource
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPermissions (FsPermission permissions)
name|SetPermissionsOp
name|setPermissions
parameter_list|(
name|FsPermission
name|permissions
parameter_list|)
block|{
name|this
operator|.
name|permissions
operator|=
name|permissions
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|permissions
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|permissions
operator|=
name|FsPermission
operator|.
name|read
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetPermissionsOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", permissions="
argument_list|)
operator|.
name|append
argument_list|(
name|permissions
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MODE"
argument_list|,
name|Short
operator|.
name|toString
argument_list|(
name|permissions
operator|.
name|toShort
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|permissions
operator|=
operator|new
name|FsPermission
argument_list|(
name|Short
operator|.
name|parseShort
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MODE"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setOwner} */
DECL|class|SetOwnerOp
specifier|static
class|class
name|SetOwnerOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|username
name|String
name|username
decl_stmt|;
DECL|field|groupname
name|String
name|groupname
decl_stmt|;
DECL|method|SetOwnerOp ()
name|SetOwnerOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_OWNER
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetOwnerOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetOwnerOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_OWNER
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
name|username
operator|=
literal|null
expr_stmt|;
name|groupname
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSource (String src)
name|SetOwnerOp
name|setSource
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setUser (String username)
name|SetOwnerOp
name|setUser
parameter_list|(
name|String
name|username
parameter_list|)
block|{
name|this
operator|.
name|username
operator|=
name|username
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setGroup (String groupname)
name|SetOwnerOp
name|setGroup
parameter_list|(
name|String
name|groupname
parameter_list|)
block|{
name|this
operator|.
name|groupname
operator|=
name|groupname
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|username
operator|==
literal|null
condition|?
literal|""
else|:
name|username
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|groupname
operator|==
literal|null
condition|?
literal|""
else|:
name|groupname
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|username
operator|=
name|FSImageSerialization
operator|.
name|readString_EmptyAsNull
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|groupname
operator|=
name|FSImageSerialization
operator|.
name|readString_EmptyAsNull
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetOwnerOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", username="
argument_list|)
operator|.
name|append
argument_list|(
name|username
argument_list|)
operator|.
name|append
argument_list|(
literal|", groupname="
argument_list|)
operator|.
name|append
argument_list|(
name|groupname
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
if|if
condition|(
name|username
operator|!=
literal|null
condition|)
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"USERNAME"
argument_list|,
name|username
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|groupname
operator|!=
literal|null
condition|)
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"GROUPNAME"
argument_list|,
name|groupname
argument_list|)
expr_stmt|;
block|}
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|username
operator|=
operator|(
name|st
operator|.
name|hasChildren
argument_list|(
literal|"USERNAME"
argument_list|)
operator|)
condition|?
name|st
operator|.
name|getValue
argument_list|(
literal|"USERNAME"
argument_list|)
else|:
literal|null
expr_stmt|;
name|this
operator|.
name|groupname
operator|=
operator|(
name|st
operator|.
name|hasChildren
argument_list|(
literal|"GROUPNAME"
argument_list|)
operator|)
condition|?
name|st
operator|.
name|getValue
argument_list|(
literal|"GROUPNAME"
argument_list|)
else|:
literal|null
expr_stmt|;
block|}
block|}
DECL|class|SetNSQuotaOp
specifier|static
class|class
name|SetNSQuotaOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|nsQuota
name|long
name|nsQuota
decl_stmt|;
DECL|method|SetNSQuotaOp ()
name|SetNSQuotaOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_NS_QUOTA
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetNSQuotaOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetNSQuotaOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_NS_QUOTA
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
name|nsQuota
operator|=
literal|0L
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Deprecated"
argument_list|)
throw|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|nsQuota
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetNSQuotaOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", nsQuota="
argument_list|)
operator|.
name|append
argument_list|(
name|nsQuota
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NSQUOTA"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|nsQuota
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|nsQuota
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"NSQUOTA"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|ClearNSQuotaOp
specifier|static
class|class
name|ClearNSQuotaOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|method|ClearNSQuotaOp ()
name|ClearNSQuotaOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_CLEAR_NS_QUOTA
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|ClearNSQuotaOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|ClearNSQuotaOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_CLEAR_NS_QUOTA
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Deprecated"
argument_list|)
throw|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"ClearNSQuotaOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setQuota} */
DECL|class|SetQuotaOp
specifier|static
class|class
name|SetQuotaOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|nsQuota
name|long
name|nsQuota
decl_stmt|;
DECL|field|dsQuota
name|long
name|dsQuota
decl_stmt|;
DECL|method|SetQuotaOp ()
name|SetQuotaOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_QUOTA
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetQuotaOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetQuotaOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_QUOTA
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
name|nsQuota
operator|=
literal|0L
expr_stmt|;
name|dsQuota
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setSource (String src)
name|SetQuotaOp
name|setSource
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNSQuota (long nsQuota)
name|SetQuotaOp
name|setNSQuota
parameter_list|(
name|long
name|nsQuota
parameter_list|)
block|{
name|this
operator|.
name|nsQuota
operator|=
name|nsQuota
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setDSQuota (long dsQuota)
name|SetQuotaOp
name|setDSQuota
parameter_list|(
name|long
name|dsQuota
parameter_list|)
block|{
name|this
operator|.
name|dsQuota
operator|=
name|dsQuota
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|nsQuota
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|dsQuota
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|nsQuota
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|dsQuota
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetQuotaOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", nsQuota="
argument_list|)
operator|.
name|append
argument_list|(
name|nsQuota
argument_list|)
operator|.
name|append
argument_list|(
literal|", dsQuota="
argument_list|)
operator|.
name|append
argument_list|(
name|dsQuota
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NSQUOTA"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|nsQuota
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"DSQUOTA"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|dsQuota
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|nsQuota
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"NSQUOTA"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|dsQuota
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"DSQUOTA"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setQuota} */
DECL|class|SetQuotaByStorageTypeOp
specifier|static
class|class
name|SetQuotaByStorageTypeOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|dsQuota
name|long
name|dsQuota
decl_stmt|;
DECL|field|type
name|StorageType
name|type
decl_stmt|;
DECL|method|SetQuotaByStorageTypeOp ()
name|SetQuotaByStorageTypeOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_QUOTA_BY_STORAGETYPE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetQuotaByStorageTypeOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetQuotaByStorageTypeOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_QUOTA_BY_STORAGETYPE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
name|dsQuota
operator|=
operator|-
literal|1L
expr_stmt|;
name|type
operator|=
name|StorageType
operator|.
name|DEFAULT
expr_stmt|;
block|}
DECL|method|setSource (String src)
name|SetQuotaByStorageTypeOp
name|setSource
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setQuotaByStorageType (long dsQuota, StorageType type)
name|SetQuotaByStorageTypeOp
name|setQuotaByStorageType
parameter_list|(
name|long
name|dsQuota
parameter_list|,
name|StorageType
name|type
parameter_list|)
block|{
name|this
operator|.
name|type
operator|=
name|type
expr_stmt|;
name|this
operator|.
name|dsQuota
operator|=
name|dsQuota
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeInt
argument_list|(
name|type
operator|.
name|ordinal
argument_list|()
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|dsQuota
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|type
operator|=
name|StorageType
operator|.
name|parseStorageType
argument_list|(
name|FSImageSerialization
operator|.
name|readInt
argument_list|(
name|in
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|dsQuota
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetTypeQuotaOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", storageType="
argument_list|)
operator|.
name|append
argument_list|(
name|type
argument_list|)
operator|.
name|append
argument_list|(
literal|", dsQuota="
argument_list|)
operator|.
name|append
argument_list|(
name|dsQuota
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"STORAGETYPE"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|type
operator|.
name|ordinal
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"DSQUOTA"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|dsQuota
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|type
operator|=
name|StorageType
operator|.
name|parseStorageType
argument_list|(
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"STORAGETYPE"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|dsQuota
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"DSQUOTA"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setTimes} */
DECL|class|TimesOp
specifier|static
class|class
name|TimesOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|mtime
name|long
name|mtime
decl_stmt|;
DECL|field|atime
name|long
name|atime
decl_stmt|;
DECL|method|TimesOp ()
name|TimesOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_TIMES
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|TimesOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|TimesOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_TIMES
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|path
operator|=
literal|null
expr_stmt|;
name|mtime
operator|=
literal|0L
expr_stmt|;
name|atime
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setPath (String path)
name|TimesOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setModificationTime (long mtime)
name|TimesOp
name|setModificationTime
parameter_list|(
name|long
name|mtime
parameter_list|)
block|{
name|this
operator|.
name|mtime
operator|=
name|mtime
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setAccessTime (long atime)
name|TimesOp
name|setAccessTime
parameter_list|(
name|long
name|atime
parameter_list|)
block|{
name|this
operator|.
name|atime
operator|=
name|atime
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|mtime
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|atime
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
if|if
condition|(
name|length
operator|!=
literal|3
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"times operation."
argument_list|)
throw|;
block|}
block|}
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|mtime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|mtime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"TimesOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", mtime="
argument_list|)
operator|.
name|append
argument_list|(
name|mtime
argument_list|)
operator|.
name|append
argument_list|(
literal|", atime="
argument_list|)
operator|.
name|append
argument_list|(
name|atime
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MTIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|mtime
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"ATIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|atime
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|mtime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MTIME"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"ATIME"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#createSymlink} */
DECL|class|SymlinkOp
specifier|static
class|class
name|SymlinkOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|inodeId
name|long
name|inodeId
decl_stmt|;
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|value
name|String
name|value
decl_stmt|;
DECL|field|mtime
name|long
name|mtime
decl_stmt|;
DECL|field|atime
name|long
name|atime
decl_stmt|;
DECL|field|permissionStatus
name|PermissionStatus
name|permissionStatus
decl_stmt|;
DECL|method|SymlinkOp ()
name|SymlinkOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SYMLINK
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SymlinkOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SymlinkOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SYMLINK
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|inodeId
operator|=
literal|0L
expr_stmt|;
name|path
operator|=
literal|null
expr_stmt|;
name|value
operator|=
literal|null
expr_stmt|;
name|mtime
operator|=
literal|0L
expr_stmt|;
name|atime
operator|=
literal|0L
expr_stmt|;
name|permissionStatus
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setId (long inodeId)
name|SymlinkOp
name|setId
parameter_list|(
name|long
name|inodeId
parameter_list|)
block|{
name|this
operator|.
name|inodeId
operator|=
name|inodeId
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPath (String path)
name|SymlinkOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setValue (String value)
name|SymlinkOp
name|setValue
parameter_list|(
name|String
name|value
parameter_list|)
block|{
name|this
operator|.
name|value
operator|=
name|value
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setModificationTime (long mtime)
name|SymlinkOp
name|setModificationTime
parameter_list|(
name|long
name|mtime
parameter_list|)
block|{
name|this
operator|.
name|mtime
operator|=
name|mtime
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setAccessTime (long atime)
name|SymlinkOp
name|setAccessTime
parameter_list|(
name|long
name|atime
parameter_list|)
block|{
name|this
operator|.
name|atime
operator|=
name|atime
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPermissionStatus (PermissionStatus permissionStatus)
name|SymlinkOp
name|setPermissionStatus
parameter_list|(
name|PermissionStatus
name|permissionStatus
parameter_list|)
block|{
name|this
operator|.
name|permissionStatus
operator|=
name|permissionStatus
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|inodeId
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|value
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|mtime
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|atime
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|permissionStatus
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|length
operator|!=
literal|4
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"symlink operation."
argument_list|)
throw|;
block|}
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|ADD_INODE_ID
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|inodeId
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// This id should be updated when the editLogOp is applied
name|this
operator|.
name|inodeId
operator|=
name|HdfsConstants
operator|.
name|GRANDFATHER_INODE_ID
expr_stmt|;
block|}
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|value
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|mtime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|mtime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
name|this
operator|.
name|permissionStatus
operator|=
name|PermissionStatus
operator|.
name|read
argument_list|(
name|in
argument_list|)
expr_stmt|;
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SymlinkOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", inodeId="
argument_list|)
operator|.
name|append
argument_list|(
name|inodeId
argument_list|)
operator|.
name|append
argument_list|(
literal|", path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", value="
argument_list|)
operator|.
name|append
argument_list|(
name|value
argument_list|)
operator|.
name|append
argument_list|(
literal|", mtime="
argument_list|)
operator|.
name|append
argument_list|(
name|mtime
argument_list|)
operator|.
name|append
argument_list|(
literal|", atime="
argument_list|)
operator|.
name|append
argument_list|(
name|atime
argument_list|)
operator|.
name|append
argument_list|(
literal|", permissionStatus="
argument_list|)
operator|.
name|append
argument_list|(
name|permissionStatus
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"INODEID"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|inodeId
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"VALUE"
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MTIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|mtime
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"ATIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|atime
argument_list|)
argument_list|)
expr_stmt|;
name|FSEditLogOp
operator|.
name|permissionStatusToXml
argument_list|(
name|contentHandler
argument_list|,
name|permissionStatus
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|inodeId
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"INODEID"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|value
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"VALUE"
argument_list|)
expr_stmt|;
name|this
operator|.
name|mtime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MTIME"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|atime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"ATIME"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|permissionStatus
operator|=
name|permissionStatusFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#rename2} */
DECL|class|RenameOp
specifier|static
class|class
name|RenameOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|length
name|int
name|length
decl_stmt|;
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|dst
name|String
name|dst
decl_stmt|;
DECL|field|timestamp
name|long
name|timestamp
decl_stmt|;
DECL|field|options
name|Rename
index|[]
name|options
decl_stmt|;
DECL|method|RenameOp ()
name|RenameOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_RENAME
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RenameOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RenameOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_RENAME
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|length
operator|=
literal|0
expr_stmt|;
name|src
operator|=
literal|null
expr_stmt|;
name|dst
operator|=
literal|null
expr_stmt|;
name|timestamp
operator|=
literal|0L
expr_stmt|;
name|options
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSource (String src)
name|RenameOp
name|setSource
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setDestination (String dst)
name|RenameOp
name|setDestination
parameter_list|(
name|String
name|dst
parameter_list|)
block|{
name|this
operator|.
name|dst
operator|=
name|dst
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTimestamp (long timestamp)
name|RenameOp
name|setTimestamp
parameter_list|(
name|long
name|timestamp
parameter_list|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|timestamp
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setOptions (Rename[] options)
name|RenameOp
name|setOptions
parameter_list|(
name|Rename
index|[]
name|options
parameter_list|)
block|{
name|this
operator|.
name|options
operator|=
name|options
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|dst
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|toBytesWritable
argument_list|(
name|options
argument_list|)
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|length
operator|=
name|in
operator|.
name|readInt
argument_list|()
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|length
operator|!=
literal|3
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Incorrect data format. "
operator|+
literal|"Rename operation."
argument_list|)
throw|;
block|}
block|}
name|this
operator|.
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|dst
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|timestamp
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
name|this
operator|.
name|options
operator|=
name|readRenameOptions
argument_list|(
name|in
argument_list|)
expr_stmt|;
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
DECL|method|readRenameOptions (DataInputStream in)
specifier|private
specifier|static
name|Rename
index|[]
name|readRenameOptions
parameter_list|(
name|DataInputStream
name|in
parameter_list|)
throws|throws
name|IOException
block|{
name|BytesWritable
name|writable
init|=
operator|new
name|BytesWritable
argument_list|()
decl_stmt|;
name|writable
operator|.
name|readFields
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|byte
index|[]
name|bytes
init|=
name|writable
operator|.
name|getBytes
argument_list|()
decl_stmt|;
name|int
name|len
init|=
name|writable
operator|.
name|getLength
argument_list|()
decl_stmt|;
name|Rename
index|[]
name|options
init|=
operator|new
name|Rename
index|[
name|len
index|]
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|len
condition|;
name|i
operator|++
control|)
block|{
name|options
index|[
name|i
index|]
operator|=
name|Rename
operator|.
name|valueOf
argument_list|(
name|bytes
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
return|return
name|options
return|;
block|}
DECL|method|toBytesWritable (Rename... options)
specifier|static
name|BytesWritable
name|toBytesWritable
parameter_list|(
name|Rename
modifier|...
name|options
parameter_list|)
block|{
name|byte
index|[]
name|bytes
init|=
operator|new
name|byte
index|[
name|options
operator|.
name|length
index|]
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|options
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|bytes
index|[
name|i
index|]
operator|=
name|options
index|[
name|i
index|]
operator|.
name|value
argument_list|()
expr_stmt|;
block|}
return|return
operator|new
name|BytesWritable
argument_list|(
name|bytes
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RenameOp [length="
argument_list|)
operator|.
name|append
argument_list|(
name|length
argument_list|)
operator|.
name|append
argument_list|(
literal|", src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", dst="
argument_list|)
operator|.
name|append
argument_list|(
name|dst
argument_list|)
operator|.
name|append
argument_list|(
literal|", timestamp="
argument_list|)
operator|.
name|append
argument_list|(
name|timestamp
argument_list|)
operator|.
name|append
argument_list|(
literal|", options="
argument_list|)
operator|.
name|append
argument_list|(
name|Arrays
operator|.
name|toString
argument_list|(
name|options
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LENGTH"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"DST"
argument_list|,
name|dst
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TIMESTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
name|StringBuilder
name|bld
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|String
name|prefix
init|=
literal|""
decl_stmt|;
for|for
control|(
name|Rename
name|r
range|:
name|options
control|)
block|{
name|bld
operator|.
name|append
argument_list|(
name|prefix
argument_list|)
operator|.
name|append
argument_list|(
name|r
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|prefix
operator|=
literal|"|"
expr_stmt|;
block|}
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"OPTIONS"
argument_list|,
name|bld
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|length
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"LENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|dst
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"DST"
argument_list|)
expr_stmt|;
name|this
operator|.
name|timestamp
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TIMESTAMP"
argument_list|)
argument_list|)
expr_stmt|;
name|String
name|opts
init|=
name|st
operator|.
name|getValue
argument_list|(
literal|"OPTIONS"
argument_list|)
decl_stmt|;
name|String
name|o
index|[]
init|=
name|opts
operator|.
name|split
argument_list|(
literal|"\\|"
argument_list|)
decl_stmt|;
name|this
operator|.
name|options
operator|=
operator|new
name|Rename
index|[
name|o
operator|.
name|length
index|]
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|o
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|o
index|[
name|i
index|]
operator|.
name|equals
argument_list|(
literal|""
argument_list|)
condition|)
continue|continue;
try|try
block|{
name|this
operator|.
name|options
index|[
name|i
index|]
operator|=
name|Rename
operator|.
name|valueOf
argument_list|(
name|o
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
finally|finally
block|{
if|if
condition|(
name|this
operator|.
name|options
index|[
name|i
index|]
operator|==
literal|null
condition|)
block|{
name|System
operator|.
name|err
operator|.
name|println
argument_list|(
literal|"error parsing Rename value: \""
operator|+
name|o
index|[
name|i
index|]
operator|+
literal|"\""
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|TruncateOp
specifier|static
class|class
name|TruncateOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|field|clientName
name|String
name|clientName
decl_stmt|;
DECL|field|clientMachine
name|String
name|clientMachine
decl_stmt|;
DECL|field|newLength
name|long
name|newLength
decl_stmt|;
DECL|field|timestamp
name|long
name|timestamp
decl_stmt|;
DECL|field|truncateBlock
name|Block
name|truncateBlock
decl_stmt|;
DECL|method|TruncateOp ()
name|TruncateOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_TRUNCATE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|TruncateOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|TruncateOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_TRUNCATE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|src
operator|=
literal|null
expr_stmt|;
name|clientName
operator|=
literal|null
expr_stmt|;
name|clientMachine
operator|=
literal|null
expr_stmt|;
name|newLength
operator|=
literal|0L
expr_stmt|;
name|timestamp
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setPath (String src)
name|TruncateOp
name|setPath
parameter_list|(
name|String
name|src
parameter_list|)
block|{
name|this
operator|.
name|src
operator|=
name|src
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setClientName (String clientName)
name|TruncateOp
name|setClientName
parameter_list|(
name|String
name|clientName
parameter_list|)
block|{
name|this
operator|.
name|clientName
operator|=
name|clientName
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setClientMachine (String clientMachine)
name|TruncateOp
name|setClientMachine
parameter_list|(
name|String
name|clientMachine
parameter_list|)
block|{
name|this
operator|.
name|clientMachine
operator|=
name|clientMachine
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNewLength (long newLength)
name|TruncateOp
name|setNewLength
parameter_list|(
name|long
name|newLength
parameter_list|)
block|{
name|this
operator|.
name|newLength
operator|=
name|newLength
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTimestamp (long timestamp)
name|TruncateOp
name|setTimestamp
parameter_list|(
name|long
name|timestamp
parameter_list|)
block|{
name|this
operator|.
name|timestamp
operator|=
name|timestamp
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setTruncateBlock (Block truncateBlock)
name|TruncateOp
name|setTruncateBlock
parameter_list|(
name|Block
name|truncateBlock
parameter_list|)
block|{
name|this
operator|.
name|truncateBlock
operator|=
name|truncateBlock
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|src
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|clientName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|clientMachine
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|newLength
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|timestamp
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|Block
index|[]
name|blocks
init|=
name|FSImageSerialization
operator|.
name|readCompactBlockArray
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
decl_stmt|;
assert|assert
name|blocks
operator|.
name|length
operator|<=
literal|1
operator|:
literal|"Truncate op should have 1 or 0 blocks"
assert|;
name|truncateBlock
operator|=
operator|(
name|blocks
operator|.
name|length
operator|==
literal|0
operator|)
condition|?
literal|null
else|:
name|blocks
index|[
literal|0
index|]
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|src
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|clientName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|clientMachine
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|newLength
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|timestamp
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|int
name|size
init|=
name|truncateBlock
operator|!=
literal|null
condition|?
literal|1
else|:
literal|0
decl_stmt|;
name|Block
index|[]
name|blocks
init|=
operator|new
name|Block
index|[
name|size
index|]
decl_stmt|;
if|if
condition|(
name|truncateBlock
operator|!=
literal|null
condition|)
block|{
name|blocks
index|[
literal|0
index|]
operator|=
name|truncateBlock
expr_stmt|;
block|}
name|FSImageSerialization
operator|.
name|writeCompactBlockArray
argument_list|(
name|blocks
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CLIENTNAME"
argument_list|,
name|clientName
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CLIENTMACHINE"
argument_list|,
name|clientMachine
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NEWLENGTH"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|newLength
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TIMESTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|timestamp
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|truncateBlock
operator|!=
literal|null
condition|)
name|FSEditLogOp
operator|.
name|blockToXml
argument_list|(
name|contentHandler
argument_list|,
name|truncateBlock
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CLIENTNAME"
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientMachine
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CLIENTMACHINE"
argument_list|)
expr_stmt|;
name|this
operator|.
name|newLength
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"NEWLENGTH"
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|timestamp
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TIMESTAMP"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|st
operator|.
name|hasChildren
argument_list|(
literal|"BLOCK"
argument_list|)
condition|)
name|this
operator|.
name|truncateBlock
operator|=
name|FSEditLogOp
operator|.
name|blockFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"TruncateOp [src="
argument_list|)
operator|.
name|append
argument_list|(
name|src
argument_list|)
operator|.
name|append
argument_list|(
literal|", clientName="
argument_list|)
operator|.
name|append
argument_list|(
name|clientName
argument_list|)
operator|.
name|append
argument_list|(
literal|", clientMachine="
argument_list|)
operator|.
name|append
argument_list|(
name|clientMachine
argument_list|)
operator|.
name|append
argument_list|(
literal|", newLength="
argument_list|)
operator|.
name|append
argument_list|(
name|newLength
argument_list|)
operator|.
name|append
argument_list|(
literal|", timestamp="
argument_list|)
operator|.
name|append
argument_list|(
name|timestamp
argument_list|)
operator|.
name|append
argument_list|(
literal|", truncateBlock="
argument_list|)
operator|.
name|append
argument_list|(
name|truncateBlock
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * {@literal @Idempotent} for {@link ClientProtocol#recoverLease}. In the    * meanwhile, startFile and appendFile both have their own corresponding    * editlog op.    */
DECL|class|ReassignLeaseOp
specifier|static
class|class
name|ReassignLeaseOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|leaseHolder
name|String
name|leaseHolder
decl_stmt|;
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|newHolder
name|String
name|newHolder
decl_stmt|;
DECL|method|ReassignLeaseOp ()
name|ReassignLeaseOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_REASSIGN_LEASE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|ReassignLeaseOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|ReassignLeaseOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_REASSIGN_LEASE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|leaseHolder
operator|=
literal|null
expr_stmt|;
name|path
operator|=
literal|null
expr_stmt|;
name|newHolder
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setLeaseHolder (String leaseHolder)
name|ReassignLeaseOp
name|setLeaseHolder
parameter_list|(
name|String
name|leaseHolder
parameter_list|)
block|{
name|this
operator|.
name|leaseHolder
operator|=
name|leaseHolder
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPath (String path)
name|ReassignLeaseOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setNewHolder (String newHolder)
name|ReassignLeaseOp
name|setNewHolder
parameter_list|(
name|String
name|newHolder
parameter_list|)
block|{
name|this
operator|.
name|newHolder
operator|=
name|newHolder
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|leaseHolder
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|newHolder
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|leaseHolder
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|newHolder
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"ReassignLeaseOp [leaseHolder="
argument_list|)
operator|.
name|append
argument_list|(
name|leaseHolder
argument_list|)
operator|.
name|append
argument_list|(
literal|", path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", newHolder="
argument_list|)
operator|.
name|append
argument_list|(
name|newHolder
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"LEASEHOLDER"
argument_list|,
name|leaseHolder
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NEWHOLDER"
argument_list|,
name|newHolder
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|leaseHolder
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"LEASEHOLDER"
argument_list|)
expr_stmt|;
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|newHolder
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"NEWHOLDER"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#getDelegationToken} */
DECL|class|GetDelegationTokenOp
specifier|static
class|class
name|GetDelegationTokenOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|token
name|DelegationTokenIdentifier
name|token
decl_stmt|;
DECL|field|expiryTime
name|long
name|expiryTime
decl_stmt|;
DECL|method|GetDelegationTokenOp ()
name|GetDelegationTokenOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_GET_DELEGATION_TOKEN
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|GetDelegationTokenOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|GetDelegationTokenOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_GET_DELEGATION_TOKEN
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|token
operator|=
literal|null
expr_stmt|;
name|expiryTime
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setDelegationTokenIdentifier ( DelegationTokenIdentifier token)
name|GetDelegationTokenOp
name|setDelegationTokenIdentifier
parameter_list|(
name|DelegationTokenIdentifier
name|token
parameter_list|)
block|{
name|this
operator|.
name|token
operator|=
name|token
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setExpiryTime (long expiryTime)
name|GetDelegationTokenOp
name|setExpiryTime
parameter_list|(
name|long
name|expiryTime
parameter_list|)
block|{
name|this
operator|.
name|expiryTime
operator|=
name|expiryTime
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|token
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|expiryTime
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|token
operator|=
operator|new
name|DelegationTokenIdentifier
argument_list|()
expr_stmt|;
name|this
operator|.
name|token
operator|.
name|readFields
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|expiryTime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|expiryTime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"GetDelegationTokenOp [token="
argument_list|)
operator|.
name|append
argument_list|(
name|token
argument_list|)
operator|.
name|append
argument_list|(
literal|", expiryTime="
argument_list|)
operator|.
name|append
argument_list|(
name|expiryTime
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSEditLogOp
operator|.
name|delegationTokenToXml
argument_list|(
name|contentHandler
argument_list|,
name|token
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"EXPIRY_TIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|expiryTime
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|token
operator|=
name|delegationTokenFromXml
argument_list|(
name|st
operator|.
name|getChildren
argument_list|(
literal|"DELEGATION_TOKEN_IDENTIFIER"
argument_list|)
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|expiryTime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"EXPIRY_TIME"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#renewDelegationToken} */
DECL|class|RenewDelegationTokenOp
specifier|static
class|class
name|RenewDelegationTokenOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|token
name|DelegationTokenIdentifier
name|token
decl_stmt|;
DECL|field|expiryTime
name|long
name|expiryTime
decl_stmt|;
DECL|method|RenewDelegationTokenOp ()
name|RenewDelegationTokenOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_RENEW_DELEGATION_TOKEN
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RenewDelegationTokenOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RenewDelegationTokenOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_RENEW_DELEGATION_TOKEN
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|token
operator|=
literal|null
expr_stmt|;
name|expiryTime
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setDelegationTokenIdentifier ( DelegationTokenIdentifier token)
name|RenewDelegationTokenOp
name|setDelegationTokenIdentifier
parameter_list|(
name|DelegationTokenIdentifier
name|token
parameter_list|)
block|{
name|this
operator|.
name|token
operator|=
name|token
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setExpiryTime (long expiryTime)
name|RenewDelegationTokenOp
name|setExpiryTime
parameter_list|(
name|long
name|expiryTime
parameter_list|)
block|{
name|this
operator|.
name|expiryTime
operator|=
name|expiryTime
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|token
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|expiryTime
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|token
operator|=
operator|new
name|DelegationTokenIdentifier
argument_list|()
expr_stmt|;
name|this
operator|.
name|token
operator|.
name|readFields
argument_list|(
name|in
argument_list|)
expr_stmt|;
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_OP_OPTIMIZATION
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|this
operator|.
name|expiryTime
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|expiryTime
operator|=
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RenewDelegationTokenOp [token="
argument_list|)
operator|.
name|append
argument_list|(
name|token
argument_list|)
operator|.
name|append
argument_list|(
literal|", expiryTime="
argument_list|)
operator|.
name|append
argument_list|(
name|expiryTime
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSEditLogOp
operator|.
name|delegationTokenToXml
argument_list|(
name|contentHandler
argument_list|,
name|token
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"EXPIRY_TIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|expiryTime
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|token
operator|=
name|delegationTokenFromXml
argument_list|(
name|st
operator|.
name|getChildren
argument_list|(
literal|"DELEGATION_TOKEN_IDENTIFIER"
argument_list|)
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|expiryTime
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"EXPIRY_TIME"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#cancelDelegationToken} */
DECL|class|CancelDelegationTokenOp
specifier|static
class|class
name|CancelDelegationTokenOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|token
name|DelegationTokenIdentifier
name|token
decl_stmt|;
DECL|method|CancelDelegationTokenOp ()
name|CancelDelegationTokenOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_CANCEL_DELEGATION_TOKEN
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|CancelDelegationTokenOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|CancelDelegationTokenOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_CANCEL_DELEGATION_TOKEN
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|token
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setDelegationTokenIdentifier ( DelegationTokenIdentifier token)
name|CancelDelegationTokenOp
name|setDelegationTokenIdentifier
parameter_list|(
name|DelegationTokenIdentifier
name|token
parameter_list|)
block|{
name|this
operator|.
name|token
operator|=
name|token
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|token
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|token
operator|=
operator|new
name|DelegationTokenIdentifier
argument_list|()
expr_stmt|;
name|this
operator|.
name|token
operator|.
name|readFields
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"CancelDelegationTokenOp [token="
argument_list|)
operator|.
name|append
argument_list|(
name|token
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSEditLogOp
operator|.
name|delegationTokenToXml
argument_list|(
name|contentHandler
argument_list|,
name|token
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|token
operator|=
name|delegationTokenFromXml
argument_list|(
name|st
operator|.
name|getChildren
argument_list|(
literal|"DELEGATION_TOKEN_IDENTIFIER"
argument_list|)
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|UpdateMasterKeyOp
specifier|static
class|class
name|UpdateMasterKeyOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|key
name|DelegationKey
name|key
decl_stmt|;
DECL|method|UpdateMasterKeyOp ()
name|UpdateMasterKeyOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_UPDATE_MASTER_KEY
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|UpdateMasterKeyOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|UpdateMasterKeyOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_UPDATE_MASTER_KEY
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|key
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setDelegationKey (DelegationKey key)
name|UpdateMasterKeyOp
name|setDelegationKey
parameter_list|(
name|DelegationKey
name|key
parameter_list|)
block|{
name|this
operator|.
name|key
operator|=
name|key
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|key
operator|.
name|write
argument_list|(
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|key
operator|=
operator|new
name|DelegationKey
argument_list|()
expr_stmt|;
name|this
operator|.
name|key
operator|.
name|readFields
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"UpdateMasterKeyOp [key="
argument_list|)
operator|.
name|append
argument_list|(
name|key
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSEditLogOp
operator|.
name|delegationKeyToXml
argument_list|(
name|contentHandler
argument_list|,
name|key
argument_list|)
expr_stmt|;
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|key
operator|=
name|delegationKeyFromXml
argument_list|(
name|st
operator|.
name|getChildren
argument_list|(
literal|"DELEGATION_KEY"
argument_list|)
operator|.
name|get
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|LogSegmentOp
specifier|static
class|class
name|LogSegmentOp
extends|extends
name|FSEditLogOp
block|{
DECL|method|LogSegmentOp (FSEditLogOpCodes code)
specifier|private
name|LogSegmentOp
parameter_list|(
name|FSEditLogOpCodes
name|code
parameter_list|)
block|{
name|super
argument_list|(
name|code
argument_list|)
expr_stmt|;
assert|assert
name|code
operator|==
name|OP_START_LOG_SEGMENT
operator|||
name|code
operator|==
name|OP_END_LOG_SEGMENT
operator|:
literal|"Bad op: "
operator|+
name|code
assert|;
block|}
DECL|method|getInstance (OpInstanceCache cache, FSEditLogOpCodes code)
specifier|static
name|LogSegmentOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|,
name|FSEditLogOpCodes
name|code
parameter_list|)
block|{
return|return
operator|(
name|LogSegmentOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|code
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
comment|// no data stored in these ops yet
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
specifier|public
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
comment|// no data stored in these ops yet
block|}
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
comment|// no data stored
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"LogSegmentOp [opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
comment|// no data stored
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
comment|// do nothing
block|}
block|}
DECL|class|StartLogSegmentOp
specifier|static
class|class
name|StartLogSegmentOp
extends|extends
name|LogSegmentOp
block|{
DECL|method|StartLogSegmentOp ()
name|StartLogSegmentOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_START_LOG_SEGMENT
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|EndLogSegmentOp
specifier|static
class|class
name|EndLogSegmentOp
extends|extends
name|LogSegmentOp
block|{
DECL|method|EndLogSegmentOp ()
name|EndLogSegmentOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_END_LOG_SEGMENT
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|InvalidOp
specifier|static
class|class
name|InvalidOp
extends|extends
name|FSEditLogOp
block|{
DECL|method|InvalidOp ()
name|InvalidOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_INVALID
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|InvalidOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|InvalidOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_INVALID
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{     }
annotation|@
name|Override
specifier|public
DECL|method|writeFields (DataOutputStream out)
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{     }
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
comment|// nothing to read
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"InvalidOp [opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
comment|// no data stored
block|}
DECL|method|fromXml (Stanza st)
annotation|@
name|Override
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
comment|// do nothing
block|}
block|}
comment|/**    * Operation corresponding to creating a snapshot.    * {@literal @AtMostOnce} for {@link ClientProtocol#createSnapshot}.    */
DECL|class|CreateSnapshotOp
specifier|static
class|class
name|CreateSnapshotOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|snapshotRoot
name|String
name|snapshotRoot
decl_stmt|;
DECL|field|snapshotName
name|String
name|snapshotName
decl_stmt|;
DECL|method|CreateSnapshotOp ()
specifier|public
name|CreateSnapshotOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_CREATE_SNAPSHOT
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|CreateSnapshotOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|CreateSnapshotOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_CREATE_SNAPSHOT
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|snapshotRoot
operator|=
literal|null
expr_stmt|;
name|snapshotName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSnapshotName (String snapName)
name|CreateSnapshotOp
name|setSnapshotName
parameter_list|(
name|String
name|snapName
parameter_list|)
block|{
name|this
operator|.
name|snapshotName
operator|=
name|snapName
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setSnapshotRoot (String snapRoot)
specifier|public
name|CreateSnapshotOp
name|setSnapshotRoot
parameter_list|(
name|String
name|snapRoot
parameter_list|)
block|{
name|snapshotRoot
operator|=
name|snapRoot
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|snapshotRoot
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|snapshotName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotRoot
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTROOT"
argument_list|,
name|snapshotRoot
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTNAME"
argument_list|,
name|snapshotName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|snapshotRoot
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTROOT"
argument_list|)
expr_stmt|;
name|snapshotName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"CreateSnapshotOp [snapshotRoot="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotRoot
argument_list|)
operator|.
name|append
argument_list|(
literal|", snapshotName="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to delete a snapshot.    * {@literal @AtMostOnce} for {@link ClientProtocol#deleteSnapshot}.    */
DECL|class|DeleteSnapshotOp
specifier|static
class|class
name|DeleteSnapshotOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|snapshotRoot
name|String
name|snapshotRoot
decl_stmt|;
DECL|field|snapshotName
name|String
name|snapshotName
decl_stmt|;
DECL|method|DeleteSnapshotOp ()
name|DeleteSnapshotOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_DELETE_SNAPSHOT
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|DeleteSnapshotOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|DeleteSnapshotOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_DELETE_SNAPSHOT
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|snapshotRoot
operator|=
literal|null
expr_stmt|;
name|snapshotName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSnapshotName (String snapName)
name|DeleteSnapshotOp
name|setSnapshotName
parameter_list|(
name|String
name|snapName
parameter_list|)
block|{
name|this
operator|.
name|snapshotName
operator|=
name|snapName
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setSnapshotRoot (String snapRoot)
name|DeleteSnapshotOp
name|setSnapshotRoot
parameter_list|(
name|String
name|snapRoot
parameter_list|)
block|{
name|snapshotRoot
operator|=
name|snapRoot
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|snapshotRoot
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|snapshotName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotRoot
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTROOT"
argument_list|,
name|snapshotRoot
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTNAME"
argument_list|,
name|snapshotName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|snapshotRoot
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTROOT"
argument_list|)
expr_stmt|;
name|snapshotName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"DeleteSnapshotOp [snapshotRoot="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotRoot
argument_list|)
operator|.
name|append
argument_list|(
literal|", snapshotName="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to rename a snapshot.    * {@literal @AtMostOnce} for {@link ClientProtocol#renameSnapshot}.    */
DECL|class|RenameSnapshotOp
specifier|static
class|class
name|RenameSnapshotOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|snapshotRoot
name|String
name|snapshotRoot
decl_stmt|;
DECL|field|snapshotOldName
name|String
name|snapshotOldName
decl_stmt|;
DECL|field|snapshotNewName
name|String
name|snapshotNewName
decl_stmt|;
DECL|method|RenameSnapshotOp ()
name|RenameSnapshotOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_RENAME_SNAPSHOT
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RenameSnapshotOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RenameSnapshotOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_RENAME_SNAPSHOT
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|snapshotRoot
operator|=
literal|null
expr_stmt|;
name|snapshotOldName
operator|=
literal|null
expr_stmt|;
name|snapshotNewName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSnapshotOldName (String snapshotOldName)
name|RenameSnapshotOp
name|setSnapshotOldName
parameter_list|(
name|String
name|snapshotOldName
parameter_list|)
block|{
name|this
operator|.
name|snapshotOldName
operator|=
name|snapshotOldName
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setSnapshotNewName (String snapshotNewName)
name|RenameSnapshotOp
name|setSnapshotNewName
parameter_list|(
name|String
name|snapshotNewName
parameter_list|)
block|{
name|this
operator|.
name|snapshotNewName
operator|=
name|snapshotNewName
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setSnapshotRoot (String snapshotRoot)
name|RenameSnapshotOp
name|setSnapshotRoot
parameter_list|(
name|String
name|snapshotRoot
parameter_list|)
block|{
name|this
operator|.
name|snapshotRoot
operator|=
name|snapshotRoot
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|snapshotRoot
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|snapshotOldName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|snapshotNewName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
comment|// read RPC ids if necessary
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotRoot
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotOldName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotNewName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTROOT"
argument_list|,
name|snapshotRoot
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTOLDNAME"
argument_list|,
name|snapshotOldName
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTNEWNAME"
argument_list|,
name|snapshotNewName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|snapshotRoot
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTROOT"
argument_list|)
expr_stmt|;
name|snapshotOldName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTOLDNAME"
argument_list|)
expr_stmt|;
name|snapshotNewName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTNEWNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RenameSnapshotOp [snapshotRoot="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotRoot
argument_list|)
operator|.
name|append
argument_list|(
literal|", snapshotOldName="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotOldName
argument_list|)
operator|.
name|append
argument_list|(
literal|", snapshotNewName="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotNewName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to allow creating snapshot on a directory    */
DECL|class|AllowSnapshotOp
specifier|static
class|class
name|AllowSnapshotOp
extends|extends
name|FSEditLogOp
block|{
comment|// @Idempotent
DECL|field|snapshotRoot
name|String
name|snapshotRoot
decl_stmt|;
DECL|method|AllowSnapshotOp ()
specifier|public
name|AllowSnapshotOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ALLOW_SNAPSHOT
argument_list|)
expr_stmt|;
block|}
DECL|method|AllowSnapshotOp (String snapRoot)
specifier|public
name|AllowSnapshotOp
parameter_list|(
name|String
name|snapRoot
parameter_list|)
block|{
name|super
argument_list|(
name|OP_ALLOW_SNAPSHOT
argument_list|)
expr_stmt|;
name|snapshotRoot
operator|=
name|snapRoot
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AllowSnapshotOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AllowSnapshotOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ALLOW_SNAPSHOT
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|snapshotRoot
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSnapshotRoot (String snapRoot)
specifier|public
name|AllowSnapshotOp
name|setSnapshotRoot
parameter_list|(
name|String
name|snapRoot
parameter_list|)
block|{
name|snapshotRoot
operator|=
name|snapRoot
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|snapshotRoot
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotRoot
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTROOT"
argument_list|,
name|snapshotRoot
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|snapshotRoot
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTROOT"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AllowSnapshotOp [snapshotRoot="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotRoot
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to disallow creating snapshot on a directory    */
DECL|class|DisallowSnapshotOp
specifier|static
class|class
name|DisallowSnapshotOp
extends|extends
name|FSEditLogOp
block|{
comment|// @Idempotent
DECL|field|snapshotRoot
name|String
name|snapshotRoot
decl_stmt|;
DECL|method|DisallowSnapshotOp ()
specifier|public
name|DisallowSnapshotOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_DISALLOW_SNAPSHOT
argument_list|)
expr_stmt|;
block|}
DECL|method|DisallowSnapshotOp (String snapRoot)
specifier|public
name|DisallowSnapshotOp
parameter_list|(
name|String
name|snapRoot
parameter_list|)
block|{
name|super
argument_list|(
name|OP_DISALLOW_SNAPSHOT
argument_list|)
expr_stmt|;
name|snapshotRoot
operator|=
name|snapRoot
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|DisallowSnapshotOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|DisallowSnapshotOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_DISALLOW_SNAPSHOT
argument_list|)
return|;
block|}
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|snapshotRoot
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setSnapshotRoot (String snapRoot)
specifier|public
name|DisallowSnapshotOp
name|setSnapshotRoot
parameter_list|(
name|String
name|snapRoot
parameter_list|)
block|{
name|snapshotRoot
operator|=
name|snapRoot
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|snapshotRoot
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|snapshotRoot
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SNAPSHOTROOT"
argument_list|,
name|snapshotRoot
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|snapshotRoot
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SNAPSHOTROOT"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"DisallowSnapshotOp [snapshotRoot="
argument_list|)
operator|.
name|append
argument_list|(
name|snapshotRoot
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * {@literal @AtMostOnce} for    * {@link ClientProtocol#addCacheDirective}    */
DECL|class|AddCacheDirectiveInfoOp
specifier|static
class|class
name|AddCacheDirectiveInfoOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|directive
name|CacheDirectiveInfo
name|directive
decl_stmt|;
DECL|method|AddCacheDirectiveInfoOp ()
specifier|public
name|AddCacheDirectiveInfoOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ADD_CACHE_DIRECTIVE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AddCacheDirectiveInfoOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AddCacheDirectiveInfoOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ADD_CACHE_DIRECTIVE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|directive
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setDirective ( CacheDirectiveInfo directive)
specifier|public
name|AddCacheDirectiveInfoOp
name|setDirective
parameter_list|(
name|CacheDirectiveInfo
name|directive
parameter_list|)
block|{
name|this
operator|.
name|directive
operator|=
name|directive
expr_stmt|;
assert|assert
operator|(
name|directive
operator|.
name|getId
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|directive
operator|.
name|getPath
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|directive
operator|.
name|getReplication
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|directive
operator|.
name|getPool
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|directive
operator|.
name|getExpiration
argument_list|()
operator|!=
literal|null
operator|)
assert|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|directive
operator|=
name|FSImageSerialization
operator|.
name|readCacheDirectiveInfo
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeCacheDirectiveInfo
argument_list|(
name|out
argument_list|,
name|directive
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSImageSerialization
operator|.
name|writeCacheDirectiveInfo
argument_list|(
name|contentHandler
argument_list|,
name|directive
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|directive
operator|=
name|FSImageSerialization
operator|.
name|readCacheDirectiveInfo
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AddCacheDirectiveInfo ["
argument_list|)
operator|.
name|append
argument_list|(
literal|"id="
operator|+
name|directive
operator|.
name|getId
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"path="
operator|+
name|directive
operator|.
name|getPath
argument_list|()
operator|.
name|toUri
argument_list|()
operator|.
name|getPath
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"replication="
operator|+
name|directive
operator|.
name|getReplication
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"pool="
operator|+
name|directive
operator|.
name|getPool
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"expiration="
operator|+
name|directive
operator|.
name|getExpiration
argument_list|()
operator|.
name|getMillis
argument_list|()
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * {@literal @AtMostOnce} for    * {@link ClientProtocol#modifyCacheDirective}    */
DECL|class|ModifyCacheDirectiveInfoOp
specifier|static
class|class
name|ModifyCacheDirectiveInfoOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|directive
name|CacheDirectiveInfo
name|directive
decl_stmt|;
DECL|method|ModifyCacheDirectiveInfoOp ()
specifier|public
name|ModifyCacheDirectiveInfoOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_MODIFY_CACHE_DIRECTIVE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|ModifyCacheDirectiveInfoOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|ModifyCacheDirectiveInfoOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_MODIFY_CACHE_DIRECTIVE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|directive
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setDirective ( CacheDirectiveInfo directive)
specifier|public
name|ModifyCacheDirectiveInfoOp
name|setDirective
parameter_list|(
name|CacheDirectiveInfo
name|directive
parameter_list|)
block|{
name|this
operator|.
name|directive
operator|=
name|directive
expr_stmt|;
assert|assert
operator|(
name|directive
operator|.
name|getId
argument_list|()
operator|!=
literal|null
operator|)
assert|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|directive
operator|=
name|FSImageSerialization
operator|.
name|readCacheDirectiveInfo
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeCacheDirectiveInfo
argument_list|(
name|out
argument_list|,
name|directive
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSImageSerialization
operator|.
name|writeCacheDirectiveInfo
argument_list|(
name|contentHandler
argument_list|,
name|directive
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|directive
operator|=
name|FSImageSerialization
operator|.
name|readCacheDirectiveInfo
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"ModifyCacheDirectiveInfoOp["
argument_list|)
operator|.
name|append
argument_list|(
literal|"id="
argument_list|)
operator|.
name|append
argument_list|(
name|directive
operator|.
name|getId
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|directive
operator|.
name|getPath
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|builder
operator|.
name|append
argument_list|(
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"path="
argument_list|)
operator|.
name|append
argument_list|(
name|directive
operator|.
name|getPath
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|directive
operator|.
name|getReplication
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|builder
operator|.
name|append
argument_list|(
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"replication="
argument_list|)
operator|.
name|append
argument_list|(
name|directive
operator|.
name|getReplication
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|directive
operator|.
name|getPool
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|builder
operator|.
name|append
argument_list|(
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"pool="
argument_list|)
operator|.
name|append
argument_list|(
name|directive
operator|.
name|getPool
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|directive
operator|.
name|getExpiration
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|builder
operator|.
name|append
argument_list|(
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"expiration="
argument_list|)
operator|.
name|append
argument_list|(
name|directive
operator|.
name|getExpiration
argument_list|()
operator|.
name|getMillis
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * {@literal @AtMostOnce} for    * {@link ClientProtocol#removeCacheDirective}    */
DECL|class|RemoveCacheDirectiveInfoOp
specifier|static
class|class
name|RemoveCacheDirectiveInfoOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|id
name|long
name|id
decl_stmt|;
DECL|method|RemoveCacheDirectiveInfoOp ()
specifier|public
name|RemoveCacheDirectiveInfoOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_REMOVE_CACHE_DIRECTIVE
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RemoveCacheDirectiveInfoOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RemoveCacheDirectiveInfoOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_REMOVE_CACHE_DIRECTIVE
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|id
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|setId (long id)
specifier|public
name|RemoveCacheDirectiveInfoOp
name|setId
parameter_list|(
name|long
name|id
parameter_list|)
block|{
name|this
operator|.
name|id
operator|=
name|id
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|id
operator|=
name|FSImageSerialization
operator|.
name|readLong
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|id
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"ID"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|id
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|id
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"ID"
argument_list|)
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RemoveCacheDirectiveInfo ["
argument_list|)
operator|.
name|append
argument_list|(
literal|"id="
operator|+
name|Long
operator|.
name|toString
argument_list|(
name|id
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#addCachePool} */
DECL|class|AddCachePoolOp
specifier|static
class|class
name|AddCachePoolOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|info
name|CachePoolInfo
name|info
decl_stmt|;
DECL|method|AddCachePoolOp ()
specifier|public
name|AddCachePoolOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ADD_CACHE_POOL
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AddCachePoolOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AddCachePoolOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ADD_CACHE_POOL
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|info
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setPool (CachePoolInfo info)
specifier|public
name|AddCachePoolOp
name|setPool
parameter_list|(
name|CachePoolInfo
name|info
parameter_list|)
block|{
name|this
operator|.
name|info
operator|=
name|info
expr_stmt|;
assert|assert
operator|(
name|info
operator|.
name|getPoolName
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|info
operator|.
name|getOwnerName
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|info
operator|.
name|getGroupName
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|info
operator|.
name|getMode
argument_list|()
operator|!=
literal|null
operator|)
assert|;
assert|assert
operator|(
name|info
operator|.
name|getLimit
argument_list|()
operator|!=
literal|null
operator|)
assert|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|info
operator|=
name|FSImageSerialization
operator|.
name|readCachePoolInfo
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeCachePoolInfo
argument_list|(
name|out
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSImageSerialization
operator|.
name|writeCachePoolInfo
argument_list|(
name|contentHandler
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|info
operator|=
name|FSImageSerialization
operator|.
name|readCachePoolInfo
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AddCachePoolOp ["
argument_list|)
operator|.
name|append
argument_list|(
literal|"poolName="
operator|+
name|info
operator|.
name|getPoolName
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"ownerName="
operator|+
name|info
operator|.
name|getOwnerName
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"groupName="
operator|+
name|info
operator|.
name|getGroupName
argument_list|()
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"mode="
operator|+
name|Short
operator|.
name|toString
argument_list|(
name|info
operator|.
name|getMode
argument_list|()
operator|.
name|toShort
argument_list|()
argument_list|)
operator|+
literal|","
argument_list|)
operator|.
name|append
argument_list|(
literal|"limit="
operator|+
name|Long
operator|.
name|toString
argument_list|(
name|info
operator|.
name|getLimit
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#modifyCachePool} */
DECL|class|ModifyCachePoolOp
specifier|static
class|class
name|ModifyCachePoolOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|info
name|CachePoolInfo
name|info
decl_stmt|;
DECL|method|ModifyCachePoolOp ()
specifier|public
name|ModifyCachePoolOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_MODIFY_CACHE_POOL
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|ModifyCachePoolOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|ModifyCachePoolOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_MODIFY_CACHE_POOL
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|info
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setInfo (CachePoolInfo info)
specifier|public
name|ModifyCachePoolOp
name|setInfo
parameter_list|(
name|CachePoolInfo
name|info
parameter_list|)
block|{
name|this
operator|.
name|info
operator|=
name|info
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|info
operator|=
name|FSImageSerialization
operator|.
name|readCachePoolInfo
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeCachePoolInfo
argument_list|(
name|out
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|FSImageSerialization
operator|.
name|writeCachePoolInfo
argument_list|(
name|contentHandler
argument_list|,
name|info
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|info
operator|=
name|FSImageSerialization
operator|.
name|readCachePoolInfo
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"ModifyCachePoolOp ["
argument_list|)
expr_stmt|;
name|ArrayList
argument_list|<
name|String
argument_list|>
name|fields
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|(
literal|5
argument_list|)
decl_stmt|;
if|if
condition|(
name|info
operator|.
name|getPoolName
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|fields
operator|.
name|add
argument_list|(
literal|"poolName="
operator|+
name|info
operator|.
name|getPoolName
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|info
operator|.
name|getOwnerName
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|fields
operator|.
name|add
argument_list|(
literal|"ownerName="
operator|+
name|info
operator|.
name|getOwnerName
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|info
operator|.
name|getGroupName
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|fields
operator|.
name|add
argument_list|(
literal|"groupName="
operator|+
name|info
operator|.
name|getGroupName
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|info
operator|.
name|getMode
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|fields
operator|.
name|add
argument_list|(
literal|"mode="
operator|+
name|info
operator|.
name|getMode
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|info
operator|.
name|getLimit
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|fields
operator|.
name|add
argument_list|(
literal|"limit="
operator|+
name|info
operator|.
name|getLimit
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|builder
operator|.
name|append
argument_list|(
name|Joiner
operator|.
name|on
argument_list|(
literal|","
argument_list|)
operator|.
name|join
argument_list|(
name|fields
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/** {@literal @AtMostOnce} for {@link ClientProtocol#removeCachePool} */
DECL|class|RemoveCachePoolOp
specifier|static
class|class
name|RemoveCachePoolOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|poolName
name|String
name|poolName
decl_stmt|;
DECL|method|RemoveCachePoolOp ()
specifier|public
name|RemoveCachePoolOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_REMOVE_CACHE_POOL
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RemoveCachePoolOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RemoveCachePoolOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_REMOVE_CACHE_POOL
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|poolName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|setPoolName (String poolName)
specifier|public
name|RemoveCachePoolOp
name|setPoolName
parameter_list|(
name|String
name|poolName
parameter_list|)
block|{
name|this
operator|.
name|poolName
operator|=
name|poolName
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|poolName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|poolName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"POOLNAME"
argument_list|,
name|poolName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|poolName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"POOLNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RemoveCachePoolOp ["
argument_list|)
operator|.
name|append
argument_list|(
literal|"poolName="
operator|+
name|poolName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
DECL|class|RemoveXAttrOp
specifier|static
class|class
name|RemoveXAttrOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|xAttrs
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
decl_stmt|;
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|method|RemoveXAttrOp ()
name|RemoveXAttrOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_REMOVE_XATTR
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RemoveXAttrOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RemoveXAttrOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_REMOVE_XATTR
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|xAttrs
operator|=
literal|null
expr_stmt|;
name|src
operator|=
literal|null
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|XAttrEditLogProto
name|p
init|=
name|XAttrEditLogProto
operator|.
name|parseDelimitedFrom
argument_list|(
name|in
argument_list|)
decl_stmt|;
name|src
operator|=
name|p
operator|.
name|getSrc
argument_list|()
expr_stmt|;
name|xAttrs
operator|=
name|PBHelperClient
operator|.
name|convertXAttrs
argument_list|(
name|p
operator|.
name|getXAttrsList
argument_list|()
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|XAttrEditLogProto
operator|.
name|Builder
name|b
init|=
name|XAttrEditLogProto
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
name|src
operator|!=
literal|null
condition|)
block|{
name|b
operator|.
name|setSrc
argument_list|(
name|src
argument_list|)
expr_stmt|;
block|}
name|b
operator|.
name|addAllXAttrs
argument_list|(
name|PBHelperClient
operator|.
name|convertXAttrProto
argument_list|(
name|xAttrs
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|.
name|build
argument_list|()
operator|.
name|writeDelimitedTo
argument_list|(
name|out
argument_list|)
expr_stmt|;
comment|// clientId and callId
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|appendXAttrsToXml
argument_list|(
name|contentHandler
argument_list|,
name|xAttrs
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|xAttrs
operator|=
name|readXAttrsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|SetXAttrOp
specifier|static
class|class
name|SetXAttrOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|xAttrs
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
decl_stmt|;
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|method|SetXAttrOp ()
name|SetXAttrOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_XATTR
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetXAttrOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetXAttrOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_XATTR
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|xAttrs
operator|=
literal|null
expr_stmt|;
name|src
operator|=
literal|null
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|XAttrEditLogProto
name|p
init|=
name|XAttrEditLogProto
operator|.
name|parseDelimitedFrom
argument_list|(
name|in
argument_list|)
decl_stmt|;
name|src
operator|=
name|p
operator|.
name|getSrc
argument_list|()
expr_stmt|;
name|xAttrs
operator|=
name|PBHelperClient
operator|.
name|convertXAttrs
argument_list|(
name|p
operator|.
name|getXAttrsList
argument_list|()
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|XAttrEditLogProto
operator|.
name|Builder
name|b
init|=
name|XAttrEditLogProto
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
name|src
operator|!=
literal|null
condition|)
block|{
name|b
operator|.
name|setSrc
argument_list|(
name|src
argument_list|)
expr_stmt|;
block|}
name|b
operator|.
name|addAllXAttrs
argument_list|(
name|PBHelperClient
operator|.
name|convertXAttrProto
argument_list|(
name|xAttrs
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|.
name|build
argument_list|()
operator|.
name|writeDelimitedTo
argument_list|(
name|out
argument_list|)
expr_stmt|;
comment|// clientId and callId
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|appendXAttrsToXml
argument_list|(
name|contentHandler
argument_list|,
name|xAttrs
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|xAttrs
operator|=
name|readXAttrsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|SetAclOp
specifier|static
class|class
name|SetAclOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|aclEntries
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
init|=
name|Lists
operator|.
name|newArrayList
argument_list|()
decl_stmt|;
DECL|field|src
name|String
name|src
decl_stmt|;
DECL|method|SetAclOp ()
name|SetAclOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_ACL
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetAclOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetAclOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_ACL
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|aclEntries
operator|=
literal|null
expr_stmt|;
name|src
operator|=
literal|null
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|AclEditLogProto
name|p
init|=
name|AclEditLogProto
operator|.
name|parseDelimitedFrom
argument_list|(
name|in
argument_list|)
decl_stmt|;
if|if
condition|(
name|p
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Failed to read fields from SetAclOp"
argument_list|)
throw|;
block|}
name|src
operator|=
name|p
operator|.
name|getSrc
argument_list|()
expr_stmt|;
name|aclEntries
operator|=
name|PBHelperClient
operator|.
name|convertAclEntry
argument_list|(
name|p
operator|.
name|getEntriesList
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|AclEditLogProto
operator|.
name|Builder
name|b
init|=
name|AclEditLogProto
operator|.
name|newBuilder
argument_list|()
decl_stmt|;
if|if
condition|(
name|src
operator|!=
literal|null
condition|)
name|b
operator|.
name|setSrc
argument_list|(
name|src
argument_list|)
expr_stmt|;
name|b
operator|.
name|addAllEntries
argument_list|(
name|PBHelperClient
operator|.
name|convertAclEntryProto
argument_list|(
name|aclEntries
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|.
name|build
argument_list|()
operator|.
name|writeDelimitedTo
argument_list|(
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SRC"
argument_list|,
name|src
argument_list|)
expr_stmt|;
name|appendAclEntriesToXml
argument_list|(
name|contentHandler
argument_list|,
name|aclEntries
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|src
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"SRC"
argument_list|)
expr_stmt|;
name|aclEntries
operator|=
name|readAclEntriesFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
if|if
condition|(
name|aclEntries
operator|==
literal|null
condition|)
block|{
name|aclEntries
operator|=
name|Lists
operator|.
name|newArrayList
argument_list|()
expr_stmt|;
block|}
block|}
block|}
DECL|method|readShort (DataInputStream in)
specifier|static
specifier|private
name|short
name|readShort
parameter_list|(
name|DataInputStream
name|in
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|Short
operator|.
name|parseShort
argument_list|(
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
argument_list|)
return|;
block|}
DECL|method|readLong (DataInputStream in)
specifier|static
specifier|private
name|long
name|readLong
parameter_list|(
name|DataInputStream
name|in
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|Long
operator|.
name|parseLong
argument_list|(
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
argument_list|)
return|;
block|}
comment|/**    * A class to read in blocks stored in the old format. The only two    * fields in the block were blockid and length.    */
DECL|class|BlockTwo
specifier|static
class|class
name|BlockTwo
implements|implements
name|Writable
block|{
DECL|field|blkid
name|long
name|blkid
decl_stmt|;
DECL|field|len
name|long
name|len
decl_stmt|;
static|static
block|{
comment|// register a ctor
name|WritableFactories
operator|.
name|setFactory
argument_list|(
name|BlockTwo
operator|.
name|class
argument_list|,
operator|new
name|WritableFactory
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|Writable
name|newInstance
parameter_list|()
block|{
return|return
operator|new
name|BlockTwo
argument_list|()
return|;
block|}
block|}
argument_list|)
expr_stmt|;
block|}
DECL|method|BlockTwo ()
name|BlockTwo
parameter_list|()
block|{
name|blkid
operator|=
literal|0
expr_stmt|;
name|len
operator|=
literal|0
expr_stmt|;
block|}
comment|/////////////////////////////////////
comment|// Writable
comment|/////////////////////////////////////
annotation|@
name|Override
DECL|method|write (DataOutput out)
specifier|public
name|void
name|write
parameter_list|(
name|DataOutput
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|out
operator|.
name|writeLong
argument_list|(
name|blkid
argument_list|)
expr_stmt|;
name|out
operator|.
name|writeLong
argument_list|(
name|len
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInput in)
specifier|public
name|void
name|readFields
parameter_list|(
name|DataInput
name|in
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|blkid
operator|=
name|in
operator|.
name|readLong
argument_list|()
expr_stmt|;
name|this
operator|.
name|len
operator|=
name|in
operator|.
name|readLong
argument_list|()
expr_stmt|;
block|}
block|}
comment|/**    * Operation corresponding to add an erasure coding policy.    */
DECL|class|AddErasureCodingPolicyOp
specifier|static
class|class
name|AddErasureCodingPolicyOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|ecPolicy
specifier|private
name|ErasureCodingPolicy
name|ecPolicy
decl_stmt|;
DECL|method|AddErasureCodingPolicyOp ()
name|AddErasureCodingPolicyOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ADD_ERASURE_CODING_POLICY
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|AddErasureCodingPolicyOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|AddErasureCodingPolicyOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ADD_ERASURE_CODING_POLICY
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|this
operator|.
name|ecPolicy
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|getEcPolicy ()
specifier|public
name|ErasureCodingPolicy
name|getEcPolicy
parameter_list|()
block|{
return|return
name|this
operator|.
name|ecPolicy
return|;
block|}
DECL|method|setErasureCodingPolicy ( ErasureCodingPolicy policy)
specifier|public
name|AddErasureCodingPolicyOp
name|setErasureCodingPolicy
parameter_list|(
name|ErasureCodingPolicy
name|policy
parameter_list|)
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|policy
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|policy
operator|.
name|getSchema
argument_list|()
argument_list|)
expr_stmt|;
name|Preconditions
operator|.
name|checkArgument
argument_list|(
name|policy
operator|.
name|getCellSize
argument_list|()
operator|>
literal|0
argument_list|)
expr_stmt|;
name|this
operator|.
name|ecPolicy
operator|=
name|policy
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|ecPolicy
operator|=
name|FSImageSerialization
operator|.
name|readErasureCodingPolicy
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|ecPolicy
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeErasureCodingPolicy
argument_list|(
name|out
argument_list|,
name|ecPolicy
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|ecPolicy
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CODEC"
argument_list|,
name|ecPolicy
operator|.
name|getCodecName
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"DATAUNITS"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|ecPolicy
operator|.
name|getNumDataUnits
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PARITYUNITS"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|ecPolicy
operator|.
name|getNumParityUnits
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"CELLSIZE"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|ecPolicy
operator|.
name|getCellSize
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|extraOptions
init|=
name|ecPolicy
operator|.
name|getSchema
argument_list|()
operator|.
name|getExtraOptions
argument_list|()
decl_stmt|;
if|if
condition|(
name|extraOptions
operator|==
literal|null
operator|||
name|extraOptions
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"EXTRAOPTIONS"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
return|return;
block|}
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"EXTRAOPTIONS"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|extraOptions
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Map
operator|.
name|Entry
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|entry
range|:
name|extraOptions
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"EXTRAOPTION"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"KEY"
argument_list|,
name|entry
operator|.
name|getKey
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"VALUE"
argument_list|,
name|entry
operator|.
name|getValue
argument_list|()
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"EXTRAOPTION"
argument_list|)
expr_stmt|;
block|}
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
specifier|final
name|String
name|codecName
init|=
name|st
operator|.
name|getValue
argument_list|(
literal|"CODEC"
argument_list|)
decl_stmt|;
specifier|final
name|int
name|dataUnits
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"DATAUNITS"
argument_list|)
argument_list|)
decl_stmt|;
specifier|final
name|int
name|parityUnits
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"PARITYUNITS"
argument_list|)
argument_list|)
decl_stmt|;
specifier|final
name|int
name|cellSize
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"CELLSIZE"
argument_list|)
argument_list|)
decl_stmt|;
specifier|final
name|int
name|extraOptionNum
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"EXTRAOPTIONS"
argument_list|)
argument_list|)
decl_stmt|;
name|ECSchema
name|schema
decl_stmt|;
if|if
condition|(
name|extraOptionNum
operator|==
literal|0
condition|)
block|{
name|schema
operator|=
operator|new
name|ECSchema
argument_list|(
name|codecName
argument_list|,
name|dataUnits
argument_list|,
name|parityUnits
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|extraOptions
init|=
operator|new
name|HashMap
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|Stanza
argument_list|>
name|stanzas
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"EXTRAOPTION"
argument_list|)
decl_stmt|;
for|for
control|(
name|Stanza
name|a
range|:
name|stanzas
control|)
block|{
name|extraOptions
operator|.
name|put
argument_list|(
name|a
operator|.
name|getValue
argument_list|(
literal|"KEY"
argument_list|)
argument_list|,
name|a
operator|.
name|getValue
argument_list|(
literal|"VALUE"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|schema
operator|=
operator|new
name|ECSchema
argument_list|(
name|codecName
argument_list|,
name|dataUnits
argument_list|,
name|parityUnits
argument_list|,
name|extraOptions
argument_list|)
expr_stmt|;
block|}
name|this
operator|.
name|ecPolicy
operator|=
operator|new
name|ErasureCodingPolicy
argument_list|(
name|schema
argument_list|,
name|cellSize
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"AddErasureCodingPolicy ["
argument_list|)
operator|.
name|append
argument_list|(
name|ecPolicy
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to enable an erasure coding policy.    */
DECL|class|EnableErasureCodingPolicyOp
specifier|static
class|class
name|EnableErasureCodingPolicyOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|ecPolicyName
specifier|private
name|String
name|ecPolicyName
decl_stmt|;
DECL|method|EnableErasureCodingPolicyOp ()
name|EnableErasureCodingPolicyOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ENABLE_ERASURE_CODING_POLICY
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|EnableErasureCodingPolicyOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|EnableErasureCodingPolicyOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ENABLE_ERASURE_CODING_POLICY
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|this
operator|.
name|ecPolicyName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|getEcPolicy ()
specifier|public
name|String
name|getEcPolicy
parameter_list|()
block|{
return|return
name|this
operator|.
name|ecPolicyName
return|;
block|}
DECL|method|setErasureCodingPolicy ( String policyName)
specifier|public
name|EnableErasureCodingPolicyOp
name|setErasureCodingPolicy
parameter_list|(
name|String
name|policyName
parameter_list|)
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|policyName
argument_list|)
expr_stmt|;
name|this
operator|.
name|ecPolicyName
operator|=
name|policyName
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|ecPolicyName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|ecPolicyName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"POLICYNAME"
argument_list|,
name|this
operator|.
name|ecPolicyName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|ecPolicyName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"POLICYNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"EnableErasureCodingPolicy ["
argument_list|)
operator|.
name|append
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to disable an erasure coding policy.    */
DECL|class|DisableErasureCodingPolicyOp
specifier|static
class|class
name|DisableErasureCodingPolicyOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|ecPolicyName
specifier|private
name|String
name|ecPolicyName
decl_stmt|;
DECL|method|DisableErasureCodingPolicyOp ()
name|DisableErasureCodingPolicyOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_DISABLE_ERASURE_CODING_POLICY
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|DisableErasureCodingPolicyOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|DisableErasureCodingPolicyOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_DISABLE_ERASURE_CODING_POLICY
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|this
operator|.
name|ecPolicyName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|getEcPolicy ()
specifier|public
name|String
name|getEcPolicy
parameter_list|()
block|{
return|return
name|this
operator|.
name|ecPolicyName
return|;
block|}
DECL|method|setErasureCodingPolicy ( String policyName)
specifier|public
name|DisableErasureCodingPolicyOp
name|setErasureCodingPolicy
parameter_list|(
name|String
name|policyName
parameter_list|)
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|policyName
argument_list|)
expr_stmt|;
name|this
operator|.
name|ecPolicyName
operator|=
name|policyName
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|ecPolicyName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|ecPolicyName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"POLICYNAME"
argument_list|,
name|this
operator|.
name|ecPolicyName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|ecPolicyName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"POLICYNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"DisableErasureCodingPolicy ["
argument_list|)
operator|.
name|append
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to remove an erasure coding policy.    */
DECL|class|RemoveErasureCodingPolicyOp
specifier|static
class|class
name|RemoveErasureCodingPolicyOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|ecPolicyName
specifier|private
name|String
name|ecPolicyName
decl_stmt|;
DECL|method|RemoveErasureCodingPolicyOp ()
name|RemoveErasureCodingPolicyOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_REMOVE_ERASURE_CODING_POLICY
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RemoveErasureCodingPolicyOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RemoveErasureCodingPolicyOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_REMOVE_ERASURE_CODING_POLICY
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|this
operator|.
name|ecPolicyName
operator|=
literal|null
expr_stmt|;
block|}
DECL|method|getEcPolicy ()
specifier|public
name|String
name|getEcPolicy
parameter_list|()
block|{
return|return
name|this
operator|.
name|ecPolicyName
return|;
block|}
DECL|method|setErasureCodingPolicy ( String policyName)
specifier|public
name|RemoveErasureCodingPolicyOp
name|setErasureCodingPolicy
parameter_list|(
name|String
name|policyName
parameter_list|)
block|{
name|Preconditions
operator|.
name|checkNotNull
argument_list|(
name|policyName
argument_list|)
expr_stmt|;
name|this
operator|.
name|ecPolicyName
operator|=
name|policyName
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|ecPolicyName
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|readRpcIds
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|ecPolicyName
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|writeRpcIds
argument_list|(
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"POLICYNAME"
argument_list|,
name|this
operator|.
name|ecPolicyName
argument_list|)
expr_stmt|;
name|appendRpcIdsToXml
argument_list|(
name|contentHandler
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|ecPolicyName
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"POLICYNAME"
argument_list|)
expr_stmt|;
name|readRpcIdsFromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"RemoveErasureCodingPolicy ["
argument_list|)
operator|.
name|append
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
name|appendRpcIdsToString
argument_list|(
name|builder
argument_list|,
name|rpcClientId
argument_list|,
name|rpcCallId
argument_list|)
expr_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
block|}
comment|/**    * Operation corresponding to upgrade    */
DECL|class|RollingUpgradeOp
specifier|abstract
specifier|static
class|class
name|RollingUpgradeOp
extends|extends
name|FSEditLogOp
block|{
comment|// @Idempotent
DECL|field|name
specifier|private
specifier|final
name|String
name|name
decl_stmt|;
DECL|field|time
specifier|private
name|long
name|time
decl_stmt|;
DECL|method|RollingUpgradeOp (FSEditLogOpCodes code, String name)
specifier|public
name|RollingUpgradeOp
parameter_list|(
name|FSEditLogOpCodes
name|code
parameter_list|,
name|String
name|name
parameter_list|)
block|{
name|super
argument_list|(
name|code
argument_list|)
expr_stmt|;
name|this
operator|.
name|name
operator|=
name|StringUtils
operator|.
name|toUpperCase
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|time
operator|=
literal|0L
expr_stmt|;
block|}
DECL|method|getTime ()
name|long
name|getTime
parameter_list|()
block|{
return|return
name|time
return|;
block|}
DECL|method|setTime (long time)
name|void
name|setTime
parameter_list|(
name|long
name|time
parameter_list|)
block|{
name|this
operator|.
name|time
operator|=
name|time
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|time
operator|=
name|in
operator|.
name|readLong
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeLong
argument_list|(
name|time
argument_list|,
name|out
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
name|name
operator|+
literal|"TIME"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|time
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|time
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
name|name
operator|+
literal|"TIME"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
return|return
operator|new
name|StringBuilder
argument_list|()
operator|.
name|append
argument_list|(
literal|"RollingUpgradeOp ["
argument_list|)
operator|.
name|append
argument_list|(
name|name
argument_list|)
operator|.
name|append
argument_list|(
literal|", time="
argument_list|)
operator|.
name|append
argument_list|(
name|time
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
operator|.
name|toString
argument_list|()
return|;
block|}
DECL|class|RollbackException
specifier|static
class|class
name|RollbackException
extends|extends
name|IOException
block|{
DECL|field|serialVersionUID
specifier|private
specifier|static
specifier|final
name|long
name|serialVersionUID
init|=
literal|1L
decl_stmt|;
block|}
block|}
comment|/** {@literal @Idempotent} for {@link ClientProtocol#setStoragePolicy} */
DECL|class|SetStoragePolicyOp
specifier|static
class|class
name|SetStoragePolicyOp
extends|extends
name|FSEditLogOp
block|{
DECL|field|path
name|String
name|path
decl_stmt|;
DECL|field|policyId
name|byte
name|policyId
decl_stmt|;
DECL|method|SetStoragePolicyOp ()
name|SetStoragePolicyOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_SET_STORAGE_POLICY
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|SetStoragePolicyOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|SetStoragePolicyOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_SET_STORAGE_POLICY
argument_list|)
return|;
block|}
annotation|@
name|Override
DECL|method|resetSubFields ()
name|void
name|resetSubFields
parameter_list|()
block|{
name|path
operator|=
literal|null
expr_stmt|;
name|policyId
operator|=
literal|0
expr_stmt|;
block|}
DECL|method|setPath (String path)
name|SetStoragePolicyOp
name|setPath
parameter_list|(
name|String
name|path
parameter_list|)
block|{
name|this
operator|.
name|path
operator|=
name|path
expr_stmt|;
return|return
name|this
return|;
block|}
DECL|method|setPolicyId (byte policyId)
name|SetStoragePolicyOp
name|setPolicyId
parameter_list|(
name|byte
name|policyId
parameter_list|)
block|{
name|this
operator|.
name|policyId
operator|=
name|policyId
expr_stmt|;
return|return
name|this
return|;
block|}
annotation|@
name|Override
DECL|method|writeFields (DataOutputStream out)
specifier|public
name|void
name|writeFields
parameter_list|(
name|DataOutputStream
name|out
parameter_list|)
throws|throws
name|IOException
block|{
name|FSImageSerialization
operator|.
name|writeString
argument_list|(
name|path
argument_list|,
name|out
argument_list|)
expr_stmt|;
name|out
operator|.
name|writeByte
argument_list|(
name|policyId
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|readFields (DataInputStream in, int logVersion)
name|void
name|readFields
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|path
operator|=
name|FSImageSerialization
operator|.
name|readString
argument_list|(
name|in
argument_list|)
expr_stmt|;
name|this
operator|.
name|policyId
operator|=
name|in
operator|.
name|readByte
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|toString ()
specifier|public
name|String
name|toString
parameter_list|()
block|{
name|StringBuilder
name|builder
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|append
argument_list|(
literal|"SetStoragePolicyOp [path="
argument_list|)
operator|.
name|append
argument_list|(
name|path
argument_list|)
operator|.
name|append
argument_list|(
literal|", policyId="
argument_list|)
operator|.
name|append
argument_list|(
name|policyId
argument_list|)
operator|.
name|append
argument_list|(
literal|", opCode="
argument_list|)
operator|.
name|append
argument_list|(
name|opCode
argument_list|)
operator|.
name|append
argument_list|(
literal|", txid="
argument_list|)
operator|.
name|append
argument_list|(
name|txid
argument_list|)
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|builder
operator|.
name|toString
argument_list|()
return|;
block|}
annotation|@
name|Override
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PATH"
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"POLICYID"
argument_list|,
name|Byte
operator|.
name|toString
argument_list|(
name|policyId
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|fromXml (Stanza st)
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|path
operator|=
name|st
operator|.
name|getValue
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
name|this
operator|.
name|policyId
operator|=
name|Byte
operator|.
name|parseByte
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"POLICYID"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
DECL|class|RollingUpgradeStartOp
specifier|static
class|class
name|RollingUpgradeStartOp
extends|extends
name|RollingUpgradeOp
block|{
DECL|method|RollingUpgradeStartOp ()
name|RollingUpgradeStartOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ROLLING_UPGRADE_START
argument_list|,
literal|"start"
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RollingUpgradeStartOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RollingUpgradeStartOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ROLLING_UPGRADE_START
argument_list|)
return|;
block|}
block|}
DECL|class|RollingUpgradeFinalizeOp
specifier|static
class|class
name|RollingUpgradeFinalizeOp
extends|extends
name|RollingUpgradeOp
block|{
DECL|method|RollingUpgradeFinalizeOp ()
name|RollingUpgradeFinalizeOp
parameter_list|()
block|{
name|super
argument_list|(
name|OP_ROLLING_UPGRADE_FINALIZE
argument_list|,
literal|"finalize"
argument_list|)
expr_stmt|;
block|}
DECL|method|getInstance (OpInstanceCache cache)
specifier|static
name|RollingUpgradeFinalizeOp
name|getInstance
parameter_list|(
name|OpInstanceCache
name|cache
parameter_list|)
block|{
return|return
operator|(
name|RollingUpgradeFinalizeOp
operator|)
name|cache
operator|.
name|get
argument_list|(
name|OP_ROLLING_UPGRADE_FINALIZE
argument_list|)
return|;
block|}
block|}
comment|/**    * Class for writing editlog ops    */
DECL|class|Writer
specifier|public
specifier|static
class|class
name|Writer
block|{
DECL|field|buf
specifier|private
specifier|final
name|DataOutputBuffer
name|buf
decl_stmt|;
DECL|field|checksum
specifier|private
specifier|final
name|Checksum
name|checksum
decl_stmt|;
DECL|method|Writer (DataOutputBuffer out)
specifier|public
name|Writer
parameter_list|(
name|DataOutputBuffer
name|out
parameter_list|)
block|{
name|this
operator|.
name|buf
operator|=
name|out
expr_stmt|;
name|this
operator|.
name|checksum
operator|=
name|DataChecksum
operator|.
name|newCrc32
argument_list|()
expr_stmt|;
block|}
comment|/**      * Write an operation to the output stream      *       * @param op The operation to write      * @param logVersion The version of edit log      * @throws IOException if an error occurs during writing.      */
DECL|method|writeOp (FSEditLogOp op, int logVersion)
specifier|public
name|void
name|writeOp
parameter_list|(
name|FSEditLogOp
name|op
parameter_list|,
name|int
name|logVersion
parameter_list|)
throws|throws
name|IOException
block|{
name|int
name|start
init|=
name|buf
operator|.
name|getLength
argument_list|()
decl_stmt|;
comment|// write the op code first to make padding and terminator verification
comment|// work
name|buf
operator|.
name|writeByte
argument_list|(
name|op
operator|.
name|opCode
operator|.
name|getOpCode
argument_list|()
argument_list|)
expr_stmt|;
name|buf
operator|.
name|writeInt
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// write 0 for the length first
name|buf
operator|.
name|writeLong
argument_list|(
name|op
operator|.
name|txid
argument_list|)
expr_stmt|;
name|op
operator|.
name|writeFields
argument_list|(
name|buf
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|int
name|end
init|=
name|buf
operator|.
name|getLength
argument_list|()
decl_stmt|;
comment|// write the length back: content of the op + 4 bytes checksum - op_code
name|int
name|length
init|=
name|end
operator|-
name|start
operator|-
literal|1
decl_stmt|;
name|buf
operator|.
name|writeInt
argument_list|(
name|length
argument_list|,
name|start
operator|+
literal|1
argument_list|)
expr_stmt|;
name|checksum
operator|.
name|reset
argument_list|()
expr_stmt|;
name|checksum
operator|.
name|update
argument_list|(
name|buf
operator|.
name|getData
argument_list|()
argument_list|,
name|start
argument_list|,
name|end
operator|-
name|start
argument_list|)
expr_stmt|;
name|int
name|sum
init|=
operator|(
name|int
operator|)
name|checksum
operator|.
name|getValue
argument_list|()
decl_stmt|;
name|buf
operator|.
name|writeInt
argument_list|(
name|sum
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Class for reading editlog ops from a stream    */
DECL|class|Reader
specifier|public
specifier|abstract
specifier|static
class|class
name|Reader
block|{
DECL|field|in
specifier|final
name|DataInputStream
name|in
decl_stmt|;
DECL|field|limiter
specifier|final
name|StreamLimiter
name|limiter
decl_stmt|;
DECL|field|cache
specifier|final
name|OpInstanceCache
name|cache
decl_stmt|;
DECL|field|temp
specifier|final
name|byte
index|[]
name|temp
init|=
operator|new
name|byte
index|[
literal|4096
index|]
decl_stmt|;
DECL|field|logVersion
specifier|final
name|int
name|logVersion
decl_stmt|;
DECL|field|maxOpSize
name|int
name|maxOpSize
decl_stmt|;
DECL|method|create (DataInputStream in, StreamLimiter limiter, int logVersion)
specifier|public
specifier|static
name|Reader
name|create
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|StreamLimiter
name|limiter
parameter_list|,
name|int
name|logVersion
parameter_list|)
block|{
if|if
condition|(
name|logVersion
operator|<
name|NameNodeLayoutVersion
operator|.
name|CURRENT_LAYOUT_VERSION
condition|)
block|{
comment|// Use the LengthPrefixedReader on edit logs which are newer than what
comment|// we can parse.  (Newer layout versions are represented by smaller
comment|// negative integers, for historical reasons.) Even though we can't
comment|// parse the Ops contained in them, we should still be able to call
comment|// scanOp on them.  This is important for the JournalNode during rolling
comment|// upgrade.
return|return
operator|new
name|LengthPrefixedReader
argument_list|(
name|in
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|NameNodeLayoutVersion
operator|.
name|Feature
operator|.
name|EDITLOG_LENGTH
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
return|return
operator|new
name|LengthPrefixedReader
argument_list|(
name|in
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|EDITS_CHECKSUM
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|Checksum
name|checksum
init|=
name|DataChecksum
operator|.
name|newCrc32
argument_list|()
decl_stmt|;
return|return
operator|new
name|ChecksummedReader
argument_list|(
name|checksum
argument_list|,
name|in
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
return|;
block|}
else|else
block|{
return|return
operator|new
name|LegacyReader
argument_list|(
name|in
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
return|;
block|}
block|}
comment|/**      * Construct the reader      * @param in            The stream to read from.      * @param limiter       The limiter for this stream.      * @param logVersion    The version of the data coming from the stream.      */
DECL|method|Reader (DataInputStream in, StreamLimiter limiter, int logVersion)
name|Reader
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|StreamLimiter
name|limiter
parameter_list|,
name|int
name|logVersion
parameter_list|)
block|{
name|this
operator|.
name|in
operator|=
name|in
expr_stmt|;
name|this
operator|.
name|limiter
operator|=
name|limiter
expr_stmt|;
name|this
operator|.
name|logVersion
operator|=
name|logVersion
expr_stmt|;
name|this
operator|.
name|cache
operator|=
operator|new
name|OpInstanceCache
argument_list|()
expr_stmt|;
name|this
operator|.
name|maxOpSize
operator|=
name|DFSConfigKeys
operator|.
name|DFS_NAMENODE_MAX_OP_SIZE_DEFAULT
expr_stmt|;
block|}
DECL|method|setMaxOpSize (int maxOpSize)
specifier|public
name|void
name|setMaxOpSize
parameter_list|(
name|int
name|maxOpSize
parameter_list|)
block|{
name|this
operator|.
name|maxOpSize
operator|=
name|maxOpSize
expr_stmt|;
block|}
comment|/**      * Read an operation from the input stream.      *       * Note that the objects returned from this method may be re-used by future      * calls to the same method.      *       * @param skipBrokenEdits    If true, attempt to skip over damaged parts of      * the input stream, rather than throwing an IOException      * @return the operation read from the stream, or null at the end of the       *         file      * @throws IOException on error.  This function should only throw an      *         exception when skipBrokenEdits is false.      */
DECL|method|readOp (boolean skipBrokenEdits)
specifier|public
name|FSEditLogOp
name|readOp
parameter_list|(
name|boolean
name|skipBrokenEdits
parameter_list|)
throws|throws
name|IOException
block|{
while|while
condition|(
literal|true
condition|)
block|{
try|try
block|{
return|return
name|decodeOp
argument_list|()
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|in
operator|.
name|reset
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|skipBrokenEdits
condition|)
block|{
throw|throw
name|e
throw|;
block|}
block|}
catch|catch
parameter_list|(
name|RuntimeException
name|e
parameter_list|)
block|{
comment|// FSEditLogOp#decodeOp is not supposed to throw RuntimeException.
comment|// However, we handle it here for recovery mode, just to be more
comment|// robust.
name|in
operator|.
name|reset
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|skipBrokenEdits
condition|)
block|{
throw|throw
name|e
throw|;
block|}
block|}
catch|catch
parameter_list|(
name|Throwable
name|e
parameter_list|)
block|{
name|in
operator|.
name|reset
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|skipBrokenEdits
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"got unexpected exception "
operator|+
name|e
operator|.
name|getMessage
argument_list|()
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
comment|// Move ahead one byte and re-try the decode process.
if|if
condition|(
name|in
operator|.
name|skip
argument_list|(
literal|1
argument_list|)
operator|<
literal|1
condition|)
block|{
return|return
literal|null
return|;
block|}
block|}
block|}
DECL|method|verifyTerminator ()
name|void
name|verifyTerminator
parameter_list|()
throws|throws
name|IOException
block|{
comment|/** The end of the edit log should contain only 0x00 or 0xff bytes.        * If it contains other bytes, the log itself may be corrupt.        * It is important to check this; if we don't, a stray OP_INVALID byte         * could make us stop reading the edit log halfway through, and we'd never        * know that we had lost data.        */
name|limiter
operator|.
name|clearLimit
argument_list|()
expr_stmt|;
name|int
name|numRead
init|=
operator|-
literal|1
decl_stmt|,
name|idx
init|=
literal|0
decl_stmt|;
while|while
condition|(
literal|true
condition|)
block|{
try|try
block|{
name|numRead
operator|=
operator|-
literal|1
expr_stmt|;
name|idx
operator|=
literal|0
expr_stmt|;
name|numRead
operator|=
name|in
operator|.
name|read
argument_list|(
name|temp
argument_list|)
expr_stmt|;
if|if
condition|(
name|numRead
operator|==
operator|-
literal|1
condition|)
block|{
return|return;
block|}
while|while
condition|(
name|idx
operator|<
name|numRead
condition|)
block|{
if|if
condition|(
operator|(
name|temp
index|[
name|idx
index|]
operator|!=
operator|(
name|byte
operator|)
literal|0
operator|)
operator|&&
operator|(
name|temp
index|[
name|idx
index|]
operator|!=
operator|(
name|byte
operator|)
operator|-
literal|1
operator|)
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Read extra bytes after "
operator|+
literal|"the terminator!"
argument_list|)
throw|;
block|}
name|idx
operator|++
expr_stmt|;
block|}
block|}
finally|finally
block|{
comment|// After reading each group of bytes, we reposition the mark one
comment|// byte before the next group.  Similarly, if there is an error, we
comment|// want to reposition the mark one byte before the error
if|if
condition|(
name|numRead
operator|!=
operator|-
literal|1
condition|)
block|{
name|in
operator|.
name|reset
argument_list|()
expr_stmt|;
name|IOUtils
operator|.
name|skipFully
argument_list|(
name|in
argument_list|,
name|idx
argument_list|)
expr_stmt|;
name|in
operator|.
name|mark
argument_list|(
name|temp
operator|.
name|length
operator|+
literal|1
argument_list|)
expr_stmt|;
name|IOUtils
operator|.
name|skipFully
argument_list|(
name|in
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
comment|/**      * Read an opcode from the input stream.      *      * @return   the opcode, or null on EOF.      *      * If an exception is thrown, the stream's mark will be set to the first      * problematic byte.  This usually means the beginning of the opcode.      */
DECL|method|decodeOp ()
specifier|public
specifier|abstract
name|FSEditLogOp
name|decodeOp
parameter_list|()
throws|throws
name|IOException
function_decl|;
comment|/**      * Similar to decodeOp(), but we only retrieve the transaction ID of the      * Op rather than reading it.  If the edit log format supports length      * prefixing, this can be much faster than full decoding.      *      * @return the last txid of the segment, or INVALID_TXID on EOF.      */
DECL|method|scanOp ()
specifier|public
specifier|abstract
name|long
name|scanOp
parameter_list|()
throws|throws
name|IOException
function_decl|;
block|}
comment|/**    * Reads edit logs which are prefixed with a length.  These edit logs also    * include a checksum and transaction ID.    */
DECL|class|LengthPrefixedReader
specifier|private
specifier|static
class|class
name|LengthPrefixedReader
extends|extends
name|Reader
block|{
comment|/**      * The minimum length of a length-prefixed Op.      *      * The minimum Op has:      * 1-byte opcode      * 4-byte length      * 8-byte txid      * 0-byte body      * 4-byte checksum      */
DECL|field|MIN_OP_LENGTH
specifier|private
specifier|static
specifier|final
name|int
name|MIN_OP_LENGTH
init|=
literal|17
decl_stmt|;
comment|/**      * The op id length.      *      * Not included in the stored length.      */
DECL|field|OP_ID_LENGTH
specifier|private
specifier|static
specifier|final
name|int
name|OP_ID_LENGTH
init|=
literal|1
decl_stmt|;
comment|/**      * The checksum length.      *      * Not included in the stored length.      */
DECL|field|CHECKSUM_LENGTH
specifier|private
specifier|static
specifier|final
name|int
name|CHECKSUM_LENGTH
init|=
literal|4
decl_stmt|;
DECL|field|checksum
specifier|private
specifier|final
name|Checksum
name|checksum
decl_stmt|;
DECL|method|LengthPrefixedReader (DataInputStream in, StreamLimiter limiter, int logVersion)
name|LengthPrefixedReader
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|StreamLimiter
name|limiter
parameter_list|,
name|int
name|logVersion
parameter_list|)
block|{
name|super
argument_list|(
name|in
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|this
operator|.
name|checksum
operator|=
name|DataChecksum
operator|.
name|newCrc32
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|decodeOp ()
specifier|public
name|FSEditLogOp
name|decodeOp
parameter_list|()
throws|throws
name|IOException
block|{
name|long
name|txid
init|=
name|decodeOpFrame
argument_list|()
decl_stmt|;
if|if
condition|(
name|txid
operator|==
name|HdfsServerConstants
operator|.
name|INVALID_TXID
condition|)
block|{
return|return
literal|null
return|;
block|}
name|in
operator|.
name|reset
argument_list|()
expr_stmt|;
name|in
operator|.
name|mark
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|FSEditLogOpCodes
name|opCode
init|=
name|FSEditLogOpCodes
operator|.
name|fromByte
argument_list|(
name|in
operator|.
name|readByte
argument_list|()
argument_list|)
decl_stmt|;
name|FSEditLogOp
name|op
init|=
name|cache
operator|.
name|get
argument_list|(
name|opCode
argument_list|)
decl_stmt|;
if|if
condition|(
name|op
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Read invalid opcode "
operator|+
name|opCode
argument_list|)
throw|;
block|}
name|op
operator|.
name|setTransactionId
argument_list|(
name|txid
argument_list|)
expr_stmt|;
name|IOUtils
operator|.
name|skipFully
argument_list|(
name|in
argument_list|,
literal|4
operator|+
literal|8
argument_list|)
expr_stmt|;
comment|// skip length and txid
name|op
operator|.
name|readFields
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
comment|// skip over the checksum, which we validated above.
name|IOUtils
operator|.
name|skipFully
argument_list|(
name|in
argument_list|,
name|CHECKSUM_LENGTH
argument_list|)
expr_stmt|;
return|return
name|op
return|;
block|}
annotation|@
name|Override
DECL|method|scanOp ()
specifier|public
name|long
name|scanOp
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|decodeOpFrame
argument_list|()
return|;
block|}
comment|/**      * Decode the opcode "frame".  This includes reading the opcode and      * transaction ID, and validating the checksum and length.  It does not      * include reading the opcode-specific fields.      * The input stream will be advanced to the end of the op at the end of this      * function.      *      * @return        An op with the txid set, but none of the other fields      *                  filled in, or null if we hit EOF.      */
DECL|method|decodeOpFrame ()
specifier|private
name|long
name|decodeOpFrame
parameter_list|()
throws|throws
name|IOException
block|{
name|limiter
operator|.
name|setLimit
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|in
operator|.
name|mark
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|byte
name|opCodeByte
decl_stmt|;
try|try
block|{
name|opCodeByte
operator|=
name|in
operator|.
name|readByte
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|EOFException
name|eof
parameter_list|)
block|{
comment|// EOF at an opcode boundary is expected.
return|return
name|HdfsServerConstants
operator|.
name|INVALID_TXID
return|;
block|}
if|if
condition|(
name|opCodeByte
operator|==
name|FSEditLogOpCodes
operator|.
name|OP_INVALID
operator|.
name|getOpCode
argument_list|()
condition|)
block|{
name|verifyTerminator
argument_list|()
expr_stmt|;
return|return
name|HdfsServerConstants
operator|.
name|INVALID_TXID
return|;
block|}
comment|// Here, we verify that the Op size makes sense and that the
comment|// data matches its checksum before attempting to construct an Op.
comment|// This is important because otherwise we may encounter an
comment|// OutOfMemoryException which could bring down the NameNode or
comment|// JournalNode when reading garbage data.
name|int
name|opLength
init|=
name|in
operator|.
name|readInt
argument_list|()
operator|+
name|OP_ID_LENGTH
operator|+
name|CHECKSUM_LENGTH
decl_stmt|;
if|if
condition|(
name|opLength
operator|>
name|maxOpSize
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Op "
operator|+
operator|(
name|int
operator|)
name|opCodeByte
operator|+
literal|" has size "
operator|+
name|opLength
operator|+
literal|", but maxOpSize = "
operator|+
name|maxOpSize
argument_list|)
throw|;
block|}
elseif|else
if|if
condition|(
name|opLength
operator|<
name|MIN_OP_LENGTH
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Op "
operator|+
operator|(
name|int
operator|)
name|opCodeByte
operator|+
literal|" has size "
operator|+
name|opLength
operator|+
literal|", but the minimum op size is "
operator|+
name|MIN_OP_LENGTH
argument_list|)
throw|;
block|}
name|long
name|txid
init|=
name|in
operator|.
name|readLong
argument_list|()
decl_stmt|;
comment|// Verify checksum
name|in
operator|.
name|reset
argument_list|()
expr_stmt|;
name|in
operator|.
name|mark
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|checksum
operator|.
name|reset
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|rem
init|=
name|opLength
operator|-
name|CHECKSUM_LENGTH
init|;
name|rem
operator|>
literal|0
condition|;
control|)
block|{
name|int
name|toRead
init|=
name|Math
operator|.
name|min
argument_list|(
name|temp
operator|.
name|length
argument_list|,
name|rem
argument_list|)
decl_stmt|;
name|IOUtils
operator|.
name|readFully
argument_list|(
name|in
argument_list|,
name|temp
argument_list|,
literal|0
argument_list|,
name|toRead
argument_list|)
expr_stmt|;
name|checksum
operator|.
name|update
argument_list|(
name|temp
argument_list|,
literal|0
argument_list|,
name|toRead
argument_list|)
expr_stmt|;
name|rem
operator|-=
name|toRead
expr_stmt|;
block|}
name|int
name|expectedChecksum
init|=
name|in
operator|.
name|readInt
argument_list|()
decl_stmt|;
name|int
name|calculatedChecksum
init|=
operator|(
name|int
operator|)
name|checksum
operator|.
name|getValue
argument_list|()
decl_stmt|;
if|if
condition|(
name|expectedChecksum
operator|!=
name|calculatedChecksum
condition|)
block|{
throw|throw
operator|new
name|ChecksumException
argument_list|(
literal|"Transaction is corrupt. Calculated checksum is "
operator|+
name|calculatedChecksum
operator|+
literal|" but read checksum "
operator|+
name|expectedChecksum
argument_list|,
name|txid
argument_list|)
throw|;
block|}
return|return
name|txid
return|;
block|}
block|}
comment|/**    * Read edit logs which have a checksum and a transaction ID, but not a    * length.    */
DECL|class|ChecksummedReader
specifier|private
specifier|static
class|class
name|ChecksummedReader
extends|extends
name|Reader
block|{
DECL|field|checksum
specifier|private
specifier|final
name|Checksum
name|checksum
decl_stmt|;
DECL|method|ChecksummedReader (Checksum checksum, DataInputStream in, StreamLimiter limiter, int logVersion)
name|ChecksummedReader
parameter_list|(
name|Checksum
name|checksum
parameter_list|,
name|DataInputStream
name|in
parameter_list|,
name|StreamLimiter
name|limiter
parameter_list|,
name|int
name|logVersion
parameter_list|)
block|{
name|super
argument_list|(
operator|new
name|DataInputStream
argument_list|(
operator|new
name|CheckedInputStream
argument_list|(
name|in
argument_list|,
name|checksum
argument_list|)
argument_list|)
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
name|this
operator|.
name|checksum
operator|=
name|checksum
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|decodeOp ()
specifier|public
name|FSEditLogOp
name|decodeOp
parameter_list|()
throws|throws
name|IOException
block|{
name|limiter
operator|.
name|setLimit
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|in
operator|.
name|mark
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
comment|// Reset the checksum.  Since we are using a CheckedInputStream, each
comment|// subsequent read from the  stream will update the checksum.
name|checksum
operator|.
name|reset
argument_list|()
expr_stmt|;
name|byte
name|opCodeByte
decl_stmt|;
try|try
block|{
name|opCodeByte
operator|=
name|in
operator|.
name|readByte
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|EOFException
name|eof
parameter_list|)
block|{
comment|// EOF at an opcode boundary is expected.
return|return
literal|null
return|;
block|}
name|FSEditLogOpCodes
name|opCode
init|=
name|FSEditLogOpCodes
operator|.
name|fromByte
argument_list|(
name|opCodeByte
argument_list|)
decl_stmt|;
if|if
condition|(
name|opCode
operator|==
name|OP_INVALID
condition|)
block|{
name|verifyTerminator
argument_list|()
expr_stmt|;
return|return
literal|null
return|;
block|}
name|FSEditLogOp
name|op
init|=
name|cache
operator|.
name|get
argument_list|(
name|opCode
argument_list|)
decl_stmt|;
if|if
condition|(
name|op
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Read invalid opcode "
operator|+
name|opCode
argument_list|)
throw|;
block|}
name|op
operator|.
name|setTransactionId
argument_list|(
name|in
operator|.
name|readLong
argument_list|()
argument_list|)
expr_stmt|;
name|op
operator|.
name|readFields
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
comment|// Verify checksum
name|int
name|calculatedChecksum
init|=
operator|(
name|int
operator|)
name|checksum
operator|.
name|getValue
argument_list|()
decl_stmt|;
name|int
name|expectedChecksum
init|=
name|in
operator|.
name|readInt
argument_list|()
decl_stmt|;
if|if
condition|(
name|expectedChecksum
operator|!=
name|calculatedChecksum
condition|)
block|{
throw|throw
operator|new
name|ChecksumException
argument_list|(
literal|"Transaction is corrupt. Calculated checksum is "
operator|+
name|calculatedChecksum
operator|+
literal|" but read checksum "
operator|+
name|expectedChecksum
argument_list|,
name|op
operator|.
name|txid
argument_list|)
throw|;
block|}
return|return
name|op
return|;
block|}
annotation|@
name|Override
DECL|method|scanOp ()
specifier|public
name|long
name|scanOp
parameter_list|()
throws|throws
name|IOException
block|{
comment|// Edit logs of this age don't have any length prefix, so we just have
comment|// to read the entire Op.
name|FSEditLogOp
name|op
init|=
name|decodeOp
argument_list|()
decl_stmt|;
return|return
name|op
operator|==
literal|null
condition|?
name|HdfsServerConstants
operator|.
name|INVALID_TXID
else|:
name|op
operator|.
name|getTransactionId
argument_list|()
return|;
block|}
block|}
comment|/**    * Read older edit logs which may or may not have transaction IDs and other    * features.  This code is used during upgrades and to allow HDFS INotify to    * read older edit log files.    */
DECL|class|LegacyReader
specifier|private
specifier|static
class|class
name|LegacyReader
extends|extends
name|Reader
block|{
DECL|method|LegacyReader (DataInputStream in, StreamLimiter limiter, int logVersion)
name|LegacyReader
parameter_list|(
name|DataInputStream
name|in
parameter_list|,
name|StreamLimiter
name|limiter
parameter_list|,
name|int
name|logVersion
parameter_list|)
block|{
name|super
argument_list|(
name|in
argument_list|,
name|limiter
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|decodeOp ()
specifier|public
name|FSEditLogOp
name|decodeOp
parameter_list|()
throws|throws
name|IOException
block|{
name|limiter
operator|.
name|setLimit
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|in
operator|.
name|mark
argument_list|(
name|maxOpSize
argument_list|)
expr_stmt|;
name|byte
name|opCodeByte
decl_stmt|;
try|try
block|{
name|opCodeByte
operator|=
name|in
operator|.
name|readByte
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|EOFException
name|eof
parameter_list|)
block|{
comment|// EOF at an opcode boundary is expected.
return|return
literal|null
return|;
block|}
name|FSEditLogOpCodes
name|opCode
init|=
name|FSEditLogOpCodes
operator|.
name|fromByte
argument_list|(
name|opCodeByte
argument_list|)
decl_stmt|;
if|if
condition|(
name|opCode
operator|==
name|OP_INVALID
condition|)
block|{
name|verifyTerminator
argument_list|()
expr_stmt|;
return|return
literal|null
return|;
block|}
name|FSEditLogOp
name|op
init|=
name|cache
operator|.
name|get
argument_list|(
name|opCode
argument_list|)
decl_stmt|;
if|if
condition|(
name|op
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Read invalid opcode "
operator|+
name|opCode
argument_list|)
throw|;
block|}
if|if
condition|(
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|STORED_TXIDS
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
name|op
operator|.
name|setTransactionId
argument_list|(
name|in
operator|.
name|readLong
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|op
operator|.
name|setTransactionId
argument_list|(
name|HdfsServerConstants
operator|.
name|INVALID_TXID
argument_list|)
expr_stmt|;
block|}
name|op
operator|.
name|readFields
argument_list|(
name|in
argument_list|,
name|logVersion
argument_list|)
expr_stmt|;
return|return
name|op
return|;
block|}
annotation|@
name|Override
DECL|method|scanOp ()
specifier|public
name|long
name|scanOp
parameter_list|()
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|NameNodeLayoutVersion
operator|.
name|supports
argument_list|(
name|LayoutVersion
operator|.
name|Feature
operator|.
name|STORED_TXIDS
argument_list|,
name|logVersion
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Can't scan a pre-transactional edit log."
argument_list|)
throw|;
block|}
name|FSEditLogOp
name|op
init|=
name|decodeOp
argument_list|()
decl_stmt|;
return|return
name|op
operator|==
literal|null
condition|?
name|HdfsServerConstants
operator|.
name|INVALID_TXID
else|:
name|op
operator|.
name|getTransactionId
argument_list|()
return|;
block|}
block|}
DECL|method|outputToXml (ContentHandler contentHandler)
specifier|public
name|void
name|outputToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"RECORD"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"OPCODE"
argument_list|,
name|opCode
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"DATA"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TXID"
argument_list|,
literal|""
operator|+
name|txid
argument_list|)
expr_stmt|;
name|toXml
argument_list|(
name|contentHandler
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"DATA"
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"RECORD"
argument_list|)
expr_stmt|;
block|}
DECL|method|toXml (ContentHandler contentHandler)
specifier|protected
specifier|abstract
name|void
name|toXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|)
throws|throws
name|SAXException
function_decl|;
DECL|method|fromXml (Stanza st)
specifier|abstract
name|void
name|fromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
function_decl|;
DECL|method|decodeXml (Stanza st)
specifier|public
name|void
name|decodeXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|this
operator|.
name|txid
operator|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"TXID"
argument_list|)
argument_list|)
expr_stmt|;
name|fromXml
argument_list|(
name|st
argument_list|)
expr_stmt|;
block|}
DECL|method|blockToXml (ContentHandler contentHandler, Block block)
specifier|public
specifier|static
name|void
name|blockToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|Block
name|block
parameter_list|)
throws|throws
name|SAXException
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"BLOCK"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"BLOCK_ID"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|block
operator|.
name|getBlockId
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NUM_BYTES"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|block
operator|.
name|getNumBytes
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"GENSTAMP"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|block
operator|.
name|getGenerationStamp
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"BLOCK"
argument_list|)
expr_stmt|;
block|}
DECL|method|blockFromXml (Stanza st)
specifier|public
specifier|static
name|Block
name|blockFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|long
name|blockId
init|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"BLOCK_ID"
argument_list|)
argument_list|)
decl_stmt|;
name|long
name|numBytes
init|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"NUM_BYTES"
argument_list|)
argument_list|)
decl_stmt|;
name|long
name|generationStamp
init|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"GENSTAMP"
argument_list|)
argument_list|)
decl_stmt|;
return|return
operator|new
name|Block
argument_list|(
name|blockId
argument_list|,
name|numBytes
argument_list|,
name|generationStamp
argument_list|)
return|;
block|}
DECL|method|delegationTokenToXml (ContentHandler contentHandler, DelegationTokenIdentifier token)
specifier|public
specifier|static
name|void
name|delegationTokenToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|DelegationTokenIdentifier
name|token
parameter_list|)
throws|throws
name|SAXException
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"DELEGATION_TOKEN_IDENTIFIER"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"KIND"
argument_list|,
name|token
operator|.
name|getKind
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SEQUENCE_NUMBER"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|token
operator|.
name|getSequenceNumber
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"OWNER"
argument_list|,
name|token
operator|.
name|getOwner
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"RENEWER"
argument_list|,
name|token
operator|.
name|getRenewer
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"REALUSER"
argument_list|,
name|token
operator|.
name|getRealUser
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"ISSUE_DATE"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|token
operator|.
name|getIssueDate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MAX_DATE"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|token
operator|.
name|getMaxDate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MASTER_KEY_ID"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|token
operator|.
name|getMasterKeyId
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"DELEGATION_TOKEN_IDENTIFIER"
argument_list|)
expr_stmt|;
block|}
DECL|method|delegationTokenFromXml (Stanza st)
specifier|public
specifier|static
name|DelegationTokenIdentifier
name|delegationTokenFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|String
name|kind
init|=
name|st
operator|.
name|getValue
argument_list|(
literal|"KIND"
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|kind
operator|.
name|equals
argument_list|(
name|DelegationTokenIdentifier
operator|.
name|HDFS_DELEGATION_KIND
operator|.
name|toString
argument_list|()
argument_list|)
condition|)
block|{
throw|throw
operator|new
name|InvalidXmlException
argument_list|(
literal|"can't understand "
operator|+
literal|"DelegationTokenIdentifier KIND "
operator|+
name|kind
argument_list|)
throw|;
block|}
name|int
name|seqNum
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"SEQUENCE_NUMBER"
argument_list|)
argument_list|)
decl_stmt|;
name|String
name|owner
init|=
name|st
operator|.
name|getValue
argument_list|(
literal|"OWNER"
argument_list|)
decl_stmt|;
name|String
name|renewer
init|=
name|st
operator|.
name|getValue
argument_list|(
literal|"RENEWER"
argument_list|)
decl_stmt|;
name|String
name|realuser
init|=
name|st
operator|.
name|getValue
argument_list|(
literal|"REALUSER"
argument_list|)
decl_stmt|;
name|long
name|issueDate
init|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"ISSUE_DATE"
argument_list|)
argument_list|)
decl_stmt|;
name|long
name|maxDate
init|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MAX_DATE"
argument_list|)
argument_list|)
decl_stmt|;
name|int
name|masterKeyId
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MASTER_KEY_ID"
argument_list|)
argument_list|)
decl_stmt|;
name|DelegationTokenIdentifier
name|token
init|=
operator|new
name|DelegationTokenIdentifier
argument_list|(
operator|new
name|Text
argument_list|(
name|owner
argument_list|)
argument_list|,
operator|new
name|Text
argument_list|(
name|renewer
argument_list|)
argument_list|,
operator|new
name|Text
argument_list|(
name|realuser
argument_list|)
argument_list|)
decl_stmt|;
name|token
operator|.
name|setSequenceNumber
argument_list|(
name|seqNum
argument_list|)
expr_stmt|;
name|token
operator|.
name|setIssueDate
argument_list|(
name|issueDate
argument_list|)
expr_stmt|;
name|token
operator|.
name|setMaxDate
argument_list|(
name|maxDate
argument_list|)
expr_stmt|;
name|token
operator|.
name|setMasterKeyId
argument_list|(
name|masterKeyId
argument_list|)
expr_stmt|;
return|return
name|token
return|;
block|}
DECL|method|delegationKeyToXml (ContentHandler contentHandler, DelegationKey key)
specifier|public
specifier|static
name|void
name|delegationKeyToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|DelegationKey
name|key
parameter_list|)
throws|throws
name|SAXException
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"DELEGATION_KEY"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"KEY_ID"
argument_list|,
name|Integer
operator|.
name|toString
argument_list|(
name|key
operator|.
name|getKeyId
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"EXPIRY_DATE"
argument_list|,
name|Long
operator|.
name|toString
argument_list|(
name|key
operator|.
name|getExpiryDate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|key
operator|.
name|getEncodedKey
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"KEY"
argument_list|,
name|Hex
operator|.
name|encodeHexString
argument_list|(
name|key
operator|.
name|getEncodedKey
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"DELEGATION_KEY"
argument_list|)
expr_stmt|;
block|}
DECL|method|delegationKeyFromXml (Stanza st)
specifier|public
specifier|static
name|DelegationKey
name|delegationKeyFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|int
name|keyId
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"KEY_ID"
argument_list|)
argument_list|)
decl_stmt|;
name|long
name|expiryDate
init|=
name|Long
operator|.
name|parseLong
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"EXPIRY_DATE"
argument_list|)
argument_list|)
decl_stmt|;
name|byte
name|key
index|[]
init|=
literal|null
decl_stmt|;
try|try
block|{
name|key
operator|=
name|Hex
operator|.
name|decodeHex
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"KEY"
argument_list|)
operator|.
name|toCharArray
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|DecoderException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|InvalidXmlException
argument_list|(
name|e
operator|.
name|toString
argument_list|()
argument_list|)
throw|;
block|}
catch|catch
parameter_list|(
name|InvalidXmlException
name|e
parameter_list|)
block|{     }
return|return
operator|new
name|DelegationKey
argument_list|(
name|keyId
argument_list|,
name|expiryDate
argument_list|,
name|key
argument_list|)
return|;
block|}
DECL|method|permissionStatusToXml (ContentHandler contentHandler, PermissionStatus perm)
specifier|public
specifier|static
name|void
name|permissionStatusToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|PermissionStatus
name|perm
parameter_list|)
throws|throws
name|SAXException
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"PERMISSION_STATUS"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"USERNAME"
argument_list|,
name|perm
operator|.
name|getUserName
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"GROUPNAME"
argument_list|,
name|perm
operator|.
name|getGroupName
argument_list|()
argument_list|)
expr_stmt|;
name|fsPermissionToXml
argument_list|(
name|contentHandler
argument_list|,
name|perm
operator|.
name|getPermission
argument_list|()
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"PERMISSION_STATUS"
argument_list|)
expr_stmt|;
block|}
DECL|method|permissionStatusFromXml (Stanza st)
specifier|public
specifier|static
name|PermissionStatus
name|permissionStatusFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|Stanza
name|status
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"PERMISSION_STATUS"
argument_list|)
operator|.
name|get
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|String
name|username
init|=
name|status
operator|.
name|getValue
argument_list|(
literal|"USERNAME"
argument_list|)
decl_stmt|;
name|String
name|groupname
init|=
name|status
operator|.
name|getValue
argument_list|(
literal|"GROUPNAME"
argument_list|)
decl_stmt|;
name|FsPermission
name|mode
init|=
name|fsPermissionFromXml
argument_list|(
name|status
argument_list|)
decl_stmt|;
return|return
operator|new
name|PermissionStatus
argument_list|(
name|username
argument_list|,
name|groupname
argument_list|,
name|mode
argument_list|)
return|;
block|}
DECL|method|fsPermissionToXml (ContentHandler contentHandler, FsPermission mode)
specifier|public
specifier|static
name|void
name|fsPermissionToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|FsPermission
name|mode
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"MODE"
argument_list|,
name|Short
operator|.
name|toString
argument_list|(
name|mode
operator|.
name|toShort
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|fsPermissionFromXml (Stanza st)
specifier|public
specifier|static
name|FsPermission
name|fsPermissionFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|short
name|mode
init|=
name|Short
operator|.
name|parseShort
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"MODE"
argument_list|)
argument_list|)
decl_stmt|;
return|return
operator|new
name|FsPermission
argument_list|(
name|mode
argument_list|)
return|;
block|}
DECL|method|fsActionToXml (ContentHandler contentHandler, FsAction v)
specifier|private
specifier|static
name|void
name|fsActionToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|FsAction
name|v
parameter_list|)
throws|throws
name|SAXException
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"PERM"
argument_list|,
name|v
operator|.
name|SYMBOL
argument_list|)
expr_stmt|;
block|}
DECL|method|fsActionFromXml (Stanza st)
specifier|private
specifier|static
name|FsAction
name|fsActionFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
name|FsAction
name|v
init|=
name|FSACTION_SYMBOL_MAP
operator|.
name|get
argument_list|(
name|st
operator|.
name|getValue
argument_list|(
literal|"PERM"
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|v
operator|==
literal|null
condition|)
throw|throw
operator|new
name|InvalidXmlException
argument_list|(
literal|"Invalid value for FsAction"
argument_list|)
throw|;
return|return
name|v
return|;
block|}
DECL|method|appendAclEntriesToXml (ContentHandler contentHandler, List<AclEntry> aclEntries)
specifier|private
specifier|static
name|void
name|appendAclEntriesToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
parameter_list|)
throws|throws
name|SAXException
block|{
for|for
control|(
name|AclEntry
name|e
range|:
name|aclEntries
control|)
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"ENTRY"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"SCOPE"
argument_list|,
name|e
operator|.
name|getScope
argument_list|()
operator|.
name|name
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"TYPE"
argument_list|,
name|e
operator|.
name|getType
argument_list|()
operator|.
name|name
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|e
operator|.
name|getName
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NAME"
argument_list|,
name|e
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|fsActionToXml
argument_list|(
name|contentHandler
argument_list|,
name|e
operator|.
name|getPermission
argument_list|()
argument_list|)
expr_stmt|;
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"ENTRY"
argument_list|)
expr_stmt|;
block|}
block|}
DECL|method|readAclEntriesFromXml (Stanza st)
specifier|private
specifier|static
name|List
argument_list|<
name|AclEntry
argument_list|>
name|readAclEntriesFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
block|{
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclEntries
init|=
name|Lists
operator|.
name|newArrayList
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|st
operator|.
name|hasChildren
argument_list|(
literal|"ENTRY"
argument_list|)
condition|)
return|return
literal|null
return|;
name|List
argument_list|<
name|Stanza
argument_list|>
name|stanzas
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"ENTRY"
argument_list|)
decl_stmt|;
for|for
control|(
name|Stanza
name|s
range|:
name|stanzas
control|)
block|{
name|AclEntry
name|e
init|=
operator|new
name|AclEntry
operator|.
name|Builder
argument_list|()
operator|.
name|setScope
argument_list|(
name|AclEntryScope
operator|.
name|valueOf
argument_list|(
name|s
operator|.
name|getValue
argument_list|(
literal|"SCOPE"
argument_list|)
argument_list|)
argument_list|)
operator|.
name|setType
argument_list|(
name|AclEntryType
operator|.
name|valueOf
argument_list|(
name|s
operator|.
name|getValue
argument_list|(
literal|"TYPE"
argument_list|)
argument_list|)
argument_list|)
operator|.
name|setName
argument_list|(
name|s
operator|.
name|getValueOrNull
argument_list|(
literal|"NAME"
argument_list|)
argument_list|)
operator|.
name|setPermission
argument_list|(
name|fsActionFromXml
argument_list|(
name|s
argument_list|)
argument_list|)
operator|.
name|build
argument_list|()
decl_stmt|;
name|aclEntries
operator|.
name|add
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
return|return
name|aclEntries
return|;
block|}
DECL|method|appendXAttrsToXml (ContentHandler contentHandler, List<XAttr> xAttrs)
specifier|private
specifier|static
name|void
name|appendXAttrsToXml
parameter_list|(
name|ContentHandler
name|contentHandler
parameter_list|,
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
parameter_list|)
throws|throws
name|SAXException
block|{
for|for
control|(
name|XAttr
name|xAttr
range|:
name|xAttrs
control|)
block|{
name|contentHandler
operator|.
name|startElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"XATTR"
argument_list|,
operator|new
name|AttributesImpl
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NAMESPACE"
argument_list|,
name|xAttr
operator|.
name|getNameSpace
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"NAME"
argument_list|,
name|xAttr
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|xAttr
operator|.
name|getValue
argument_list|()
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|XMLUtils
operator|.
name|addSaxString
argument_list|(
name|contentHandler
argument_list|,
literal|"VALUE"
argument_list|,
name|XAttrCodec
operator|.
name|encodeValue
argument_list|(
name|xAttr
operator|.
name|getValue
argument_list|()
argument_list|,
name|XAttrCodec
operator|.
name|HEX
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|SAXException
argument_list|(
name|e
argument_list|)
throw|;
block|}
block|}
name|contentHandler
operator|.
name|endElement
argument_list|(
literal|""
argument_list|,
literal|""
argument_list|,
literal|"XATTR"
argument_list|)
expr_stmt|;
block|}
block|}
DECL|method|readXAttrsFromXml (Stanza st)
specifier|private
specifier|static
name|List
argument_list|<
name|XAttr
argument_list|>
name|readXAttrsFromXml
parameter_list|(
name|Stanza
name|st
parameter_list|)
throws|throws
name|InvalidXmlException
block|{
if|if
condition|(
operator|!
name|st
operator|.
name|hasChildren
argument_list|(
literal|"XATTR"
argument_list|)
condition|)
block|{
return|return
literal|null
return|;
block|}
name|List
argument_list|<
name|Stanza
argument_list|>
name|stanzas
init|=
name|st
operator|.
name|getChildren
argument_list|(
literal|"XATTR"
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|XAttr
argument_list|>
name|xattrs
init|=
name|Lists
operator|.
name|newArrayListWithCapacity
argument_list|(
name|stanzas
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|Stanza
name|a
range|:
name|stanzas
control|)
block|{
name|XAttr
operator|.
name|Builder
name|builder
init|=
operator|new
name|XAttr
operator|.
name|Builder
argument_list|()
decl_stmt|;
name|builder
operator|.
name|setNameSpace
argument_list|(
name|XAttr
operator|.
name|NameSpace
operator|.
name|valueOf
argument_list|(
name|a
operator|.
name|getValue
argument_list|(
literal|"NAMESPACE"
argument_list|)
argument_list|)
argument_list|)
operator|.
name|setName
argument_list|(
name|a
operator|.
name|getValue
argument_list|(
literal|"NAME"
argument_list|)
argument_list|)
expr_stmt|;
name|String
name|v
init|=
name|a
operator|.
name|getValueOrNull
argument_list|(
literal|"VALUE"
argument_list|)
decl_stmt|;
if|if
condition|(
name|v
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|builder
operator|.
name|setValue
argument_list|(
name|XAttrCodec
operator|.
name|decodeValue
argument_list|(
name|v
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|InvalidXmlException
argument_list|(
name|e
operator|.
name|toString
argument_list|()
argument_list|)
throw|;
block|}
block|}
name|xattrs
operator|.
name|add
argument_list|(
name|builder
operator|.
name|build
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|xattrs
return|;
block|}
block|}
end_class

end_unit

