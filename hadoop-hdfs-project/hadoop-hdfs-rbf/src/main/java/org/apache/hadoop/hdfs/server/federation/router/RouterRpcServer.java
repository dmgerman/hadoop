begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.hdfs.server.federation.router
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
package|;
end_package

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_HANDLER_COUNT_DEFAULT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_HANDLER_COUNT_KEY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_HANDLER_QUEUE_SIZE_DEFAULT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_HANDLER_QUEUE_SIZE_KEY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_READER_COUNT_DEFAULT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_READER_COUNT_KEY
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_READER_QUEUE_SIZE_DEFAULT
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|router
operator|.
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_READER_QUEUE_SIZE_KEY
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileNotFoundException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Array
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|InetSocketAddress
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|EnumSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|LinkedHashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|LinkedHashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
operator|.
name|Entry
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|crypto
operator|.
name|CryptoProtocolVersion
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|BatchedRemoteIterator
operator|.
name|BatchedEntries
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|CacheFlag
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|CommonConfigurationKeys
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|ContentSummary
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|CreateFlag
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FileAlreadyExistsException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|FsServerDefaults
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|Options
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|QuotaUsage
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|StorageType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|XAttr
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|XAttrSetFlag
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|AclEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|AclStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|FsAction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|permission
operator|.
name|FsPermission
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|AddBlockFlag
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|DFSUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|inotify
operator|.
name|EventBatchList
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|AddErasureCodingPolicyResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|BlockStoragePolicy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CacheDirectiveEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CacheDirectiveInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CachePoolEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CachePoolInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ClientProtocol
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|CorruptFileBlocks
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|DatanodeID
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|DatanodeInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|DirectoryListing
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ECBlockGroupStats
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|EncryptionZone
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ErasureCodingPolicy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ErasureCodingPolicyInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ExtendedBlock
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsConstants
operator|.
name|DatanodeReportType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsConstants
operator|.
name|ReencryptAction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsConstants
operator|.
name|RollingUpgradeAction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsConstants
operator|.
name|SafeModeAction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsFileStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|HdfsLocatedFileStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|LastBlockWithStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|LocatedBlock
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|LocatedBlocks
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|OpenFileEntry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|OpenFilesIterator
operator|.
name|OpenFilesType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ReplicatedBlockStats
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|RollingUpgradeInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|SnapshotDiffReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|SnapshotDiffReportListing
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|SnapshottableDirectoryStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|ZoneReencryptionStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|proto
operator|.
name|NamenodeProtocolProtos
operator|.
name|NamenodeProtocolService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocol
operator|.
name|proto
operator|.
name|ClientNamenodeProtocolProtos
operator|.
name|ClientNamenodeProtocol
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocolPB
operator|.
name|ClientNamenodeProtocolPB
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocolPB
operator|.
name|ClientNamenodeProtocolServerSideTranslatorPB
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocolPB
operator|.
name|NamenodeProtocolPB
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|protocolPB
operator|.
name|NamenodeProtocolServerSideTranslatorPB
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|security
operator|.
name|token
operator|.
name|block
operator|.
name|DataEncryptionKey
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|security
operator|.
name|token
operator|.
name|block
operator|.
name|ExportedBlockKeys
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|security
operator|.
name|token
operator|.
name|delegation
operator|.
name|DelegationTokenIdentifier
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|metrics
operator|.
name|FederationRPCMetrics
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|resolver
operator|.
name|ActiveNamenodeResolver
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|resolver
operator|.
name|FederationNamespaceInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|resolver
operator|.
name|FileSubclusterResolver
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|resolver
operator|.
name|MountTableResolver
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|resolver
operator|.
name|PathLocation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|resolver
operator|.
name|RemoteLocation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|federation
operator|.
name|store
operator|.
name|records
operator|.
name|MountTable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|CheckpointSignature
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|LeaseExpiredException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|NameNode
operator|.
name|OperationCategory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|NotReplicatedYetException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|namenode
operator|.
name|SafeModeException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|BlocksWithLocations
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|DatanodeStorageReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|NamenodeCommand
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|NamenodeProtocol
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|NamenodeRegistration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|NamespaceInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|hdfs
operator|.
name|server
operator|.
name|protocol
operator|.
name|RemoteEditLogManifest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|EnumSetWritable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|Text
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|ProtobufRpcEngine
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|RPC
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|RPC
operator|.
name|Server
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|RemoteException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|ipc
operator|.
name|StandbyException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|net
operator|.
name|NodeBase
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|AccessControlException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|UserGroupInformation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|token
operator|.
name|Token
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|service
operator|.
name|AbstractService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|ReflectionUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|LoggerFactory
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|annotations
operator|.
name|VisibleForTesting
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|protobuf
operator|.
name|BlockingService
import|;
end_import

begin_comment
comment|/**  * This class is responsible for handling all of the RPC calls to the It is  * created, started, and stopped by {@link Router}. It implements the  * {@link ClientProtocol} to mimic a  * {@link org.apache.hadoop.hdfs.server.namenode.NameNode NameNode} and proxies  * the requests to the active  * {@link org.apache.hadoop.hdfs.server.namenode.NameNode NameNode}.  */
end_comment

begin_class
DECL|class|RouterRpcServer
specifier|public
class|class
name|RouterRpcServer
extends|extends
name|AbstractService
implements|implements
name|ClientProtocol
implements|,
name|NamenodeProtocol
block|{
DECL|field|LOG
specifier|private
specifier|static
specifier|final
name|Logger
name|LOG
init|=
name|LoggerFactory
operator|.
name|getLogger
argument_list|(
name|RouterRpcServer
operator|.
name|class
argument_list|)
decl_stmt|;
comment|/** Configuration for the RPC server. */
DECL|field|conf
specifier|private
name|Configuration
name|conf
decl_stmt|;
comment|/** Router using this RPC server. */
DECL|field|router
specifier|private
specifier|final
name|Router
name|router
decl_stmt|;
comment|/** The RPC server that listens to requests from clients. */
DECL|field|rpcServer
specifier|private
specifier|final
name|Server
name|rpcServer
decl_stmt|;
comment|/** The address for this RPC server. */
DECL|field|rpcAddress
specifier|private
specifier|final
name|InetSocketAddress
name|rpcAddress
decl_stmt|;
comment|/** RPC clients to connect to the Namenodes. */
DECL|field|rpcClient
specifier|private
specifier|final
name|RouterRpcClient
name|rpcClient
decl_stmt|;
comment|/** Monitor metrics for the RPC calls. */
DECL|field|rpcMonitor
specifier|private
specifier|final
name|RouterRpcMonitor
name|rpcMonitor
decl_stmt|;
comment|/** Interface to identify the active NN for a nameservice or blockpool ID. */
DECL|field|namenodeResolver
specifier|private
specifier|final
name|ActiveNamenodeResolver
name|namenodeResolver
decl_stmt|;
comment|/** Interface to map global name space to HDFS subcluster name spaces. */
DECL|field|subclusterResolver
specifier|private
specifier|final
name|FileSubclusterResolver
name|subclusterResolver
decl_stmt|;
comment|/** Category of the operation that a thread is executing. */
DECL|field|opCategory
specifier|private
specifier|final
name|ThreadLocal
argument_list|<
name|OperationCategory
argument_list|>
name|opCategory
init|=
operator|new
name|ThreadLocal
argument_list|<>
argument_list|()
decl_stmt|;
comment|// Modules implementing groups of RPC calls
comment|/** Router Quota calls. */
DECL|field|quotaCall
specifier|private
specifier|final
name|Quota
name|quotaCall
decl_stmt|;
comment|/** NamenodeProtocol calls. */
DECL|field|nnProto
specifier|private
specifier|final
name|RouterNamenodeProtocol
name|nnProto
decl_stmt|;
comment|/** ClientProtocol calls. */
DECL|field|clientProto
specifier|private
specifier|final
name|RouterClientProtocol
name|clientProto
decl_stmt|;
comment|/**    * Construct a router RPC server.    *    * @param configuration HDFS Configuration.    * @param router A router using this RPC server.    * @param nnResolver The NN resolver instance to determine active NNs in HA.    * @param fileResolver File resolver to resolve file paths to subclusters.    * @throws IOException If the RPC server could not be created.    */
DECL|method|RouterRpcServer (Configuration configuration, Router router, ActiveNamenodeResolver nnResolver, FileSubclusterResolver fileResolver)
specifier|public
name|RouterRpcServer
parameter_list|(
name|Configuration
name|configuration
parameter_list|,
name|Router
name|router
parameter_list|,
name|ActiveNamenodeResolver
name|nnResolver
parameter_list|,
name|FileSubclusterResolver
name|fileResolver
parameter_list|)
throws|throws
name|IOException
block|{
name|super
argument_list|(
name|RouterRpcServer
operator|.
name|class
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|this
operator|.
name|conf
operator|=
name|configuration
expr_stmt|;
name|this
operator|.
name|router
operator|=
name|router
expr_stmt|;
name|this
operator|.
name|namenodeResolver
operator|=
name|nnResolver
expr_stmt|;
name|this
operator|.
name|subclusterResolver
operator|=
name|fileResolver
expr_stmt|;
comment|// RPC server settings
name|int
name|handlerCount
init|=
name|this
operator|.
name|conf
operator|.
name|getInt
argument_list|(
name|DFS_ROUTER_HANDLER_COUNT_KEY
argument_list|,
name|DFS_ROUTER_HANDLER_COUNT_DEFAULT
argument_list|)
decl_stmt|;
name|int
name|readerCount
init|=
name|this
operator|.
name|conf
operator|.
name|getInt
argument_list|(
name|DFS_ROUTER_READER_COUNT_KEY
argument_list|,
name|DFS_ROUTER_READER_COUNT_DEFAULT
argument_list|)
decl_stmt|;
name|int
name|handlerQueueSize
init|=
name|this
operator|.
name|conf
operator|.
name|getInt
argument_list|(
name|DFS_ROUTER_HANDLER_QUEUE_SIZE_KEY
argument_list|,
name|DFS_ROUTER_HANDLER_QUEUE_SIZE_DEFAULT
argument_list|)
decl_stmt|;
comment|// Override Hadoop Common IPC setting
name|int
name|readerQueueSize
init|=
name|this
operator|.
name|conf
operator|.
name|getInt
argument_list|(
name|DFS_ROUTER_READER_QUEUE_SIZE_KEY
argument_list|,
name|DFS_ROUTER_READER_QUEUE_SIZE_DEFAULT
argument_list|)
decl_stmt|;
name|this
operator|.
name|conf
operator|.
name|setInt
argument_list|(
name|CommonConfigurationKeys
operator|.
name|IPC_SERVER_RPC_READ_CONNECTION_QUEUE_SIZE_KEY
argument_list|,
name|readerQueueSize
argument_list|)
expr_stmt|;
name|RPC
operator|.
name|setProtocolEngine
argument_list|(
name|this
operator|.
name|conf
argument_list|,
name|ClientNamenodeProtocolPB
operator|.
name|class
argument_list|,
name|ProtobufRpcEngine
operator|.
name|class
argument_list|)
expr_stmt|;
name|ClientNamenodeProtocolServerSideTranslatorPB
name|clientProtocolServerTranslator
init|=
operator|new
name|ClientNamenodeProtocolServerSideTranslatorPB
argument_list|(
name|this
argument_list|)
decl_stmt|;
name|BlockingService
name|clientNNPbService
init|=
name|ClientNamenodeProtocol
operator|.
name|newReflectiveBlockingService
argument_list|(
name|clientProtocolServerTranslator
argument_list|)
decl_stmt|;
name|NamenodeProtocolServerSideTranslatorPB
name|namenodeProtocolXlator
init|=
operator|new
name|NamenodeProtocolServerSideTranslatorPB
argument_list|(
name|this
argument_list|)
decl_stmt|;
name|BlockingService
name|nnPbService
init|=
name|NamenodeProtocolService
operator|.
name|newReflectiveBlockingService
argument_list|(
name|namenodeProtocolXlator
argument_list|)
decl_stmt|;
name|InetSocketAddress
name|confRpcAddress
init|=
name|conf
operator|.
name|getSocketAddr
argument_list|(
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_RPC_BIND_HOST_KEY
argument_list|,
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_RPC_ADDRESS_KEY
argument_list|,
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_RPC_ADDRESS_DEFAULT
argument_list|,
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_RPC_PORT_DEFAULT
argument_list|)
decl_stmt|;
name|LOG
operator|.
name|info
argument_list|(
literal|"RPC server binding to {} with {} handlers for Router {}"
argument_list|,
name|confRpcAddress
argument_list|,
name|handlerCount
argument_list|,
name|this
operator|.
name|router
operator|.
name|getRouterId
argument_list|()
argument_list|)
expr_stmt|;
name|this
operator|.
name|rpcServer
operator|=
operator|new
name|RPC
operator|.
name|Builder
argument_list|(
name|this
operator|.
name|conf
argument_list|)
operator|.
name|setProtocol
argument_list|(
name|ClientNamenodeProtocolPB
operator|.
name|class
argument_list|)
operator|.
name|setInstance
argument_list|(
name|clientNNPbService
argument_list|)
operator|.
name|setBindAddress
argument_list|(
name|confRpcAddress
operator|.
name|getHostName
argument_list|()
argument_list|)
operator|.
name|setPort
argument_list|(
name|confRpcAddress
operator|.
name|getPort
argument_list|()
argument_list|)
operator|.
name|setNumHandlers
argument_list|(
name|handlerCount
argument_list|)
operator|.
name|setnumReaders
argument_list|(
name|readerCount
argument_list|)
operator|.
name|setQueueSizePerHandler
argument_list|(
name|handlerQueueSize
argument_list|)
operator|.
name|setVerbose
argument_list|(
literal|false
argument_list|)
operator|.
name|build
argument_list|()
expr_stmt|;
comment|// Add all the RPC protocols that the Router implements
name|DFSUtil
operator|.
name|addPBProtocol
argument_list|(
name|conf
argument_list|,
name|NamenodeProtocolPB
operator|.
name|class
argument_list|,
name|nnPbService
argument_list|,
name|this
operator|.
name|rpcServer
argument_list|)
expr_stmt|;
comment|// We don't want the server to log the full stack trace for some exceptions
name|this
operator|.
name|rpcServer
operator|.
name|addTerseExceptions
argument_list|(
name|RemoteException
operator|.
name|class
argument_list|,
name|SafeModeException
operator|.
name|class
argument_list|,
name|FileNotFoundException
operator|.
name|class
argument_list|,
name|FileAlreadyExistsException
operator|.
name|class
argument_list|,
name|AccessControlException
operator|.
name|class
argument_list|,
name|LeaseExpiredException
operator|.
name|class
argument_list|,
name|NotReplicatedYetException
operator|.
name|class
argument_list|,
name|IOException
operator|.
name|class
argument_list|)
expr_stmt|;
name|this
operator|.
name|rpcServer
operator|.
name|addSuppressedLoggingExceptions
argument_list|(
name|StandbyException
operator|.
name|class
argument_list|)
expr_stmt|;
comment|// The RPC-server port can be ephemeral... ensure we have the correct info
name|InetSocketAddress
name|listenAddress
init|=
name|this
operator|.
name|rpcServer
operator|.
name|getListenerAddress
argument_list|()
decl_stmt|;
name|this
operator|.
name|rpcAddress
operator|=
operator|new
name|InetSocketAddress
argument_list|(
name|confRpcAddress
operator|.
name|getHostName
argument_list|()
argument_list|,
name|listenAddress
operator|.
name|getPort
argument_list|()
argument_list|)
expr_stmt|;
comment|// Create metrics monitor
name|Class
argument_list|<
name|?
extends|extends
name|RouterRpcMonitor
argument_list|>
name|rpcMonitorClass
init|=
name|this
operator|.
name|conf
operator|.
name|getClass
argument_list|(
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_METRICS_CLASS
argument_list|,
name|RBFConfigKeys
operator|.
name|DFS_ROUTER_METRICS_CLASS_DEFAULT
argument_list|,
name|RouterRpcMonitor
operator|.
name|class
argument_list|)
decl_stmt|;
name|this
operator|.
name|rpcMonitor
operator|=
name|ReflectionUtils
operator|.
name|newInstance
argument_list|(
name|rpcMonitorClass
argument_list|,
name|conf
argument_list|)
expr_stmt|;
comment|// Create the client
name|this
operator|.
name|rpcClient
operator|=
operator|new
name|RouterRpcClient
argument_list|(
name|this
operator|.
name|conf
argument_list|,
name|this
operator|.
name|router
argument_list|,
name|this
operator|.
name|namenodeResolver
argument_list|,
name|this
operator|.
name|rpcMonitor
argument_list|)
expr_stmt|;
comment|// Initialize modules
name|this
operator|.
name|quotaCall
operator|=
operator|new
name|Quota
argument_list|(
name|this
operator|.
name|router
argument_list|,
name|this
argument_list|)
expr_stmt|;
name|this
operator|.
name|nnProto
operator|=
operator|new
name|RouterNamenodeProtocol
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|this
operator|.
name|clientProto
operator|=
operator|new
name|RouterClientProtocol
argument_list|(
name|conf
argument_list|,
name|this
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|serviceInit (Configuration configuration)
specifier|protected
name|void
name|serviceInit
parameter_list|(
name|Configuration
name|configuration
parameter_list|)
throws|throws
name|Exception
block|{
name|this
operator|.
name|conf
operator|=
name|configuration
expr_stmt|;
if|if
condition|(
name|this
operator|.
name|rpcMonitor
operator|==
literal|null
condition|)
block|{
name|LOG
operator|.
name|error
argument_list|(
literal|"Cannot instantiate Router RPC metrics class"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|this
operator|.
name|rpcMonitor
operator|.
name|init
argument_list|(
name|this
operator|.
name|conf
argument_list|,
name|this
argument_list|,
name|this
operator|.
name|router
operator|.
name|getStateStore
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|super
operator|.
name|serviceInit
argument_list|(
name|configuration
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|serviceStart ()
specifier|protected
name|void
name|serviceStart
parameter_list|()
throws|throws
name|Exception
block|{
if|if
condition|(
name|this
operator|.
name|rpcServer
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|rpcServer
operator|.
name|start
argument_list|()
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
literal|"Router RPC up at: {}"
argument_list|,
name|this
operator|.
name|getRpcAddress
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|super
operator|.
name|serviceStart
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|serviceStop ()
specifier|protected
name|void
name|serviceStop
parameter_list|()
throws|throws
name|Exception
block|{
if|if
condition|(
name|this
operator|.
name|rpcServer
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|rpcServer
operator|.
name|stop
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|rpcMonitor
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|rpcMonitor
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
name|super
operator|.
name|serviceStop
argument_list|()
expr_stmt|;
block|}
comment|/**    * Get the RPC client to the Namenode.    *    * @return RPC clients to the Namenodes.    */
DECL|method|getRPCClient ()
specifier|public
name|RouterRpcClient
name|getRPCClient
parameter_list|()
block|{
return|return
name|rpcClient
return|;
block|}
comment|/**    * Get the subcluster resolver.    *    * @return Subcluster resolver.    */
DECL|method|getSubclusterResolver ()
specifier|public
name|FileSubclusterResolver
name|getSubclusterResolver
parameter_list|()
block|{
return|return
name|subclusterResolver
return|;
block|}
comment|/**    * Get the active namenode resolver    */
DECL|method|getNamenodeResolver ()
specifier|public
name|ActiveNamenodeResolver
name|getNamenodeResolver
parameter_list|()
block|{
return|return
name|namenodeResolver
return|;
block|}
comment|/**    * Get the RPC monitor and metrics.    *    * @return RPC monitor and metrics.    */
DECL|method|getRPCMonitor ()
specifier|public
name|RouterRpcMonitor
name|getRPCMonitor
parameter_list|()
block|{
return|return
name|rpcMonitor
return|;
block|}
comment|/**    * Allow access to the client RPC server for testing.    *    * @return The RPC server.    */
annotation|@
name|VisibleForTesting
DECL|method|getServer ()
specifier|public
name|Server
name|getServer
parameter_list|()
block|{
return|return
name|rpcServer
return|;
block|}
comment|/**    * Get the RPC address of the service.    *    * @return RPC service address.    */
DECL|method|getRpcAddress ()
specifier|public
name|InetSocketAddress
name|getRpcAddress
parameter_list|()
block|{
return|return
name|rpcAddress
return|;
block|}
comment|/**    * Check if the Router is in safe mode. We should only see READ, WRITE, and    * UNCHECKED. It includes a default handler when we haven't implemented an    * operation. If not supported, it always throws an exception reporting the    * operation.    *    * @param op Category of the operation to check.    * @param supported If the operation is supported or not. If not, it will    *                  throw an UnsupportedOperationException.    * @throws SafeModeException If the Router is in safe mode and cannot serve    *                           client requests.    * @throws UnsupportedOperationException If the operation is not supported.    */
DECL|method|checkOperation (OperationCategory op, boolean supported)
name|void
name|checkOperation
parameter_list|(
name|OperationCategory
name|op
parameter_list|,
name|boolean
name|supported
parameter_list|)
throws|throws
name|StandbyException
throws|,
name|UnsupportedOperationException
block|{
name|checkOperation
argument_list|(
name|op
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|supported
condition|)
block|{
if|if
condition|(
name|rpcMonitor
operator|!=
literal|null
condition|)
block|{
name|rpcMonitor
operator|.
name|proxyOpNotImplemented
argument_list|()
expr_stmt|;
block|}
name|String
name|methodName
init|=
name|getMethodName
argument_list|()
decl_stmt|;
throw|throw
operator|new
name|UnsupportedOperationException
argument_list|(
literal|"Operation \""
operator|+
name|methodName
operator|+
literal|"\" is not supported"
argument_list|)
throw|;
block|}
block|}
comment|/**    * Check if the Router is in safe mode. We should only see READ, WRITE, and    * UNCHECKED. This function should be called by all ClientProtocol functions.    *    * @param op Category of the operation to check.    * @throws SafeModeException If the Router is in safe mode and cannot serve    *                           client requests.    */
DECL|method|checkOperation (OperationCategory op)
name|void
name|checkOperation
parameter_list|(
name|OperationCategory
name|op
parameter_list|)
throws|throws
name|StandbyException
block|{
comment|// Log the function we are currently calling.
if|if
condition|(
name|rpcMonitor
operator|!=
literal|null
condition|)
block|{
name|rpcMonitor
operator|.
name|startOp
argument_list|()
expr_stmt|;
block|}
comment|// Log the function we are currently calling.
if|if
condition|(
name|LOG
operator|.
name|isDebugEnabled
argument_list|()
condition|)
block|{
name|String
name|methodName
init|=
name|getMethodName
argument_list|()
decl_stmt|;
name|LOG
operator|.
name|debug
argument_list|(
literal|"Proxying operation: {}"
argument_list|,
name|methodName
argument_list|)
expr_stmt|;
block|}
comment|// Store the category of the operation category for this thread
name|opCategory
operator|.
name|set
argument_list|(
name|op
argument_list|)
expr_stmt|;
comment|// We allow unchecked and read operations
if|if
condition|(
name|op
operator|==
name|OperationCategory
operator|.
name|UNCHECKED
operator|||
name|op
operator|==
name|OperationCategory
operator|.
name|READ
condition|)
block|{
return|return;
block|}
name|RouterSafemodeService
name|safemodeService
init|=
name|router
operator|.
name|getSafemodeService
argument_list|()
decl_stmt|;
if|if
condition|(
name|safemodeService
operator|!=
literal|null
operator|&&
name|safemodeService
operator|.
name|isInSafeMode
argument_list|()
condition|)
block|{
comment|// Throw standby exception, router is not available
if|if
condition|(
name|rpcMonitor
operator|!=
literal|null
condition|)
block|{
name|rpcMonitor
operator|.
name|routerFailureSafemode
argument_list|()
expr_stmt|;
block|}
throw|throw
operator|new
name|StandbyException
argument_list|(
literal|"Router "
operator|+
name|router
operator|.
name|getRouterId
argument_list|()
operator|+
literal|" is in safe mode and cannot handle "
operator|+
name|op
operator|+
literal|" requests"
argument_list|)
throw|;
block|}
block|}
comment|/**    * Get the name of the method that is calling this function.    *    * @return Name of the method calling this function.    */
DECL|method|getMethodName ()
specifier|static
name|String
name|getMethodName
parameter_list|()
block|{
specifier|final
name|StackTraceElement
index|[]
name|stack
init|=
name|Thread
operator|.
name|currentThread
argument_list|()
operator|.
name|getStackTrace
argument_list|()
decl_stmt|;
name|String
name|methodName
init|=
name|stack
index|[
literal|3
index|]
operator|.
name|getMethodName
argument_list|()
decl_stmt|;
return|return
name|methodName
return|;
block|}
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getDelegationToken (Text renewer)
specifier|public
name|Token
argument_list|<
name|DelegationTokenIdentifier
argument_list|>
name|getDelegationToken
parameter_list|(
name|Text
name|renewer
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getDelegationToken
argument_list|(
name|renewer
argument_list|)
return|;
block|}
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|renewDelegationToken (Token<DelegationTokenIdentifier> token)
specifier|public
name|long
name|renewDelegationToken
parameter_list|(
name|Token
argument_list|<
name|DelegationTokenIdentifier
argument_list|>
name|token
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|renewDelegationToken
argument_list|(
name|token
argument_list|)
return|;
block|}
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|cancelDelegationToken (Token<DelegationTokenIdentifier> token)
specifier|public
name|void
name|cancelDelegationToken
parameter_list|(
name|Token
argument_list|<
name|DelegationTokenIdentifier
argument_list|>
name|token
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|cancelDelegationToken
argument_list|(
name|token
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getBlockLocations (String src, final long offset, final long length)
specifier|public
name|LocatedBlocks
name|getBlockLocations
parameter_list|(
name|String
name|src
parameter_list|,
specifier|final
name|long
name|offset
parameter_list|,
specifier|final
name|long
name|length
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getBlockLocations
argument_list|(
name|src
argument_list|,
name|offset
argument_list|,
name|length
argument_list|)
return|;
block|}
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getServerDefaults ()
specifier|public
name|FsServerDefaults
name|getServerDefaults
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getServerDefaults
argument_list|()
return|;
block|}
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|create (String src, FsPermission masked, String clientName, EnumSetWritable<CreateFlag> flag, boolean createParent, short replication, long blockSize, CryptoProtocolVersion[] supportedVersions, String ecPolicyName)
specifier|public
name|HdfsFileStatus
name|create
parameter_list|(
name|String
name|src
parameter_list|,
name|FsPermission
name|masked
parameter_list|,
name|String
name|clientName
parameter_list|,
name|EnumSetWritable
argument_list|<
name|CreateFlag
argument_list|>
name|flag
parameter_list|,
name|boolean
name|createParent
parameter_list|,
name|short
name|replication
parameter_list|,
name|long
name|blockSize
parameter_list|,
name|CryptoProtocolVersion
index|[]
name|supportedVersions
parameter_list|,
name|String
name|ecPolicyName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|create
argument_list|(
name|src
argument_list|,
name|masked
argument_list|,
name|clientName
argument_list|,
name|flag
argument_list|,
name|createParent
argument_list|,
name|replication
argument_list|,
name|blockSize
argument_list|,
name|supportedVersions
argument_list|,
name|ecPolicyName
argument_list|)
return|;
block|}
comment|/**    * Get the location to create a file. It checks if the file already existed    * in one of the locations.    *    * @param src Path of the file to check.    * @return The remote location for this file.    * @throws IOException If the file has no creation location.    */
DECL|method|getCreateLocation (final String src)
name|RemoteLocation
name|getCreateLocation
parameter_list|(
specifier|final
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
specifier|final
name|List
argument_list|<
name|RemoteLocation
argument_list|>
name|locations
init|=
name|getLocationsForPath
argument_list|(
name|src
argument_list|,
literal|true
argument_list|)
decl_stmt|;
if|if
condition|(
name|locations
operator|==
literal|null
operator|||
name|locations
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Cannot get locations to create "
operator|+
name|src
argument_list|)
throw|;
block|}
name|RemoteLocation
name|createLocation
init|=
name|locations
operator|.
name|get
argument_list|(
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|locations
operator|.
name|size
argument_list|()
operator|>
literal|1
condition|)
block|{
try|try
block|{
comment|// Check if this file already exists in other subclusters
name|LocatedBlocks
name|existingLocation
init|=
name|getBlockLocations
argument_list|(
name|src
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
name|existingLocation
operator|!=
literal|null
condition|)
block|{
comment|// Forward to the existing location and let the NN handle the error
name|LocatedBlock
name|existingLocationLastLocatedBlock
init|=
name|existingLocation
operator|.
name|getLastLocatedBlock
argument_list|()
decl_stmt|;
if|if
condition|(
name|existingLocationLastLocatedBlock
operator|==
literal|null
condition|)
block|{
comment|// The block has no blocks yet, check for the meta data
for|for
control|(
name|RemoteLocation
name|location
range|:
name|locations
control|)
block|{
name|RemoteMethod
name|method
init|=
operator|new
name|RemoteMethod
argument_list|(
literal|"getFileInfo"
argument_list|,
operator|new
name|Class
argument_list|<
name|?
argument_list|>
index|[]
block|{
name|String
operator|.
name|class
block|}
operator|,
operator|new
name|RemoteParam
argument_list|()
block|)
empty_stmt|;
if|if
condition|(
name|rpcClient
operator|.
name|invokeSingle
argument_list|(
name|location
argument_list|,
name|method
argument_list|)
operator|!=
literal|null
condition|)
block|{
name|createLocation
operator|=
name|location
expr_stmt|;
break|break;
block|}
block|}
block|}
else|else
block|{
name|ExtendedBlock
name|existingLocationLastBlock
init|=
name|existingLocationLastLocatedBlock
operator|.
name|getBlock
argument_list|()
decl_stmt|;
name|String
name|blockPoolId
init|=
name|existingLocationLastBlock
operator|.
name|getBlockPoolId
argument_list|()
decl_stmt|;
name|createLocation
operator|=
name|getLocationForPath
argument_list|(
name|src
argument_list|,
literal|true
argument_list|,
name|blockPoolId
argument_list|)
expr_stmt|;
block|}
block|}
block|}
catch|catch
parameter_list|(
name|FileNotFoundException
name|fne
parameter_list|)
block|{
comment|// Ignore if the file is not found
block|}
block|}
return|return
name|createLocation
return|;
block|}
end_class

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|append (String src, final String clientName, final EnumSetWritable<CreateFlag> flag)
specifier|public
name|LastBlockWithStatus
name|append
parameter_list|(
name|String
name|src
parameter_list|,
specifier|final
name|String
name|clientName
parameter_list|,
specifier|final
name|EnumSetWritable
argument_list|<
name|CreateFlag
argument_list|>
name|flag
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|append
argument_list|(
name|src
argument_list|,
name|clientName
argument_list|,
name|flag
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|recoverLease (String src, String clientName)
specifier|public
name|boolean
name|recoverLease
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|clientName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|recoverLease
argument_list|(
name|src
argument_list|,
name|clientName
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setReplication (String src, short replication)
specifier|public
name|boolean
name|setReplication
parameter_list|(
name|String
name|src
parameter_list|,
name|short
name|replication
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|setReplication
argument_list|(
name|src
argument_list|,
name|replication
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setStoragePolicy (String src, String policyName)
specifier|public
name|void
name|setStoragePolicy
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|policyName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setStoragePolicy
argument_list|(
name|src
argument_list|,
name|policyName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getStoragePolicies ()
specifier|public
name|BlockStoragePolicy
index|[]
name|getStoragePolicies
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getStoragePolicies
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setPermission (String src, FsPermission permissions)
specifier|public
name|void
name|setPermission
parameter_list|(
name|String
name|src
parameter_list|,
name|FsPermission
name|permissions
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setPermission
argument_list|(
name|src
argument_list|,
name|permissions
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setOwner (String src, String username, String groupname)
specifier|public
name|void
name|setOwner
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|username
parameter_list|,
name|String
name|groupname
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setOwner
argument_list|(
name|src
argument_list|,
name|username
argument_list|,
name|groupname
argument_list|)
expr_stmt|;
block|}
end_function

begin_comment
comment|/**    * Excluded and favored nodes are not verified and will be ignored by    * placement policy if they are not in the same nameservice as the file.    */
end_comment

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|addBlock (String src, String clientName, ExtendedBlock previous, DatanodeInfo[] excludedNodes, long fileId, String[] favoredNodes, EnumSet<AddBlockFlag> addBlockFlags)
specifier|public
name|LocatedBlock
name|addBlock
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|clientName
parameter_list|,
name|ExtendedBlock
name|previous
parameter_list|,
name|DatanodeInfo
index|[]
name|excludedNodes
parameter_list|,
name|long
name|fileId
parameter_list|,
name|String
index|[]
name|favoredNodes
parameter_list|,
name|EnumSet
argument_list|<
name|AddBlockFlag
argument_list|>
name|addBlockFlags
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|addBlock
argument_list|(
name|src
argument_list|,
name|clientName
argument_list|,
name|previous
argument_list|,
name|excludedNodes
argument_list|,
name|fileId
argument_list|,
name|favoredNodes
argument_list|,
name|addBlockFlags
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    * Excluded nodes are not verified and will be ignored by placement if they    * are not in the same nameservice as the file.    */
end_comment

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getAdditionalDatanode (final String src, final long fileId, final ExtendedBlock blk, final DatanodeInfo[] existings, final String[] existingStorageIDs, final DatanodeInfo[] excludes, final int numAdditionalNodes, final String clientName)
specifier|public
name|LocatedBlock
name|getAdditionalDatanode
parameter_list|(
specifier|final
name|String
name|src
parameter_list|,
specifier|final
name|long
name|fileId
parameter_list|,
specifier|final
name|ExtendedBlock
name|blk
parameter_list|,
specifier|final
name|DatanodeInfo
index|[]
name|existings
parameter_list|,
specifier|final
name|String
index|[]
name|existingStorageIDs
parameter_list|,
specifier|final
name|DatanodeInfo
index|[]
name|excludes
parameter_list|,
specifier|final
name|int
name|numAdditionalNodes
parameter_list|,
specifier|final
name|String
name|clientName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getAdditionalDatanode
argument_list|(
name|src
argument_list|,
name|fileId
argument_list|,
name|blk
argument_list|,
name|existings
argument_list|,
name|existingStorageIDs
argument_list|,
name|excludes
argument_list|,
name|numAdditionalNodes
argument_list|,
name|clientName
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|abandonBlock (ExtendedBlock b, long fileId, String src, String holder)
specifier|public
name|void
name|abandonBlock
parameter_list|(
name|ExtendedBlock
name|b
parameter_list|,
name|long
name|fileId
parameter_list|,
name|String
name|src
parameter_list|,
name|String
name|holder
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|abandonBlock
argument_list|(
name|b
argument_list|,
name|fileId
argument_list|,
name|src
argument_list|,
name|holder
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|complete (String src, String clientName, ExtendedBlock last, long fileId)
specifier|public
name|boolean
name|complete
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|clientName
parameter_list|,
name|ExtendedBlock
name|last
parameter_list|,
name|long
name|fileId
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|complete
argument_list|(
name|src
argument_list|,
name|clientName
argument_list|,
name|last
argument_list|,
name|fileId
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|updateBlockForPipeline ( ExtendedBlock block, String clientName)
specifier|public
name|LocatedBlock
name|updateBlockForPipeline
parameter_list|(
name|ExtendedBlock
name|block
parameter_list|,
name|String
name|clientName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|updateBlockForPipeline
argument_list|(
name|block
argument_list|,
name|clientName
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    * Datanode are not verified to be in the same nameservice as the old block.    * TODO This may require validation.    */
end_comment

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|updatePipeline (String clientName, ExtendedBlock oldBlock, ExtendedBlock newBlock, DatanodeID[] newNodes, String[] newStorageIDs)
specifier|public
name|void
name|updatePipeline
parameter_list|(
name|String
name|clientName
parameter_list|,
name|ExtendedBlock
name|oldBlock
parameter_list|,
name|ExtendedBlock
name|newBlock
parameter_list|,
name|DatanodeID
index|[]
name|newNodes
parameter_list|,
name|String
index|[]
name|newStorageIDs
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|updatePipeline
argument_list|(
name|clientName
argument_list|,
name|oldBlock
argument_list|,
name|newBlock
argument_list|,
name|newNodes
argument_list|,
name|newStorageIDs
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getPreferredBlockSize (String src)
specifier|public
name|long
name|getPreferredBlockSize
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getPreferredBlockSize
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Deprecated
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|rename (final String src, final String dst)
specifier|public
name|boolean
name|rename
parameter_list|(
specifier|final
name|String
name|src
parameter_list|,
specifier|final
name|String
name|dst
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|rename
argument_list|(
name|src
argument_list|,
name|dst
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|rename2 (final String src, final String dst, final Options.Rename... options)
specifier|public
name|void
name|rename2
parameter_list|(
specifier|final
name|String
name|src
parameter_list|,
specifier|final
name|String
name|dst
parameter_list|,
specifier|final
name|Options
operator|.
name|Rename
modifier|...
name|options
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|rename2
argument_list|(
name|src
argument_list|,
name|dst
argument_list|,
name|options
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|concat (String trg, String[] src)
specifier|public
name|void
name|concat
parameter_list|(
name|String
name|trg
parameter_list|,
name|String
index|[]
name|src
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|concat
argument_list|(
name|trg
argument_list|,
name|src
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|truncate (String src, long newLength, String clientName)
specifier|public
name|boolean
name|truncate
parameter_list|(
name|String
name|src
parameter_list|,
name|long
name|newLength
parameter_list|,
name|String
name|clientName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|truncate
argument_list|(
name|src
argument_list|,
name|newLength
argument_list|,
name|clientName
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|delete (String src, boolean recursive)
specifier|public
name|boolean
name|delete
parameter_list|(
name|String
name|src
parameter_list|,
name|boolean
name|recursive
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|delete
argument_list|(
name|src
argument_list|,
name|recursive
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|mkdirs (String src, FsPermission masked, boolean createParent)
specifier|public
name|boolean
name|mkdirs
parameter_list|(
name|String
name|src
parameter_list|,
name|FsPermission
name|masked
parameter_list|,
name|boolean
name|createParent
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|mkdirs
argument_list|(
name|src
argument_list|,
name|masked
argument_list|,
name|createParent
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|renewLease (String clientName)
specifier|public
name|void
name|renewLease
parameter_list|(
name|String
name|clientName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|renewLease
argument_list|(
name|clientName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getListing (String src, byte[] startAfter, boolean needLocation)
specifier|public
name|DirectoryListing
name|getListing
parameter_list|(
name|String
name|src
parameter_list|,
name|byte
index|[]
name|startAfter
parameter_list|,
name|boolean
name|needLocation
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getListing
argument_list|(
name|src
argument_list|,
name|startAfter
argument_list|,
name|needLocation
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getFileInfo (String src)
specifier|public
name|HdfsFileStatus
name|getFileInfo
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getFileInfo
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|isFileClosed (String src)
specifier|public
name|boolean
name|isFileClosed
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|isFileClosed
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getFileLinkInfo (String src)
specifier|public
name|HdfsFileStatus
name|getFileLinkInfo
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getFileLinkInfo
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getLocatedFileInfo (String src, boolean needBlockToken)
specifier|public
name|HdfsLocatedFileStatus
name|getLocatedFileInfo
parameter_list|(
name|String
name|src
parameter_list|,
name|boolean
name|needBlockToken
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getLocatedFileInfo
argument_list|(
name|src
argument_list|,
name|needBlockToken
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getStats ()
specifier|public
name|long
index|[]
name|getStats
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getStats
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getDatanodeReport (DatanodeReportType type)
specifier|public
name|DatanodeInfo
index|[]
name|getDatanodeReport
parameter_list|(
name|DatanodeReportType
name|type
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getDatanodeReport
argument_list|(
name|type
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    * Get the datanode report with a timeout.    * @param type Type of the datanode.    * @param requireResponse If we require all the namespaces to report.    * @param timeOutMs Time out for the reply in milliseconds.    * @return List of datanodes.    * @throws IOException If it cannot get the report.    */
end_comment

begin_function
DECL|method|getDatanodeReport ( DatanodeReportType type, boolean requireResponse, long timeOutMs)
specifier|public
name|DatanodeInfo
index|[]
name|getDatanodeReport
parameter_list|(
name|DatanodeReportType
name|type
parameter_list|,
name|boolean
name|requireResponse
parameter_list|,
name|long
name|timeOutMs
parameter_list|)
throws|throws
name|IOException
block|{
name|checkOperation
argument_list|(
name|OperationCategory
operator|.
name|UNCHECKED
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|String
argument_list|,
name|DatanodeInfo
argument_list|>
name|datanodesMap
init|=
operator|new
name|LinkedHashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|RemoteMethod
name|method
init|=
operator|new
name|RemoteMethod
argument_list|(
literal|"getDatanodeReport"
argument_list|,
operator|new
name|Class
argument_list|<
name|?
argument_list|>
index|[]
block|{
name|DatanodeReportType
operator|.
name|class
block|}
operator|,
name|type
block|)
function|;
end_function

begin_decl_stmt
name|Set
argument_list|<
name|FederationNamespaceInfo
argument_list|>
name|nss
init|=
name|namenodeResolver
operator|.
name|getNamespaces
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Map
argument_list|<
name|FederationNamespaceInfo
argument_list|,
name|DatanodeInfo
index|[]
argument_list|>
name|results
init|=
name|rpcClient
operator|.
name|invokeConcurrent
argument_list|(
name|nss
argument_list|,
name|method
argument_list|,
name|requireResponse
argument_list|,
literal|false
argument_list|,
name|timeOutMs
argument_list|,
name|DatanodeInfo
index|[]
operator|.
expr|class
argument_list|)
decl_stmt|;
end_decl_stmt

begin_for
for|for
control|(
name|Entry
argument_list|<
name|FederationNamespaceInfo
argument_list|,
name|DatanodeInfo
index|[]
argument_list|>
name|entry
range|:
name|results
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|FederationNamespaceInfo
name|ns
init|=
name|entry
operator|.
name|getKey
argument_list|()
decl_stmt|;
name|DatanodeInfo
index|[]
name|result
init|=
name|entry
operator|.
name|getValue
argument_list|()
decl_stmt|;
for|for
control|(
name|DatanodeInfo
name|node
range|:
name|result
control|)
block|{
name|String
name|nodeId
init|=
name|node
operator|.
name|getXferAddr
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|datanodesMap
operator|.
name|containsKey
argument_list|(
name|nodeId
argument_list|)
condition|)
block|{
comment|// Add the subcluster as a suffix to the network location
name|node
operator|.
name|setNetworkLocation
argument_list|(
name|NodeBase
operator|.
name|PATH_SEPARATOR_STR
operator|+
name|ns
operator|.
name|getNameserviceId
argument_list|()
operator|+
name|node
operator|.
name|getNetworkLocation
argument_list|()
argument_list|)
expr_stmt|;
name|datanodesMap
operator|.
name|put
argument_list|(
name|nodeId
argument_list|,
name|node
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|LOG
operator|.
name|debug
argument_list|(
literal|"{} is in multiple subclusters"
argument_list|,
name|nodeId
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_for

begin_comment
comment|// Map -> Array
end_comment

begin_decl_stmt
name|Collection
argument_list|<
name|DatanodeInfo
argument_list|>
name|datanodes
init|=
name|datanodesMap
operator|.
name|values
argument_list|()
decl_stmt|;
end_decl_stmt

begin_return
return|return
name|toArray
argument_list|(
name|datanodes
argument_list|,
name|DatanodeInfo
operator|.
name|class
argument_list|)
return|;
end_return

begin_function
unit|}    @
name|Override
comment|// ClientProtocol
DECL|method|getDatanodeStorageReport ( DatanodeReportType type)
specifier|public
name|DatanodeStorageReport
index|[]
name|getDatanodeStorageReport
parameter_list|(
name|DatanodeReportType
name|type
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getDatanodeStorageReport
argument_list|(
name|type
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    * Get the list of datanodes per subcluster.    *    * @param type Type of the datanodes to get.    * @return nsId -> datanode list.    * @throws IOException    */
end_comment

begin_function
DECL|method|getDatanodeStorageReportMap ( DatanodeReportType type)
specifier|public
name|Map
argument_list|<
name|String
argument_list|,
name|DatanodeStorageReport
index|[]
argument_list|>
name|getDatanodeStorageReportMap
parameter_list|(
name|DatanodeReportType
name|type
parameter_list|)
throws|throws
name|IOException
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|DatanodeStorageReport
index|[]
argument_list|>
name|ret
init|=
operator|new
name|LinkedHashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|RemoteMethod
name|method
init|=
operator|new
name|RemoteMethod
argument_list|(
literal|"getDatanodeStorageReport"
argument_list|,
operator|new
name|Class
argument_list|<
name|?
argument_list|>
index|[]
block|{
name|DatanodeReportType
operator|.
name|class
block|}
operator|,
name|type
block|)
function|;
end_function

begin_decl_stmt
name|Set
argument_list|<
name|FederationNamespaceInfo
argument_list|>
name|nss
init|=
name|namenodeResolver
operator|.
name|getNamespaces
argument_list|()
decl_stmt|;
end_decl_stmt

begin_decl_stmt
name|Map
argument_list|<
name|FederationNamespaceInfo
argument_list|,
name|DatanodeStorageReport
index|[]
argument_list|>
name|results
init|=
name|rpcClient
operator|.
name|invokeConcurrent
argument_list|(
name|nss
argument_list|,
name|method
argument_list|,
literal|true
argument_list|,
literal|false
argument_list|,
name|DatanodeStorageReport
index|[]
operator|.
expr|class
argument_list|)
decl_stmt|;
end_decl_stmt

begin_for
for|for
control|(
name|Entry
argument_list|<
name|FederationNamespaceInfo
argument_list|,
name|DatanodeStorageReport
index|[]
argument_list|>
name|entry
range|:
name|results
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|FederationNamespaceInfo
name|ns
init|=
name|entry
operator|.
name|getKey
argument_list|()
decl_stmt|;
name|String
name|nsId
init|=
name|ns
operator|.
name|getNameserviceId
argument_list|()
decl_stmt|;
name|DatanodeStorageReport
index|[]
name|result
init|=
name|entry
operator|.
name|getValue
argument_list|()
decl_stmt|;
name|ret
operator|.
name|put
argument_list|(
name|nsId
argument_list|,
name|result
argument_list|)
expr_stmt|;
block|}
end_for

begin_return
return|return
name|ret
return|;
end_return

begin_function
unit|}    @
name|Override
comment|// ClientProtocol
DECL|method|setSafeMode (SafeModeAction action, boolean isChecked)
specifier|public
name|boolean
name|setSafeMode
parameter_list|(
name|SafeModeAction
name|action
parameter_list|,
name|boolean
name|isChecked
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|setSafeMode
argument_list|(
name|action
argument_list|,
name|isChecked
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|restoreFailedStorage (String arg)
specifier|public
name|boolean
name|restoreFailedStorage
parameter_list|(
name|String
name|arg
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|restoreFailedStorage
argument_list|(
name|arg
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|saveNamespace (long timeWindow, long txGap)
specifier|public
name|boolean
name|saveNamespace
parameter_list|(
name|long
name|timeWindow
parameter_list|,
name|long
name|txGap
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|saveNamespace
argument_list|(
name|timeWindow
argument_list|,
name|txGap
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|rollEdits ()
specifier|public
name|long
name|rollEdits
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|rollEdits
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|refreshNodes ()
specifier|public
name|void
name|refreshNodes
parameter_list|()
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|refreshNodes
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|finalizeUpgrade ()
specifier|public
name|void
name|finalizeUpgrade
parameter_list|()
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|finalizeUpgrade
argument_list|()
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|upgradeStatus ()
specifier|public
name|boolean
name|upgradeStatus
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|upgradeStatus
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|rollingUpgrade (RollingUpgradeAction action)
specifier|public
name|RollingUpgradeInfo
name|rollingUpgrade
parameter_list|(
name|RollingUpgradeAction
name|action
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|rollingUpgrade
argument_list|(
name|action
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|metaSave (String filename)
specifier|public
name|void
name|metaSave
parameter_list|(
name|String
name|filename
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|metaSave
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listCorruptFileBlocks (String path, String cookie)
specifier|public
name|CorruptFileBlocks
name|listCorruptFileBlocks
parameter_list|(
name|String
name|path
parameter_list|,
name|String
name|cookie
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listCorruptFileBlocks
argument_list|(
name|path
argument_list|,
name|cookie
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setBalancerBandwidth (long bandwidth)
specifier|public
name|void
name|setBalancerBandwidth
parameter_list|(
name|long
name|bandwidth
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setBalancerBandwidth
argument_list|(
name|bandwidth
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getContentSummary (String path)
specifier|public
name|ContentSummary
name|getContentSummary
parameter_list|(
name|String
name|path
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getContentSummary
argument_list|(
name|path
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|fsync (String src, long fileId, String clientName, long lastBlockLength)
specifier|public
name|void
name|fsync
parameter_list|(
name|String
name|src
parameter_list|,
name|long
name|fileId
parameter_list|,
name|String
name|clientName
parameter_list|,
name|long
name|lastBlockLength
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|fsync
argument_list|(
name|src
argument_list|,
name|fileId
argument_list|,
name|clientName
argument_list|,
name|lastBlockLength
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setTimes (String src, long mtime, long atime)
specifier|public
name|void
name|setTimes
parameter_list|(
name|String
name|src
parameter_list|,
name|long
name|mtime
parameter_list|,
name|long
name|atime
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setTimes
argument_list|(
name|src
argument_list|,
name|mtime
argument_list|,
name|atime
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|createSymlink (String target, String link, FsPermission dirPerms, boolean createParent)
specifier|public
name|void
name|createSymlink
parameter_list|(
name|String
name|target
parameter_list|,
name|String
name|link
parameter_list|,
name|FsPermission
name|dirPerms
parameter_list|,
name|boolean
name|createParent
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|createSymlink
argument_list|(
name|target
argument_list|,
name|link
argument_list|,
name|dirPerms
argument_list|,
name|createParent
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getLinkTarget (String path)
specifier|public
name|String
name|getLinkTarget
parameter_list|(
name|String
name|path
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getLinkTarget
argument_list|(
name|path
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// Client Protocol
DECL|method|allowSnapshot (String snapshotRoot)
specifier|public
name|void
name|allowSnapshot
parameter_list|(
name|String
name|snapshotRoot
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|allowSnapshot
argument_list|(
name|snapshotRoot
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// Client Protocol
DECL|method|disallowSnapshot (String snapshot)
specifier|public
name|void
name|disallowSnapshot
parameter_list|(
name|String
name|snapshot
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|disallowSnapshot
argument_list|(
name|snapshot
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|renameSnapshot (String snapshotRoot, String snapshotOldName, String snapshotNewName)
specifier|public
name|void
name|renameSnapshot
parameter_list|(
name|String
name|snapshotRoot
parameter_list|,
name|String
name|snapshotOldName
parameter_list|,
name|String
name|snapshotNewName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|renameSnapshot
argument_list|(
name|snapshotRoot
argument_list|,
name|snapshotOldName
argument_list|,
name|snapshotNewName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// Client Protocol
DECL|method|getSnapshottableDirListing ()
specifier|public
name|SnapshottableDirectoryStatus
index|[]
name|getSnapshottableDirListing
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getSnapshottableDirListing
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getSnapshotDiffReport (String snapshotRoot, String earlierSnapshotName, String laterSnapshotName)
specifier|public
name|SnapshotDiffReport
name|getSnapshotDiffReport
parameter_list|(
name|String
name|snapshotRoot
parameter_list|,
name|String
name|earlierSnapshotName
parameter_list|,
name|String
name|laterSnapshotName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getSnapshotDiffReport
argument_list|(
name|snapshotRoot
argument_list|,
name|earlierSnapshotName
argument_list|,
name|laterSnapshotName
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getSnapshotDiffReportListing ( String snapshotRoot, String earlierSnapshotName, String laterSnapshotName, byte[] startPath, int index)
specifier|public
name|SnapshotDiffReportListing
name|getSnapshotDiffReportListing
parameter_list|(
name|String
name|snapshotRoot
parameter_list|,
name|String
name|earlierSnapshotName
parameter_list|,
name|String
name|laterSnapshotName
parameter_list|,
name|byte
index|[]
name|startPath
parameter_list|,
name|int
name|index
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getSnapshotDiffReportListing
argument_list|(
name|snapshotRoot
argument_list|,
name|earlierSnapshotName
argument_list|,
name|laterSnapshotName
argument_list|,
name|startPath
argument_list|,
name|index
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|addCacheDirective (CacheDirectiveInfo path, EnumSet<CacheFlag> flags)
specifier|public
name|long
name|addCacheDirective
parameter_list|(
name|CacheDirectiveInfo
name|path
parameter_list|,
name|EnumSet
argument_list|<
name|CacheFlag
argument_list|>
name|flags
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|addCacheDirective
argument_list|(
name|path
argument_list|,
name|flags
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|modifyCacheDirective (CacheDirectiveInfo directive, EnumSet<CacheFlag> flags)
specifier|public
name|void
name|modifyCacheDirective
parameter_list|(
name|CacheDirectiveInfo
name|directive
parameter_list|,
name|EnumSet
argument_list|<
name|CacheFlag
argument_list|>
name|flags
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|modifyCacheDirective
argument_list|(
name|directive
argument_list|,
name|flags
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|removeCacheDirective (long id)
specifier|public
name|void
name|removeCacheDirective
parameter_list|(
name|long
name|id
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeCacheDirective
argument_list|(
name|id
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listCacheDirectives ( long prevId, CacheDirectiveInfo filter)
specifier|public
name|BatchedEntries
argument_list|<
name|CacheDirectiveEntry
argument_list|>
name|listCacheDirectives
parameter_list|(
name|long
name|prevId
parameter_list|,
name|CacheDirectiveInfo
name|filter
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listCacheDirectives
argument_list|(
name|prevId
argument_list|,
name|filter
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|addCachePool (CachePoolInfo info)
specifier|public
name|void
name|addCachePool
parameter_list|(
name|CachePoolInfo
name|info
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|addCachePool
argument_list|(
name|info
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|modifyCachePool (CachePoolInfo info)
specifier|public
name|void
name|modifyCachePool
parameter_list|(
name|CachePoolInfo
name|info
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|modifyCachePool
argument_list|(
name|info
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|removeCachePool (String cachePoolName)
specifier|public
name|void
name|removeCachePool
parameter_list|(
name|String
name|cachePoolName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeCachePool
argument_list|(
name|cachePoolName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listCachePools (String prevKey)
specifier|public
name|BatchedEntries
argument_list|<
name|CachePoolEntry
argument_list|>
name|listCachePools
parameter_list|(
name|String
name|prevKey
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listCachePools
argument_list|(
name|prevKey
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|modifyAclEntries (String src, List<AclEntry> aclSpec)
specifier|public
name|void
name|modifyAclEntries
parameter_list|(
name|String
name|src
parameter_list|,
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclSpec
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|modifyAclEntries
argument_list|(
name|src
argument_list|,
name|aclSpec
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClienProtocol
DECL|method|removeAclEntries (String src, List<AclEntry> aclSpec)
specifier|public
name|void
name|removeAclEntries
parameter_list|(
name|String
name|src
parameter_list|,
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclSpec
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeAclEntries
argument_list|(
name|src
argument_list|,
name|aclSpec
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|removeDefaultAcl (String src)
specifier|public
name|void
name|removeDefaultAcl
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeDefaultAcl
argument_list|(
name|src
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|removeAcl (String src)
specifier|public
name|void
name|removeAcl
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeAcl
argument_list|(
name|src
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setAcl (String src, List<AclEntry> aclSpec)
specifier|public
name|void
name|setAcl
parameter_list|(
name|String
name|src
parameter_list|,
name|List
argument_list|<
name|AclEntry
argument_list|>
name|aclSpec
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setAcl
argument_list|(
name|src
argument_list|,
name|aclSpec
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getAclStatus (String src)
specifier|public
name|AclStatus
name|getAclStatus
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getAclStatus
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|createEncryptionZone (String src, String keyName)
specifier|public
name|void
name|createEncryptionZone
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|keyName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|createEncryptionZone
argument_list|(
name|src
argument_list|,
name|keyName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getEZForPath (String src)
specifier|public
name|EncryptionZone
name|getEZForPath
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getEZForPath
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listEncryptionZones (long prevId)
specifier|public
name|BatchedEntries
argument_list|<
name|EncryptionZone
argument_list|>
name|listEncryptionZones
parameter_list|(
name|long
name|prevId
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listEncryptionZones
argument_list|(
name|prevId
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|reencryptEncryptionZone (String zone, ReencryptAction action)
specifier|public
name|void
name|reencryptEncryptionZone
parameter_list|(
name|String
name|zone
parameter_list|,
name|ReencryptAction
name|action
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|reencryptEncryptionZone
argument_list|(
name|zone
argument_list|,
name|action
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listReencryptionStatus ( long prevId)
specifier|public
name|BatchedEntries
argument_list|<
name|ZoneReencryptionStatus
argument_list|>
name|listReencryptionStatus
parameter_list|(
name|long
name|prevId
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listReencryptionStatus
argument_list|(
name|prevId
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setXAttr (String src, XAttr xAttr, EnumSet<XAttrSetFlag> flag)
specifier|public
name|void
name|setXAttr
parameter_list|(
name|String
name|src
parameter_list|,
name|XAttr
name|xAttr
parameter_list|,
name|EnumSet
argument_list|<
name|XAttrSetFlag
argument_list|>
name|flag
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setXAttr
argument_list|(
name|src
argument_list|,
name|xAttr
argument_list|,
name|flag
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getXAttrs (String src, List<XAttr> xAttrs)
specifier|public
name|List
argument_list|<
name|XAttr
argument_list|>
name|getXAttrs
parameter_list|(
name|String
name|src
parameter_list|,
name|List
argument_list|<
name|XAttr
argument_list|>
name|xAttrs
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getXAttrs
argument_list|(
name|src
argument_list|,
name|xAttrs
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listXAttrs (String src)
specifier|public
name|List
argument_list|<
name|XAttr
argument_list|>
name|listXAttrs
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listXAttrs
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|removeXAttr (String src, XAttr xAttr)
specifier|public
name|void
name|removeXAttr
parameter_list|(
name|String
name|src
parameter_list|,
name|XAttr
name|xAttr
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeXAttr
argument_list|(
name|src
argument_list|,
name|xAttr
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|checkAccess (String path, FsAction mode)
specifier|public
name|void
name|checkAccess
parameter_list|(
name|String
name|path
parameter_list|,
name|FsAction
name|mode
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|checkAccess
argument_list|(
name|path
argument_list|,
name|mode
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getCurrentEditLogTxid ()
specifier|public
name|long
name|getCurrentEditLogTxid
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getCurrentEditLogTxid
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getEditsFromTxid (long txid)
specifier|public
name|EventBatchList
name|getEditsFromTxid
parameter_list|(
name|long
name|txid
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getEditsFromTxid
argument_list|(
name|txid
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getDataEncryptionKey ()
specifier|public
name|DataEncryptionKey
name|getDataEncryptionKey
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getDataEncryptionKey
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|createSnapshot (String snapshotRoot, String snapshotName)
specifier|public
name|String
name|createSnapshot
parameter_list|(
name|String
name|snapshotRoot
parameter_list|,
name|String
name|snapshotName
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|createSnapshot
argument_list|(
name|snapshotRoot
argument_list|,
name|snapshotName
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|deleteSnapshot (String snapshotRoot, String snapshotName)
specifier|public
name|void
name|deleteSnapshot
parameter_list|(
name|String
name|snapshotRoot
parameter_list|,
name|String
name|snapshotName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|deleteSnapshot
argument_list|(
name|snapshotRoot
argument_list|,
name|snapshotName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setQuota (String path, long namespaceQuota, long storagespaceQuota, StorageType type)
specifier|public
name|void
name|setQuota
parameter_list|(
name|String
name|path
parameter_list|,
name|long
name|namespaceQuota
parameter_list|,
name|long
name|storagespaceQuota
parameter_list|,
name|StorageType
name|type
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setQuota
argument_list|(
name|path
argument_list|,
name|namespaceQuota
argument_list|,
name|storagespaceQuota
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getQuotaUsage (String path)
specifier|public
name|QuotaUsage
name|getQuotaUsage
parameter_list|(
name|String
name|path
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getQuotaUsage
argument_list|(
name|path
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|reportBadBlocks (LocatedBlock[] blocks)
specifier|public
name|void
name|reportBadBlocks
parameter_list|(
name|LocatedBlock
index|[]
name|blocks
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|reportBadBlocks
argument_list|(
name|blocks
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|unsetStoragePolicy (String src)
specifier|public
name|void
name|unsetStoragePolicy
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|unsetStoragePolicy
argument_list|(
name|src
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getStoragePolicy (String path)
specifier|public
name|BlockStoragePolicy
name|getStoragePolicy
parameter_list|(
name|String
name|path
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getStoragePolicy
argument_list|(
name|path
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getErasureCodingPolicies ()
specifier|public
name|ErasureCodingPolicyInfo
index|[]
name|getErasureCodingPolicies
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getErasureCodingPolicies
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getErasureCodingCodecs ()
specifier|public
name|Map
argument_list|<
name|String
argument_list|,
name|String
argument_list|>
name|getErasureCodingCodecs
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getErasureCodingCodecs
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|addErasureCodingPolicies ( ErasureCodingPolicy[] policies)
specifier|public
name|AddErasureCodingPolicyResponse
index|[]
name|addErasureCodingPolicies
parameter_list|(
name|ErasureCodingPolicy
index|[]
name|policies
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|addErasureCodingPolicies
argument_list|(
name|policies
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|removeErasureCodingPolicy (String ecPolicyName)
specifier|public
name|void
name|removeErasureCodingPolicy
parameter_list|(
name|String
name|ecPolicyName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|removeErasureCodingPolicy
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|disableErasureCodingPolicy (String ecPolicyName)
specifier|public
name|void
name|disableErasureCodingPolicy
parameter_list|(
name|String
name|ecPolicyName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|disableErasureCodingPolicy
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|enableErasureCodingPolicy (String ecPolicyName)
specifier|public
name|void
name|enableErasureCodingPolicy
parameter_list|(
name|String
name|ecPolicyName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|enableErasureCodingPolicy
argument_list|(
name|ecPolicyName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getErasureCodingPolicy (String src)
specifier|public
name|ErasureCodingPolicy
name|getErasureCodingPolicy
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getErasureCodingPolicy
argument_list|(
name|src
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|setErasureCodingPolicy (String src, String ecPolicyName)
specifier|public
name|void
name|setErasureCodingPolicy
parameter_list|(
name|String
name|src
parameter_list|,
name|String
name|ecPolicyName
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|setErasureCodingPolicy
argument_list|(
name|src
argument_list|,
name|ecPolicyName
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|unsetErasureCodingPolicy (String src)
specifier|public
name|void
name|unsetErasureCodingPolicy
parameter_list|(
name|String
name|src
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|unsetErasureCodingPolicy
argument_list|(
name|src
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getECBlockGroupStats ()
specifier|public
name|ECBlockGroupStats
name|getECBlockGroupStats
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getECBlockGroupStats
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|getReplicatedBlockStats ()
specifier|public
name|ReplicatedBlockStats
name|getReplicatedBlockStats
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|getReplicatedBlockStats
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Deprecated
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listOpenFiles (long prevId)
specifier|public
name|BatchedEntries
argument_list|<
name|OpenFileEntry
argument_list|>
name|listOpenFiles
parameter_list|(
name|long
name|prevId
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listOpenFiles
argument_list|(
name|prevId
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|listOpenFiles (long prevId, EnumSet<OpenFilesType> openFilesTypes, String path)
specifier|public
name|BatchedEntries
argument_list|<
name|OpenFileEntry
argument_list|>
name|listOpenFiles
parameter_list|(
name|long
name|prevId
parameter_list|,
name|EnumSet
argument_list|<
name|OpenFilesType
argument_list|>
name|openFilesTypes
parameter_list|,
name|String
name|path
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|clientProto
operator|.
name|listOpenFiles
argument_list|(
name|prevId
argument_list|,
name|openFilesTypes
argument_list|,
name|path
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// ClientProtocol
DECL|method|satisfyStoragePolicy (String path)
specifier|public
name|void
name|satisfyStoragePolicy
parameter_list|(
name|String
name|path
parameter_list|)
throws|throws
name|IOException
block|{
name|clientProto
operator|.
name|satisfyStoragePolicy
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|getBlocks (DatanodeInfo datanode, long size, long minBlockSize)
specifier|public
name|BlocksWithLocations
name|getBlocks
parameter_list|(
name|DatanodeInfo
name|datanode
parameter_list|,
name|long
name|size
parameter_list|,
name|long
name|minBlockSize
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|getBlocks
argument_list|(
name|datanode
argument_list|,
name|size
argument_list|,
name|minBlockSize
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|getBlockKeys ()
specifier|public
name|ExportedBlockKeys
name|getBlockKeys
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|getBlockKeys
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|getTransactionID ()
specifier|public
name|long
name|getTransactionID
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|getTransactionID
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|getMostRecentCheckpointTxId ()
specifier|public
name|long
name|getMostRecentCheckpointTxId
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|getMostRecentCheckpointTxId
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|rollEditLog ()
specifier|public
name|CheckpointSignature
name|rollEditLog
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|rollEditLog
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|versionRequest ()
specifier|public
name|NamespaceInfo
name|versionRequest
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|versionRequest
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|errorReport (NamenodeRegistration registration, int errorCode, String msg)
specifier|public
name|void
name|errorReport
parameter_list|(
name|NamenodeRegistration
name|registration
parameter_list|,
name|int
name|errorCode
parameter_list|,
name|String
name|msg
parameter_list|)
throws|throws
name|IOException
block|{
name|nnProto
operator|.
name|errorReport
argument_list|(
name|registration
argument_list|,
name|errorCode
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|registerSubordinateNamenode ( NamenodeRegistration registration)
specifier|public
name|NamenodeRegistration
name|registerSubordinateNamenode
parameter_list|(
name|NamenodeRegistration
name|registration
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|registerSubordinateNamenode
argument_list|(
name|registration
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|startCheckpoint (NamenodeRegistration registration)
specifier|public
name|NamenodeCommand
name|startCheckpoint
parameter_list|(
name|NamenodeRegistration
name|registration
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|startCheckpoint
argument_list|(
name|registration
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|endCheckpoint (NamenodeRegistration registration, CheckpointSignature sig)
specifier|public
name|void
name|endCheckpoint
parameter_list|(
name|NamenodeRegistration
name|registration
parameter_list|,
name|CheckpointSignature
name|sig
parameter_list|)
throws|throws
name|IOException
block|{
name|nnProto
operator|.
name|endCheckpoint
argument_list|(
name|registration
argument_list|,
name|sig
argument_list|)
expr_stmt|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|getEditLogManifest (long sinceTxId)
specifier|public
name|RemoteEditLogManifest
name|getEditLogManifest
parameter_list|(
name|long
name|sinceTxId
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|getEditLogManifest
argument_list|(
name|sinceTxId
argument_list|)
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|isUpgradeFinalized ()
specifier|public
name|boolean
name|isUpgradeFinalized
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|isUpgradeFinalized
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|isRollingUpgrade ()
specifier|public
name|boolean
name|isRollingUpgrade
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|isRollingUpgrade
argument_list|()
return|;
block|}
end_function

begin_function
annotation|@
name|Override
comment|// NamenodeProtocol
DECL|method|getNextSPSPath ()
specifier|public
name|Long
name|getNextSPSPath
parameter_list|()
throws|throws
name|IOException
block|{
return|return
name|nnProto
operator|.
name|getNextSPSPath
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/**    * Locate the location with the matching block pool id.    *    * @param path Path to check.    * @param failIfLocked Fail the request if locked (top mount point).    * @param blockPoolId The block pool ID of the namespace to search for.    * @return Prioritized list of locations in the federated cluster.    * @throws IOException if the location for this path cannot be determined.    */
end_comment

begin_function
DECL|method|getLocationForPath ( String path, boolean failIfLocked, String blockPoolId)
specifier|protected
name|RemoteLocation
name|getLocationForPath
parameter_list|(
name|String
name|path
parameter_list|,
name|boolean
name|failIfLocked
parameter_list|,
name|String
name|blockPoolId
parameter_list|)
throws|throws
name|IOException
block|{
specifier|final
name|List
argument_list|<
name|RemoteLocation
argument_list|>
name|locations
init|=
name|getLocationsForPath
argument_list|(
name|path
argument_list|,
name|failIfLocked
argument_list|)
decl_stmt|;
name|String
name|nameserviceId
init|=
literal|null
decl_stmt|;
name|Set
argument_list|<
name|FederationNamespaceInfo
argument_list|>
name|namespaces
init|=
name|this
operator|.
name|namenodeResolver
operator|.
name|getNamespaces
argument_list|()
decl_stmt|;
for|for
control|(
name|FederationNamespaceInfo
name|namespace
range|:
name|namespaces
control|)
block|{
if|if
condition|(
name|namespace
operator|.
name|getBlockPoolId
argument_list|()
operator|.
name|equals
argument_list|(
name|blockPoolId
argument_list|)
condition|)
block|{
name|nameserviceId
operator|=
name|namespace
operator|.
name|getNameserviceId
argument_list|()
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|nameserviceId
operator|!=
literal|null
condition|)
block|{
for|for
control|(
name|RemoteLocation
name|location
range|:
name|locations
control|)
block|{
if|if
condition|(
name|location
operator|.
name|getNameserviceId
argument_list|()
operator|.
name|equals
argument_list|(
name|nameserviceId
argument_list|)
condition|)
block|{
return|return
name|location
return|;
block|}
block|}
block|}
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Cannot locate a nameservice for block pool "
operator|+
name|blockPoolId
argument_list|)
throw|;
block|}
end_function

begin_comment
comment|/**    * Get the possible locations of a path in the federated cluster.    * During the get operation, it will do the quota verification.    *    * @param path Path to check.    * @param failIfLocked Fail the request if locked (top mount point).    * @return Prioritized list of locations in the federated cluster.    * @throws IOException If the location for this path cannot be determined.    */
end_comment

begin_function
DECL|method|getLocationsForPath (String path, boolean failIfLocked)
specifier|protected
name|List
argument_list|<
name|RemoteLocation
argument_list|>
name|getLocationsForPath
parameter_list|(
name|String
name|path
parameter_list|,
name|boolean
name|failIfLocked
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|getLocationsForPath
argument_list|(
name|path
argument_list|,
name|failIfLocked
argument_list|,
literal|true
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    * Get the possible locations of a path in the federated cluster.    *    * @param path Path to check.    * @param failIfLocked Fail the request if locked (top mount point).    * @param needQuotaVerify If need to do the quota verification.    * @return Prioritized list of locations in the federated cluster.    * @throws IOException If the location for this path cannot be determined.    */
end_comment

begin_function
DECL|method|getLocationsForPath (String path, boolean failIfLocked, boolean needQuotaVerify)
specifier|protected
name|List
argument_list|<
name|RemoteLocation
argument_list|>
name|getLocationsForPath
parameter_list|(
name|String
name|path
parameter_list|,
name|boolean
name|failIfLocked
parameter_list|,
name|boolean
name|needQuotaVerify
parameter_list|)
throws|throws
name|IOException
block|{
try|try
block|{
comment|// Check the location for this path
specifier|final
name|PathLocation
name|location
init|=
name|this
operator|.
name|subclusterResolver
operator|.
name|getDestinationForPath
argument_list|(
name|path
argument_list|)
decl_stmt|;
if|if
condition|(
name|location
operator|==
literal|null
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Cannot find locations for "
operator|+
name|path
operator|+
literal|" in "
operator|+
name|this
operator|.
name|subclusterResolver
operator|.
name|getClass
argument_list|()
operator|.
name|getSimpleName
argument_list|()
argument_list|)
throw|;
block|}
comment|// We may block some write operations
if|if
condition|(
name|opCategory
operator|.
name|get
argument_list|()
operator|==
name|OperationCategory
operator|.
name|WRITE
condition|)
block|{
comment|// Check if the path is in a read only mount point
if|if
condition|(
name|isPathReadOnly
argument_list|(
name|path
argument_list|)
condition|)
block|{
if|if
condition|(
name|this
operator|.
name|rpcMonitor
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|rpcMonitor
operator|.
name|routerFailureReadOnly
argument_list|()
expr_stmt|;
block|}
throw|throw
operator|new
name|IOException
argument_list|(
name|path
operator|+
literal|" is in a read only mount point"
argument_list|)
throw|;
block|}
comment|// Check quota
if|if
condition|(
name|this
operator|.
name|router
operator|.
name|isQuotaEnabled
argument_list|()
operator|&&
name|needQuotaVerify
condition|)
block|{
name|RouterQuotaUsage
name|quotaUsage
init|=
name|this
operator|.
name|router
operator|.
name|getQuotaManager
argument_list|()
operator|.
name|getQuotaUsage
argument_list|(
name|path
argument_list|)
decl_stmt|;
if|if
condition|(
name|quotaUsage
operator|!=
literal|null
condition|)
block|{
name|quotaUsage
operator|.
name|verifyNamespaceQuota
argument_list|()
expr_stmt|;
name|quotaUsage
operator|.
name|verifyStoragespaceQuota
argument_list|()
expr_stmt|;
block|}
block|}
block|}
comment|// Filter disabled subclusters
name|Set
argument_list|<
name|String
argument_list|>
name|disabled
init|=
name|namenodeResolver
operator|.
name|getDisabledNamespaces
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|RemoteLocation
argument_list|>
name|locs
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
for|for
control|(
name|RemoteLocation
name|loc
range|:
name|location
operator|.
name|getDestinations
argument_list|()
control|)
block|{
if|if
condition|(
operator|!
name|disabled
operator|.
name|contains
argument_list|(
name|loc
operator|.
name|getNameserviceId
argument_list|()
argument_list|)
condition|)
block|{
name|locs
operator|.
name|add
argument_list|(
name|loc
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|locs
return|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
if|if
condition|(
name|this
operator|.
name|rpcMonitor
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|rpcMonitor
operator|.
name|routerFailureStateStore
argument_list|()
expr_stmt|;
block|}
throw|throw
name|ioe
throw|;
block|}
block|}
end_function

begin_comment
comment|/**    * Check if a path is in a read only mount point.    *    * @param path Path to check.    * @return If the path is in a read only mount point.    */
end_comment

begin_function
DECL|method|isPathReadOnly (final String path)
specifier|private
name|boolean
name|isPathReadOnly
parameter_list|(
specifier|final
name|String
name|path
parameter_list|)
block|{
if|if
condition|(
name|subclusterResolver
operator|instanceof
name|MountTableResolver
condition|)
block|{
try|try
block|{
name|MountTableResolver
name|mountTable
init|=
operator|(
name|MountTableResolver
operator|)
name|subclusterResolver
decl_stmt|;
name|MountTable
name|entry
init|=
name|mountTable
operator|.
name|getMountPoint
argument_list|(
name|path
argument_list|)
decl_stmt|;
if|if
condition|(
name|entry
operator|!=
literal|null
operator|&&
name|entry
operator|.
name|isReadOnly
argument_list|()
condition|)
block|{
return|return
literal|true
return|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|e
parameter_list|)
block|{
name|LOG
operator|.
name|error
argument_list|(
literal|"Cannot get mount point"
argument_list|,
name|e
argument_list|)
expr_stmt|;
block|}
block|}
return|return
literal|false
return|;
block|}
end_function

begin_comment
comment|/**    * Get the user that is invoking this operation.    *    * @return Remote user group information.    * @throws IOException If we cannot get the user information.    */
end_comment

begin_function
DECL|method|getRemoteUser ()
specifier|static
name|UserGroupInformation
name|getRemoteUser
parameter_list|()
throws|throws
name|IOException
block|{
name|UserGroupInformation
name|ugi
init|=
name|Server
operator|.
name|getRemoteUser
argument_list|()
decl_stmt|;
return|return
operator|(
name|ugi
operator|!=
literal|null
operator|)
condition|?
name|ugi
else|:
name|UserGroupInformation
operator|.
name|getCurrentUser
argument_list|()
return|;
block|}
end_function

begin_comment
comment|/**    * Merge the outputs from multiple namespaces.    * @param map Namespace -> Output array.    * @param clazz Class of the values.    * @return Array with the outputs.    */
end_comment

begin_function
DECL|method|merge ( Map<FederationNamespaceInfo, T[]> map, Class<T> clazz)
specifier|protected
specifier|static
parameter_list|<
name|T
parameter_list|>
name|T
index|[]
name|merge
parameter_list|(
name|Map
argument_list|<
name|FederationNamespaceInfo
argument_list|,
name|T
index|[]
argument_list|>
name|map
parameter_list|,
name|Class
argument_list|<
name|T
argument_list|>
name|clazz
parameter_list|)
block|{
comment|// Put all results into a set to avoid repeats
name|Set
argument_list|<
name|T
argument_list|>
name|ret
init|=
operator|new
name|LinkedHashSet
argument_list|<>
argument_list|()
decl_stmt|;
for|for
control|(
name|T
index|[]
name|values
range|:
name|map
operator|.
name|values
argument_list|()
control|)
block|{
for|for
control|(
name|T
name|val
range|:
name|values
control|)
block|{
name|ret
operator|.
name|add
argument_list|(
name|val
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|toArray
argument_list|(
name|ret
argument_list|,
name|clazz
argument_list|)
return|;
block|}
end_function

begin_comment
comment|/**    * Convert a set of values into an array.    * @param set Input set.    * @param clazz Class of the values.    * @return Array with the values in set.    */
end_comment

begin_function
DECL|method|toArray (Collection<T> set, Class<T> clazz)
specifier|private
specifier|static
parameter_list|<
name|T
parameter_list|>
name|T
index|[]
name|toArray
parameter_list|(
name|Collection
argument_list|<
name|T
argument_list|>
name|set
parameter_list|,
name|Class
argument_list|<
name|T
argument_list|>
name|clazz
parameter_list|)
block|{
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
name|T
index|[]
name|combinedData
init|=
operator|(
name|T
index|[]
operator|)
name|Array
operator|.
name|newInstance
argument_list|(
name|clazz
argument_list|,
name|set
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
name|combinedData
operator|=
name|set
operator|.
name|toArray
argument_list|(
name|combinedData
argument_list|)
expr_stmt|;
return|return
name|combinedData
return|;
block|}
end_function

begin_comment
comment|/**    * Get quota module implement.    */
end_comment

begin_function
DECL|method|getQuotaModule ()
specifier|public
name|Quota
name|getQuotaModule
parameter_list|()
block|{
return|return
name|this
operator|.
name|quotaCall
return|;
block|}
end_function

begin_comment
comment|/**    * Get RPC metrics info.    * @return The instance of FederationRPCMetrics.    */
end_comment

begin_function
DECL|method|getRPCMetrics ()
specifier|public
name|FederationRPCMetrics
name|getRPCMetrics
parameter_list|()
block|{
return|return
name|this
operator|.
name|rpcMonitor
operator|.
name|getRPCMetrics
argument_list|()
return|;
block|}
end_function

unit|}
end_unit

