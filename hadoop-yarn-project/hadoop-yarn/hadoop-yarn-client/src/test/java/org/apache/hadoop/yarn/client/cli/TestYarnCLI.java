begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.yarn.client.cli
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|client
operator|.
name|cli
package|;
end_package

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|Assert
operator|.
name|assertEquals
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Matchers
operator|.
name|any
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Matchers
operator|.
name|anyInt
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Matchers
operator|.
name|isA
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|doThrow
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|mock
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|spy
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|times
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|verify
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|mockito
operator|.
name|Mockito
operator|.
name|when
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|ByteArrayOutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|PrintStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|PrintWriter
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|EnumSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|cli
operator|.
name|Options
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|lang
operator|.
name|time
operator|.
name|DateFormatUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterNodeLabelsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNodesToLabelsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationAttemptId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationAttemptReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationResourceUsageReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ContainerId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ContainerReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ContainerState
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|FinalApplicationStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|NodeId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|NodeReport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|NodeState
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|Priority
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|QueueInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|QueueState
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|Resource
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|YarnApplicationAttemptState
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|YarnApplicationState
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|client
operator|.
name|api
operator|.
name|YarnClient
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|exceptions
operator|.
name|ApplicationNotFoundException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|nodelabels
operator|.
name|CommonNodeLabelsManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|util
operator|.
name|Records
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jboss
operator|.
name|netty
operator|.
name|logging
operator|.
name|CommonsLoggerFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Assert
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Before
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|mortbay
operator|.
name|log
operator|.
name|Log
import|;
end_import

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableSet
import|;
end_import

begin_class
DECL|class|TestYarnCLI
specifier|public
class|class
name|TestYarnCLI
block|{
DECL|field|client
specifier|private
name|YarnClient
name|client
init|=
name|mock
argument_list|(
name|YarnClient
operator|.
name|class
argument_list|)
decl_stmt|;
DECL|field|sysOutStream
name|ByteArrayOutputStream
name|sysOutStream
decl_stmt|;
DECL|field|sysOut
specifier|private
name|PrintStream
name|sysOut
decl_stmt|;
DECL|field|sysErrStream
name|ByteArrayOutputStream
name|sysErrStream
decl_stmt|;
DECL|field|sysErr
specifier|private
name|PrintStream
name|sysErr
decl_stmt|;
annotation|@
name|Before
DECL|method|setup ()
specifier|public
name|void
name|setup
parameter_list|()
block|{
name|sysOutStream
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|sysOut
operator|=
name|spy
argument_list|(
operator|new
name|PrintStream
argument_list|(
name|sysOutStream
argument_list|)
argument_list|)
expr_stmt|;
name|sysErrStream
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|sysErr
operator|=
name|spy
argument_list|(
operator|new
name|PrintStream
argument_list|(
name|sysErrStream
argument_list|)
argument_list|)
expr_stmt|;
name|System
operator|.
name|setOut
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetApplicationReport ()
specifier|public
name|void
name|testGetApplicationReport
parameter_list|()
throws|throws
name|Exception
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationResourceUsageReport
name|usageReport
init|=
name|i
operator|==
literal|0
condition|?
literal|null
else|:
name|ApplicationResourceUsageReport
operator|.
name|newInstance
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|123456
argument_list|,
literal|4567
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|"user"
argument_list|,
literal|"queue"
argument_list|,
literal|"appname"
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|,
literal|"diagnostics"
argument_list|,
literal|"url"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
name|usageReport
argument_list|,
literal|"N/A"
argument_list|,
literal|0.53789f
argument_list|,
literal|"YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationReport
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|newApplicationReport
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-status"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|,
name|times
argument_list|(
literal|1
operator|+
name|i
argument_list|)
argument_list|)
operator|.
name|getApplicationReport
argument_list|(
name|applicationId
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Application Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tApplication-Id : application_1234_0005"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tApplication-Name : appname"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tApplication-Type : YARN"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tUser : user"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tQueue : queue"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tStart-Time : 0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tFinish-Time : 0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tProgress : 53.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tState : FINISHED"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tFinal-State : SUCCEEDED"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tTracking-URL : N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tRPC Port : 124"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tAM Host : host"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tAggregate Resource Allocation : "
operator|+
operator|(
name|i
operator|==
literal|0
condition|?
literal|"N/A"
else|:
literal|"123456 MB-seconds, 4567 vcore-seconds"
operator|)
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tDiagnostics : diagnostics"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
operator|+
name|i
argument_list|)
argument_list|)
operator|.
name|println
argument_list|(
name|isA
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Test
DECL|method|testGetApplicationAttemptReport ()
specifier|public
name|void
name|testGetApplicationAttemptReport
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationAttemptId
name|attemptId
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ApplicationAttemptReport
name|attemptReport
init|=
name|ApplicationAttemptReport
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|"url"
argument_list|,
literal|"oUrl"
argument_list|,
literal|"diagnostics"
argument_list|,
name|YarnApplicationAttemptState
operator|.
name|FINISHED
argument_list|,
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationAttemptReport
argument_list|(
name|any
argument_list|(
name|ApplicationAttemptId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|attemptReport
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"applicationattempt"
block|,
literal|"-status"
block|,
name|attemptId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplicationAttemptReport
argument_list|(
name|attemptId
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Application Attempt Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tApplicationAttempt-Id : appattempt_1234_0005_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tState : FINISHED"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tAMContainer : container_1234_0005_01_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tTracking-URL : url"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tRPC Port : 124"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tAM Host : host"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tDiagnostics : diagnostics"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|println
argument_list|(
name|isA
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetApplicationAttempts ()
specifier|public
name|void
name|testGetApplicationAttempts
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationAttemptId
name|attemptId
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ApplicationAttemptId
name|attemptId1
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|ApplicationAttemptReport
name|attemptReport
init|=
name|ApplicationAttemptReport
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|"url"
argument_list|,
literal|"oUrl"
argument_list|,
literal|"diagnostics"
argument_list|,
name|YarnApplicationAttemptState
operator|.
name|FINISHED
argument_list|,
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|ApplicationAttemptReport
name|attemptReport1
init|=
name|ApplicationAttemptReport
operator|.
name|newInstance
argument_list|(
name|attemptId1
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|"url"
argument_list|,
literal|"oUrl"
argument_list|,
literal|"diagnostics"
argument_list|,
name|YarnApplicationAttemptState
operator|.
name|FINISHED
argument_list|,
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|attemptId1
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|ApplicationAttemptReport
argument_list|>
name|reports
init|=
operator|new
name|ArrayList
argument_list|<
name|ApplicationAttemptReport
argument_list|>
argument_list|()
decl_stmt|;
name|reports
operator|.
name|add
argument_list|(
name|attemptReport
argument_list|)
expr_stmt|;
name|reports
operator|.
name|add
argument_list|(
name|attemptReport1
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationAttempts
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|reports
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"applicationattempt"
block|,
literal|"-list"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplicationAttempts
argument_list|(
name|applicationId
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of application attempts :2"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         ApplicationAttempt-Id"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t               State"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t                    AM-Container-Id"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"   appattempt_1234_0005_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t            FINISHED"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      container_1234_0005_01_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                url"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"   appattempt_1234_0005_000002"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t            FINISHED"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      container_1234_0005_02_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                url"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetContainerReport ()
specifier|public
name|void
name|testGetContainerReport
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationAttemptId
name|attemptId
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ContainerId
name|containerId
init|=
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ContainerReport
name|container
init|=
name|ContainerReport
operator|.
name|newInstance
argument_list|(
name|containerId
argument_list|,
literal|null
argument_list|,
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host"
argument_list|,
literal|1234
argument_list|)
argument_list|,
name|Priority
operator|.
name|UNDEFINED
argument_list|,
literal|1234
argument_list|,
literal|5678
argument_list|,
literal|"diagnosticInfo"
argument_list|,
literal|"logURL"
argument_list|,
literal|0
argument_list|,
name|ContainerState
operator|.
name|COMPLETE
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getContainerReport
argument_list|(
name|any
argument_list|(
name|ContainerId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|container
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"container"
block|,
literal|"-status"
block|,
name|containerId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getContainerReport
argument_list|(
name|containerId
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Container Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tContainer-Id : container_1234_0005_01_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tStart-Time : 1234"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tFinish-Time : 5678"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tState : COMPLETE"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tLOG-URL : logURL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tHost : host:1234"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tDiagnostics : diagnosticInfo"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|println
argument_list|(
name|isA
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetContainers ()
specifier|public
name|void
name|testGetContainers
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationAttemptId
name|attemptId
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ContainerId
name|containerId
init|=
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|ContainerId
name|containerId1
init|=
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|attemptId
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|ContainerReport
name|container
init|=
name|ContainerReport
operator|.
name|newInstance
argument_list|(
name|containerId
argument_list|,
literal|null
argument_list|,
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host"
argument_list|,
literal|1234
argument_list|)
argument_list|,
name|Priority
operator|.
name|UNDEFINED
argument_list|,
literal|1234
argument_list|,
literal|5678
argument_list|,
literal|"diagnosticInfo"
argument_list|,
literal|"logURL"
argument_list|,
literal|0
argument_list|,
name|ContainerState
operator|.
name|COMPLETE
argument_list|)
decl_stmt|;
name|ContainerReport
name|container1
init|=
name|ContainerReport
operator|.
name|newInstance
argument_list|(
name|containerId1
argument_list|,
literal|null
argument_list|,
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host"
argument_list|,
literal|1234
argument_list|)
argument_list|,
name|Priority
operator|.
name|UNDEFINED
argument_list|,
literal|1234
argument_list|,
literal|5678
argument_list|,
literal|"diagnosticInfo"
argument_list|,
literal|"logURL"
argument_list|,
literal|0
argument_list|,
name|ContainerState
operator|.
name|COMPLETE
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|ContainerReport
argument_list|>
name|reports
init|=
operator|new
name|ArrayList
argument_list|<
name|ContainerReport
argument_list|>
argument_list|()
decl_stmt|;
name|reports
operator|.
name|add
argument_list|(
name|container
argument_list|)
expr_stmt|;
name|reports
operator|.
name|add
argument_list|(
name|container1
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getContainers
argument_list|(
name|any
argument_list|(
name|ApplicationAttemptId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|reports
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"container"
block|,
literal|"-list"
block|,
name|attemptId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getContainers
argument_list|(
name|attemptId
argument_list|)
expr_stmt|;
name|Log
operator|.
name|info
argument_list|(
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of containers :2"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                  Container-Id"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t          Start Time"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t         Finish Time"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t               State"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t                Host"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                            LOG-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|" container_1234_0005_01_000001"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t                1234"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t                5678"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t            COMPLETE"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t           host:1234"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                             logURL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|" container_1234_0005_01_000002"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t                1234"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t                5678"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t            COMPLETE"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t           host:1234"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                             logURL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetApplicationReportException ()
specifier|public
name|void
name|testGetApplicationReportException
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationReport
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenThrow
argument_list|(
operator|new
name|ApplicationNotFoundException
argument_list|(
literal|"History file for application"
operator|+
name|applicationId
operator|+
literal|" is not found"
argument_list|)
argument_list|)
expr_stmt|;
try|try
block|{
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-status"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|fail
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
name|Assert
operator|.
name|assertTrue
argument_list|(
name|ex
operator|instanceof
name|ApplicationNotFoundException
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"History file for application"
operator|+
name|applicationId
operator|+
literal|" is not found"
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Test
DECL|method|testGetApplications ()
specifier|public
name|void
name|testGetApplications
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|"user"
argument_list|,
literal|"queue"
argument_list|,
literal|"appname"
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|RUNNING
argument_list|,
literal|"diagnostics"
argument_list|,
literal|"url"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.53789f
argument_list|,
literal|"YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|List
argument_list|<
name|ApplicationReport
argument_list|>
name|applicationReports
init|=
operator|new
name|ArrayList
argument_list|<
name|ApplicationReport
argument_list|>
argument_list|()
decl_stmt|;
name|applicationReports
operator|.
name|add
argument_list|(
name|newApplicationReport
argument_list|)
expr_stmt|;
name|ApplicationId
name|applicationId2
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|6
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport2
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId2
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId2
argument_list|,
literal|2
argument_list|)
argument_list|,
literal|"user2"
argument_list|,
literal|"queue2"
argument_list|,
literal|"appname2"
argument_list|,
literal|"host2"
argument_list|,
literal|125
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|,
literal|"diagnostics2"
argument_list|,
literal|"url2"
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.63789f
argument_list|,
literal|"NON-YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|applicationReports
operator|.
name|add
argument_list|(
name|newApplicationReport2
argument_list|)
expr_stmt|;
name|ApplicationId
name|applicationId3
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|7
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport3
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId3
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId3
argument_list|,
literal|3
argument_list|)
argument_list|,
literal|"user3"
argument_list|,
literal|"queue3"
argument_list|,
literal|"appname3"
argument_list|,
literal|"host3"
argument_list|,
literal|126
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|RUNNING
argument_list|,
literal|"diagnostics3"
argument_list|,
literal|"url3"
argument_list|,
literal|3
argument_list|,
literal|3
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.73789f
argument_list|,
literal|"MAPREDUCE"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|applicationReports
operator|.
name|add
argument_list|(
name|newApplicationReport3
argument_list|)
expr_stmt|;
name|ApplicationId
name|applicationId4
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|8
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport4
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId4
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId4
argument_list|,
literal|4
argument_list|)
argument_list|,
literal|"user4"
argument_list|,
literal|"queue4"
argument_list|,
literal|"appname4"
argument_list|,
literal|"host4"
argument_list|,
literal|127
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|FAILED
argument_list|,
literal|"diagnostics4"
argument_list|,
literal|"url4"
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.83789f
argument_list|,
literal|"NON-MAPREDUCE"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|applicationReports
operator|.
name|add
argument_list|(
name|newApplicationReport4
argument_list|)
expr_stmt|;
name|ApplicationId
name|applicationId5
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|9
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport5
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId5
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId5
argument_list|,
literal|5
argument_list|)
argument_list|,
literal|"user5"
argument_list|,
literal|"queue5"
argument_list|,
literal|"appname5"
argument_list|,
literal|"host5"
argument_list|,
literal|128
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|ACCEPTED
argument_list|,
literal|"diagnostics5"
argument_list|,
literal|"url5"
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|,
name|FinalApplicationStatus
operator|.
name|KILLED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.93789f
argument_list|,
literal|"HIVE"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|applicationReports
operator|.
name|add
argument_list|(
name|newApplicationReport5
argument_list|)
expr_stmt|;
name|ApplicationId
name|applicationId6
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport6
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId6
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId6
argument_list|,
literal|6
argument_list|)
argument_list|,
literal|"user6"
argument_list|,
literal|"queue6"
argument_list|,
literal|"appname6"
argument_list|,
literal|"host6"
argument_list|,
literal|129
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|SUBMITTED
argument_list|,
literal|"diagnostics6"
argument_list|,
literal|"url6"
argument_list|,
literal|6
argument_list|,
literal|6
argument_list|,
name|FinalApplicationStatus
operator|.
name|KILLED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.99789f
argument_list|,
literal|"PIG"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|applicationReports
operator|.
name|add
argument_list|(
name|newApplicationReport6
argument_list|)
expr_stmt|;
comment|// Test command yarn application -list
comment|// if the set appStates is empty, RUNNING state will be automatically added
comment|// to the appStates list
comment|// the output of yarn application -list should be the same as
comment|// equals to yarn application -list --appStates RUNNING,ACCEPTED,SUBMITTED
name|Set
argument_list|<
name|String
argument_list|>
name|appType1
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appState1
init|=
name|EnumSet
operator|.
name|noneOf
argument_list|(
name|YarnApplicationState
operator|.
name|class
argument_list|)
decl_stmt|;
name|appState1
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|RUNNING
argument_list|)
expr_stmt|;
name|appState1
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|ACCEPTED
argument_list|)
expr_stmt|;
name|appState1
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|SUBMITTED
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplications
argument_list|(
name|appType1
argument_list|,
name|appState1
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getApplicationReports
argument_list|(
name|applicationReports
argument_list|,
name|appType1
argument_list|,
name|appState1
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplications
argument_list|(
name|appType1
argument_list|,
name|appState1
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of applications (application-types: "
operator|+
name|appType1
operator|+
literal|" and states: "
operator|+
name|appState1
operator|+
literal|")"
operator|+
literal|":"
operator|+
literal|4
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                Application-Id\t    Application-Name"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t    Application-Type"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      User\t     Queue\t             State\t       "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"Final-State\t       Progress"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0005\t             "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname\t                YARN\t      user\t     "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue\t           RUNNING\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         53.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0007\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname3\t           MAPREDUCE\t     user3\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue3\t           RUNNING\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         73.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0009\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname5\t                HIVE\t     user5\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue5\t          ACCEPTED\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"KILLED\t         93.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0010\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname6\t                 PIG\t     user6\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue6\t         SUBMITTED\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"KILLED\t         99.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appsReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
comment|//Test command yarn application -list --appTypes apptype1,apptype2
comment|//the output should be the same as
comment|// yarn application -list --appTypes apptyp1, apptype2 --appStates
comment|// RUNNING,ACCEPTED,SUBMITTED
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|appType2
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|appType2
operator|.
name|add
argument_list|(
literal|"YARN"
argument_list|)
expr_stmt|;
name|appType2
operator|.
name|add
argument_list|(
literal|"NON-YARN"
argument_list|)
expr_stmt|;
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appState2
init|=
name|EnumSet
operator|.
name|noneOf
argument_list|(
name|YarnApplicationState
operator|.
name|class
argument_list|)
decl_stmt|;
name|appState2
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|RUNNING
argument_list|)
expr_stmt|;
name|appState2
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|ACCEPTED
argument_list|)
expr_stmt|;
name|appState2
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|SUBMITTED
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplications
argument_list|(
name|appType2
argument_list|,
name|appState2
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getApplicationReports
argument_list|(
name|applicationReports
argument_list|,
name|appType2
argument_list|,
name|appState2
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|,
literal|"-appTypes"
block|,
literal|"YARN, ,,  NON-YARN"
block|,
literal|"   ,, ,,"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplications
argument_list|(
name|appType2
argument_list|,
name|appState2
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of applications (application-types: "
operator|+
name|appType2
operator|+
literal|" and states: "
operator|+
name|appState2
operator|+
literal|")"
operator|+
literal|":"
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                Application-Id\t    Application-Name"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t    Application-Type"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      User\t     Queue\t             State\t       "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"Final-State\t       Progress"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0005\t             "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname\t                YARN\t      user\t     "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue\t           RUNNING\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         53.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|appsReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|2
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
comment|//Test command yarn application -list --appStates appState1,appState2
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|appType3
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appState3
init|=
name|EnumSet
operator|.
name|noneOf
argument_list|(
name|YarnApplicationState
operator|.
name|class
argument_list|)
decl_stmt|;
name|appState3
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|)
expr_stmt|;
name|appState3
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|FAILED
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplications
argument_list|(
name|appType3
argument_list|,
name|appState3
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getApplicationReports
argument_list|(
name|applicationReports
argument_list|,
name|appType3
argument_list|,
name|appState3
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|,
literal|"--appStates"
block|,
literal|"FINISHED ,, , FAILED"
block|,
literal|",,FINISHED"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplications
argument_list|(
name|appType3
argument_list|,
name|appState3
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of applications (application-types: "
operator|+
name|appType3
operator|+
literal|" and states: "
operator|+
name|appState3
operator|+
literal|")"
operator|+
literal|":"
operator|+
literal|2
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                Application-Id\t    Application-Name"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t    Application-Type"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      User\t     Queue\t             State\t       "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"Final-State\t       Progress"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0006\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname2\t            NON-YARN\t     user2\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue2\t          FINISHED\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         63.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0008\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname4\t       NON-MAPREDUCE\t     user4\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue4\t            FAILED\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         83.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|appsReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|3
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
comment|// Test command yarn application -list --appTypes apptype1,apptype2
comment|// --appStates appstate1,appstate2
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|appType4
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|appType4
operator|.
name|add
argument_list|(
literal|"YARN"
argument_list|)
expr_stmt|;
name|appType4
operator|.
name|add
argument_list|(
literal|"NON-YARN"
argument_list|)
expr_stmt|;
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appState4
init|=
name|EnumSet
operator|.
name|noneOf
argument_list|(
name|YarnApplicationState
operator|.
name|class
argument_list|)
decl_stmt|;
name|appState4
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|)
expr_stmt|;
name|appState4
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|FAILED
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplications
argument_list|(
name|appType4
argument_list|,
name|appState4
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getApplicationReports
argument_list|(
name|applicationReports
argument_list|,
name|appType4
argument_list|,
name|appState4
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|,
literal|"--appTypes"
block|,
literal|"YARN,NON-YARN"
block|,
literal|"--appStates"
block|,
literal|"FINISHED ,, , FAILED"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplications
argument_list|(
name|appType2
argument_list|,
name|appState2
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of applications (application-types: "
operator|+
name|appType4
operator|+
literal|" and states: "
operator|+
name|appState4
operator|+
literal|")"
operator|+
literal|":"
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                Application-Id\t    Application-Name"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t    Application-Type"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      User\t     Queue\t             State\t       "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"Final-State\t       Progress"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0006\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname2\t            NON-YARN\t     user2\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue2\t          FINISHED\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         63.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|appsReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|4
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
comment|//Test command yarn application -list --appStates with invalid appStates
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|,
literal|"--appStates"
block|,
literal|"FINISHED ,, , INVALID"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|-
literal|1
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"The application state  INVALID is invalid."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"The valid application state can be one of the following: "
argument_list|)
expr_stmt|;
name|StringBuilder
name|sb
init|=
operator|new
name|StringBuilder
argument_list|()
decl_stmt|;
name|sb
operator|.
name|append
argument_list|(
literal|"ALL,"
argument_list|)
expr_stmt|;
for|for
control|(
name|YarnApplicationState
name|state
range|:
name|YarnApplicationState
operator|.
name|values
argument_list|()
control|)
block|{
name|sb
operator|.
name|append
argument_list|(
name|state
operator|+
literal|","
argument_list|)
expr_stmt|;
block|}
name|String
name|output
init|=
name|sb
operator|.
name|toString
argument_list|()
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
name|output
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|output
operator|.
name|length
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|appsReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|4
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
comment|//Test command yarn application -list --appStates all
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|appType5
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appState5
init|=
name|EnumSet
operator|.
name|noneOf
argument_list|(
name|YarnApplicationState
operator|.
name|class
argument_list|)
decl_stmt|;
name|appState5
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplications
argument_list|(
name|appType5
argument_list|,
name|appState5
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getApplicationReports
argument_list|(
name|applicationReports
argument_list|,
name|appType5
argument_list|,
name|appState5
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|,
literal|"--appStates"
block|,
literal|"FINISHED ,, , ALL"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplications
argument_list|(
name|appType5
argument_list|,
name|appState5
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of applications (application-types: "
operator|+
name|appType5
operator|+
literal|" and states: "
operator|+
name|appState5
operator|+
literal|")"
operator|+
literal|":"
operator|+
literal|6
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                Application-Id\t    Application-Name"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t    Application-Type"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      User\t     Queue\t             State\t       "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"Final-State\t       Progress"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0005\t             "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname\t                YARN\t      user\t     "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue\t           RUNNING\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         53.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0006\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname2\t            NON-YARN\t     user2\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue2\t          FINISHED\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         63.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0007\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname3\t           MAPREDUCE\t     user3\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue3\t           RUNNING\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         73.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0008\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname4\t       NON-MAPREDUCE\t     user4\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue4\t            FAILED\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         83.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0009\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname5\t                HIVE\t     user5\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue5\t          ACCEPTED\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"KILLED\t         93.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0010\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname6\t                 PIG\t     user6\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue6\t         SUBMITTED\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"KILLED\t         99.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|appsReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|5
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
comment|// Test command yarn application user case insensitive
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|appType6
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|appType6
operator|.
name|add
argument_list|(
literal|"YARN"
argument_list|)
expr_stmt|;
name|appType6
operator|.
name|add
argument_list|(
literal|"NON-YARN"
argument_list|)
expr_stmt|;
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appState6
init|=
name|EnumSet
operator|.
name|noneOf
argument_list|(
name|YarnApplicationState
operator|.
name|class
argument_list|)
decl_stmt|;
name|appState6
operator|.
name|add
argument_list|(
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplications
argument_list|(
name|appType6
argument_list|,
name|appState6
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getApplicationReports
argument_list|(
name|applicationReports
argument_list|,
name|appType6
argument_list|,
name|appState6
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-list"
block|,
literal|"-appTypes"
block|,
literal|"YARN, ,,  NON-YARN"
block|,
literal|"--appStates"
block|,
literal|"finished"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getApplications
argument_list|(
name|appType6
argument_list|,
name|appState6
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total number of applications (application-types: "
operator|+
name|appType6
operator|+
literal|" and states: "
operator|+
name|appState6
operator|+
literal|")"
operator|+
literal|":"
operator|+
literal|1
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"                Application-Id\t    Application-Name"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t    Application-Type"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"\t      User\t     Queue\t             State\t       "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"Final-State\t       Progress"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                       Tracking-URL"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         application_1234_0006\t            "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"appname2\t            NON-YARN\t     user2\t    "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"queue2\t          FINISHED\t         "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"SUCCEEDED\t         63.79%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\t                                N/A"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|appsReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|appsReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|6
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|getApplicationReports ( List<ApplicationReport> applicationReports, Set<String> appTypes, EnumSet<YarnApplicationState> appStates, boolean allStates)
specifier|private
name|List
argument_list|<
name|ApplicationReport
argument_list|>
name|getApplicationReports
parameter_list|(
name|List
argument_list|<
name|ApplicationReport
argument_list|>
name|applicationReports
parameter_list|,
name|Set
argument_list|<
name|String
argument_list|>
name|appTypes
parameter_list|,
name|EnumSet
argument_list|<
name|YarnApplicationState
argument_list|>
name|appStates
parameter_list|,
name|boolean
name|allStates
parameter_list|)
block|{
name|List
argument_list|<
name|ApplicationReport
argument_list|>
name|appReports
init|=
operator|new
name|ArrayList
argument_list|<
name|ApplicationReport
argument_list|>
argument_list|()
decl_stmt|;
if|if
condition|(
name|allStates
condition|)
block|{
for|for
control|(
name|YarnApplicationState
name|state
range|:
name|YarnApplicationState
operator|.
name|values
argument_list|()
control|)
block|{
name|appStates
operator|.
name|add
argument_list|(
name|state
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|ApplicationReport
name|appReport
range|:
name|applicationReports
control|)
block|{
if|if
condition|(
name|appTypes
operator|!=
literal|null
operator|&&
operator|!
name|appTypes
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|appTypes
operator|.
name|contains
argument_list|(
name|appReport
operator|.
name|getApplicationType
argument_list|()
argument_list|)
condition|)
block|{
continue|continue;
block|}
block|}
if|if
condition|(
name|appStates
operator|!=
literal|null
operator|&&
operator|!
name|appStates
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|appStates
operator|.
name|contains
argument_list|(
name|appReport
operator|.
name|getYarnApplicationState
argument_list|()
argument_list|)
condition|)
block|{
continue|continue;
block|}
block|}
name|appReports
operator|.
name|add
argument_list|(
name|appReport
argument_list|)
expr_stmt|;
block|}
return|return
name|appReports
return|;
block|}
annotation|@
name|Test
argument_list|(
name|timeout
operator|=
literal|10000
argument_list|)
DECL|method|testAppsHelpCommand ()
specifier|public
name|void
name|testAppsHelpCommand
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationCLI
name|spyCli
init|=
name|spy
argument_list|(
name|cli
argument_list|)
decl_stmt|;
name|int
name|result
init|=
name|spyCli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-help"
block|}
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|result
operator|==
literal|0
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createApplicationCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-kill"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|,
literal|"args"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createApplicationCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|NodeId
name|nodeId
init|=
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host0"
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-status"
block|,
name|nodeId
operator|.
name|toString
argument_list|()
block|,
literal|"args"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createApplicationCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|timeout
operator|=
literal|10000
argument_list|)
DECL|method|testAppAttemptsHelpCommand ()
specifier|public
name|void
name|testAppAttemptsHelpCommand
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationCLI
name|spyCli
init|=
name|spy
argument_list|(
name|cli
argument_list|)
decl_stmt|;
name|int
name|result
init|=
name|spyCli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"applicationattempt"
block|,
literal|"-help"
block|}
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|result
operator|==
literal|0
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createApplicationAttemptCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"applicationattempt"
block|,
literal|"-list"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|,
literal|"args"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createApplicationAttemptCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|ApplicationAttemptId
name|appAttemptId
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|6
argument_list|)
decl_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"applicationattempt"
block|,
literal|"-status"
block|,
name|appAttemptId
operator|.
name|toString
argument_list|()
block|,
literal|"args"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createApplicationAttemptCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|timeout
operator|=
literal|10000
argument_list|)
DECL|method|testContainersHelpCommand ()
specifier|public
name|void
name|testContainersHelpCommand
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationCLI
name|spyCli
init|=
name|spy
argument_list|(
name|cli
argument_list|)
decl_stmt|;
name|int
name|result
init|=
name|spyCli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"container"
block|,
literal|"-help"
block|}
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertTrue
argument_list|(
name|result
operator|==
literal|0
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createContainerCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationAttemptId
name|appAttemptId
init|=
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|6
argument_list|)
decl_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"container"
block|,
literal|"-list"
block|,
name|appAttemptId
operator|.
name|toString
argument_list|()
block|,
literal|"args"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createContainerCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|ContainerId
name|containerId
init|=
name|ContainerId
operator|.
name|newInstance
argument_list|(
name|appAttemptId
argument_list|,
literal|7
argument_list|)
decl_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"container"
block|,
literal|"-status"
block|,
name|containerId
operator|.
name|toString
argument_list|()
block|,
literal|"args"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|spyCli
argument_list|)
operator|.
name|printUsage
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|Options
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createContainerCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
argument_list|(
name|timeout
operator|=
literal|5000
argument_list|)
DECL|method|testNodesHelpCommand ()
specifier|public
name|void
name|testNodesHelpCommand
parameter_list|()
throws|throws
name|Exception
block|{
name|NodeCLI
name|nodeCLI
init|=
operator|new
name|NodeCLI
argument_list|()
decl_stmt|;
name|nodeCLI
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|nodeCLI
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|nodeCLI
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
name|nodeCLI
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{}
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|createNodeCLIHelpMessage
argument_list|()
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testKillApplication ()
specifier|public
name|void
name|testKillApplication
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport2
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|"user"
argument_list|,
literal|"queue"
argument_list|,
literal|"appname"
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|,
literal|"diagnostics"
argument_list|,
literal|"url"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.53789f
argument_list|,
literal|"YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationReport
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|newApplicationReport2
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-kill"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|,
name|times
argument_list|(
literal|0
argument_list|)
argument_list|)
operator|.
name|killApplication
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Application "
operator|+
name|applicationId
operator|+
literal|" has already finished "
argument_list|)
expr_stmt|;
name|ApplicationReport
name|newApplicationReport
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|"user"
argument_list|,
literal|"queue"
argument_list|,
literal|"appname"
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|RUNNING
argument_list|,
literal|"diagnostics"
argument_list|,
literal|"url"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.53789f
argument_list|,
literal|"YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationReport
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|newApplicationReport
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-kill"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|killApplication
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Killing application application_1234_0005"
argument_list|)
expr_stmt|;
name|doThrow
argument_list|(
operator|new
name|ApplicationNotFoundException
argument_list|(
literal|"Application with id '"
operator|+
name|applicationId
operator|+
literal|"' doesn't exist in RM."
argument_list|)
argument_list|)
operator|.
name|when
argument_list|(
name|client
argument_list|)
operator|.
name|getApplicationReport
argument_list|(
name|applicationId
argument_list|)
expr_stmt|;
name|cli
operator|=
name|createAndGetAppCLI
argument_list|()
expr_stmt|;
try|try
block|{
name|int
name|exitCode
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-kill"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Application with id '"
operator|+
name|applicationId
operator|+
literal|"' doesn't exist in RM."
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertNotSame
argument_list|(
literal|"should return non-zero exit code."
argument_list|,
literal|0
argument_list|,
name|exitCode
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ApplicationNotFoundException
name|appEx
parameter_list|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"application -kill should not throw"
operator|+
literal|"ApplicationNotFoundException. "
operator|+
name|appEx
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|Assert
operator|.
name|fail
argument_list|(
literal|"Unexpected exception: "
operator|+
name|e
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Test
DECL|method|testMoveApplicationAcrossQueues ()
specifier|public
name|void
name|testMoveApplicationAcrossQueues
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|ApplicationId
name|applicationId
init|=
name|ApplicationId
operator|.
name|newInstance
argument_list|(
literal|1234
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|ApplicationReport
name|newApplicationReport2
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|"user"
argument_list|,
literal|"queue"
argument_list|,
literal|"appname"
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|FINISHED
argument_list|,
literal|"diagnostics"
argument_list|,
literal|"url"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.53789f
argument_list|,
literal|"YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationReport
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|newApplicationReport2
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-movetoqueue"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|,
literal|"-queue"
block|,
literal|"targetqueue"
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|,
name|times
argument_list|(
literal|0
argument_list|)
argument_list|)
operator|.
name|moveApplicationAcrossQueues
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Application "
operator|+
name|applicationId
operator|+
literal|" has already finished "
argument_list|)
expr_stmt|;
name|ApplicationReport
name|newApplicationReport
init|=
name|ApplicationReport
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
name|ApplicationAttemptId
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|,
literal|1
argument_list|)
argument_list|,
literal|"user"
argument_list|,
literal|"queue"
argument_list|,
literal|"appname"
argument_list|,
literal|"host"
argument_list|,
literal|124
argument_list|,
literal|null
argument_list|,
name|YarnApplicationState
operator|.
name|RUNNING
argument_list|,
literal|"diagnostics"
argument_list|,
literal|"url"
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|FinalApplicationStatus
operator|.
name|SUCCEEDED
argument_list|,
literal|null
argument_list|,
literal|"N/A"
argument_list|,
literal|0.53789f
argument_list|,
literal|"YARN"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getApplicationReport
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|newApplicationReport
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-movetoqueue"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|,
literal|"-queue"
block|,
literal|"targetqueue"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|moveApplicationAcrossQueues
argument_list|(
name|any
argument_list|(
name|ApplicationId
operator|.
name|class
argument_list|)
argument_list|,
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Moving application application_1234_0005 to queue targetqueue"
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Successfully completed move."
argument_list|)
expr_stmt|;
name|doThrow
argument_list|(
operator|new
name|ApplicationNotFoundException
argument_list|(
literal|"Application with id '"
operator|+
name|applicationId
operator|+
literal|"' doesn't exist in RM."
argument_list|)
argument_list|)
operator|.
name|when
argument_list|(
name|client
argument_list|)
operator|.
name|moveApplicationAcrossQueues
argument_list|(
name|applicationId
argument_list|,
literal|"targetqueue"
argument_list|)
expr_stmt|;
name|cli
operator|=
name|createAndGetAppCLI
argument_list|()
expr_stmt|;
try|try
block|{
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-movetoqueue"
block|,
name|applicationId
operator|.
name|toString
argument_list|()
block|,
literal|"-queue"
block|,
literal|"targetqueue"
block|}
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|fail
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|ex
parameter_list|)
block|{
name|Assert
operator|.
name|assertTrue
argument_list|(
name|ex
operator|instanceof
name|ApplicationNotFoundException
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
literal|"Application with id '"
operator|+
name|applicationId
operator|+
literal|"' doesn't exist in RM."
argument_list|,
name|ex
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Test
DECL|method|testListClusterNodes ()
specifier|public
name|void
name|testListClusterNodes
parameter_list|()
throws|throws
name|Exception
block|{
name|List
argument_list|<
name|NodeReport
argument_list|>
name|nodeReports
init|=
operator|new
name|ArrayList
argument_list|<
name|NodeReport
argument_list|>
argument_list|()
decl_stmt|;
name|nodeReports
operator|.
name|addAll
argument_list|(
name|getNodeReports
argument_list|(
literal|1
argument_list|,
name|NodeState
operator|.
name|NEW
argument_list|)
argument_list|)
expr_stmt|;
name|nodeReports
operator|.
name|addAll
argument_list|(
name|getNodeReports
argument_list|(
literal|2
argument_list|,
name|NodeState
operator|.
name|RUNNING
argument_list|)
argument_list|)
expr_stmt|;
name|nodeReports
operator|.
name|addAll
argument_list|(
name|getNodeReports
argument_list|(
literal|1
argument_list|,
name|NodeState
operator|.
name|UNHEALTHY
argument_list|)
argument_list|)
expr_stmt|;
name|nodeReports
operator|.
name|addAll
argument_list|(
name|getNodeReports
argument_list|(
literal|1
argument_list|,
name|NodeState
operator|.
name|DECOMMISSIONED
argument_list|)
argument_list|)
expr_stmt|;
name|nodeReports
operator|.
name|addAll
argument_list|(
name|getNodeReports
argument_list|(
literal|1
argument_list|,
name|NodeState
operator|.
name|REBOOTED
argument_list|)
argument_list|)
expr_stmt|;
name|nodeReports
operator|.
name|addAll
argument_list|(
name|getNodeReports
argument_list|(
literal|1
argument_list|,
name|NodeState
operator|.
name|LOST
argument_list|)
argument_list|)
expr_stmt|;
name|NodeCLI
name|cli
init|=
operator|new
name|NodeCLI
argument_list|()
decl_stmt|;
name|cli
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|Set
argument_list|<
name|NodeState
argument_list|>
name|nodeStates
init|=
operator|new
name|HashSet
argument_list|<
name|NodeState
argument_list|>
argument_list|()
decl_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|NEW
argument_list|)
expr_stmt|;
name|NodeState
index|[]
name|states
init|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"NEW"
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t            NEW\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|nodesReportStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|RUNNING
argument_list|)
expr_stmt|;
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"RUNNING"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:2"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t        RUNNING\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host1:0\t        RUNNING\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|2
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|3
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|UNHEALTHY
argument_list|)
expr_stmt|;
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"UNHEALTHY"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t      UNHEALTHY\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|4
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|DECOMMISSIONED
argument_list|)
expr_stmt|;
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"DECOMMISSIONED"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t DECOMMISSIONED\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|5
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|REBOOTED
argument_list|)
expr_stmt|;
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"REBOOTED"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t       REBOOTED\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|6
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|LOST
argument_list|)
expr_stmt|;
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"LOST"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t           LOST\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|7
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|NEW
argument_list|)
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|RUNNING
argument_list|)
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|LOST
argument_list|)
expr_stmt|;
name|nodeStates
operator|.
name|add
argument_list|(
name|NodeState
operator|.
name|REBOOTED
argument_list|)
expr_stmt|;
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--states"
block|,
literal|"NEW,RUNNING,LOST,REBOOTED"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:5"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t            NEW\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t        RUNNING\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host1:0\t        RUNNING\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t       REBOOTED\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t           LOST\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|8
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|nodeStates
operator|.
name|clear
argument_list|()
expr_stmt|;
for|for
control|(
name|NodeState
name|s
range|:
name|NodeState
operator|.
name|values
argument_list|()
control|)
block|{
name|nodeStates
operator|.
name|add
argument_list|(
name|s
argument_list|)
expr_stmt|;
block|}
name|states
operator|=
name|nodeStates
operator|.
name|toArray
argument_list|(
operator|new
name|NodeState
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
name|nodeReports
argument_list|,
name|nodeStates
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-list"
block|,
literal|"--all"
block|}
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|(
name|states
argument_list|)
expr_stmt|;
name|baos
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|pw
operator|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Total Nodes:7"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         Node-Id\t     Node-State\tNode-Http-Address\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Number-of-Running-Containers"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t            NEW\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t        RUNNING\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host1:0\t        RUNNING\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t      UNHEALTHY\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t DECOMMISSIONED\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t       REBOOTED\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|print
argument_list|(
literal|"         host0:0\t           LOST\t       host1:8888\t"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                           0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|nodesReportStr
operator|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|nodesReportStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|9
argument_list|)
argument_list|)
operator|.
name|write
argument_list|(
name|any
argument_list|(
name|byte
index|[]
operator|.
expr|class
argument_list|)
argument_list|,
name|anyInt
argument_list|()
argument_list|,
name|anyInt
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|getNodeReports ( List<NodeReport> nodeReports, Set<NodeState> nodeStates)
specifier|private
name|List
argument_list|<
name|NodeReport
argument_list|>
name|getNodeReports
parameter_list|(
name|List
argument_list|<
name|NodeReport
argument_list|>
name|nodeReports
parameter_list|,
name|Set
argument_list|<
name|NodeState
argument_list|>
name|nodeStates
parameter_list|)
block|{
name|List
argument_list|<
name|NodeReport
argument_list|>
name|reports
init|=
operator|new
name|ArrayList
argument_list|<
name|NodeReport
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|NodeReport
name|nodeReport
range|:
name|nodeReports
control|)
block|{
if|if
condition|(
name|nodeStates
operator|.
name|contains
argument_list|(
name|nodeReport
operator|.
name|getNodeState
argument_list|()
argument_list|)
condition|)
block|{
name|reports
operator|.
name|add
argument_list|(
name|nodeReport
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|reports
return|;
block|}
annotation|@
name|Test
DECL|method|testNodeStatus ()
specifier|public
name|void
name|testNodeStatus
parameter_list|()
throws|throws
name|Exception
block|{
name|NodeId
name|nodeId
init|=
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host0"
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|NodeCLI
name|cli
init|=
operator|new
name|NodeCLI
argument_list|()
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
literal|3
argument_list|,
name|NodeState
operator|.
name|RUNNING
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-status"
block|,
name|nodeId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|()
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Node Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-Id : host0:0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tRack : rack1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-State : RUNNING"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-Http-Address : host1:8888"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tLast-Health-Update : "
operator|+
name|DateFormatUtils
operator|.
name|format
argument_list|(
operator|new
name|Date
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|"E dd/MMM/yy hh:mm:ss:SSzz"
argument_list|)
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tHealth-Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tContainers : 0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tMemory-Used : 0MB"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tMemory-Capacity : 0MB"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCPU-Used : 0 vcores"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCPU-Capacity : 0 vcores"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-Labels : a,b,c,x,y,z"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|nodeStatusStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|println
argument_list|(
name|isA
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
name|nodeStatusStr
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testNodeStatusWithEmptyNodeLabels ()
specifier|public
name|void
name|testNodeStatusWithEmptyNodeLabels
parameter_list|()
throws|throws
name|Exception
block|{
name|NodeId
name|nodeId
init|=
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host0"
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|NodeCLI
name|cli
init|=
operator|new
name|NodeCLI
argument_list|()
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
literal|3
argument_list|,
name|NodeState
operator|.
name|RUNNING
argument_list|)
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-status"
block|,
name|nodeId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|()
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Node Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-Id : host0:0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tRack : rack1"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-State : RUNNING"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-Http-Address : host1:8888"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tLast-Health-Update : "
operator|+
name|DateFormatUtils
operator|.
name|format
argument_list|(
operator|new
name|Date
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|"E dd/MMM/yy hh:mm:ss:SSzz"
argument_list|)
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tHealth-Report : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tContainers : 0"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tMemory-Used : 0MB"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tMemory-Capacity : 0MB"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCPU-Used : 0 vcores"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCPU-Capacity : 0 vcores"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tNode-Labels : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|nodeStatusStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|println
argument_list|(
name|isA
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
name|nodeStatusStr
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAbsentNodeStatus ()
specifier|public
name|void
name|testAbsentNodeStatus
parameter_list|()
throws|throws
name|Exception
block|{
name|NodeId
name|nodeId
init|=
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"Absenthost0"
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|NodeCLI
name|cli
init|=
operator|new
name|NodeCLI
argument_list|()
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getNodeReports
argument_list|()
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|getNodeReports
argument_list|(
literal|0
argument_list|,
name|NodeState
operator|.
name|RUNNING
argument_list|)
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-status"
block|,
name|nodeId
operator|.
name|toString
argument_list|()
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getNodeReports
argument_list|()
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|,
name|times
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|println
argument_list|(
name|isA
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysOut
argument_list|)
operator|.
name|println
argument_list|(
literal|"Could not find the node report for node id : "
operator|+
name|nodeId
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAppCLIUsageInfo ()
specifier|public
name|void
name|testAppCLIUsageInfo
parameter_list|()
throws|throws
name|Exception
block|{
name|verifyUsageInfo
argument_list|(
operator|new
name|ApplicationCLI
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testNodeCLIUsageInfo ()
specifier|public
name|void
name|testNodeCLIUsageInfo
parameter_list|()
throws|throws
name|Exception
block|{
name|verifyUsageInfo
argument_list|(
operator|new
name|NodeCLI
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testMissingArguments ()
specifier|public
name|void
name|testMissingArguments
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationCLI
name|cli
init|=
name|createAndGetAppCLI
argument_list|()
decl_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|,
literal|"-status"
block|}
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|result
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Missing argument for options%n%1s"
argument_list|,
name|createApplicationCLIHelpMessage
argument_list|()
argument_list|)
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"applicationattempt"
block|,
literal|"-status"
block|}
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|result
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Missing argument for options%n%1s"
argument_list|,
name|createApplicationAttemptCLIHelpMessage
argument_list|()
argument_list|)
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|result
operator|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"container"
block|,
literal|"-status"
block|}
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|result
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Missing argument for options%n%1s"
argument_list|,
name|createContainerCLIHelpMessage
argument_list|()
argument_list|)
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sysOutStream
operator|.
name|reset
argument_list|()
expr_stmt|;
name|NodeCLI
name|nodeCLI
init|=
operator|new
name|NodeCLI
argument_list|()
decl_stmt|;
name|nodeCLI
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|nodeCLI
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|nodeCLI
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
name|result
operator|=
name|nodeCLI
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"-status"
block|}
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|result
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Missing argument for options%n%1s"
argument_list|,
name|createNodeCLIHelpMessage
argument_list|()
argument_list|)
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetQueueInfo ()
specifier|public
name|void
name|testGetQueueInfo
parameter_list|()
throws|throws
name|Exception
block|{
name|QueueCLI
name|cli
init|=
name|createAndGetQueueCLI
argument_list|()
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|nodeLabels
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|nodeLabels
operator|.
name|add
argument_list|(
literal|"GPU"
argument_list|)
expr_stmt|;
name|nodeLabels
operator|.
name|add
argument_list|(
literal|"JDK_7"
argument_list|)
expr_stmt|;
name|QueueInfo
name|queueInfo
init|=
name|QueueInfo
operator|.
name|newInstance
argument_list|(
literal|"queueA"
argument_list|,
literal|0.4f
argument_list|,
literal|0.8f
argument_list|,
literal|0.5f
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
name|QueueState
operator|.
name|RUNNING
argument_list|,
name|nodeLabels
argument_list|,
literal|"GPU"
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getQueueInfo
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|queueInfo
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"queue"
block|,
literal|"-status"
block|,
literal|"queueA"
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getQueueInfo
argument_list|(
literal|"queueA"
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Queue Information : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Queue Name : "
operator|+
literal|"queueA"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tState : "
operator|+
literal|"RUNNING"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCapacity : "
operator|+
literal|"40.0%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCurrent Capacity : "
operator|+
literal|"50.0%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tMaximum Capacity : "
operator|+
literal|"80.0%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tDefault Node Label expression : "
operator|+
literal|"GPU"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tAccessible Node Labels : "
operator|+
literal|"JDK_7,GPU"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|queueInfoStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|queueInfoStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testGetQueueInfoWithEmptyNodeLabel ()
specifier|public
name|void
name|testGetQueueInfoWithEmptyNodeLabel
parameter_list|()
throws|throws
name|Exception
block|{
name|QueueCLI
name|cli
init|=
name|createAndGetQueueCLI
argument_list|()
decl_stmt|;
name|QueueInfo
name|queueInfo
init|=
name|QueueInfo
operator|.
name|newInstance
argument_list|(
literal|"queueA"
argument_list|,
literal|0.4f
argument_list|,
literal|0.8f
argument_list|,
literal|0.5f
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
name|QueueState
operator|.
name|RUNNING
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|when
argument_list|(
name|client
operator|.
name|getQueueInfo
argument_list|(
name|any
argument_list|(
name|String
operator|.
name|class
argument_list|)
argument_list|)
argument_list|)
operator|.
name|thenReturn
argument_list|(
name|queueInfo
argument_list|)
expr_stmt|;
name|int
name|result
init|=
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"queue"
block|,
literal|"-status"
block|,
literal|"queueA"
block|}
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|result
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|client
argument_list|)
operator|.
name|getQueueInfo
argument_list|(
literal|"queueA"
argument_list|)
expr_stmt|;
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Queue Information : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"Queue Name : "
operator|+
literal|"queueA"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tState : "
operator|+
literal|"RUNNING"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCapacity : "
operator|+
literal|"40.0%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tCurrent Capacity : "
operator|+
literal|"50.0%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tMaximum Capacity : "
operator|+
literal|"80.0%"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tDefault Node Label expression : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"\tAccessible Node Labels : "
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|queueInfoStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
name|Assert
operator|.
name|assertEquals
argument_list|(
name|queueInfoStr
argument_list|,
name|sysOutStream
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|verifyUsageInfo (YarnCLI cli)
specifier|private
name|void
name|verifyUsageInfo
parameter_list|(
name|YarnCLI
name|cli
parameter_list|)
throws|throws
name|Exception
block|{
name|cli
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
name|cli
operator|.
name|run
argument_list|(
operator|new
name|String
index|[]
block|{
literal|"application"
block|}
argument_list|)
expr_stmt|;
name|verify
argument_list|(
name|sysErr
argument_list|)
operator|.
name|println
argument_list|(
literal|"Invalid Command Usage : "
argument_list|)
expr_stmt|;
block|}
DECL|method|getNodeReports (int noOfNodes, NodeState state)
specifier|private
name|List
argument_list|<
name|NodeReport
argument_list|>
name|getNodeReports
parameter_list|(
name|int
name|noOfNodes
parameter_list|,
name|NodeState
name|state
parameter_list|)
block|{
return|return
name|getNodeReports
argument_list|(
name|noOfNodes
argument_list|,
name|state
argument_list|,
literal|true
argument_list|)
return|;
block|}
DECL|method|getNodeReports (int noOfNodes, NodeState state, boolean emptyNodeLabel)
specifier|private
name|List
argument_list|<
name|NodeReport
argument_list|>
name|getNodeReports
parameter_list|(
name|int
name|noOfNodes
parameter_list|,
name|NodeState
name|state
parameter_list|,
name|boolean
name|emptyNodeLabel
parameter_list|)
block|{
name|List
argument_list|<
name|NodeReport
argument_list|>
name|nodeReports
init|=
operator|new
name|ArrayList
argument_list|<
name|NodeReport
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|noOfNodes
condition|;
name|i
operator|++
control|)
block|{
name|Set
argument_list|<
name|String
argument_list|>
name|nodeLabels
init|=
literal|null
decl_stmt|;
if|if
condition|(
operator|!
name|emptyNodeLabel
condition|)
block|{
comment|// node labels is not ordered, but when we output it, it should be
comment|// ordered
name|nodeLabels
operator|=
name|ImmutableSet
operator|.
name|of
argument_list|(
literal|"c"
argument_list|,
literal|"b"
argument_list|,
literal|"a"
argument_list|,
literal|"x"
argument_list|,
literal|"z"
argument_list|,
literal|"y"
argument_list|)
expr_stmt|;
block|}
name|NodeReport
name|nodeReport
init|=
name|NodeReport
operator|.
name|newInstance
argument_list|(
name|NodeId
operator|.
name|newInstance
argument_list|(
literal|"host"
operator|+
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
name|state
argument_list|,
literal|"host"
operator|+
literal|1
operator|+
literal|":8888"
argument_list|,
literal|"rack1"
argument_list|,
name|Records
operator|.
name|newRecord
argument_list|(
name|Resource
operator|.
name|class
argument_list|)
argument_list|,
name|Records
operator|.
name|newRecord
argument_list|(
name|Resource
operator|.
name|class
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|""
argument_list|,
literal|0
argument_list|,
name|nodeLabels
argument_list|)
decl_stmt|;
name|nodeReports
operator|.
name|add
argument_list|(
name|nodeReport
argument_list|)
expr_stmt|;
block|}
return|return
name|nodeReports
return|;
block|}
DECL|method|createAndGetAppCLI ()
specifier|private
name|ApplicationCLI
name|createAndGetAppCLI
parameter_list|()
block|{
name|ApplicationCLI
name|cli
init|=
operator|new
name|ApplicationCLI
argument_list|()
decl_stmt|;
name|cli
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
return|return
name|cli
return|;
block|}
DECL|method|createAndGetQueueCLI ()
specifier|private
name|QueueCLI
name|createAndGetQueueCLI
parameter_list|()
block|{
name|QueueCLI
name|cli
init|=
operator|new
name|QueueCLI
argument_list|()
decl_stmt|;
name|cli
operator|.
name|setClient
argument_list|(
name|client
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysOutPrintStream
argument_list|(
name|sysOut
argument_list|)
expr_stmt|;
name|cli
operator|.
name|setSysErrPrintStream
argument_list|(
name|sysErr
argument_list|)
expr_stmt|;
return|return
name|cli
return|;
block|}
DECL|method|createApplicationCLIHelpMessage ()
specifier|private
name|String
name|createApplicationCLIHelpMessage
parameter_list|()
throws|throws
name|IOException
block|{
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"usage: application"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -appStates<States>             Works with -list to filter applications"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 based on input comma-separated list of"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 application states. The valid application"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 state can be one of the following:"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 ALL,NEW,NEW_SAVING,SUBMITTED,ACCEPTED,RUN"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 NING,FINISHED,FAILED,KILLED"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -appTypes<Types>               Works with -list to filter applications"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 based on input comma-separated list of"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 application types."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -help                           Displays help for all commands."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -kill<Application ID>          Kills the application."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -list                           List applications. Supports optional use"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 of -appTypes to filter applications based"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 on application type, and -appStates to"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 filter applications based on application"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 state."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -movetoqueue<Application ID>   Moves the application to a different"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 queue."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -queue<Queue Name>             Works with the movetoqueue command to"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 specify which queue to move an"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                 application to."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -status<Application ID>        Prints the status of the application."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appsHelpStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
return|return
name|appsHelpStr
return|;
block|}
DECL|method|createApplicationAttemptCLIHelpMessage ()
specifier|private
name|String
name|createApplicationAttemptCLIHelpMessage
parameter_list|()
throws|throws
name|IOException
block|{
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"usage: applicationattempt"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -help                              Displays help for all commands."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -list<Application ID>             List application attempts for"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                    aplication."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -status<Application Attempt ID>   Prints the status of the application"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                                    attempt."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appsHelpStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
return|return
name|appsHelpStr
return|;
block|}
DECL|method|createContainerCLIHelpMessage ()
specifier|private
name|String
name|createContainerCLIHelpMessage
parameter_list|()
throws|throws
name|IOException
block|{
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"usage: container"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -help                            Displays help for all commands."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -list<Application Attempt ID>   List containers for application attempt."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -status<Container ID>           Prints the status of the container."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|appsHelpStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
return|return
name|appsHelpStr
return|;
block|}
DECL|method|createNodeCLIHelpMessage ()
specifier|private
name|String
name|createNodeCLIHelpMessage
parameter_list|()
throws|throws
name|IOException
block|{
name|ByteArrayOutputStream
name|baos
init|=
operator|new
name|ByteArrayOutputStream
argument_list|()
decl_stmt|;
name|PrintWriter
name|pw
init|=
operator|new
name|PrintWriter
argument_list|(
name|baos
argument_list|)
decl_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"usage: node"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -all               Works with -list to list all nodes."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -list              List all running nodes. Supports optional use of"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                    -states to filter nodes based on node state, all -all"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                    to list all nodes."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -states<States>   Works with -list to filter nodes based on input"
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|"                    comma-separated list of node states."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|println
argument_list|(
literal|" -status<NodeId>   Prints the status report of the node."
argument_list|)
expr_stmt|;
name|pw
operator|.
name|close
argument_list|()
expr_stmt|;
name|String
name|nodesHelpStr
init|=
name|baos
operator|.
name|toString
argument_list|(
literal|"UTF-8"
argument_list|)
decl_stmt|;
return|return
name|nodesHelpStr
return|;
block|}
block|}
end_class

end_unit

