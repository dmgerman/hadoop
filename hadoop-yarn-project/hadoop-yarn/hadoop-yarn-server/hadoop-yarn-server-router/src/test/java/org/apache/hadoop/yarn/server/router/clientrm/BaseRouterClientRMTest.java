begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.yarn.server.router.clientrm
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|server
operator|.
name|router
operator|.
name|clientrm
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|PrivilegedExceptionAction
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|ExecutorService
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|concurrent
operator|.
name|Executors
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|UserGroupInformation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|CancelDelegationTokenRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|CancelDelegationTokenResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationAttemptReportRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationAttemptReportResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationAttemptsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationAttemptsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationReportRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationReportResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetApplicationsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterMetricsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterMetricsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterNodeLabelsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterNodeLabelsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterNodesRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetClusterNodesResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetContainerReportRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetContainerReportResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetContainersRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetContainersResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetDelegationTokenRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetDelegationTokenResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetLabelsToNodesRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetLabelsToNodesResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNewApplicationRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNewApplicationResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNewReservationRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNewReservationResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNodesToLabelsRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetNodesToLabelsResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetQueueInfoRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetQueueInfoResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetQueueUserAclsInfoRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|GetQueueUserAclsInfoResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|KillApplicationRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|KillApplicationResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|MoveApplicationAcrossQueuesRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|MoveApplicationAcrossQueuesResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|RenewDelegationTokenRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|RenewDelegationTokenResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|ReservationDeleteRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|ReservationDeleteResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|ReservationSubmissionRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|ReservationSubmissionResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|ReservationUpdateRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|ReservationUpdateResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|SubmitApplicationRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|protocolrecords
operator|.
name|SubmitApplicationResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationAttemptId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ApplicationSubmissionContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ContainerId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ReservationDefinition
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ReservationId
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ReservationRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ReservationRequestInterpreter
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|ReservationRequests
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|Resource
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|api
operator|.
name|records
operator|.
name|Token
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|conf
operator|.
name|YarnConfiguration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|event
operator|.
name|AsyncDispatcher
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|exceptions
operator|.
name|YarnException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|util
operator|.
name|Clock
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|util
operator|.
name|UTCClock
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|After
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Assert
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Before
import|;
end_import

begin_comment
comment|/**  * Base class for all the RouterClientRMService test cases. It provides utility  * methods that can be used by the concrete test case classes.  *  */
end_comment

begin_class
DECL|class|BaseRouterClientRMTest
specifier|public
specifier|abstract
class|class
name|BaseRouterClientRMTest
block|{
comment|/**    * The RouterClientRMService instance that will be used by all the test cases.    */
DECL|field|clientrmService
specifier|private
name|MockRouterClientRMService
name|clientrmService
decl_stmt|;
comment|/**    * Thread pool used for asynchronous operations.    */
DECL|field|threadpool
specifier|private
specifier|static
name|ExecutorService
name|threadpool
init|=
name|Executors
operator|.
name|newCachedThreadPool
argument_list|()
decl_stmt|;
DECL|field|conf
specifier|private
name|Configuration
name|conf
decl_stmt|;
DECL|field|dispatcher
specifier|private
name|AsyncDispatcher
name|dispatcher
decl_stmt|;
DECL|field|TEST_MAX_CACHE_SIZE
specifier|public
specifier|final
specifier|static
name|int
name|TEST_MAX_CACHE_SIZE
init|=
literal|10
decl_stmt|;
DECL|method|getRouterClientRMService ()
specifier|protected
name|MockRouterClientRMService
name|getRouterClientRMService
parameter_list|()
block|{
name|Assert
operator|.
name|assertNotNull
argument_list|(
name|this
operator|.
name|clientrmService
argument_list|)
expr_stmt|;
return|return
name|this
operator|.
name|clientrmService
return|;
block|}
annotation|@
name|Before
DECL|method|setUp ()
specifier|public
name|void
name|setUp
parameter_list|()
block|{
name|this
operator|.
name|conf
operator|=
operator|new
name|YarnConfiguration
argument_list|()
expr_stmt|;
name|String
name|mockPassThroughInterceptorClass
init|=
name|PassThroughClientRequestInterceptor
operator|.
name|class
operator|.
name|getName
argument_list|()
decl_stmt|;
comment|// Create a request intercepter pipeline for testing. The last one in the
comment|// chain will call the mock resource manager. The others in the chain will
comment|// simply forward it to the next one in the chain
name|this
operator|.
name|conf
operator|.
name|set
argument_list|(
name|YarnConfiguration
operator|.
name|ROUTER_CLIENTRM_INTERCEPTOR_CLASS_PIPELINE
argument_list|,
name|mockPassThroughInterceptorClass
operator|+
literal|","
operator|+
name|mockPassThroughInterceptorClass
operator|+
literal|","
operator|+
name|mockPassThroughInterceptorClass
operator|+
literal|","
operator|+
name|MockClientRequestInterceptor
operator|.
name|class
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|this
operator|.
name|conf
operator|.
name|setInt
argument_list|(
name|YarnConfiguration
operator|.
name|ROUTER_PIPELINE_CACHE_MAX_SIZE
argument_list|,
name|TEST_MAX_CACHE_SIZE
argument_list|)
expr_stmt|;
name|this
operator|.
name|dispatcher
operator|=
operator|new
name|AsyncDispatcher
argument_list|()
expr_stmt|;
name|this
operator|.
name|dispatcher
operator|.
name|init
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|this
operator|.
name|dispatcher
operator|.
name|start
argument_list|()
expr_stmt|;
name|this
operator|.
name|clientrmService
operator|=
name|createAndStartRouterClientRMService
argument_list|()
expr_stmt|;
block|}
annotation|@
name|After
DECL|method|tearDown ()
specifier|public
name|void
name|tearDown
parameter_list|()
block|{
if|if
condition|(
name|clientrmService
operator|!=
literal|null
condition|)
block|{
name|clientrmService
operator|.
name|stop
argument_list|()
expr_stmt|;
name|clientrmService
operator|=
literal|null
expr_stmt|;
block|}
if|if
condition|(
name|this
operator|.
name|dispatcher
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|dispatcher
operator|.
name|stop
argument_list|()
expr_stmt|;
block|}
block|}
DECL|method|getThreadPool ()
specifier|protected
name|ExecutorService
name|getThreadPool
parameter_list|()
block|{
return|return
name|threadpool
return|;
block|}
DECL|method|createAndStartRouterClientRMService ()
specifier|protected
name|MockRouterClientRMService
name|createAndStartRouterClientRMService
parameter_list|()
block|{
name|MockRouterClientRMService
name|svc
init|=
operator|new
name|MockRouterClientRMService
argument_list|()
decl_stmt|;
name|svc
operator|.
name|init
argument_list|(
name|conf
argument_list|)
expr_stmt|;
name|svc
operator|.
name|start
argument_list|()
expr_stmt|;
return|return
name|svc
return|;
block|}
DECL|class|MockRouterClientRMService
specifier|protected
specifier|static
class|class
name|MockRouterClientRMService
extends|extends
name|RouterClientRMService
block|{
DECL|method|MockRouterClientRMService ()
specifier|public
name|MockRouterClientRMService
parameter_list|()
block|{
name|super
argument_list|()
expr_stmt|;
block|}
block|}
DECL|method|getNewApplication (String user)
specifier|protected
name|GetNewApplicationResponse
name|getNewApplication
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetNewApplicationResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetNewApplicationResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetNewApplicationRequest
name|req
init|=
name|GetNewApplicationRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetNewApplicationResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getNewApplication
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|submitApplication ( final ApplicationId appId, String user)
specifier|protected
name|SubmitApplicationResponse
name|submitApplication
parameter_list|(
specifier|final
name|ApplicationId
name|appId
parameter_list|,
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|SubmitApplicationResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|SubmitApplicationResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|ApplicationSubmissionContext
name|context
init|=
name|ApplicationSubmissionContext
operator|.
name|newInstance
argument_list|(
name|appId
argument_list|,
literal|""
argument_list|,
literal|""
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|,
operator|-
literal|1
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|SubmitApplicationRequest
name|req
init|=
name|SubmitApplicationRequest
operator|.
name|newInstance
argument_list|(
name|context
argument_list|)
decl_stmt|;
name|SubmitApplicationResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|submitApplication
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|forceKillApplication ( final ApplicationId appId, String user)
specifier|protected
name|KillApplicationResponse
name|forceKillApplication
parameter_list|(
specifier|final
name|ApplicationId
name|appId
parameter_list|,
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|KillApplicationResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|KillApplicationResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|KillApplicationRequest
name|req
init|=
name|KillApplicationRequest
operator|.
name|newInstance
argument_list|(
name|appId
argument_list|)
decl_stmt|;
name|KillApplicationResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|forceKillApplication
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getClusterMetrics (String user)
specifier|protected
name|GetClusterMetricsResponse
name|getClusterMetrics
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetClusterMetricsResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetClusterMetricsResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetClusterMetricsRequest
name|req
init|=
name|GetClusterMetricsRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetClusterMetricsResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getClusterMetrics
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getClusterNodes (String user)
specifier|protected
name|GetClusterNodesResponse
name|getClusterNodes
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetClusterNodesResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetClusterNodesResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetClusterNodesRequest
name|req
init|=
name|GetClusterNodesRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetClusterNodesResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getClusterNodes
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getQueueInfo (String user)
specifier|protected
name|GetQueueInfoResponse
name|getQueueInfo
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetQueueInfoResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetQueueInfoResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetQueueInfoRequest
name|req
init|=
name|GetQueueInfoRequest
operator|.
name|newInstance
argument_list|(
literal|"default"
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|)
decl_stmt|;
name|GetQueueInfoResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getQueueInfo
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getQueueUserAcls (String user)
specifier|protected
name|GetQueueUserAclsInfoResponse
name|getQueueUserAcls
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetQueueUserAclsInfoResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetQueueUserAclsInfoResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetQueueUserAclsInfoRequest
name|req
init|=
name|GetQueueUserAclsInfoRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetQueueUserAclsInfoResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getQueueUserAcls
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|moveApplicationAcrossQueues ( String user, final ApplicationId appId)
specifier|protected
name|MoveApplicationAcrossQueuesResponse
name|moveApplicationAcrossQueues
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ApplicationId
name|appId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|MoveApplicationAcrossQueuesResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|MoveApplicationAcrossQueuesResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|MoveApplicationAcrossQueuesRequest
name|req
init|=
name|MoveApplicationAcrossQueuesRequest
operator|.
name|newInstance
argument_list|(
name|appId
argument_list|,
literal|"newQueue"
argument_list|)
decl_stmt|;
name|MoveApplicationAcrossQueuesResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|moveApplicationAcrossQueues
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getNewReservation (String user)
specifier|public
name|GetNewReservationResponse
name|getNewReservation
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetNewReservationResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetNewReservationResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetNewReservationResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getNewReservation
argument_list|(
name|GetNewReservationRequest
operator|.
name|newInstance
argument_list|()
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|submitReservation (String user, final ReservationId reservationId)
specifier|protected
name|ReservationSubmissionResponse
name|submitReservation
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ReservationId
name|reservationId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|ReservationSubmissionResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|ReservationSubmissionResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|Clock
name|clock
init|=
operator|new
name|UTCClock
argument_list|()
decl_stmt|;
name|long
name|arrival
init|=
name|clock
operator|.
name|getTime
argument_list|()
decl_stmt|;
name|long
name|duration
init|=
literal|60000
decl_stmt|;
name|long
name|deadline
init|=
call|(
name|long
call|)
argument_list|(
name|arrival
operator|+
literal|1.05
operator|*
name|duration
argument_list|)
decl_stmt|;
name|ReservationSubmissionRequest
name|req
init|=
name|createSimpleReservationRequest
argument_list|(
literal|1
argument_list|,
name|arrival
argument_list|,
name|deadline
argument_list|,
name|duration
argument_list|,
name|reservationId
argument_list|)
decl_stmt|;
name|ReservationSubmissionResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|submitReservation
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|updateReservation (String user, final ReservationId reservationId)
specifier|protected
name|ReservationUpdateResponse
name|updateReservation
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ReservationId
name|reservationId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|ReservationUpdateResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|ReservationUpdateResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|Clock
name|clock
init|=
operator|new
name|UTCClock
argument_list|()
decl_stmt|;
name|long
name|arrival
init|=
name|clock
operator|.
name|getTime
argument_list|()
decl_stmt|;
name|long
name|duration
init|=
literal|60000
decl_stmt|;
name|long
name|deadline
init|=
call|(
name|long
call|)
argument_list|(
name|arrival
operator|+
literal|1.05
operator|*
name|duration
argument_list|)
decl_stmt|;
name|ReservationDefinition
name|rDef
init|=
name|createSimpleReservationRequest
argument_list|(
literal|1
argument_list|,
name|arrival
argument_list|,
name|deadline
argument_list|,
name|duration
argument_list|,
name|reservationId
argument_list|)
operator|.
name|getReservationDefinition
argument_list|()
decl_stmt|;
name|ReservationUpdateRequest
name|req
init|=
name|ReservationUpdateRequest
operator|.
name|newInstance
argument_list|(
name|rDef
argument_list|,
name|reservationId
argument_list|)
decl_stmt|;
name|ReservationUpdateResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|updateReservation
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|deleteReservation (String user, final ReservationId reservationId)
specifier|protected
name|ReservationDeleteResponse
name|deleteReservation
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ReservationId
name|reservationId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|ReservationDeleteResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|ReservationDeleteResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|ReservationDeleteRequest
name|req
init|=
name|ReservationDeleteRequest
operator|.
name|newInstance
argument_list|(
name|reservationId
argument_list|)
decl_stmt|;
name|ReservationDeleteResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|deleteReservation
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getNodeToLabels (String user)
specifier|protected
name|GetNodesToLabelsResponse
name|getNodeToLabels
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetNodesToLabelsResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetNodesToLabelsResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetNodesToLabelsRequest
name|req
init|=
name|GetNodesToLabelsRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetNodesToLabelsResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getNodeToLabels
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getLabelsToNodes (String user)
specifier|protected
name|GetLabelsToNodesResponse
name|getLabelsToNodes
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetLabelsToNodesResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetLabelsToNodesResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetLabelsToNodesRequest
name|req
init|=
name|GetLabelsToNodesRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetLabelsToNodesResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getLabelsToNodes
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getClusterNodeLabels (String user)
specifier|protected
name|GetClusterNodeLabelsResponse
name|getClusterNodeLabels
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetClusterNodeLabelsResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetClusterNodeLabelsResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetClusterNodeLabelsRequest
name|req
init|=
name|GetClusterNodeLabelsRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetClusterNodeLabelsResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getClusterNodeLabels
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getApplicationReport (String user, final ApplicationId appId)
specifier|protected
name|GetApplicationReportResponse
name|getApplicationReport
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ApplicationId
name|appId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetApplicationReportResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetApplicationReportResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetApplicationReportRequest
name|req
init|=
name|GetApplicationReportRequest
operator|.
name|newInstance
argument_list|(
name|appId
argument_list|)
decl_stmt|;
name|GetApplicationReportResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getApplicationReport
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getApplications (String user)
specifier|protected
name|GetApplicationsResponse
name|getApplications
parameter_list|(
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetApplicationsResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetApplicationsResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetApplicationsRequest
name|req
init|=
name|GetApplicationsRequest
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|GetApplicationsResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getApplications
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getApplicationAttemptReport ( String user, final ApplicationAttemptId appAttemptId)
specifier|protected
name|GetApplicationAttemptReportResponse
name|getApplicationAttemptReport
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ApplicationAttemptId
name|appAttemptId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetApplicationAttemptReportResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetApplicationAttemptReportResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetApplicationAttemptReportRequest
name|req
init|=
name|GetApplicationAttemptReportRequest
operator|.
name|newInstance
argument_list|(
name|appAttemptId
argument_list|)
decl_stmt|;
name|GetApplicationAttemptReportResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getApplicationAttemptReport
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getApplicationAttempts (String user, final ApplicationId applicationId)
specifier|protected
name|GetApplicationAttemptsResponse
name|getApplicationAttempts
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ApplicationId
name|applicationId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetApplicationAttemptsResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetApplicationAttemptsResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetApplicationAttemptsRequest
name|req
init|=
name|GetApplicationAttemptsRequest
operator|.
name|newInstance
argument_list|(
name|applicationId
argument_list|)
decl_stmt|;
name|GetApplicationAttemptsResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getApplicationAttempts
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getContainerReport (String user, final ContainerId containerId)
specifier|protected
name|GetContainerReportResponse
name|getContainerReport
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ContainerId
name|containerId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetContainerReportResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetContainerReportResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetContainerReportRequest
name|req
init|=
name|GetContainerReportRequest
operator|.
name|newInstance
argument_list|(
name|containerId
argument_list|)
decl_stmt|;
name|GetContainerReportResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getContainerReport
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getContainers (String user, final ApplicationAttemptId appAttemptId)
specifier|protected
name|GetContainersResponse
name|getContainers
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|ApplicationAttemptId
name|appAttemptId
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetContainersResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetContainersResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetContainersRequest
name|req
init|=
name|GetContainersRequest
operator|.
name|newInstance
argument_list|(
name|appAttemptId
argument_list|)
decl_stmt|;
name|GetContainersResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getContainers
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|getDelegationToken (final String user)
specifier|protected
name|GetDelegationTokenResponse
name|getDelegationToken
parameter_list|(
specifier|final
name|String
name|user
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|GetDelegationTokenResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|GetDelegationTokenResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|GetDelegationTokenRequest
name|req
init|=
name|GetDelegationTokenRequest
operator|.
name|newInstance
argument_list|(
name|user
argument_list|)
decl_stmt|;
name|GetDelegationTokenResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|getDelegationToken
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|renewDelegationToken (String user, final Token token)
specifier|protected
name|RenewDelegationTokenResponse
name|renewDelegationToken
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|Token
name|token
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|RenewDelegationTokenResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|RenewDelegationTokenResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|RenewDelegationTokenRequest
name|req
init|=
name|RenewDelegationTokenRequest
operator|.
name|newInstance
argument_list|(
name|token
argument_list|)
decl_stmt|;
name|RenewDelegationTokenResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|renewDelegationToken
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|cancelDelegationToken (String user, final Token token)
specifier|protected
name|CancelDelegationTokenResponse
name|cancelDelegationToken
parameter_list|(
name|String
name|user
parameter_list|,
specifier|final
name|Token
name|token
parameter_list|)
throws|throws
name|YarnException
throws|,
name|IOException
throws|,
name|InterruptedException
block|{
return|return
name|UserGroupInformation
operator|.
name|createRemoteUser
argument_list|(
name|user
argument_list|)
operator|.
name|doAs
argument_list|(
operator|new
name|PrivilegedExceptionAction
argument_list|<
name|CancelDelegationTokenResponse
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|CancelDelegationTokenResponse
name|run
parameter_list|()
throws|throws
name|Exception
block|{
name|CancelDelegationTokenRequest
name|req
init|=
name|CancelDelegationTokenRequest
operator|.
name|newInstance
argument_list|(
name|token
argument_list|)
decl_stmt|;
name|CancelDelegationTokenResponse
name|response
init|=
name|getRouterClientRMService
argument_list|()
operator|.
name|cancelDelegationToken
argument_list|(
name|req
argument_list|)
decl_stmt|;
return|return
name|response
return|;
block|}
block|}
argument_list|)
return|;
block|}
DECL|method|createSimpleReservationRequest ( int numContainers, long arrival, long deadline, long duration, ReservationId reservationId)
specifier|private
name|ReservationSubmissionRequest
name|createSimpleReservationRequest
parameter_list|(
name|int
name|numContainers
parameter_list|,
name|long
name|arrival
parameter_list|,
name|long
name|deadline
parameter_list|,
name|long
name|duration
parameter_list|,
name|ReservationId
name|reservationId
parameter_list|)
block|{
comment|// create a request with a single atomic ask
name|ReservationRequest
name|r
init|=
name|ReservationRequest
operator|.
name|newInstance
argument_list|(
name|Resource
operator|.
name|newInstance
argument_list|(
literal|1024
argument_list|,
literal|1
argument_list|)
argument_list|,
name|numContainers
argument_list|,
literal|1
argument_list|,
name|duration
argument_list|)
decl_stmt|;
name|ReservationRequests
name|reqs
init|=
name|ReservationRequests
operator|.
name|newInstance
argument_list|(
name|Collections
operator|.
name|singletonList
argument_list|(
name|r
argument_list|)
argument_list|,
name|ReservationRequestInterpreter
operator|.
name|R_ALL
argument_list|)
decl_stmt|;
name|ReservationDefinition
name|rDef
init|=
name|ReservationDefinition
operator|.
name|newInstance
argument_list|(
name|arrival
argument_list|,
name|deadline
argument_list|,
name|reqs
argument_list|,
literal|"testRouterClientRMService#reservation"
argument_list|)
decl_stmt|;
name|ReservationSubmissionRequest
name|request
init|=
name|ReservationSubmissionRequest
operator|.
name|newInstance
argument_list|(
name|rDef
argument_list|,
literal|"dedicated"
argument_list|,
name|reservationId
argument_list|)
decl_stmt|;
return|return
name|request
return|;
block|}
block|}
end_class

end_unit

