begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one  * or more contributor license agreements.  See the NOTICE file  * distributed with this work for additional information  * regarding copyright ownership.  The ASF licenses this file  * to you under the Apache License, Version 2.0 (the  * "License"); you may not use this file except in compliance  * with the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.hadoop.yarn.service.utils
package|package
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|yarn
operator|.
name|service
operator|.
name|utils
package|;
end_package

begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|annotations
operator|.
name|VisibleForTesting
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|io
operator|.
name|IOUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|commons
operator|.
name|lang
operator|.
name|StringUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|conf
operator|.
name|Configuration
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|io
operator|.
name|Text
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|Credentials
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|SaslPropertiesResolver
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|SecurityUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|UserGroupInformation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|token
operator|.
name|Token
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|token
operator|.
name|TokenIdentifier
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|ExitUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|Shell
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|LoggerFactory
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|crypto
operator|.
name|Cipher
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|Closeable
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|PrintStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|InvocationTargetException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|InetAddress
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|NoSuchAlgorithmException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|regex
operator|.
name|Pattern
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|UserGroupInformation
operator|.
name|*
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|security
operator|.
name|authentication
operator|.
name|util
operator|.
name|KerberosUtil
operator|.
name|*
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|fs
operator|.
name|CommonConfigurationKeysPublic
operator|.
name|*
import|;
end_import

begin_comment
comment|/**  * Kerberos diagnostics  * At some point this may move to hadoop core, so please keep use of slider  * methods and classes to ~0.  *  * This operation expands some of the diagnostic output of the security code,  * but not all. For completeness  *  * Set the environment variable {@code HADOOP_JAAS_DEBUG=true}  * Set the log level for {@code org.apache.hadoop.security=DEBUG}  */
end_comment

begin_class
DECL|class|KerberosDiags
specifier|public
class|class
name|KerberosDiags
implements|implements
name|Closeable
block|{
DECL|field|LOG
specifier|private
specifier|static
specifier|final
name|Logger
name|LOG
init|=
name|LoggerFactory
operator|.
name|getLogger
argument_list|(
name|KerberosDiags
operator|.
name|class
argument_list|)
decl_stmt|;
DECL|field|KRB5_CCNAME
specifier|public
specifier|static
specifier|final
name|String
name|KRB5_CCNAME
init|=
literal|"KRB5CCNAME"
decl_stmt|;
DECL|field|JAVA_SECURITY_KRB5_CONF
specifier|public
specifier|static
specifier|final
name|String
name|JAVA_SECURITY_KRB5_CONF
init|=
literal|"java.security.krb5.conf"
decl_stmt|;
DECL|field|JAVA_SECURITY_KRB5_REALM
specifier|public
specifier|static
specifier|final
name|String
name|JAVA_SECURITY_KRB5_REALM
init|=
literal|"java.security.krb5.realm"
decl_stmt|;
DECL|field|SUN_SECURITY_KRB5_DEBUG
specifier|public
specifier|static
specifier|final
name|String
name|SUN_SECURITY_KRB5_DEBUG
init|=
literal|"sun.security.krb5.debug"
decl_stmt|;
DECL|field|SUN_SECURITY_SPNEGO_DEBUG
specifier|public
specifier|static
specifier|final
name|String
name|SUN_SECURITY_SPNEGO_DEBUG
init|=
literal|"sun.security.spnego.debug"
decl_stmt|;
DECL|field|SUN_SECURITY_JAAS_FILE
specifier|public
specifier|static
specifier|final
name|String
name|SUN_SECURITY_JAAS_FILE
init|=
literal|"java.security.auth.login.config"
decl_stmt|;
DECL|field|KERBEROS_KINIT_COMMAND
specifier|public
specifier|static
specifier|final
name|String
name|KERBEROS_KINIT_COMMAND
init|=
literal|"hadoop.kerberos.kinit.command"
decl_stmt|;
DECL|field|HADOOP_AUTHENTICATION_IS_DISABLED
specifier|public
specifier|static
specifier|final
name|String
name|HADOOP_AUTHENTICATION_IS_DISABLED
init|=
literal|"Hadoop authentication is disabled"
decl_stmt|;
DECL|field|UNSET
specifier|public
specifier|static
specifier|final
name|String
name|UNSET
init|=
literal|"(unset)"
decl_stmt|;
DECL|field|NO_DEFAULT_REALM
specifier|public
specifier|static
specifier|final
name|String
name|NO_DEFAULT_REALM
init|=
literal|"Cannot locate default realm"
decl_stmt|;
DECL|field|conf
specifier|private
specifier|final
name|Configuration
name|conf
decl_stmt|;
DECL|field|services
specifier|private
specifier|final
name|List
argument_list|<
name|String
argument_list|>
name|services
decl_stmt|;
DECL|field|out
specifier|private
specifier|final
name|PrintStream
name|out
decl_stmt|;
DECL|field|keytab
specifier|private
specifier|final
name|File
name|keytab
decl_stmt|;
DECL|field|principal
specifier|private
specifier|final
name|String
name|principal
decl_stmt|;
DECL|field|minKeyLength
specifier|private
specifier|final
name|long
name|minKeyLength
decl_stmt|;
DECL|field|securityRequired
specifier|private
specifier|final
name|boolean
name|securityRequired
decl_stmt|;
DECL|field|CAT_JVM
specifier|public
specifier|static
specifier|final
name|String
name|CAT_JVM
init|=
literal|"JVM"
decl_stmt|;
DECL|field|CAT_JAAS
specifier|public
specifier|static
specifier|final
name|String
name|CAT_JAAS
init|=
literal|"JAAS"
decl_stmt|;
DECL|field|CAT_CONFIG
specifier|public
specifier|static
specifier|final
name|String
name|CAT_CONFIG
init|=
literal|"CONFIG"
decl_stmt|;
DECL|field|CAT_LOGIN
specifier|public
specifier|static
specifier|final
name|String
name|CAT_LOGIN
init|=
literal|"LOGIN"
decl_stmt|;
DECL|field|CAT_KERBEROS
specifier|public
specifier|static
specifier|final
name|String
name|CAT_KERBEROS
init|=
literal|"KERBEROS"
decl_stmt|;
DECL|field|CAT_SASL
specifier|public
specifier|static
specifier|final
name|String
name|CAT_SASL
init|=
literal|"SASL"
decl_stmt|;
annotation|@
name|SuppressWarnings
argument_list|(
literal|"IOResourceOpenedButNotSafelyClosed"
argument_list|)
DECL|method|KerberosDiags (Configuration conf, PrintStream out, List<String> services, File keytab, String principal, long minKeyLength, boolean securityRequired)
specifier|public
name|KerberosDiags
parameter_list|(
name|Configuration
name|conf
parameter_list|,
name|PrintStream
name|out
parameter_list|,
name|List
argument_list|<
name|String
argument_list|>
name|services
parameter_list|,
name|File
name|keytab
parameter_list|,
name|String
name|principal
parameter_list|,
name|long
name|minKeyLength
parameter_list|,
name|boolean
name|securityRequired
parameter_list|)
block|{
name|this
operator|.
name|conf
operator|=
name|conf
expr_stmt|;
name|this
operator|.
name|services
operator|=
name|services
expr_stmt|;
name|this
operator|.
name|keytab
operator|=
name|keytab
expr_stmt|;
name|this
operator|.
name|principal
operator|=
name|principal
expr_stmt|;
name|this
operator|.
name|out
operator|=
name|out
expr_stmt|;
name|this
operator|.
name|minKeyLength
operator|=
name|minKeyLength
expr_stmt|;
name|this
operator|.
name|securityRequired
operator|=
name|securityRequired
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|close ()
specifier|public
name|void
name|close
parameter_list|()
throws|throws
name|IOException
block|{
name|flush
argument_list|()
expr_stmt|;
block|}
comment|/**    * Execute diagnostics.    *<p>    * Things it would be nice if UGI made accessible    *<ol>    *<li>A way to enable JAAS debug programatically</li>    *<li>Access to the TGT</li>    *</ol>    * @return true if security was enabled and all probes were successful    * @throws KerberosDiagsFailure explicitly raised failure    * @throws Exception other security problems    */
annotation|@
name|SuppressWarnings
argument_list|(
literal|"deprecation"
argument_list|)
DECL|method|execute ()
specifier|public
name|boolean
name|execute
parameter_list|()
throws|throws
name|Exception
block|{
name|title
argument_list|(
literal|"Kerberos Diagnostics scan at %s"
argument_list|,
operator|new
name|Date
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// check that the machine has a name
name|println
argument_list|(
literal|"Hostname: %s"
argument_list|,
name|InetAddress
operator|.
name|getLocalHost
argument_list|()
operator|.
name|getCanonicalHostName
argument_list|()
argument_list|)
expr_stmt|;
comment|// Fail fast on a JVM without JCE installed.
name|validateKeyLength
argument_list|()
expr_stmt|;
comment|// look at realm
name|println
argument_list|(
literal|"JVM Kerberos Login Module = %s"
argument_list|,
name|getKrb5LoginModuleName
argument_list|()
argument_list|)
expr_stmt|;
name|printDefaultRealm
argument_list|()
expr_stmt|;
name|title
argument_list|(
literal|"System Properties"
argument_list|)
expr_stmt|;
for|for
control|(
name|String
name|prop
range|:
operator|new
name|String
index|[]
block|{
name|JAVA_SECURITY_KRB5_CONF
block|,
name|JAVA_SECURITY_KRB5_REALM
block|,
name|SUN_SECURITY_KRB5_DEBUG
block|,
name|SUN_SECURITY_SPNEGO_DEBUG
block|,
name|SUN_SECURITY_JAAS_FILE
block|}
control|)
block|{
name|printSysprop
argument_list|(
name|prop
argument_list|)
expr_stmt|;
block|}
name|title
argument_list|(
literal|"Environment Variables"
argument_list|)
expr_stmt|;
for|for
control|(
name|String
name|env
range|:
operator|new
name|String
index|[]
block|{
literal|"HADOOP_JAAS_DEBUG"
block|,
name|KRB5_CCNAME
block|,
literal|"HADOOP_USER_NAME"
block|,
literal|"HADOOP_PROXY_USER"
block|,
name|HADOOP_TOKEN_FILE_LOCATION
block|,     }
control|)
block|{
name|printEnv
argument_list|(
name|env
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|String
name|prop
range|:
operator|new
name|String
index|[]
block|{
name|KERBEROS_KINIT_COMMAND
block|,
name|HADOOP_SECURITY_AUTHENTICATION
block|,
name|HADOOP_SECURITY_AUTHORIZATION
block|,
literal|"hadoop.kerberos.min.seconds.before.relogin"
block|,
comment|// not in 2.6
literal|"hadoop.security.dns.interface"
block|,
comment|// not in 2.6
literal|"hadoop.security.dns.nameserver"
block|,
comment|// not in 2.6
name|HADOOP_RPC_PROTECTION
block|,
name|HADOOP_SECURITY_SASL_PROPS_RESOLVER_CLASS
block|,
name|HADOOP_SECURITY_CRYPTO_CODEC_CLASSES_KEY_PREFIX
block|,
name|HADOOP_SECURITY_GROUP_MAPPING
block|,
literal|"hadoop.security.impersonation.provider.class"
block|,
comment|// not in 2.6
literal|"dfs.data.transfer.protection"
comment|// HDFS
block|}
control|)
block|{
name|printConfOpt
argument_list|(
name|prop
argument_list|)
expr_stmt|;
block|}
comment|// check that authentication is enabled
if|if
condition|(
name|SecurityUtil
operator|.
name|getAuthenticationMethod
argument_list|(
name|conf
argument_list|)
operator|.
name|equals
argument_list|(
name|AuthenticationMethod
operator|.
name|SIMPLE
argument_list|)
condition|)
block|{
name|println
argument_list|(
name|HADOOP_AUTHENTICATION_IS_DISABLED
argument_list|)
expr_stmt|;
name|failif
argument_list|(
name|securityRequired
argument_list|,
name|CAT_CONFIG
argument_list|,
name|HADOOP_AUTHENTICATION_IS_DISABLED
argument_list|)
expr_stmt|;
comment|// no security, skip rest of test
return|return
literal|false
return|;
block|}
name|validateKrb5File
argument_list|()
expr_stmt|;
name|validateSasl
argument_list|(
name|HADOOP_SECURITY_SASL_PROPS_RESOLVER_CLASS
argument_list|)
expr_stmt|;
name|validateSasl
argument_list|(
literal|"dfs.data.transfer.saslproperties.resolver.class"
argument_list|)
expr_stmt|;
name|validateKinitExecutable
argument_list|()
expr_stmt|;
name|validateJAAS
argument_list|()
expr_stmt|;
comment|// now the big test: login, then try again
name|boolean
name|krb5Debug
init|=
name|getAndSet
argument_list|(
name|SUN_SECURITY_KRB5_DEBUG
argument_list|)
decl_stmt|;
name|boolean
name|spnegoDebug
init|=
name|getAndSet
argument_list|(
name|SUN_SECURITY_SPNEGO_DEBUG
argument_list|)
decl_stmt|;
try|try
block|{
name|title
argument_list|(
literal|"Logging in"
argument_list|)
expr_stmt|;
if|if
condition|(
name|keytab
operator|!=
literal|null
condition|)
block|{
name|dumpKeytab
argument_list|(
name|keytab
argument_list|)
expr_stmt|;
name|loginFromKeytab
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|UserGroupInformation
name|loginUser
init|=
name|getLoginUser
argument_list|()
decl_stmt|;
name|dumpUGI
argument_list|(
literal|"Log in user"
argument_list|,
name|loginUser
argument_list|)
expr_stmt|;
name|validateUGI
argument_list|(
literal|"Login user"
argument_list|,
name|loginUser
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Ticket based login: %b"
argument_list|,
name|isLoginTicketBased
argument_list|()
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Keytab based login: %b"
argument_list|,
name|isLoginKeytabBased
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
literal|true
return|;
block|}
finally|finally
block|{
comment|// restore original system properties
name|System
operator|.
name|setProperty
argument_list|(
name|SUN_SECURITY_KRB5_DEBUG
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|krb5Debug
argument_list|)
argument_list|)
expr_stmt|;
name|System
operator|.
name|setProperty
argument_list|(
name|SUN_SECURITY_SPNEGO_DEBUG
argument_list|,
name|Boolean
operator|.
name|toString
argument_list|(
name|spnegoDebug
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Fail fast on a JVM without JCE installed.    *    * This is a recurrent problem    * (that is: it keeps creeping back with JVM updates);    * a fast failure is the best tactic    * @throws NoSuchAlgorithmException    */
DECL|method|validateKeyLength ()
specifier|protected
name|void
name|validateKeyLength
parameter_list|()
throws|throws
name|NoSuchAlgorithmException
block|{
name|int
name|aesLen
init|=
name|Cipher
operator|.
name|getMaxAllowedKeyLength
argument_list|(
literal|"AES"
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"Maximum AES encryption key length %d bits"
argument_list|,
name|aesLen
argument_list|)
expr_stmt|;
name|failif
argument_list|(
name|aesLen
operator|<
name|minKeyLength
argument_list|,
name|CAT_JVM
argument_list|,
literal|"Java Cryptography Extensions are not installed on this JVM."
operator|+
literal|" Maximum supported key length %s - minimum required %d"
argument_list|,
name|aesLen
argument_list|,
name|minKeyLength
argument_list|)
expr_stmt|;
block|}
comment|/**    * Get the default realm.    *<p>    * Not having a default realm may be harmless, so is noted at info.    * All other invocation failures are downgraded to warn, as    * follow-on actions may still work.    * failure to invoke the method via introspection is rejected,    * as it's a sign of JVM compatibility issues that may have other    * consequences    */
DECL|method|printDefaultRealm ()
specifier|protected
name|void
name|printDefaultRealm
parameter_list|()
block|{
try|try
block|{
name|println
argument_list|(
literal|"Default Realm = %s"
argument_list|,
name|getDefaultRealm
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|ClassNotFoundException
decl||
name|IllegalAccessException
decl||
name|NoSuchMethodException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|KerberosDiagsFailure
argument_list|(
name|CAT_JVM
argument_list|,
name|e
argument_list|,
literal|"Failed to invoke krb5.Config.getDefaultRealm: %s"
argument_list|,
name|e
argument_list|)
throw|;
block|}
catch|catch
parameter_list|(
name|InvocationTargetException
name|e
parameter_list|)
block|{
name|Throwable
name|cause
init|=
name|e
operator|.
name|getCause
argument_list|()
operator|!=
literal|null
condition|?
name|e
operator|.
name|getCause
argument_list|()
else|:
name|e
decl_stmt|;
if|if
condition|(
name|cause
operator|.
name|toString
argument_list|()
operator|.
name|contains
argument_list|(
name|NO_DEFAULT_REALM
argument_list|)
condition|)
block|{
comment|// exception raised if there is no default realm. This is not
comment|// always a problem, so downgrade to a message.
name|println
argument_list|(
literal|"Host has no default realm"
argument_list|)
expr_stmt|;
name|LOG
operator|.
name|debug
argument_list|(
name|cause
operator|.
name|toString
argument_list|()
argument_list|,
name|cause
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|println
argument_list|(
literal|"Kerberos.getDefaultRealm() failed: %s\n%s"
argument_list|,
name|cause
argument_list|,
name|org
operator|.
name|apache
operator|.
name|hadoop
operator|.
name|util
operator|.
name|StringUtils
operator|.
name|stringifyException
argument_list|(
name|cause
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/**    * Locate the krb5.conf file and dump it.    * No-op on windows.    * @throws IOException    */
DECL|method|validateKrb5File ()
specifier|private
name|void
name|validateKrb5File
parameter_list|()
throws|throws
name|IOException
block|{
if|if
condition|(
operator|!
name|Shell
operator|.
name|WINDOWS
condition|)
block|{
name|title
argument_list|(
literal|"Locating Kerberos configuration file"
argument_list|)
expr_stmt|;
name|String
name|krbPath
init|=
literal|"/etc/krb5.conf"
decl_stmt|;
name|String
name|jvmKrbPath
init|=
name|System
operator|.
name|getProperty
argument_list|(
name|JAVA_SECURITY_KRB5_CONF
argument_list|)
decl_stmt|;
if|if
condition|(
name|jvmKrbPath
operator|!=
literal|null
condition|)
block|{
name|println
argument_list|(
literal|"Setting kerberos path from sysprop %s: %s"
argument_list|,
name|JAVA_SECURITY_KRB5_CONF
argument_list|,
name|jvmKrbPath
argument_list|)
expr_stmt|;
name|krbPath
operator|=
name|jvmKrbPath
expr_stmt|;
block|}
name|String
name|krb5name
init|=
name|System
operator|.
name|getenv
argument_list|(
name|KRB5_CCNAME
argument_list|)
decl_stmt|;
if|if
condition|(
name|krb5name
operator|!=
literal|null
condition|)
block|{
name|println
argument_list|(
literal|"Setting kerberos path from environment variable %s: %s"
argument_list|,
name|KRB5_CCNAME
argument_list|,
name|krb5name
argument_list|)
expr_stmt|;
name|krbPath
operator|=
name|krb5name
expr_stmt|;
if|if
condition|(
name|jvmKrbPath
operator|!=
literal|null
condition|)
block|{
name|println
argument_list|(
literal|"Warning - both %s and %s were set - %s takes priority"
argument_list|,
name|JAVA_SECURITY_KRB5_CONF
argument_list|,
name|KRB5_CCNAME
argument_list|,
name|KRB5_CCNAME
argument_list|)
expr_stmt|;
block|}
block|}
name|File
name|krbFile
init|=
operator|new
name|File
argument_list|(
name|krbPath
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"Kerberos configuration file = %s"
argument_list|,
name|krbFile
argument_list|)
expr_stmt|;
name|failif
argument_list|(
operator|!
name|krbFile
operator|.
name|exists
argument_list|()
argument_list|,
name|CAT_KERBEROS
argument_list|,
literal|"Kerberos configuration file %s not found"
argument_list|,
name|krbFile
argument_list|)
expr_stmt|;
name|dump
argument_list|(
name|krbFile
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Dump a keytab: list all principals.    * @param keytabFile the keytab file    * @throws IOException IO problems    */
DECL|method|dumpKeytab (File keytabFile)
specifier|public
name|void
name|dumpKeytab
parameter_list|(
name|File
name|keytabFile
parameter_list|)
throws|throws
name|IOException
block|{
name|title
argument_list|(
literal|"Examining keytab %s"
argument_list|,
name|keytabFile
argument_list|)
expr_stmt|;
name|File
name|kt
init|=
name|keytabFile
operator|.
name|getCanonicalFile
argument_list|()
decl_stmt|;
name|failif
argument_list|(
operator|!
name|kt
operator|.
name|exists
argument_list|()
argument_list|,
name|CAT_CONFIG
argument_list|,
literal|"Keytab not found: %s"
argument_list|,
name|kt
argument_list|)
expr_stmt|;
name|failif
argument_list|(
operator|!
name|kt
operator|.
name|isFile
argument_list|()
argument_list|,
name|CAT_CONFIG
argument_list|,
literal|"Keytab is not a valid file: %s"
argument_list|,
name|kt
argument_list|)
expr_stmt|;
name|String
index|[]
name|names
init|=
name|getPrincipalNames
argument_list|(
name|keytabFile
operator|.
name|getCanonicalPath
argument_list|()
argument_list|,
name|Pattern
operator|.
name|compile
argument_list|(
literal|".*"
argument_list|)
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"keytab entry count: %d"
argument_list|,
name|names
operator|.
name|length
argument_list|)
expr_stmt|;
for|for
control|(
name|String
name|name
range|:
name|names
control|)
block|{
name|println
argument_list|(
literal|"    %s"
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
name|println
argument_list|(
literal|"-----"
argument_list|)
expr_stmt|;
block|}
comment|/**    * Log in from a keytab, dump the UGI, validate it, then try and log in again.    * That second-time login catches JVM/Hadoop compatibility problems.    * @throws IOException    */
DECL|method|loginFromKeytab ()
specifier|private
name|void
name|loginFromKeytab
parameter_list|()
throws|throws
name|IOException
block|{
name|UserGroupInformation
name|ugi
decl_stmt|;
name|String
name|identity
decl_stmt|;
if|if
condition|(
name|keytab
operator|!=
literal|null
condition|)
block|{
name|File
name|kt
init|=
name|keytab
operator|.
name|getCanonicalFile
argument_list|()
decl_stmt|;
name|println
argument_list|(
literal|"Using keytab %s principal %s"
argument_list|,
name|kt
argument_list|,
name|principal
argument_list|)
expr_stmt|;
name|identity
operator|=
name|principal
expr_stmt|;
name|failif
argument_list|(
name|StringUtils
operator|.
name|isEmpty
argument_list|(
name|principal
argument_list|)
argument_list|,
name|CAT_KERBEROS
argument_list|,
literal|"No principal defined"
argument_list|)
expr_stmt|;
name|ugi
operator|=
name|loginUserFromKeytabAndReturnUGI
argument_list|(
name|principal
argument_list|,
name|kt
operator|.
name|getPath
argument_list|()
argument_list|)
expr_stmt|;
name|dumpUGI
argument_list|(
name|identity
argument_list|,
name|ugi
argument_list|)
expr_stmt|;
name|validateUGI
argument_list|(
name|principal
argument_list|,
name|ugi
argument_list|)
expr_stmt|;
name|title
argument_list|(
literal|"Attempting to log in from keytab again"
argument_list|)
expr_stmt|;
comment|// package scoped -hence the reason why this class must be in the
comment|// hadoop.security package
name|setShouldRenewImmediatelyForTests
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// attempt a new login
name|ugi
operator|.
name|reloginFromKeytab
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|println
argument_list|(
literal|"No keytab: logging is as current user"
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Dump a UGI.    * @param title title of this section    * @param ugi UGI to dump    * @throws IOException    */
DECL|method|dumpUGI (String title, UserGroupInformation ugi)
specifier|private
name|void
name|dumpUGI
parameter_list|(
name|String
name|title
parameter_list|,
name|UserGroupInformation
name|ugi
parameter_list|)
throws|throws
name|IOException
block|{
name|title
argument_list|(
name|title
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"UGI instance = %s"
argument_list|,
name|ugi
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Has kerberos credentials: %b"
argument_list|,
name|ugi
operator|.
name|hasKerberosCredentials
argument_list|()
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Authentication method: %s"
argument_list|,
name|ugi
operator|.
name|getAuthenticationMethod
argument_list|()
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|"Real Authentication method: %s"
argument_list|,
name|ugi
operator|.
name|getRealAuthenticationMethod
argument_list|()
argument_list|)
expr_stmt|;
name|title
argument_list|(
literal|"Group names"
argument_list|)
expr_stmt|;
for|for
control|(
name|String
name|name
range|:
name|ugi
operator|.
name|getGroupNames
argument_list|()
control|)
block|{
name|println
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
name|title
argument_list|(
literal|"Credentials"
argument_list|)
expr_stmt|;
name|Credentials
name|credentials
init|=
name|ugi
operator|.
name|getCredentials
argument_list|()
decl_stmt|;
name|List
argument_list|<
name|Text
argument_list|>
name|secretKeys
init|=
name|credentials
operator|.
name|getAllSecretKeys
argument_list|()
decl_stmt|;
name|title
argument_list|(
literal|"Secret keys"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|secretKeys
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|Text
name|secret
range|:
name|secretKeys
control|)
block|{
name|println
argument_list|(
literal|"%s"
argument_list|,
name|secret
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|println
argument_list|(
literal|"(none)"
argument_list|)
expr_stmt|;
block|}
name|dumpTokens
argument_list|(
name|ugi
argument_list|)
expr_stmt|;
block|}
comment|/**    * Validate the UGI: verify it is kerberized.    * @param messagePrefix message in exceptions    * @param user user to validate    */
DECL|method|validateUGI (String messagePrefix, UserGroupInformation user)
specifier|private
name|void
name|validateUGI
parameter_list|(
name|String
name|messagePrefix
parameter_list|,
name|UserGroupInformation
name|user
parameter_list|)
block|{
name|failif
argument_list|(
operator|!
name|user
operator|.
name|hasKerberosCredentials
argument_list|()
argument_list|,
name|CAT_LOGIN
argument_list|,
literal|"%s: No kerberos credentials for %s"
argument_list|,
name|messagePrefix
argument_list|,
name|user
argument_list|)
expr_stmt|;
name|failif
argument_list|(
name|user
operator|.
name|getAuthenticationMethod
argument_list|()
operator|==
literal|null
argument_list|,
name|CAT_LOGIN
argument_list|,
literal|"%s: Null AuthenticationMethod for %s"
argument_list|,
name|messagePrefix
argument_list|,
name|user
argument_list|)
expr_stmt|;
block|}
comment|/**    * A cursory look at the {@code kinit} executable.    * If it is an absolute path: it must exist with a size> 0.    * If it is just a command, it has to be on the path. There's no check    * for that -but the PATH is printed out.    */
DECL|method|validateKinitExecutable ()
specifier|private
name|void
name|validateKinitExecutable
parameter_list|()
block|{
name|String
name|kinit
init|=
name|conf
operator|.
name|getTrimmed
argument_list|(
name|KERBEROS_KINIT_COMMAND
argument_list|,
literal|""
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|kinit
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|File
name|kinitPath
init|=
operator|new
name|File
argument_list|(
name|kinit
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"%s = %s"
argument_list|,
name|KERBEROS_KINIT_COMMAND
argument_list|,
name|kinitPath
argument_list|)
expr_stmt|;
if|if
condition|(
name|kinitPath
operator|.
name|isAbsolute
argument_list|()
condition|)
block|{
name|failif
argument_list|(
operator|!
name|kinitPath
operator|.
name|exists
argument_list|()
argument_list|,
name|CAT_KERBEROS
argument_list|,
literal|"%s executable does not exist: %s"
argument_list|,
name|KERBEROS_KINIT_COMMAND
argument_list|,
name|kinitPath
argument_list|)
expr_stmt|;
name|failif
argument_list|(
operator|!
name|kinitPath
operator|.
name|isFile
argument_list|()
argument_list|,
name|CAT_KERBEROS
argument_list|,
literal|"%s path does not refer to a file: %s"
argument_list|,
name|KERBEROS_KINIT_COMMAND
argument_list|,
name|kinitPath
argument_list|)
expr_stmt|;
name|failif
argument_list|(
name|kinitPath
operator|.
name|length
argument_list|()
operator|==
literal|0
argument_list|,
name|CAT_KERBEROS
argument_list|,
literal|"%s file is empty: %s"
argument_list|,
name|KERBEROS_KINIT_COMMAND
argument_list|,
name|kinitPath
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|println
argument_list|(
literal|"Executable %s is relative -must be on the PATH"
argument_list|,
name|kinit
argument_list|)
expr_stmt|;
name|printEnv
argument_list|(
literal|"PATH"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/**    * Try to load the SASL resolver.    * @param saslPropsResolverKey key for the SASL resolver    */
DECL|method|validateSasl (String saslPropsResolverKey)
specifier|private
name|void
name|validateSasl
parameter_list|(
name|String
name|saslPropsResolverKey
parameter_list|)
block|{
name|title
argument_list|(
literal|"Resolving SASL property %s"
argument_list|,
name|saslPropsResolverKey
argument_list|)
expr_stmt|;
name|String
name|saslPropsResolver
init|=
name|conf
operator|.
name|getTrimmed
argument_list|(
name|saslPropsResolverKey
argument_list|)
decl_stmt|;
try|try
block|{
name|Class
argument_list|<
name|?
extends|extends
name|SaslPropertiesResolver
argument_list|>
name|resolverClass
init|=
name|conf
operator|.
name|getClass
argument_list|(
name|saslPropsResolverKey
argument_list|,
name|SaslPropertiesResolver
operator|.
name|class
argument_list|,
name|SaslPropertiesResolver
operator|.
name|class
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"Resolver is %s"
argument_list|,
name|resolverClass
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|RuntimeException
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|KerberosDiagsFailure
argument_list|(
name|CAT_SASL
argument_list|,
name|e
argument_list|,
literal|"Failed to load %s class %s"
argument_list|,
name|saslPropsResolverKey
argument_list|,
name|saslPropsResolver
argument_list|)
throw|;
block|}
block|}
comment|/**    * Validate any JAAS entry referenced in the {@link #SUN_SECURITY_JAAS_FILE}    * property.    */
DECL|method|validateJAAS ()
specifier|private
name|void
name|validateJAAS
parameter_list|()
block|{
name|String
name|jaasFilename
init|=
name|System
operator|.
name|getProperty
argument_list|(
name|SUN_SECURITY_JAAS_FILE
argument_list|)
decl_stmt|;
if|if
condition|(
name|jaasFilename
operator|!=
literal|null
condition|)
block|{
name|title
argument_list|(
literal|"JAAS"
argument_list|)
expr_stmt|;
name|File
name|jaasFile
init|=
operator|new
name|File
argument_list|(
name|jaasFilename
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"JAAS file is defined in %s: %s"
argument_list|,
name|SUN_SECURITY_JAAS_FILE
argument_list|,
name|jaasFile
argument_list|)
expr_stmt|;
name|failif
argument_list|(
operator|!
name|jaasFile
operator|.
name|exists
argument_list|()
argument_list|,
name|CAT_JAAS
argument_list|,
literal|"JAAS file does not exist: %s"
argument_list|,
name|jaasFile
argument_list|)
expr_stmt|;
name|failif
argument_list|(
operator|!
name|jaasFile
operator|.
name|isFile
argument_list|()
argument_list|,
name|CAT_JAAS
argument_list|,
literal|"Specified JAAS file is not a file: %s"
argument_list|,
name|jaasFile
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Dump all tokens of a user    * @param user user    */
DECL|method|dumpTokens (UserGroupInformation user)
specifier|public
name|void
name|dumpTokens
parameter_list|(
name|UserGroupInformation
name|user
parameter_list|)
block|{
name|Collection
argument_list|<
name|Token
argument_list|<
name|?
extends|extends
name|TokenIdentifier
argument_list|>
argument_list|>
name|tokens
init|=
name|user
operator|.
name|getCredentials
argument_list|()
operator|.
name|getAllTokens
argument_list|()
decl_stmt|;
name|title
argument_list|(
literal|"Token Count: %d"
argument_list|,
name|tokens
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|Token
argument_list|<
name|?
extends|extends
name|TokenIdentifier
argument_list|>
name|token
range|:
name|tokens
control|)
block|{
name|println
argument_list|(
literal|"Token %s"
argument_list|,
name|token
operator|.
name|getKind
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Set the System property to true; return the old value for caching    * @param sysprop property    * @return the previous value    */
DECL|method|getAndSet (String sysprop)
specifier|private
name|boolean
name|getAndSet
parameter_list|(
name|String
name|sysprop
parameter_list|)
block|{
name|boolean
name|old
init|=
name|Boolean
operator|.
name|getBoolean
argument_list|(
name|sysprop
argument_list|)
decl_stmt|;
name|System
operator|.
name|setProperty
argument_list|(
name|sysprop
argument_list|,
literal|"true"
argument_list|)
expr_stmt|;
return|return
name|old
return|;
block|}
comment|/**    * Flush all active output channels, including {@Code System.err},    * so as to stay in sync with any JRE log messages.    */
DECL|method|flush ()
specifier|private
name|void
name|flush
parameter_list|()
block|{
if|if
condition|(
name|out
operator|!=
literal|null
condition|)
block|{
name|out
operator|.
name|flush
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|System
operator|.
name|out
operator|.
name|flush
argument_list|()
expr_stmt|;
block|}
name|System
operator|.
name|err
operator|.
name|flush
argument_list|()
expr_stmt|;
block|}
comment|/**    * Format and print a line of output.    * This goes to any output file, or    * is logged at info. The output is flushed before and after, to    * try and stay in sync with JRE logging.    * @param format format string    * @param args any arguments    */
annotation|@
name|VisibleForTesting
DECL|method|println (String format, Object... args)
specifier|public
name|void
name|println
parameter_list|(
name|String
name|format
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
block|{
name|println
argument_list|(
name|format
argument_list|(
name|format
argument_list|,
name|args
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/**    * Print a line of output. This goes to any output file, or    * is logged at info. The output is flushed before and after, to    * try and stay in sync with JRE logging.    * @param msg message string    */
annotation|@
name|VisibleForTesting
DECL|method|println (String msg)
specifier|private
name|void
name|println
parameter_list|(
name|String
name|msg
parameter_list|)
block|{
name|flush
argument_list|()
expr_stmt|;
if|if
condition|(
name|out
operator|!=
literal|null
condition|)
block|{
name|out
operator|.
name|println
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|LOG
operator|.
name|info
argument_list|(
name|msg
argument_list|)
expr_stmt|;
block|}
name|flush
argument_list|()
expr_stmt|;
block|}
comment|/**    * Print a title entry    * @param format format string    * @param args any arguments    */
DECL|method|title (String format, Object... args)
specifier|private
name|void
name|title
parameter_list|(
name|String
name|format
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
block|{
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|String
name|msg
init|=
literal|"== "
operator|+
name|format
argument_list|(
name|format
argument_list|,
name|args
argument_list|)
operator|+
literal|" =="
decl_stmt|;
name|println
argument_list|(
name|msg
argument_list|)
expr_stmt|;
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
comment|/**    * Print a system property, or {@link #UNSET} if unset.    * @param property property to print    */
DECL|method|printSysprop (String property)
specifier|private
name|void
name|printSysprop
parameter_list|(
name|String
name|property
parameter_list|)
block|{
name|println
argument_list|(
literal|"%s = \"%s\""
argument_list|,
name|property
argument_list|,
name|System
operator|.
name|getProperty
argument_list|(
name|property
argument_list|,
name|UNSET
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/**    * Print a configuration option, or {@link #UNSET} if unset.    * @param option option to print    */
DECL|method|printConfOpt (String option)
specifier|private
name|void
name|printConfOpt
parameter_list|(
name|String
name|option
parameter_list|)
block|{
name|println
argument_list|(
literal|"%s = \"%s\""
argument_list|,
name|option
argument_list|,
name|conf
operator|.
name|get
argument_list|(
name|option
argument_list|,
name|UNSET
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/**    * Print an environment variable's name and value; printing    * {@link #UNSET} if it is not set    * @param variable environment variable    */
DECL|method|printEnv (String variable)
specifier|private
name|void
name|printEnv
parameter_list|(
name|String
name|variable
parameter_list|)
block|{
name|String
name|env
init|=
name|System
operator|.
name|getenv
argument_list|(
name|variable
argument_list|)
decl_stmt|;
name|println
argument_list|(
literal|"%s = \"%s\""
argument_list|,
name|variable
argument_list|,
name|env
operator|!=
literal|null
condition|?
name|env
else|:
name|UNSET
argument_list|)
expr_stmt|;
block|}
comment|/**    * Dump any file to standard out; add a trailing newline    * @param file file to dump    * @throws IOException IO problems    */
DECL|method|dump (File file)
specifier|public
name|void
name|dump
parameter_list|(
name|File
name|file
parameter_list|)
throws|throws
name|IOException
block|{
try|try
init|(
name|FileInputStream
name|in
init|=
operator|new
name|FileInputStream
argument_list|(
name|file
argument_list|)
init|)
block|{
for|for
control|(
name|String
name|line
range|:
name|IOUtils
operator|.
name|readLines
argument_list|(
name|in
argument_list|)
control|)
block|{
name|println
argument_list|(
literal|"%s"
argument_list|,
name|line
argument_list|)
expr_stmt|;
block|}
block|}
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
block|}
comment|/**    * Format and raise a failure    *    * @param category category for exception    * @param message string formatting message    * @param args any arguments for the formatting    * @throws KerberosDiagsFailure containing the formatted text    */
DECL|method|fail (String category, String message, Object... args)
specifier|private
name|void
name|fail
parameter_list|(
name|String
name|category
parameter_list|,
name|String
name|message
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
throws|throws
name|KerberosDiagsFailure
block|{
throw|throw
operator|new
name|KerberosDiagsFailure
argument_list|(
name|category
argument_list|,
name|message
argument_list|,
name|args
argument_list|)
throw|;
block|}
comment|/**    * Conditional failure with string formatted arguments    * @param condition failure condition    * @param category category for exception    * @param message string formatting message    * @param args any arguments for the formatting    * @throws KerberosDiagsFailure containing the formatted text    *         if the condition was met    */
DECL|method|failif (boolean condition, String category, String message, Object... args)
specifier|private
name|void
name|failif
parameter_list|(
name|boolean
name|condition
parameter_list|,
name|String
name|category
parameter_list|,
name|String
name|message
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
throws|throws
name|KerberosDiagsFailure
block|{
if|if
condition|(
name|condition
condition|)
block|{
name|fail
argument_list|(
name|category
argument_list|,
name|message
argument_list|,
name|args
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**    * Format a string, treating a call where there are no varags values    * as a string to pass through unformatted.    * @param message message, which is either a format string + args, or    * a general string    * @param args argument array    * @return a string for printing.    */
DECL|method|format (String message, Object... args)
specifier|public
specifier|static
name|String
name|format
parameter_list|(
name|String
name|message
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
block|{
if|if
condition|(
name|args
operator|.
name|length
operator|==
literal|0
condition|)
block|{
return|return
name|message
return|;
block|}
else|else
block|{
return|return
name|String
operator|.
name|format
argument_list|(
name|message
argument_list|,
name|args
argument_list|)
return|;
block|}
block|}
comment|/**    * Diagnostics failures return the exit code 41, "unauthorized".    *    * They have a category, initially for testing: the category can be    * validated without having to match on the entire string.    */
DECL|class|KerberosDiagsFailure
specifier|public
specifier|static
class|class
name|KerberosDiagsFailure
extends|extends
name|ExitUtil
operator|.
name|ExitException
block|{
DECL|field|category
specifier|private
specifier|final
name|String
name|category
decl_stmt|;
DECL|method|KerberosDiagsFailure (String category, String message)
specifier|public
name|KerberosDiagsFailure
parameter_list|(
name|String
name|category
parameter_list|,
name|String
name|message
parameter_list|)
block|{
name|super
argument_list|(
literal|41
argument_list|,
name|category
operator|+
literal|": "
operator|+
name|message
argument_list|)
expr_stmt|;
name|this
operator|.
name|category
operator|=
name|category
expr_stmt|;
block|}
DECL|method|KerberosDiagsFailure (String category, String message, Object... args)
specifier|public
name|KerberosDiagsFailure
parameter_list|(
name|String
name|category
parameter_list|,
name|String
name|message
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
block|{
name|this
argument_list|(
name|category
argument_list|,
name|format
argument_list|(
name|message
argument_list|,
name|args
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|KerberosDiagsFailure (String category, Throwable throwable, String message, Object... args)
specifier|public
name|KerberosDiagsFailure
parameter_list|(
name|String
name|category
parameter_list|,
name|Throwable
name|throwable
parameter_list|,
name|String
name|message
parameter_list|,
name|Object
modifier|...
name|args
parameter_list|)
block|{
name|this
argument_list|(
name|category
argument_list|,
name|message
argument_list|,
name|args
argument_list|)
expr_stmt|;
name|initCause
argument_list|(
name|throwable
argument_list|)
expr_stmt|;
block|}
DECL|method|getCategory ()
specifier|public
name|String
name|getCategory
parameter_list|()
block|{
return|return
name|category
return|;
block|}
block|}
block|}
end_class

end_unit

